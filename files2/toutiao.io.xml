<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>7889585cc166de54f40c77c5409a160a</guid>
<title>字节的分布式链路追踪实践，教科书式的搭建指南</title>
<link>https://toutiao.io/k/t6j66db</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-role=&quot;paragraph&quot;&gt;&lt;p&gt;&lt;span&gt;可观测性的三大基础数据是 Metrics / Log / Trace。说到这三大件，可能大家会想到当需要监控变化趋势和配置告警时就去用 Metrics；当需要细查问题时去查 log；对于微服务数量较多的系统，还得有 Trace，Trace 也可以看做一种标准结构化的 log，记录了很多固定字段，例如上下游调用关系和耗时，查看上下游调用关系或者请求耗时在链路各节点上的分布可以查看 Trace。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-backh=&quot;263&quot; data-backw=&quot;568&quot; data-ratio=&quot;0.46296296296296297&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ufWcjcomw8YGTBb1uYDiaUica5v0wQiaMIfWr660Gs6Xiaw2LDNX8dWWIAlWa0FnY3rEGt2s3WWYic5dia5KVHzKMKOw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;但是如果带着孤立的观点去用这些数据的话，数据的价值会大大降低。&lt;/span&gt;&lt;span&gt;举例一个常见的场景，通过 Metrics 得知某服务 SLA 降低，错误率上升，怎么去排查根因呢？&lt;/span&gt;&lt;span&gt;先去找错误日志吧，可是我看到的错误日志是不是真的和这个错误率上升有关系呢？&lt;/span&gt;&lt;span&gt;得翻翻代码看看这些错误日志都是哪里打出来的，代表什么意思。&lt;/span&gt;&lt;span&gt;再去找找有没有错误 Trace？&lt;/span&gt;&lt;span&gt;找出来的 Trace 也不太确定是不是和这个错误率上升有关系，还是得看代码确认下。&lt;/span&gt;&lt;span&gt;终于通过一行行的代码和数据比对，确认到这个错误是下一层服务返回给我的，把那个服务的负责人拉进来一起排查吧，然后这个群越拉越大，更多的人被拖进来一层一层地查下去，最终定位到是某个底层服务上线了一个变更导致 Panic，错误层层向上传播导致服务 SLA 降低。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;这个过程很不美好，需要工程师理解每一项数据的底层逻辑，才能充分利用它们去解决具体问题。而在复杂的大规模微服务系统中，没有单个工程师能够做到熟悉每一个微服务的底层逻辑，因此复杂微服务系统的排障和观测往往是一项有挑战的困难工作。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-role=&quot;paragraph&quot;&gt;&lt;p&gt;&lt;span&gt;如果所有微服务的监控数据都是遵循统一模型和语义规范并且天生高度关联的呢？&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在软件系统中，每秒钟有无数的 Context 在流动。这些 Context 可能是一个实时在线请求，也可能是一个异步处理任务。每个 Context 都会在多个微服务节点中持续传播才能最终完成。所有的监控数据（包括 Metric, Log 等）都源自于某一个 Context。Trace 就是这个 Context 的数据载体，通过标准化的数据模型，记录 Context 在多个微服务中的全部执行过程，并沿途关联上此 Context 上发生的所有事件（包括 Metric, Log 等）。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;再回到刚才那个 Case，当我们对某个 Metric 波动发生兴趣时，可以直接将造成此波动的 Trace 关联检索出来，然后查看这些 Trace 在各个微服务中的所有执行细节，发现是底层某个微服务在执行请求过程中发生了 Panic，这个错误不断向上传播导致了服务对外 SLA 下降。如果可观测平台做得更完善一些，将微服务的变更事件数据也呈现出来，那么一个工程师就可以快速完成整个排障和根因定位的过程，甚至不需要人，通过机器就可以自动完成整个排障和根因定位过程。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-backh=&quot;307&quot; data-backw=&quot;568&quot; data-ratio=&quot;0.5407407407407407&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ufWcjcomw8YGTBb1uYDiaUica5v0wQiaMIfVvYvZyhfLKmYIEzhmQKrnC84KP6OIWjicQn5u9TpqlzKQM4KOU5v5qQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Trace 不仅仅是用来查看耗时分布甘特图的工具，&lt;/span&gt;&lt;strong&gt;也是海量监控数据的 Context 链接纽带。&lt;/strong&gt;&lt;span&gt;基于可靠关联的 Metric / Trace / Log 数据，也构建出强大的可观测性能力，回答监控排障、SLO 调优、架构梳理、流量估算、智能化故障归因等众多复杂问题。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Trace 的采集以及跨服务进程的 Context 传递一般是由微服务框架等基础设施自动完成的，但是要实现最佳效果也需要所有研发工程师的理解和配合。研发工程师在编码的过程中应当有意识地在所有代码执行过程中持续传递 Context。比如在 Golang 中，context.Context 需要在所有函数调用中作为参数持续传递；在 Java 中，一般默认用 Threadlocal 作为 Context 的存储载体，但是如果有多线程或者异步的场景，则需要开发者自行对 Context 进行显式的传递，否则上下文就断了，难以实现有效的追踪和监控。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>2ce60dbb8caa4847374e9b5a9ff977c5</guid>
<title>带你十天轻松搞定 Go 微服务系列（五）</title>
<link>https://toutiao.io/k/gbgmo1e</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;序言&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们通过一个系列文章跟大家详细展示一个 go-zero 微服务示例，整个系列分十篇文章，目录结构如下：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;环境搭建：&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2ODU1MTI0OA==&amp;amp;mid=2247484868&amp;amp;idx=1&amp;amp;sn=5433385d138b292b893f3c200ad9da38&amp;amp;chksm=ceabdafbf9dc53ed3c42939ef25deb1ec8ddcfdb4729c2a1354e0a4d199ff08a74a4c22f10ba&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;带你十天轻松搞定 Go 微服务系列（一）&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;带你十天轻松搞定 Go 微服务系列（一）&lt;/a&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;服务拆分：&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2ODU1MTI0OA==&amp;amp;mid=2247484878&amp;amp;idx=1&amp;amp;sn=ecefc6a92ab56837fe56ab393bef9e6a&amp;amp;chksm=ceabdaf1f9dc53e77a1eebabec23d1ef26f52cbead7d57df0371379ef8fb514d5d17d29b2f8e&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;带你十天轻松搞定 Go 微服务系列（二）&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;带你十天轻松搞定 Go 微服务系列（二）&lt;/a&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;用户服务：&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2ODU1MTI0OA==&amp;amp;mid=2247484889&amp;amp;idx=1&amp;amp;sn=a72ed7c901ad88d38b8dd8d2e026d04b&amp;amp;chksm=ceabdae6f9dc53f09a71ee5975ea70f8f86f30e58571640dff5048eb469381d895591a5f80a1&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;带你十天轻松搞定 Go 微服务系列（三）&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;带你十天轻松搞定 Go 微服务系列（三）&lt;/a&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;产品服务：&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2ODU1MTI0OA==&amp;amp;mid=2247484895&amp;amp;idx=1&amp;amp;sn=9e9c4ae6b6f16916b6e18873a16627a4&amp;amp;chksm=ceabdae0f9dc53f61fdcdf0cc0f43baa94f00a51495d84088397b7297563e1a88d706371fcfd&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;带你十天轻松搞定 Go 微服务系列（四）&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;带你十天轻松搞定 Go 微服务系列（四）&lt;/a&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;订单服务（本文）&lt;/strong&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;支付服务&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;RPC 服务 Auth 验证&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;服务监控&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;链路追踪&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;分布式事务&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;期望通过本系列带你在本机利用 Docker 环境利用 go-zero 快速开发一个商城系统，让你快速上手微服务。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;完整示例代码：https://github.com/nivin-studio/go-zero-mall&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;首先，我们来看一下整体的服务拆分图：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7426376440460948&quot; data-type=&quot;png&quot; data-w=&quot;1562&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/UyIojWicPOg14JJTv6hB3iaXEicibvkjR8O40icG3UfGib9s9iaES7zLA7hgiax5zsicSAJOmNUEJYcMgPzIUoAQict9BvNA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;5 订单服务（order）&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ &lt;span&gt;cd&lt;/span&gt; mall/service/order&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;5.1 生成 order model 模型&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim model/order.sql&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;CREATE&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;`order`&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;`id`&lt;/span&gt; &lt;span&gt;bigint&lt;/span&gt; &lt;span&gt;unsigned&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; AUTO_INCREMENT,&lt;br/&gt; &lt;span&gt;`uid`&lt;/span&gt; &lt;span&gt;bigint&lt;/span&gt; &lt;span&gt;unsigned&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;&#x27;0&#x27;&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;用户ID&#x27;&lt;/span&gt;,&lt;br/&gt; &lt;span&gt;`pid`&lt;/span&gt; &lt;span&gt;bigint&lt;/span&gt; &lt;span&gt;unsigned&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;&#x27;0&#x27;&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;产品ID&#x27;&lt;/span&gt;,&lt;br/&gt; &lt;span&gt;`amount`&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;(&lt;span&gt;10&lt;/span&gt;) &lt;span&gt;unsigned&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;&#x27;0&#x27;&lt;/span&gt;  &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;订单金额&#x27;&lt;/span&gt;,&lt;br/&gt; &lt;span&gt;`status`&lt;/span&gt; &lt;span&gt;tinyint&lt;/span&gt;(&lt;span&gt;3&lt;/span&gt;) &lt;span&gt;unsigned&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;&#x27;0&#x27;&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;订单状态&#x27;&lt;/span&gt;,&lt;br/&gt; &lt;span&gt;`create_time`&lt;/span&gt; &lt;span&gt;timestamp&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;CURRENT_TIMESTAMP&lt;/span&gt;,&lt;br/&gt; &lt;span&gt;`update_time`&lt;/span&gt; &lt;span&gt;timestamp&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;CURRENT_TIMESTAMP&lt;/span&gt; &lt;span&gt;ON&lt;/span&gt; &lt;span&gt;UPDATE&lt;/span&gt; &lt;span&gt;CURRENT_TIMESTAMP&lt;/span&gt;,&lt;br/&gt; PRIMARY &lt;span&gt;KEY&lt;/span&gt; (&lt;span&gt;`id`&lt;/span&gt;),&lt;br/&gt; &lt;span&gt;KEY&lt;/span&gt; &lt;span&gt;`idx_uid`&lt;/span&gt; (&lt;span&gt;`uid`&lt;/span&gt;),&lt;br/&gt; &lt;span&gt;KEY&lt;/span&gt; &lt;span&gt;`idx_pid`&lt;/span&gt; (&lt;span&gt;`pid`&lt;/span&gt;)&lt;br/&gt;) &lt;span&gt;ENGINE&lt;/span&gt;=&lt;span&gt;InnoDB&lt;/span&gt;  &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;CHARSET&lt;/span&gt;=utf8mb4;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ goctl model mysql ddl -src ./model/order.sql -dir ./model -c&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;5.2 生成 order api 服务&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim api/order.api&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;// 订单创建&lt;/span&gt;&lt;br/&gt; CreateRequest {&lt;br/&gt;  Uid    &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;uid&quot;`&lt;/span&gt;&lt;br/&gt;  Pid    &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;pid&quot;`&lt;/span&gt;&lt;br/&gt;  Amount &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;amount&quot;`&lt;/span&gt;&lt;br/&gt;  Status &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;status&quot;`&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt; CreateResponse {&lt;br/&gt;  Id &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;id&quot;`&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;// 订单创建&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;// 订单修改&lt;/span&gt;&lt;br/&gt; UpdateRequest {&lt;br/&gt;  Id     &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;id&quot;`&lt;/span&gt;&lt;br/&gt;  Uid    &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;uid,optional&quot;`&lt;/span&gt;&lt;br/&gt;  Pid    &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;pid,optional&quot;`&lt;/span&gt;&lt;br/&gt;  Amount &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;amount,optional&quot;`&lt;/span&gt;&lt;br/&gt;  Status &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;status,optional&quot;`&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt; UpdateResponse {&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;// 订单修改&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;// 订单删除&lt;/span&gt;&lt;br/&gt; RemoveRequest {&lt;br/&gt;  Id &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;id&quot;`&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt; RemoveResponse {&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;// 订单删除&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;// 订单详情&lt;/span&gt;&lt;br/&gt; DetailRequest {&lt;br/&gt;  Id &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;id&quot;`&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt; DetailResponse {&lt;br/&gt;  Id     &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;id&quot;`&lt;/span&gt;&lt;br/&gt;  Uid    &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;uid&quot;`&lt;/span&gt;&lt;br/&gt;  Pid    &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;pid&quot;`&lt;/span&gt;&lt;br/&gt;  Amount &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;amount&quot;`&lt;/span&gt;&lt;br/&gt;  Status &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;status&quot;`&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;// 订单详情&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;// 订单列表&lt;/span&gt;&lt;br/&gt; ListRequest {&lt;br/&gt;  Uid &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;uid&quot;`&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt; ListResponse {&lt;br/&gt;  Id     &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;id&quot;`&lt;/span&gt;&lt;br/&gt;  Uid    &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;uid&quot;`&lt;/span&gt;&lt;br/&gt;  Pid    &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;pid&quot;`&lt;/span&gt;&lt;br/&gt;  Amount &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;amount&quot;`&lt;/span&gt;&lt;br/&gt;  Status &lt;span&gt;int64&lt;/span&gt; &lt;span&gt;`json:&quot;status&quot;`&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;// 订单列表&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;@server(&lt;br/&gt; jwt: Auth&lt;br/&gt;)&lt;br/&gt;service Order {&lt;br/&gt; @handler Create&lt;br/&gt; post /api/order/create(CreateRequest) returns (CreateResponse)&lt;br/&gt; &lt;br/&gt; @handler Update&lt;br/&gt; post /api/order/update(UpdateRequest) returns (UpdateResponse)&lt;br/&gt; &lt;br/&gt; @handler Remove&lt;br/&gt; post /api/order/remove(RemoveRequest) returns (RemoveResponse)&lt;br/&gt; &lt;br/&gt; @handler Detail&lt;br/&gt; post /api/order/detail(DetailRequest) returns (DetailResponse)&lt;br/&gt; &lt;br/&gt; @handler List&lt;br/&gt; post /api/order/list(ListRequest) returns (ListResponse)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ goctl api go -api ./api/order.api -dir ./api&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;5.3 生成 order rpc 服务&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/order.proto&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;syntax = &quot;proto3&quot;;&lt;br/&gt;&lt;br/&gt;package orderclient;&lt;br/&gt;&lt;br/&gt;option go_package = &quot;order&quot;;&lt;br/&gt;&lt;br/&gt;// 订单创建&lt;br/&gt;message CreateRequest {&lt;br/&gt;    int64 Uid = 1;&lt;br/&gt;    int64 Pid = 2;&lt;br/&gt;    int64 Amount = 3;&lt;br/&gt;    int64 Status = 4;&lt;br/&gt;}&lt;br/&gt;message CreateResponse {&lt;br/&gt;int64 id = 1;&lt;br/&gt;}&lt;br/&gt;// 订单创建&lt;br/&gt;&lt;br/&gt;// 订单修改&lt;br/&gt;message UpdateRequest {&lt;br/&gt;    int64 id = 1;&lt;br/&gt;    int64 Uid = 2;&lt;br/&gt;    int64 Pid = 3;&lt;br/&gt;    int64 Amount = 4;&lt;br/&gt;    int64 Status = 5;&lt;br/&gt;}&lt;br/&gt;message UpdateResponse {&lt;br/&gt;}&lt;br/&gt;// 订单修改&lt;br/&gt;&lt;br/&gt;// 订单删除&lt;br/&gt;message RemoveRequest {&lt;br/&gt;    int64 id = 1;&lt;br/&gt;}&lt;br/&gt;message RemoveResponse {&lt;br/&gt;}&lt;br/&gt;// 订单删除&lt;br/&gt;&lt;br/&gt;// 订单详情&lt;br/&gt;message DetailRequest {&lt;br/&gt;    int64 id = 1;&lt;br/&gt;}&lt;br/&gt;message DetailResponse {&lt;br/&gt;    int64 id = 1;&lt;br/&gt;    int64 Uid = 2;&lt;br/&gt;    int64 Pid = 3;&lt;br/&gt;    int64 Amount = 4;&lt;br/&gt;    int64 Status = 5;&lt;br/&gt;}&lt;br/&gt;// 订单详情&lt;br/&gt;&lt;br/&gt;// 订单列表&lt;br/&gt;message ListRequest {&lt;br/&gt;    int64 uid = 1;&lt;br/&gt;}&lt;br/&gt;message ListResponse {&lt;br/&gt;    repeated DetailResponse data = 1;&lt;br/&gt;}&lt;br/&gt;// 订单列表&lt;br/&gt;&lt;br/&gt;// 订单支付&lt;br/&gt;message PaidRequest {&lt;br/&gt;    int64 id = 1;&lt;br/&gt;}&lt;br/&gt;message PaidResponse {&lt;br/&gt;}&lt;br/&gt;// 订单支付&lt;br/&gt;&lt;br/&gt;service Order {&lt;br/&gt;    rpc Create(CreateRequest) returns(CreateResponse);&lt;br/&gt;    rpc Update(UpdateRequest) returns(UpdateResponse);&lt;br/&gt;    rpc Remove(RemoveRequest) returns(RemoveResponse);&lt;br/&gt;    rpc Detail(DetailRequest) returns(DetailResponse);&lt;br/&gt;    rpc List(ListRequest) returns(ListResponse);&lt;br/&gt;    rpc Paid(PaidRequest) returns(PaidResponse);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ goctl rpc proto -src ./rpc/order.proto -dir ./rpc&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;5.4 编写 order rpc 服务&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.4.1 修改配置文件&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/etc/order.yaml&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;修改服务监听地址，端口号为0.0.0.0:9002，&lt;code&gt;Etcd&lt;/code&gt; 服务配置，&lt;code&gt;Mysql&lt;/code&gt; 服务配置，&lt;code&gt;CacheRedis&lt;/code&gt; 服务配置&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;Name:&lt;/span&gt; &lt;span&gt;order.rpc&lt;/span&gt;&lt;br/&gt;&lt;span&gt;ListenOn:&lt;/span&gt; &lt;span&gt;0.0&lt;/span&gt;&lt;span&gt;.0&lt;/span&gt;&lt;span&gt;.0&lt;/span&gt;&lt;span&gt;:9002&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;Etcd:&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Hosts:&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;-&lt;/span&gt; &lt;span&gt;etcd:2379&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Key:&lt;/span&gt; &lt;span&gt;order.rpc&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;Mysql:&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;DataSource:&lt;/span&gt; &lt;span&gt;root:123456@tcp(mysql:3306)/mall?charset=utf8mb4&amp;amp;parseTime=true&amp;amp;loc=Asia%2FShanghai&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;CacheRedis:&lt;/span&gt;&lt;br/&gt;&lt;span&gt;-&lt;/span&gt; &lt;span&gt;Host:&lt;/span&gt; &lt;span&gt;redis:6379&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Type:&lt;/span&gt; &lt;span&gt;node&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Pass:&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.4.2 添加 order model 依赖&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;添加 &lt;code&gt;Mysql&lt;/code&gt; 服务配置，&lt;code&gt;CacheRedis&lt;/code&gt; 服务配置的实例化&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/internal/config/config.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; config&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/stores/cache&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/zrpc&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; Config &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; zrpc.RpcServerConf&lt;br/&gt;&lt;br/&gt; Mysql &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt;  DataSource &lt;span&gt;string&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt;    &lt;br/&gt; CacheRedis cache.CacheConf&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/internal/svc/servicecontext.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; svc&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/model&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/internal/config&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/stores/sqlx&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; ServiceContext &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; Config config.Config&lt;br/&gt;&lt;br/&gt; OrderModel model.OrderModel&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewServiceContext&lt;/span&gt;&lt;span&gt;(c config.Config)&lt;/span&gt; *&lt;span&gt;ServiceContext&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; conn := sqlx.NewMysql(c.Mysql.DataSource)&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;ServiceContext{&lt;br/&gt;  Config:     c,&lt;br/&gt;  OrderModel: model.NewOrderModel(conn, c.CacheRedis),&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.4.3 添加 user rpc，product rpc 依赖&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;添加 &lt;code&gt;user rpc, product rpc&lt;/code&gt; 服务配置&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/etc/order.yaml&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;Name:&lt;/span&gt; &lt;span&gt;order.rpc&lt;/span&gt;&lt;br/&gt;&lt;span&gt;ListenOn:&lt;/span&gt; &lt;span&gt;0.0&lt;/span&gt;&lt;span&gt;.0&lt;/span&gt;&lt;span&gt;.0&lt;/span&gt;&lt;span&gt;:9002&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Etcd:&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Hosts:&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;-&lt;/span&gt; &lt;span&gt;etcd:2379&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Key:&lt;/span&gt; &lt;span&gt;order.rpc&lt;/span&gt;&lt;br/&gt;  &lt;br/&gt;&lt;span&gt;......&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;UserRpc:&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Etcd:&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;Hosts:&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;-&lt;/span&gt; &lt;span&gt;etcd:2379&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;Key:&lt;/span&gt; &lt;span&gt;user.rpc&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;ProductRpc:&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Etcd:&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;Hosts:&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;-&lt;/span&gt; &lt;span&gt;etcd:2379&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;Key:&lt;/span&gt; &lt;span&gt;product.rpc&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;添加 &lt;code&gt;user rpc, product rpc&lt;/code&gt; 服务配置的实例化&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/internal/config/config.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; config&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/stores/cache&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/zrpc&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; Config &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; zrpc.RpcServerConf&lt;br/&gt;&lt;br/&gt; Mysql &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt;  DataSource &lt;span&gt;string&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt;    &lt;br/&gt; CacheRedis cache.CacheConf&lt;br/&gt;&lt;br/&gt; UserRpc    zrpc.RpcClientConf&lt;br/&gt; ProductRpc zrpc.RpcClientConf&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;注册服务上下文 &lt;code&gt;user rpc, product rpc&lt;/code&gt; 的依赖&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/internal/svc/servicecontext.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; svc&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/model&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/internal/config&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/product/rpc/productclient&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/user/rpc/userclient&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/stores/sqlx&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/zrpc&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; ServiceContext &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; Config config.Config&lt;br/&gt;&lt;br/&gt; OrderModel model.OrderModel&lt;br/&gt;&lt;br/&gt; UserRpc    userclient.User&lt;br/&gt; ProductRpc productclient.Product&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewServiceContext&lt;/span&gt;&lt;span&gt;(c config.Config)&lt;/span&gt; *&lt;span&gt;ServiceContext&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; conn := sqlx.NewMysql(c.Mysql.DataSource)&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;ServiceContext{&lt;br/&gt;  Config:     c,&lt;br/&gt;  OrderModel: model.NewOrderModel(conn, c.CacheRedis),&lt;br/&gt;  UserRpc:    userclient.NewUser(zrpc.MustNewClient(c.UserRpc)),&lt;br/&gt;  ProductRpc: productclient.NewProduct(zrpc.MustNewClient(c.ProductRpc)),&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.4.4 添加订单创建逻辑 Create&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;订单创建流程，通过调用 &lt;code&gt;user rpc&lt;/code&gt; 服务查询验证用户是否存在，再通过调用 &lt;code&gt;product rpc&lt;/code&gt; 服务查询验证产品是否存在，以及判断产品库存是否充足。验证通过后，创建用户订单，并通过调用 &lt;code&gt;product rpc&lt;/code&gt; 服务更新产品库存。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/internal/logic/createlogic.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; logic&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/model&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/internal/svc&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/order&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/product/rpc/product&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/user/rpc/user&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/logx&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;google.golang.org/grpc/status&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; CreateLogic &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; ctx    context.Context&lt;br/&gt; svcCtx *svc.ServiceContext&lt;br/&gt; logx.Logger&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewCreateLogic&lt;/span&gt;&lt;span&gt;(ctx context.Context, svcCtx *svc.ServiceContext)&lt;/span&gt; *&lt;span&gt;CreateLogic&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;CreateLogic{&lt;br/&gt;  ctx:    ctx,&lt;br/&gt;  svcCtx: svcCtx,&lt;br/&gt;  Logger: logx.WithContext(ctx),&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(l *CreateLogic)&lt;/span&gt; &lt;span&gt;Create&lt;/span&gt;&lt;span&gt;(in *order.CreateRequest)&lt;/span&gt; &lt;span&gt;(*order.CreateResponse, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;// 查询用户是否存在&lt;/span&gt;&lt;br/&gt; _, err := l.svcCtx.UserRpc.UserInfo(l.ctx, &amp;amp;user.UserInfoRequest{&lt;br/&gt;  Id: in.Uid,&lt;br/&gt; })&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, err&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;// 查询产品是否存在&lt;/span&gt;&lt;br/&gt; productRes, err := l.svcCtx.ProductRpc.Detail(l.ctx, &amp;amp;product.DetailRequest{&lt;br/&gt;  Id: in.Pid,&lt;br/&gt; })&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, err&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;// 判断产品库存是否充足&lt;/span&gt;&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; productRes.Stock &amp;lt;= &lt;span&gt;0&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;500&lt;/span&gt;, &lt;span&gt;&quot;产品库存不足&quot;&lt;/span&gt;)&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; newOrder := model.Order{&lt;br/&gt;  Uid:    in.Uid,&lt;br/&gt;  Pid:    in.Pid,&lt;br/&gt;  Amount: in.Amount,&lt;br/&gt;  Status: &lt;span&gt;0&lt;/span&gt;,&lt;br/&gt; }&lt;br/&gt;        &lt;span&gt;// 创建订单&lt;/span&gt;&lt;br/&gt; res, err := l.svcCtx.OrderModel.Insert(&amp;amp;newOrder)&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;500&lt;/span&gt;, err.Error())&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; newOrder.Id, err = res.LastInsertId()&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;500&lt;/span&gt;, err.Error())&lt;br/&gt; }&lt;br/&gt;        &lt;span&gt;// 更新产品库存&lt;/span&gt;&lt;br/&gt; _, err = l.svcCtx.ProductRpc.Update(l.ctx, &amp;amp;product.UpdateRequest{&lt;br/&gt;  Id:     productRes.Id,&lt;br/&gt;  Name:   productRes.Name,&lt;br/&gt;  Desc:   productRes.Desc,&lt;br/&gt;                Stock:  productRes.Stock - &lt;span&gt;1&lt;/span&gt;,&lt;br/&gt;  Amount: productRes.Amount,&lt;br/&gt;  Status: productRes.Status,&lt;br/&gt; })&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, err&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;order.CreateResponse{&lt;br/&gt;  Id: newOrder.Id,&lt;br/&gt; }, &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;!注意：这里的产品库存更新存在数据一致性问题，在以往的项目中我们会使用数据库的事务进行这一系列的操作来保证数据的一致性。但是因为我们这边把“订单”和“产品”分成了不同的微服务，在实际的项目中他们可能拥有不同的数据库，所以我们要考虑在跨服务的情况下还能保证数据的一致性，这就涉及到了分布式事务的使用，在后面的章节中我们将介绍使用分布式事务来修改这个下单的逻辑。&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.4.5 添加订单详情逻辑 Detail&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/internal/logic/detaillogic.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; logic&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/model&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/internal/svc&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/order&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/logx&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;google.golang.org/grpc/status&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; DetailLogic &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; ctx    context.Context&lt;br/&gt; svcCtx *svc.ServiceContext&lt;br/&gt; logx.Logger&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewDetailLogic&lt;/span&gt;&lt;span&gt;(ctx context.Context, svcCtx *svc.ServiceContext)&lt;/span&gt; *&lt;span&gt;DetailLogic&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;DetailLogic{&lt;br/&gt;  ctx:    ctx,&lt;br/&gt;  svcCtx: svcCtx,&lt;br/&gt;  Logger: logx.WithContext(ctx),&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(l *DetailLogic)&lt;/span&gt; &lt;span&gt;Detail&lt;/span&gt;&lt;span&gt;(in *order.DetailRequest)&lt;/span&gt; &lt;span&gt;(*order.DetailResponse, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;// 查询订单是否存在&lt;/span&gt;&lt;br/&gt; res, err := l.svcCtx.OrderModel.FindOne(in.Id)&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; err == model.ErrNotFound {&lt;br/&gt;   &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;100&lt;/span&gt;, &lt;span&gt;&quot;订单不存在&quot;&lt;/span&gt;)&lt;br/&gt;  }&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;500&lt;/span&gt;, err.Error())&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;order.DetailResponse{&lt;br/&gt;  Id:     res.Id,&lt;br/&gt;  Uid:    res.Uid,&lt;br/&gt;  Pid:    res.Pid,&lt;br/&gt;  Amount: res.Amount,&lt;br/&gt;  Status: res.Status,&lt;br/&gt; }, &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.4.6 添加订单更新逻辑 Update&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/internal/logic/updatelogic.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; logic&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/model&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/internal/svc&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/order&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/logx&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;google.golang.org/grpc/status&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; UpdateLogic &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; ctx    context.Context&lt;br/&gt; svcCtx *svc.ServiceContext&lt;br/&gt; logx.Logger&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewUpdateLogic&lt;/span&gt;&lt;span&gt;(ctx context.Context, svcCtx *svc.ServiceContext)&lt;/span&gt; *&lt;span&gt;UpdateLogic&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;UpdateLogic{&lt;br/&gt;  ctx:    ctx,&lt;br/&gt;  svcCtx: svcCtx,&lt;br/&gt;  Logger: logx.WithContext(ctx),&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(l *UpdateLogic)&lt;/span&gt; &lt;span&gt;Update&lt;/span&gt;&lt;span&gt;(in *order.UpdateRequest)&lt;/span&gt; &lt;span&gt;(*order.UpdateResponse, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;// 查询订单是否存在&lt;/span&gt;&lt;br/&gt; res, err := l.svcCtx.OrderModel.FindOne(in.Id)&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; err == model.ErrNotFound {&lt;br/&gt;   &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;100&lt;/span&gt;, &lt;span&gt;&quot;订单不存在&quot;&lt;/span&gt;)&lt;br/&gt;  }&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;500&lt;/span&gt;, err.Error())&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; in.Uid != &lt;span&gt;0&lt;/span&gt; {&lt;br/&gt;  res.Uid = in.Uid&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; in.Pid != &lt;span&gt;0&lt;/span&gt; {&lt;br/&gt;  res.Pid = in.Pid&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; in.Amount != &lt;span&gt;0&lt;/span&gt; {&lt;br/&gt;  res.Amount = in.Amount&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; in.Status != &lt;span&gt;0&lt;/span&gt; {&lt;br/&gt;  res.Status = in.Status&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; err = l.svcCtx.OrderModel.Update(res)&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;500&lt;/span&gt;, err.Error())&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;order.UpdateResponse{}, &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.4.7 添加订单删除逻辑 Remove&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/internal/logic/removelogic.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; logic&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/model&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/internal/svc&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/order&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/logx&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;google.golang.org/grpc/status&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; RemoveLogic &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; ctx    context.Context&lt;br/&gt; svcCtx *svc.ServiceContext&lt;br/&gt; logx.Logger&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewRemoveLogic&lt;/span&gt;&lt;span&gt;(ctx context.Context, svcCtx *svc.ServiceContext)&lt;/span&gt; *&lt;span&gt;RemoveLogic&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;RemoveLogic{&lt;br/&gt;  ctx:    ctx,&lt;br/&gt;  svcCtx: svcCtx,&lt;br/&gt;  Logger: logx.WithContext(ctx),&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(l *RemoveLogic)&lt;/span&gt; &lt;span&gt;Remove&lt;/span&gt;&lt;span&gt;(in *order.RemoveRequest)&lt;/span&gt; &lt;span&gt;(*order.RemoveResponse, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;// 查询订单是否存在&lt;/span&gt;&lt;br/&gt; res, err := l.svcCtx.OrderModel.FindOne(in.Id)&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; err == model.ErrNotFound {&lt;br/&gt;   &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;100&lt;/span&gt;, &lt;span&gt;&quot;订单不存在&quot;&lt;/span&gt;)&lt;br/&gt;  }&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;500&lt;/span&gt;, err.Error())&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; err = l.svcCtx.OrderModel.Delete(res.Id)&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;500&lt;/span&gt;, err.Error())&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;order.RemoveResponse{}, &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.4.8 添加订单列表逻辑 List&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;添加根据 &lt;code&gt;uid&lt;/code&gt; 查询用户所有订单的 &lt;code&gt;OrderModel&lt;/code&gt; 方法 &lt;code&gt;FindAllByUid&lt;/code&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim model/ordermodel.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; model&lt;br/&gt;&lt;br/&gt;......&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; (&lt;br/&gt; OrderModel &lt;span&gt;interface&lt;/span&gt; {&lt;br/&gt;  Insert(data *Order) (sql.Result, error)&lt;br/&gt;  FindOne(id &lt;span&gt;int64&lt;/span&gt;) (*Order, error)&lt;br/&gt;  FindAllByUid(uid &lt;span&gt;int64&lt;/span&gt;) ([]*Order, error)&lt;br/&gt;  Update(data *Order) error&lt;br/&gt;  Delete(id &lt;span&gt;int64&lt;/span&gt;) error&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; ......&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;......&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(m *defaultOrderModel)&lt;/span&gt; &lt;span&gt;FindAllByUid&lt;/span&gt;&lt;span&gt;(uid &lt;span&gt;int64&lt;/span&gt;)&lt;/span&gt; &lt;span&gt;([]*Order, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; resp []*Order&lt;br/&gt;&lt;br/&gt; query := fmt.Sprintf(&lt;span&gt;&quot;select %s from %s where `uid` = ?&quot;&lt;/span&gt;, orderRows, m.table)&lt;br/&gt; err := m.QueryRowsNoCache(&amp;amp;resp, query, uid)&lt;br/&gt;&lt;br/&gt; &lt;span&gt;switch&lt;/span&gt; err {&lt;br/&gt; &lt;span&gt;case&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;:&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; resp, &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt; &lt;span&gt;case&lt;/span&gt; sqlc.ErrNotFound:&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, ErrNotFound&lt;br/&gt; &lt;span&gt;default&lt;/span&gt;:&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, err&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;......&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/internal/logic/listlogic.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; logic&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/model&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/internal/svc&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/order&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/user/rpc/user&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/logx&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;google.golang.org/grpc/status&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; ListLogic &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; ctx    context.Context&lt;br/&gt; svcCtx *svc.ServiceContext&lt;br/&gt; logx.Logger&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewListLogic&lt;/span&gt;&lt;span&gt;(ctx context.Context, svcCtx *svc.ServiceContext)&lt;/span&gt; *&lt;span&gt;ListLogic&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;ListLogic{&lt;br/&gt;  ctx:    ctx,&lt;br/&gt;  svcCtx: svcCtx,&lt;br/&gt;  Logger: logx.WithContext(ctx),&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(l *ListLogic)&lt;/span&gt; &lt;span&gt;List&lt;/span&gt;&lt;span&gt;(in *order.ListRequest)&lt;/span&gt; &lt;span&gt;(*order.ListResponse, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;// 查询用户是否存在&lt;/span&gt;&lt;br/&gt; _, err := l.svcCtx.UserRpc.UserInfo(l.ctx, &amp;amp;user.UserInfoRequest{&lt;br/&gt;  Id: in.Uid,&lt;br/&gt; })&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, err&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;// 查询订单是否存在&lt;/span&gt;&lt;br/&gt; list, err := l.svcCtx.OrderModel.FindAllByUid(in.Uid)&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; err == model.ErrNotFound {&lt;br/&gt;   &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;100&lt;/span&gt;, &lt;span&gt;&quot;订单不存在&quot;&lt;/span&gt;)&lt;br/&gt;  }&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;500&lt;/span&gt;, err.Error())&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; orderList := &lt;span&gt;make&lt;/span&gt;([]*order.DetailResponse, &lt;span&gt;0&lt;/span&gt;)&lt;br/&gt; &lt;span&gt;for&lt;/span&gt; _, item := &lt;span&gt;range&lt;/span&gt; list {&lt;br/&gt;  orderList = &lt;span&gt;append&lt;/span&gt;(orderList, &amp;amp;order.DetailResponse{&lt;br/&gt;   Id:     item.Id,&lt;br/&gt;   Uid:    item.Uid,&lt;br/&gt;   Pid:    item.Pid,&lt;br/&gt;   Amount: item.Amount,&lt;br/&gt;   Status: item.Status,&lt;br/&gt;  })&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;order.ListResponse{&lt;br/&gt;  Data: orderList,&lt;br/&gt; }, &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.4.9 添加订单支付逻辑 Paid&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim rpc/internal/logic/paidlogic.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; logic&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/model&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/internal/svc&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/order&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/logx&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;google.golang.org/grpc/status&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; PaidLogic &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; ctx    context.Context&lt;br/&gt; svcCtx *svc.ServiceContext&lt;br/&gt; logx.Logger&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewPaidLogic&lt;/span&gt;&lt;span&gt;(ctx context.Context, svcCtx *svc.ServiceContext)&lt;/span&gt; *&lt;span&gt;PaidLogic&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;PaidLogic{&lt;br/&gt;  ctx:    ctx,&lt;br/&gt;  svcCtx: svcCtx,&lt;br/&gt;  Logger: logx.WithContext(ctx),&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(l *PaidLogic)&lt;/span&gt; &lt;span&gt;Paid&lt;/span&gt;&lt;span&gt;(in *order.PaidRequest)&lt;/span&gt; &lt;span&gt;(*order.PaidResponse, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;// 查询订单是否存在&lt;/span&gt;&lt;br/&gt; res, err := l.svcCtx.OrderModel.FindOne(in.Id)&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; err == model.ErrNotFound {&lt;br/&gt;   &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;100&lt;/span&gt;, &lt;span&gt;&quot;订单不存在&quot;&lt;/span&gt;)&lt;br/&gt;  }&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;500&lt;/span&gt;, err.Error())&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; res.Status = &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; err = l.svcCtx.OrderModel.Update(res)&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, status.Error(&lt;span&gt;500&lt;/span&gt;, err.Error())&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;order.PaidResponse{}, &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;5.5 编写 order api 服务&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.5.1 修改配置文件&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim api/etc/order.yaml&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;修改服务地址，端口号为0.0.0.0:8002，&lt;code&gt;Mysql&lt;/code&gt; 服务配置，&lt;code&gt;CacheRedis&lt;/code&gt; 服务配置，&lt;code&gt;Auth&lt;/code&gt; 验证配置&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;Name:&lt;/span&gt; &lt;span&gt;Order&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Host:&lt;/span&gt; &lt;span&gt;0.0&lt;/span&gt;&lt;span&gt;.0&lt;/span&gt;&lt;span&gt;.0&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Port:&lt;/span&gt; &lt;span&gt;8002&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;Mysql:&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;DataSource:&lt;/span&gt; &lt;span&gt;root:123456@tcp(mysql:3306)/mall?charset=utf8mb4&amp;amp;parseTime=true&amp;amp;loc=Asia%2FShanghai&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;CacheRedis:&lt;/span&gt;&lt;br/&gt;&lt;span&gt;-&lt;/span&gt; &lt;span&gt;Host:&lt;/span&gt; &lt;span&gt;redis:6379&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Type:&lt;/span&gt; &lt;span&gt;node&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Pass:&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;Auth:&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;AccessSecret:&lt;/span&gt; &lt;span&gt;uOvKLmVfztaXGpNYd4Z0I1SiT7MweJhl&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;AccessExpire:&lt;/span&gt; &lt;span&gt;86400&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.5.2 添加 order rpc 依赖&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim api/etc/order.yaml&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;Name:&lt;/span&gt; &lt;span&gt;Order&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Host:&lt;/span&gt; &lt;span&gt;0.0&lt;/span&gt;&lt;span&gt;.0&lt;/span&gt;&lt;span&gt;.0&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Port:&lt;/span&gt; &lt;span&gt;8002&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;......&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;OrderRpc:&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Etcd:&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;Hosts:&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;-&lt;/span&gt; &lt;span&gt;etcd:2379&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;Key:&lt;/span&gt; &lt;span&gt;order.rpc&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim api/internal/config/config.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; config&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/rest&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/zrpc&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; Config &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; rest.RestConf&lt;br/&gt;&lt;br/&gt; Auth &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt;  AccessSecret &lt;span&gt;string&lt;/span&gt;&lt;br/&gt;  AccessExpire &lt;span&gt;int64&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; OrderRpc zrpc.RpcClientConf&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim api/internal/svc/servicecontext.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; svc&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/api/internal/config&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/orderclient&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/zrpc&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; ServiceContext &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; Config config.Config&lt;br/&gt;&lt;br/&gt; OrderRpc orderclient.Order&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewServiceContext&lt;/span&gt;&lt;span&gt;(c config.Config)&lt;/span&gt; *&lt;span&gt;ServiceContext&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;ServiceContext{&lt;br/&gt;  Config:   c,&lt;br/&gt;  OrderRpc: orderclient.NewOrder(zrpc.MustNewClient(c.OrderRpc)),&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.5.3 添加订单创建逻辑 Create&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim api/internal/logic/createlogic.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; logic&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/api/internal/svc&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/api/internal/types&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/orderclient&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/logx&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; CreateLogic &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; logx.Logger&lt;br/&gt; ctx    context.Context&lt;br/&gt; svcCtx *svc.ServiceContext&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewCreateLogic&lt;/span&gt;&lt;span&gt;(ctx context.Context, svcCtx *svc.ServiceContext)&lt;/span&gt; &lt;span&gt;CreateLogic&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; CreateLogic{&lt;br/&gt;  Logger: logx.WithContext(ctx),&lt;br/&gt;  ctx:    ctx,&lt;br/&gt;  svcCtx: svcCtx,&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(l *CreateLogic)&lt;/span&gt; &lt;span&gt;Create&lt;/span&gt;&lt;span&gt;(req types.CreateRequest)&lt;/span&gt; &lt;span&gt;(resp *types.CreateResponse, err error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; res, err := l.svcCtx.OrderRpc.Create(l.ctx, &amp;amp;orderclient.CreateRequest{&lt;br/&gt;  Uid:    req.Uid,&lt;br/&gt;  Pid:    req.Pid,&lt;br/&gt;  Amount: req.Amount,&lt;br/&gt;  Status: req.Status,&lt;br/&gt; })&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, err&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;types.CreateResponse{&lt;br/&gt;  Id: res.Id,&lt;br/&gt; }, &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.5.4 添加订单详情逻辑 Detail&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim api/internal/logic/detaillogic.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; logic&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/api/internal/svc&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/api/internal/types&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/orderclient&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/logx&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; DetailLogic &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; logx.Logger&lt;br/&gt; ctx    context.Context&lt;br/&gt; svcCtx *svc.ServiceContext&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewDetailLogic&lt;/span&gt;&lt;span&gt;(ctx context.Context, svcCtx *svc.ServiceContext)&lt;/span&gt; &lt;span&gt;DetailLogic&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; DetailLogic{&lt;br/&gt;  Logger: logx.WithContext(ctx),&lt;br/&gt;  ctx:    ctx,&lt;br/&gt;  svcCtx: svcCtx,&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(l *DetailLogic)&lt;/span&gt; &lt;span&gt;Detail&lt;/span&gt;&lt;span&gt;(req types.DetailRequest)&lt;/span&gt; &lt;span&gt;(resp *types.DetailResponse, err error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; res, err := l.svcCtx.OrderRpc.Detail(l.ctx, &amp;amp;orderclient.DetailRequest{&lt;br/&gt;  Id: req.Id,&lt;br/&gt; })&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, err&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;types.DetailResponse{&lt;br/&gt;  Id:     res.Id,&lt;br/&gt;  Uid:    res.Uid,&lt;br/&gt;  Pid:    res.Pid,&lt;br/&gt;  Amount: res.Amount,&lt;br/&gt;  Status: res.Status,&lt;br/&gt; }, &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.5.5 添加订单更新逻辑 Update&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim api/internal/logic/updatelogic.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; logic&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/api/internal/svc&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/api/internal/types&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/orderclient&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/logx&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; UpdateLogic &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; logx.Logger&lt;br/&gt; ctx    context.Context&lt;br/&gt; svcCtx *svc.ServiceContext&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewUpdateLogic&lt;/span&gt;&lt;span&gt;(ctx context.Context, svcCtx *svc.ServiceContext)&lt;/span&gt; &lt;span&gt;UpdateLogic&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; UpdateLogic{&lt;br/&gt;  Logger: logx.WithContext(ctx),&lt;br/&gt;  ctx:    ctx,&lt;br/&gt;  svcCtx: svcCtx,&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(l *UpdateLogic)&lt;/span&gt; &lt;span&gt;Update&lt;/span&gt;&lt;span&gt;(req types.UpdateRequest)&lt;/span&gt; &lt;span&gt;(resp *types.UpdateResponse, err error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; _, err = l.svcCtx.OrderRpc.Update(l.ctx, &amp;amp;orderclient.UpdateRequest{&lt;br/&gt;  Id:     req.Id,&lt;br/&gt;  Uid:    req.Uid,&lt;br/&gt;  Pid:    req.Pid,&lt;br/&gt;  Amount: req.Amount,&lt;br/&gt;  Status: req.Status,&lt;br/&gt; })&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, err&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;types.UpdateResponse{}, &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.5.6 添加订单删除逻辑 Remove&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim api/internal/logic/removelogic.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; logic&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/api/internal/svc&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/api/internal/types&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/orderclient&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/logx&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; RemoveLogic &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; logx.Logger&lt;br/&gt; ctx    context.Context&lt;br/&gt; svcCtx *svc.ServiceContext&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewRemoveLogic&lt;/span&gt;&lt;span&gt;(ctx context.Context, svcCtx *svc.ServiceContext)&lt;/span&gt; &lt;span&gt;RemoveLogic&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; RemoveLogic{&lt;br/&gt;  Logger: logx.WithContext(ctx),&lt;br/&gt;  ctx:    ctx,&lt;br/&gt;  svcCtx: svcCtx,&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(l *RemoveLogic)&lt;/span&gt; &lt;span&gt;Remove&lt;/span&gt;&lt;span&gt;(req types.RemoveRequest)&lt;/span&gt; &lt;span&gt;(resp *types.RemoveResponse, err error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; _, err = l.svcCtx.OrderRpc.Remove(l.ctx, &amp;amp;orderclient.RemoveRequest{&lt;br/&gt;  Id: req.Id,&lt;br/&gt; })&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, err&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; &amp;amp;types.RemoveResponse{}, &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;5.5.7 添加订单列表逻辑 List&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ vim api/internal/logic/listlogic.go&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; logic&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/api/internal/svc&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/api/internal/types&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;mall/service/order/rpc/orderclient&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;&quot;github.com/tal-tech/go-zero/core/logx&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; ListLogic &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; logx.Logger&lt;br/&gt; ctx    context.Context&lt;br/&gt; svcCtx *svc.ServiceContext&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewListLogic&lt;/span&gt;&lt;span&gt;(ctx context.Context, svcCtx *svc.ServiceContext)&lt;/span&gt; &lt;span&gt;ListLogic&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; ListLogic{&lt;br/&gt;  Logger: logx.WithContext(ctx),&lt;br/&gt;  ctx:    ctx,&lt;br/&gt;  svcCtx: svcCtx,&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(l *ListLogic)&lt;/span&gt; &lt;span&gt;List&lt;/span&gt;&lt;span&gt;(req types.ListRequest)&lt;/span&gt; &lt;span&gt;(resp []*types.ListResponse, err error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; res, err := l.svcCtx.OrderRpc.List(l.ctx, &amp;amp;orderclient.ListRequest{&lt;br/&gt;  Uid: req.Uid,&lt;br/&gt; })&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; err != &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt;, err&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; orderList := &lt;span&gt;make&lt;/span&gt;([]*types.ListResponse, &lt;span&gt;0&lt;/span&gt;)&lt;br/&gt; &lt;span&gt;for&lt;/span&gt; _, item := &lt;span&gt;range&lt;/span&gt; res.Data {&lt;br/&gt;  orderList = &lt;span&gt;append&lt;/span&gt;(orderList, &amp;amp;types.ListResponse{&lt;br/&gt;   Id:     item.Id,&lt;br/&gt;   Uid:    item.Uid,&lt;br/&gt;   Pid:    item.Pid,&lt;br/&gt;   Amount: item.Amount,&lt;br/&gt;   Status: item.Status,&lt;br/&gt;  })&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; orderList, &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;5.6 启动 order rpc 服务&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;!提示：启动服务需要在 &lt;code&gt;golang&lt;/code&gt; 容器中启动&lt;/p&gt;&lt;/blockquote&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ &lt;span&gt;cd&lt;/span&gt; mall/service/order/rpc&lt;br/&gt;$ go run order.go -f etc/order.yaml&lt;br/&gt;Starting rpc server at 127.0.0.1:9002...&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;5.7 启动 order api 服务&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;!提示：启动服务需要在 &lt;code&gt;golang&lt;/code&gt; 容器中启动&lt;/p&gt;&lt;/blockquote&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;$ &lt;span&gt;cd&lt;/span&gt; mall/service/order/api&lt;br/&gt;$ go run order.go -f etc/order.yaml&lt;br/&gt;Starting server at 0.0.0.0:8002...&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;项目地址&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;https://github.com/zeromicro/go-zero&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;欢迎使用 &lt;code&gt;go-zero&lt;/code&gt; 并 &lt;strong&gt;star&lt;/strong&gt; 支持我们！&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;微信交流群&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;关注『&lt;strong&gt;微服务实践&lt;/strong&gt;』公众号并点击 &lt;strong&gt;交流群&lt;/strong&gt; 获取社区群二维码。&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>81b6b12666ec002117c6f1e1e632f71f</guid>
<title>美团技术年货：1200+页电子书，覆盖前后端、算法、数据、安全、测试、顶会论文</title>
<link>https://toutiao.io/k/jios3ly</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;578&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;48&quot; data-ratio=&quot;0.10078125&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsUrXicw2VXTQTVVN5yxXWEacdY1ZdxTH195Pgibtib8EENJRMia3tzEnyVfgyfAgRibMssKqwlE186TLSw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-backh=&quot;248&quot; data-backw=&quot;578&quot; data-ratio=&quot;0.428169014084507&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/hEx03cFgUsVQzA23lA1tpn9DXNcuy7Uia6E2nXN7RjjVXUg2VCibqXGibjvZYvw1ibYduzUcQ6XebOKCNntpHc9ZWg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1065&quot;/&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;section&gt;&lt;span&gt;新年将至，年味渐浓。虽然疫情的阴霾还没彻底消散，但是相信很多人都对2022年的春天充满了期待。期待春暖花开，期待国泰民安，期待能早一天在阳光下自由地呼吸。&lt;/span&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;老规矩，一年一度的美团技术年货如期而至。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;在2022年春节到来之际，我们精选过去一年公众号50多篇技术文章以及20多篇国际顶会论文，整理制作成一本厚达1200多页的电子书，作为新年礼物赠送给大家。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;这本电子书内容覆盖前端、后端、算法、数据、安全、测试等多个领域，希望能对同学们的工作和学习有所帮助。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;大家如果觉得有价值，也欢迎转给更多有相同兴趣、积极上进的同事和朋友们，一起切磋，共同成长。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;最后，祝大家阖家欢乐，健康平安。新的一年，「虎」力全开，走出个「龙行虎步」，闯出个「虎虎生威」！&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.64453125&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXfxuLNbtAa9Wf39H29IzAhiaJzvqAUH22HeAHURf5qBk5LLWTcfk0CQYnOVjZbaavfPnnbmMVrTbA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.64453125&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXfxuLNbtAa9Wf39H29IzAhsZRqVficXXqFJvgbSuP4dicxkALdYgsJrrFfaAjcmUHIZohRiaLPU3hgg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.64609375&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXfxuLNbtAa9Wf39H29IzAhHLEhicTiacrzCEcuT4eBJJy2J7iaKweSZE7nbeaeMwW8BVZThbLjRlr9w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;如何获取？&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;关注「美团技术团队」微信公众号，回复 【2021年货】，即可获取电子书的下载链接，大家可免费在线阅读、下载。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;温馨提示&lt;/strong&gt;：今年，我们不仅为大家准备了2021年的年度合集，同时我们将2019年到2021年美团技术团队前端、后端、算法的文章进行了分类整理，同时将安全、运维、测试相关的文章做了综合，大家可以选择性下载或者阅读。&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;2021美团技术年货合辑&lt;/strong&gt;：共1250页，约108M；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;2019年-2021年前端合辑&lt;/strong&gt;：共735页，约52M；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;2019年-2021年后端合辑&lt;/strong&gt;：共950页，约65M；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;2019年-2021年算法合辑&lt;/strong&gt;：共920页，约75M；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;2019年-2021年综合文章&lt;/strong&gt;：共475页，约37M。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;因文件较大，可能需要一点耐心。因部分文章中的动态图片无法在电子书中进行完全的展示，大家可以移步美团技术团队官方博客 &lt;/span&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://tech.meituan.com/&quot; textvalue=&quot;tech.meituan.com&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;tech.meituan.com&lt;/span&gt;&lt;/a&gt;&lt;span&gt; 或在美团技术团队公众号历史文章中进行查阅，感谢您的理解。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;往期技术年货&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;点击下方的公众号入口，关注「美团技术团队」微信公众号。回复【2020年货】、【2019年货】、 【2018年货】、【2017年货】，即可获取往期年货下载链接。&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MjM5NjQ5MTI5OA==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsVGibnsaEib3aNlqF0tOrA2RGEmNSbia2nnohE4Tpf95UyTiaSjDVbHRfY8WNBeTuLLTaVdSckkNyEx1Q/0?wx_fmt=png&quot; data-nickname=&quot;美团技术团队&quot; data-alias=&quot;meituantech&quot; data-signature=&quot;10000+工程师，如何支撑中国领先的生活服务电子商务平台？数亿消费者、数百万商户、2000多个行业、几千亿交易额背后是哪些技术在支撑？这里是美团、大众点评、美团外卖、美团配送、美团优选等技术团队的对外窗口。&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;/section&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>707b478b5bcd3392092151cecf165347</guid>
<title>Log4j安全漏洞前车之鉴，呕心整理工作中常用开源组件避坑版本</title>
<link>https://toutiao.io/k/1e2fqnw</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;&lt;span&gt;背景&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;     前段时间log4j安全漏洞事件，可以说掀起了一场”血雨腥风“，正好最近做了一个项目对安全要求特别高，对有安全漏洞开源组件做了统一修复。特此总结，希望对大家以后选择组件版本时有所帮助。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;&lt;span&gt;开源组件&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;工作中常用开源组件版本推荐，建议不要低于推荐版本，可以避免一些安全漏洞。&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;组件坐标&lt;/th&gt;&lt;th&gt;推荐版本&lt;/th&gt;&lt;th&gt;备注&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;commons-collections:commons-collections&lt;/td&gt;&lt;td&gt;3.2.2&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;com.thoughtworks.xstream:xstream&lt;/td&gt;&lt;td&gt;1.4.18&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;com.alibaba:dubbo&lt;/td&gt;&lt;td&gt;2.6.10.1&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;com.alibaba:fastjson&lt;/td&gt;&lt;td&gt;1.2.78&lt;/td&gt;&lt;td&gt;最好不用，使用jackson替代&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;log4j:log4j&lt;/td&gt;&lt;td&gt;1.2.17-cloudera1&lt;/td&gt;&lt;td&gt;最好不用，使用logback替代&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.slf4j:slf4j-log4j12&lt;/td&gt;&lt;td&gt;1.7.26&lt;/td&gt;&lt;td&gt;最好不用，使用logback替代&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Spring Framework&lt;/td&gt;&lt;td&gt;5.3.13&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Spring Boot&lt;/td&gt;&lt;td&gt;2.6.0&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.codehaus.jackson:jackson-mapper-asl&lt;/td&gt;&lt;td&gt;1.9.13-cloudera.1&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;com.fasterxml.jackson.core:jackson-databind&lt;/td&gt;&lt;td&gt;2.13.0&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;io.vertx:vertx-XXX&lt;/td&gt;&lt;td&gt;3.9.7&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.apache.shiro:shiro-web&lt;br/&gt;org.apache.shiro:shiro-core&lt;/td&gt;&lt;td&gt;1.8.0&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;ch.qos.logback:logback-classic&lt;/td&gt;&lt;td&gt;1.2.7&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;commons-fileupload:commons-fileupload&lt;/td&gt;&lt;td&gt;1.3.1-jenkins-2&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;mysql:mysql-connector-java&lt;/td&gt;&lt;td&gt;5.1.49 或者 8.0.27&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.java-websocket:Java-WebSocket&lt;/td&gt;&lt;td&gt;1.5.2&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;commons-beanutils:commons-beanutils&lt;/td&gt;&lt;td&gt;1.9.4&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.apache.commons:commons-email&lt;/td&gt;&lt;td&gt;1.5&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.freemarker:freemarker&lt;/td&gt;&lt;td&gt;2.3.31&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;addressable&lt;/td&gt;&lt;td&gt;2.8.0&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;com.google.protobuf:protobuf-java&lt;/td&gt;&lt;td&gt;3.6.1.3-2+b3&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;com.alibaba:druid-spring-boot-starter&lt;/td&gt;&lt;td&gt;1.2.8&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;io.netty:netty-XXX&lt;/td&gt;&lt;td&gt;4.1.70&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;com.squareup.okhttp3:okhttp&lt;/td&gt;&lt;td&gt;3.12.2&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;com.google.guava:guava&lt;/td&gt;&lt;td&gt;31.0.1-android,30.1.1-jre&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;commons-io:commons-io&lt;/td&gt;&lt;td&gt;2.11.0&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;commons-httpclient:commons-httpclient&lt;/td&gt;&lt;td&gt;5.2-alpha1&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;commons-codec:commons-codec&lt;/td&gt;&lt;td&gt;1.14,1.15,1.16-SNAPSHOT&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.apache.commons:commons-lang3&lt;/td&gt;&lt;td&gt;3.4&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.apache.thrift:libthrift&lt;/td&gt;&lt;td&gt;0.14.0&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.apache.poi:poi-excelant&lt;/td&gt;&lt;td&gt;4.1.2&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.apache.poi:poi:&lt;/td&gt;&lt;td&gt;4.1.2&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.apache.kafka:kafka-clients&lt;/td&gt;&lt;td&gt;1.0.1.3.0.0.18-4&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;com.itextpdf.tool:xmlworker&lt;/td&gt;&lt;td&gt;5.5.12&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.hibernate:hibernate-validator&lt;/td&gt;&lt;td&gt;6.0.20.Final&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.springframework.cloud:spring-cloud-starter-openfeign&lt;/td&gt;&lt;td&gt;2.2.10.RELEASE&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.springframework.security:spring-security-crypto&lt;/td&gt;&lt;td&gt;5.4.7&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.mybatis:mybatis&lt;/td&gt;&lt;td&gt;3.5.6&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;jquery&lt;/td&gt;&lt;td&gt;3.5.0&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;junit:junit&lt;/td&gt;&lt;td&gt;4.13.2&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.apache.rocketmq:rocketmq&lt;/td&gt;&lt;td&gt;4.6.1&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;codemirror&lt;/td&gt;&lt;td&gt;5.58.2&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.glassfish:jakarta.el&lt;/td&gt;&lt;td&gt;3.0.3.jbossorg-4&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;org.mongodb:mongo-java-driver&lt;/td&gt;&lt;td&gt;3.11.3&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;后续将不断补充，欢迎关注”浅谈架构“公众号，不定期分享干货，欢迎点赞收藏！&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot;&gt;
                                &lt;p class=&quot;tips_global&quot; aria-hidden=&quot;true&quot; id=&quot;js_a11y_reward_qr_title&quot;&gt;Long-press QR code to transfer me a reward&lt;/p&gt;
                                                                &lt;p role=&quot;option&quot; aria-labelledby=&quot;js_a11y_reward_qr_word js_a11y_comma js_a11y_reward_qr_title js_a11y_reward_qr_money&quot; aria-describedby=&quot;js_a11y_reward_qr_tips &quot; class=&quot;reward_tips&quot; id=&quot;js_a11y_reward_qr_word&quot;/&gt;
                                &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img alt=&quot;赞赏二维码&quot; class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;/&gt;&lt;/span&gt;
                                &lt;p aria-hidden=&quot;true&quot; id=&quot;js_a11y_reward_qr_tips&quot; class=&quot;tips_global&quot;&gt;As required by Apple&#x27;s new policy, the Reward feature has been disabled on Weixin for iOS. You can still reward an Official Account by transferring money via QR code.&lt;/p&gt;
                            &lt;/div&gt;
                                                                            
                              
            &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>b9c871a603c7cf55a6651e0b84a01b8e</guid>
<title>你是不是总是觉得钱不够花？——《工作、消费主义和新穷人》读书笔记</title>
<link>https://toutiao.io/k/269ugoo</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;profile_inner&quot;&gt;
                              &lt;strong class=&quot;profile_nickname&quot;&gt;开发者头条&lt;/strong&gt;
                              &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;/&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;Weixin ID&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;kaifazhetoutiao&lt;/span&gt;
                              &lt;/p&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;About Feature&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;程序员分享平台 | 官方应用下载地址：http://toutiao.io/download&lt;/span&gt;
                              &lt;/p&gt;
                              
                          &lt;/div&gt;
                          &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>