<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>2b4cada9c90d6b1ab719d6df30ff2087</guid>
<title>使用 Vue3 + AR 撸猫，才叫好玩</title>
<link>https://toutiao.io/k/4gfulxg</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;先来个预告效果图开场&lt;/span&gt;&lt;/h2&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;1208&quot; data-backw=&quot;558&quot; data-ratio=&quot;2.164772727272727&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwMHXxccY1ebBE5SxezeMudVRvtg8HLn5pyTG69yVGfFtCjy2nFhRWpg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;352&quot;/&gt;&lt;/figure&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;前言：浏览苹果官网时，你会看到发现每个设备在介绍页底部有这么一行文字：“&lt;strong&gt;用增强现实看看***&lt;/strong&gt;”。使用苹果设备点击之后就能将该设备投放于用户所在场景视界，在手机摄像头转动的时候，也能看到物体对象不同的角度，感觉就像真的有一台手机放在你的面前。（效果如下图。注意：由于该技术采用苹果自有的 arkit 技术，安卓手机无法查看）&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.081896551724138&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwUcP5zm0Zb0DpI3Mcz6Pmd5vDm4nqju4ADf1FLEia7qI5MgbIGfiaa5XA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;2088&quot;/&gt;聪明的你可能已经想到了，为什么只能用苹果手机才能查看，那有没有一种纯前端实现的通用的 web AR 技术呢？&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;纯前端解决方案&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;纯前端技术的实现可以用下图总结：&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.0672645739910314&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwfGc7PiaorIBgEaBByibXibwQkPB2y3kzJIkjzX4R3dYo7icMkQZVjI6Lug/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;446&quot;/&gt;以 JSARToolKit 为例:&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;使用 WebRTC 获取摄像头信息，然后在 canvas 画布上绘制原图;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;JSARToolKit 计算姿态矩阵，进而渲染虚拟信息&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5595667870036101&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwlTEiaTApLeyUgCOia3FJXbuBNf56CDeEGal0LBdNU8Wk7zTx6ic8RjTxw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;554&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;实现核心步骤&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5943152454780362&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwhnKgkqtVT6YfQSaNeibbCFYfga3hUA8I22bn6QjOlbYaNXwMRG2yOcA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;387&quot;/&gt;&lt;/figure&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;（识别）WebRTC 获取摄像头视频流；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;（跟踪）Tracking.js 、JSFeat 、ConvNetJS 、deeplearn.js 、keras.js ；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;（渲染）A-Frame、 Three.js、 Pixi.js 、Babylon.js&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;比较成熟的框架：AR.js&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;好比每个领域都有对应的主流开发框架，Web AR 领域比较成熟框架的就是 AR.js，它在增强现实方面主要提供了如下三大功能：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;图像追踪&lt;/strong&gt;。当相机发现一幅 2D 图像时，可以在其上方或附近显示某些内容。内容可以是 2D 图像、gif、3D 模型(也可以是动画)和 2D 视频。案例：艺术品、学习资料(书籍)、传单、广告等等。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;基于位置的 AR&lt;/strong&gt;。这种“增强现实”技术利用了真实世界的位置，在用户的设备上显示增强现实的内容。开发者可以利用该库使用户获得基于现实世界位置的体验。用户可以随意走动(最好是在户外)并通过智能手机看到现实世界中任何地点的 AR 内容。若用户移动和旋转手机，AR 内容也会同步做出反应(这样一些 AR 内容就被“固定”到真实位置了，且会根据它们与用户的距离做出适当的变化)。这样的解决方案让我们做出交互式旅游向导成为可能，比如游客来到一个新的城市，游览名胜古迹、博物馆、餐馆、酒店等等都会更方便。我们也可以改善学习体验，如寻宝游戏、生物或历史学习游戏等，还可以将该技术用于情景艺术(视觉艺术体验与特定的现实世界坐标相结合)。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;标记跟踪&lt;/strong&gt;。当相机发现一个标记时，可以显示一些内容(这与图像跟踪相同)。标记的稳定性不成问题，受限的是形状、颜色和尺寸。可以应用于需要大量不同标记和不同内容的体验，如：(增强书籍)、传单、广告等。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;开始上手体验 AR.js&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;开发调试开启 https&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;由于使用到摄像头敏感权限，调试时必须基于 https 环境打开才能正常运行。如果是以往，自己手动搭建个 https 环境调试对于很多新手来说还是比较麻烦耗费时间，好在最新的基于 vite+vue3 的脚手架搭建的项目，可以轻松用一行命令开启 https 访问。用脚手架初始化好代码之后，先修改 package.json 文件，在 dev 命令中加上--host 暴露网络请求地址（默认不开启），如下图：&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.40240963855421685&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwHz0OEGgTbbC1iajTF0MMrtOM9QnZ6VPVzJLSzVxu7tt5HYI5BI7icH7Q/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;830&quot;/&gt;接着用下面命令运行即可开启 https：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;npm run dev -- --https&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.31868131868131866&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwJIkQWek6OzI7OPoXooKay1mMTwdfujbBEf2wibTWy69TYZWxNkHkSvQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;728&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;先跑跑官方 demo，看看效果&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;学习一门新框架或语言，最好的方式就是先将官方 demo 跑起来体验看看。&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下面是官方代码展示的案例效果（注：该录制动图体积较大，请耐心等待加载）&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-backh=&quot;324&quot; data-backw=&quot;150&quot; data-ratio=&quot;2.16&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/lP9iauFI73z9c9xGzzoJiczDiaPJQACNViaGD5v3t4c1RezdYDHHY4l1sUTTiaHLVEg7iaz5jbNJDnCWaMfbHTWpTjTw/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;150&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-backh=&quot;324&quot; data-backw=&quot;150&quot; data-ratio=&quot;2.16&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/lP9iauFI73z9c9xGzzoJiczDiaPJQACNViaGhXIxTBiajJIJyKLzGM0VR6ibr595MgMVicbFYfJULbOMxBL5ibqaKje2Yw/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;150&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;wow ～ 是不是感觉还蛮有意思的？接下来正式进入文章的主题，开始撸猫吧 🐱&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;开始&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;前面有提到，AR.js 基于三种方式展示内容，下面将使用基于&lt;strong&gt;图像追踪（Image Tracking）&lt;/strong&gt; 方式实现。顾名思义，图像追踪就是基于一张图片，根据图片的特性点识别图片并跟踪展示 AR 内容，例如当摄像头捕捉到该图片时，就可以将要展示的内容悬浮于该图片上方展示。&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;引入依赖库&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Ar.js 从版本 3 开始采用了新的架构,使用&lt;span&gt;jsartoolkit5&lt;/span&gt;&lt;sup&gt;[1]&lt;/sup&gt;进行跟踪定位,而渲染库有两种方式可选：A-Frame 或 Three.js。A-Frame 方式就是通过 html 标签的方式简化创建场景素材，比如说展示一张图片，可以直接使用 &lt;code&gt;&amp;lt;a-image&amp;gt;&amp;lt;/a-image&amp;gt;&lt;/code&gt;方式展示。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;修改 index.html 文件：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;先将 vue 代码注入注释掉&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.12857142857142856&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwKxXyKVlgVpdUia4OQa648GBjS4QDvKZWzYBJ5FasuKL6rA2lw00EcKQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;560&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然后引入依赖：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&amp;lt;script src=&lt;span&gt;&#x27;./src/sdk/ar-frame/aframe-master.min.js&#x27;&lt;/span&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;br/&gt;&amp;lt;script src=&lt;span&gt;&#x27;./src/sdk/ar-frame/aframe-ar-nft.js&#x27;&lt;/span&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;撸猫姿势一：展示猫图片&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&amp;lt;body&amp;gt;&lt;br/&gt;    &amp;lt;a-scene embedded arjs&amp;gt;&lt;br/&gt;      &amp;lt;a-assets&amp;gt;&lt;br/&gt;        &amp;lt;img id=&lt;span&gt;&quot;my-image&quot;&lt;/span&gt; src=&lt;span&gt;&quot;./src/assets/cat.jpg&quot;&lt;/span&gt;&amp;gt;&lt;br/&gt;      &amp;lt;/a-assets&amp;gt;&lt;br/&gt;      &amp;lt;a-marker preset=&lt;span&gt;&quot;hiro&quot;&lt;/span&gt;&amp;gt;&lt;br/&gt;        &amp;lt;a-image rotation=&lt;span&gt;&quot;90 0 0&quot;&lt;/span&gt; src=&lt;span&gt;&quot;#my-image&quot;&lt;/span&gt;&amp;gt;&amp;lt;/a-image&amp;gt;&lt;br/&gt;        &amp;lt;!-- &amp;lt;a-box position=&lt;span&gt;&quot;0 0.5 0&quot;&lt;/span&gt; material=&lt;span&gt;&quot;color: green;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/a-box&amp;gt; --&amp;gt;&lt;br/&gt;      &amp;lt;/a-marker&amp;gt;&lt;br/&gt;      &amp;lt;a-entity camera&amp;gt;&amp;lt;/a-entity&amp;gt;&lt;br/&gt;    &amp;lt;/a-scene&amp;gt;&lt;br/&gt;&amp;lt;/body&amp;gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;简单解释下上面的代码：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;&amp;lt;a-scene&amp;gt;&lt;/code&gt;声明一个场景，你可以理解相当于一个 body 元素，里面嵌入其他标签元素；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;&amp;lt;a-marker&amp;gt;&lt;/code&gt;标签声明的是标识图片，也就是相机识别到标识图片时，做相应的处理；这里采用插件预设的 hiro 图片，下面效果动图可以看到&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;使用&lt;code&gt;&amp;lt;a-assets&amp;gt;&lt;/code&gt;包裹使用到的素材，相当于声明引入素材，接着在&lt;code&gt;&amp;lt;a-marker&amp;gt;&lt;/code&gt;中使用&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;看下效果：&lt;/strong&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;2.142857142857143&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwU3mPIV0tRJTL7WIeNYTicYiamv1jweqNhh9IkLRxkXquA2nrdicYS9THg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;224&quot;/&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;撸猫姿势二：播放视频&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;除了展示图片，还可以展示视频，先看效果：&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;2.164772727272727&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwMHXxccY1ebBE5SxezeMudVRvtg8HLn5pyTG69yVGfFtCjy2nFhRWpg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;352&quot;/&gt;代码如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;  &amp;lt;a-scene vr-mode-ui=&lt;span&gt;&quot;enabled: false;&quot;&lt;/span&gt; renderer=&lt;span&gt;&#x27;antialias: true; alpha: true; precision: mediump;&#x27;&lt;/span&gt; embedded&lt;br/&gt;    arjs=&lt;span&gt;&#x27;trackingMethod: best; sourceType: webcam; debugUIEnabled: false;&#x27;&lt;/span&gt;&amp;gt;&lt;br/&gt;&lt;br/&gt;    &amp;lt;a-assets&amp;gt;&lt;br/&gt;      &amp;lt;video&lt;br/&gt;        src=&lt;span&gt;&quot;https://ugcydzd.qq.com/uwMROfz2r57CIaQXGdGnC2ddPkb5Wzumid6GMsG9ELr7HeBy/szg_52471341_50001_d4615c1021084c03ad0df73ce2e898c8.f622.mp4?sdtfrom=v1010&amp;amp;guid=951847595ac28f04306b08161bb6d1f7&amp;amp;vkey=3A19FB37CFE7450C64A889F86411FC6CE939A42CCDAA6B177573BBCB3791A64C441EFF5B3298E3ED4E99FFA22231772796F5E8A1FCC33FE4CAC487680A326980FFCC5C56EB926E9B4D20E8740C913D1F7EBF59387012BEC78D2816B17079152BC19FCEF09976A248C4B24D3A5975B243614000CAA333F06D850034DA861B01DCA1D53B546120B74F%22&quot;&lt;/span&gt;&lt;br/&gt;        preload=&lt;span&gt;&quot;auto&quot;&lt;/span&gt; id=&lt;span&gt;&quot;vid&quot;&lt;/span&gt; response-type=&lt;span&gt;&quot;arraybuffer&quot;&lt;/span&gt; loop crossorigin webkit-playsinline muted playsinline&amp;gt;&lt;br/&gt;      &amp;lt;/video&amp;gt;&lt;br/&gt;    &amp;lt;/a-assets&amp;gt;&lt;br/&gt;&lt;br/&gt;    &amp;lt;a-nft videohandler &lt;span&gt;type&lt;/span&gt;=&lt;span&gt;&#x27;nft&#x27;&lt;/span&gt; url=&lt;span&gt;&#x27;./src/assets/dataNFT/pinball&#x27;&lt;/span&gt; smooth=&lt;span&gt;&quot;true&quot;&lt;/span&gt; smoothCount=&lt;span&gt;&quot;10&quot;&lt;/span&gt;&lt;br/&gt;      smoothTolerance=&lt;span&gt;&quot;0.01&quot;&lt;/span&gt; smoothThreshold=&lt;span&gt;&quot;5&quot;&lt;/span&gt;&amp;gt;&lt;br/&gt;      &amp;lt;a-video src=&lt;span&gt;&quot;#vid&quot;&lt;/span&gt; position=&lt;span&gt;&#x27;50 150 -100&#x27;&lt;/span&gt; rotation=&lt;span&gt;&#x27;90 0 180&#x27;&lt;/span&gt; width=&lt;span&gt;&#x27;300&#x27;&lt;/span&gt; height=&lt;span&gt;&#x27;175&#x27;&lt;/span&gt;&amp;gt;&lt;br/&gt;      &amp;lt;/a-video&amp;gt;&lt;br/&gt;    &amp;lt;/a-nft&amp;gt;&lt;br/&gt;    &amp;lt;a-entity camera&amp;gt;&amp;lt;/a-entity&amp;gt;&lt;br/&gt;  &amp;lt;/a-scene&amp;gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&amp;lt;script&amp;gt;&lt;br/&gt;  window.onload = &lt;span&gt;&lt;span&gt;function&lt;/span&gt;&lt;/span&gt; () {&lt;br/&gt;    AFRAME.registerComponent(&lt;span&gt;&#x27;videohandler&#x27;&lt;/span&gt;, {&lt;br/&gt;      init: &lt;span&gt;&lt;span&gt;function&lt;/span&gt;&lt;/span&gt; () {&lt;br/&gt;        var marker = this.el;&lt;br/&gt;&lt;br/&gt;        this.vid = document.querySelector(&lt;span&gt;&quot;#vid&quot;&lt;/span&gt;);&lt;br/&gt;&lt;br/&gt;        marker.addEventListener(&lt;span&gt;&#x27;markerFound&#x27;&lt;/span&gt;, &lt;span&gt;&lt;span&gt;function&lt;/span&gt;&lt;/span&gt; () {&lt;br/&gt;          // 识别到标识图，开始播放视频&lt;br/&gt;          this.vid.play();&lt;br/&gt;        }.&lt;span&gt;bind&lt;/span&gt;(this));&lt;br/&gt;&lt;br/&gt;        marker.addEventListener(&lt;span&gt;&#x27;markerLost&#x27;&lt;/span&gt;, &lt;span&gt;&lt;span&gt;function&lt;/span&gt;&lt;/span&gt; () {&lt;br/&gt;          // 丢失标识图，停止播放视频&lt;br/&gt;          this.vid.pause();&lt;br/&gt;          this.vid.currentTime = 0;&lt;br/&gt;        }.&lt;span&gt;bind&lt;/span&gt;(this));&lt;br/&gt;      }&lt;br/&gt;    });&lt;br/&gt;  };&lt;br/&gt;&amp;lt;/script&amp;gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;🐱：喵～是不是感觉更酷更好玩了？&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;撸猫姿势三：配合声网技术，与你家的猫隔空喊话&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;如果你是一位前端开发者，相信你一定知道阮一峰这个大佬。曾经在他的每周科技周刊看到这么一个有趣的事情：在亚马逊某片雨林里，安装了录音设备，实时将拾取到的鸟叫声传到一个网站，你可以打开该网站听到该片雨林里的实时鸟叫声，简单的说就是该网站可以听到该片雨林的”鸟叫直播 &quot;。（可惜现在一时找不到该网站网址）&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;而作为工作党，爱猫人士的我们，可能有着上述同样的情感需求：要出差几天，家里的猫一时没法好好照顾，想要实时看到家里的爱猫咋办？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;买台监控摄像头呗&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当然是打开声网找到解决方案：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;&lt;span&gt;视频通话&lt;/span&gt;&lt;sup&gt;[2]&lt;/sup&gt;&lt;/strong&gt; (这里为声网文档点个赞，整个产品的文档分类规划的特别清晰，不像某些云服务产品文档像是垃圾桶里翻东西)&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7361502347417841&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwHtmV6m8OWr5TwjNibHwu8ohRrj6RyUzMqG9mjd8BqTDBsKcS91Jpnxg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1065&quot;/&gt;&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;使用 vue3 写法改造文档 demo&lt;/span&gt;&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;先安装依赖包：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&quot;agora-rtc-sdk-ng&quot;&lt;/span&gt;: &lt;span&gt;&quot;latest&quot;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;app.vue 中代码：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&amp;lt;script setup&amp;gt;&lt;br/&gt;import AgoraRTC from &lt;span&gt;&quot;agora-rtc-sdk-ng&quot;&lt;/span&gt;;&lt;br/&gt;import { ref } from &lt;span&gt;&quot;vue&quot;&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;const joinBtn = ref(null);&lt;br/&gt;const leaveBtn = ref(null);&lt;br/&gt;&lt;br/&gt;&lt;span&gt;let&lt;/span&gt; rtc = {&lt;br/&gt;  localAudioTrack: null,&lt;br/&gt;  client: null,&lt;br/&gt;};&lt;br/&gt;&lt;br/&gt;&lt;span&gt;let&lt;/span&gt; options = {&lt;br/&gt;  appId: &lt;span&gt;&quot;2e76ff53e8c349528b5d05783d53f53c&quot;&lt;/span&gt;,&lt;br/&gt;  channel: &lt;span&gt;&quot;test&quot;&lt;/span&gt;,&lt;br/&gt;  token:&lt;br/&gt;    &lt;span&gt;&quot;0062e76ff53e8c349528b5d05783d53f53cIADkwbufdA1BIXWsCZ1oFKLEfyPRrCbL3ECbUg71dsv8HQx+f9gAAAAAEAACwxdSy/6RYQEAAQDK/pFh&quot;&lt;/span&gt;,&lt;br/&gt;  uid: 123456,&lt;br/&gt;};&lt;br/&gt;&lt;br/&gt;rtc.client = AgoraRTC.createClient({ mode: &lt;span&gt;&quot;rtc&quot;&lt;/span&gt;, codec: &lt;span&gt;&quot;vp8&quot;&lt;/span&gt; });&lt;br/&gt;&lt;br/&gt;rtc.client.on(&lt;span&gt;&quot;user-published&quot;&lt;/span&gt;, async (user, mediaType) =&amp;gt; {&lt;br/&gt;  await rtc.client.subscribe(user, mediaType);&lt;br/&gt;  console.log(&lt;span&gt;&quot;subscribe success&quot;&lt;/span&gt;);&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; (mediaType === &lt;span&gt;&quot;video&quot;&lt;/span&gt;) {&lt;br/&gt;    const remoteVideoTrack = user.videoTrack;&lt;br/&gt;    const remotePlayerContainer = document.createElement(&lt;span&gt;&quot;div&quot;&lt;/span&gt;);&lt;br/&gt;    remotePlayerContainer.id = user.uid.toString();&lt;br/&gt;    remotePlayerContainer.textContent = &lt;span&gt;&quot;Remote user &quot;&lt;/span&gt; + user.uid.toString();&lt;br/&gt;    remotePlayerContainer.style.width = &lt;span&gt;&quot;640px&quot;&lt;/span&gt;;&lt;br/&gt;    remotePlayerContainer.style.height = &lt;span&gt;&quot;480px&quot;&lt;/span&gt;;&lt;br/&gt;    document.body.append(remotePlayerContainer);&lt;br/&gt;    remoteVideoTrack.play(remotePlayerContainer);&lt;br/&gt;  }&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; (mediaType === &lt;span&gt;&quot;audio&quot;&lt;/span&gt;) {&lt;br/&gt;    const remoteAudioTrack = user.audioTrack;&lt;br/&gt;    remoteAudioTrack.play();&lt;br/&gt;  }&lt;br/&gt;&lt;br/&gt;  rtc.client.on(&lt;span&gt;&quot;user-unpublished&quot;&lt;/span&gt;, (user) =&amp;gt; {&lt;br/&gt;    const remotePlayerContainer = document.getElementById(user.uid);&lt;br/&gt;    remotePlayerContainer.remove();&lt;br/&gt;  });&lt;br/&gt;});&lt;br/&gt;&lt;br/&gt;// 加入通话&lt;br/&gt;const handleJoin = async () =&amp;gt; {&lt;br/&gt;  await rtc.client.join(&lt;br/&gt;    options.appId,&lt;br/&gt;    options.channel,&lt;br/&gt;    options.token,&lt;br/&gt;    options.uid&lt;br/&gt;  );&lt;br/&gt;  rtc.localAudioTrack = await AgoraRTC.createMicrophoneAudioTrack();&lt;br/&gt;  rtc.localVideoTrack = await AgoraRTC.createCameraVideoTrack();&lt;br/&gt;  await rtc.client.publish([rtc.localAudioTrack, rtc.localVideoTrack]);&lt;br/&gt;  const localPlayerContainer = document.createElement(&lt;span&gt;&quot;div&quot;&lt;/span&gt;);&lt;br/&gt;  localPlayerContainer.id = options.uid;&lt;br/&gt;  localPlayerContainer.textContent = &lt;span&gt;&quot;Local user &quot;&lt;/span&gt; + options.uid;&lt;br/&gt;  localPlayerContainer.style.width = &lt;span&gt;&quot;640px&quot;&lt;/span&gt;;&lt;br/&gt;  localPlayerContainer.style.height = &lt;span&gt;&quot;480px&quot;&lt;/span&gt;;&lt;br/&gt;  document.body.append(localPlayerContainer);&lt;br/&gt;  rtc.localVideoTrack.play(localPlayerContainer);&lt;br/&gt;  console.log(&lt;span&gt;&quot;publish success!&quot;&lt;/span&gt;);&lt;br/&gt;};&lt;br/&gt;// 离开通话&lt;br/&gt;const handleLeave = async () =&amp;gt; {&lt;br/&gt;  rtc.localAudioTrack.close();&lt;br/&gt;  rtc.localVideoTrack.close();&lt;br/&gt;  rtc.client.remoteUsers.forEach((user) =&amp;gt; {&lt;br/&gt;    const playerContainer = document.getElementById(user.uid);&lt;br/&gt;    playerContainer &amp;amp;&amp;amp; playerContainer.remove();&lt;br/&gt;  });&lt;br/&gt;  await rtc.client.leave();&lt;br/&gt;};&lt;br/&gt;&amp;lt;/script&amp;gt;&lt;br/&gt;&lt;br/&gt;&amp;lt;template&amp;gt;&lt;br/&gt;  &amp;lt;div&amp;gt;&lt;br/&gt;    &amp;lt;button ref=&lt;span&gt;&quot;joinBtn&quot;&lt;/span&gt; @click=&lt;span&gt;&quot;handleJoin&quot;&lt;/span&gt; &lt;span&gt;type&lt;/span&gt;=&lt;span&gt;&quot;button&quot;&lt;/span&gt; id=&lt;span&gt;&quot;join&quot;&lt;/span&gt;&amp;gt;&lt;br/&gt;      加入&lt;br/&gt;    &amp;lt;/button&amp;gt;&lt;br/&gt;    &amp;lt;button ref=&lt;span&gt;&quot;leaveBtn&quot;&lt;/span&gt; @click=&lt;span&gt;&quot;handleLeave&quot;&lt;/span&gt; &lt;span&gt;type&lt;/span&gt;=&lt;span&gt;&quot;button&quot;&lt;/span&gt; id=&lt;span&gt;&quot;leave&quot;&lt;/span&gt;&amp;gt;&lt;br/&gt;      离开&lt;br/&gt;    &amp;lt;/button&amp;gt;&lt;br/&gt;  &amp;lt;/div&amp;gt;&lt;br/&gt;&amp;lt;/template&amp;gt;&lt;br/&gt;&lt;br/&gt;&amp;lt;style&amp;gt;&amp;lt;/style&amp;gt;&lt;br/&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;跑起来效果：&lt;/strong&gt; &lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.8289124668435013&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAw2LI7RNTWNGcR59ibTyHxziaP1SLSkfmibOiaFEwPmymwgdmUP264CKwMdA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;754&quot;/&gt;这时就相当于在家安装了一个摄像头，如果我们需要远程查看，就可以通过声网官方提供的一个&lt;span&gt;测试地址&lt;/span&gt;&lt;sup&gt;[3]&lt;/sup&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;加入通话手机打开上述网址，输入你的项目 appId 跟 token，可以看到成功加入通话：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;2.164102564102564&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwWhhEAnLodbyMtQkeucTZUwVBMjmE2sHvXwGGtEhH6OFUA66HP4sMFA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1170&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5625&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwo0Re4oRpWVbib79ia88LITEx54VDuicktE6bLM6vkKjqChjJ9gf1kshMA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;4000&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;下方图片是手机摄像头捕捉到的画面，原谅我用猫照片代替 😂&lt;/strong&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;让视频画面跑在 AR.js 画面中&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个由于个人时间关系，暂时就不研究实现。这里提供一个想法就是：单纯的视频画面看起来有点单调，毕竟有可能&lt;strong&gt;猫并不在视频画面中出现&lt;/strong&gt;，结合&lt;strong&gt;撸猫姿势一&lt;/strong&gt;提到的展示图片，其实我们可以在 ar 场景中视频区域周围，布置照片墙或其他酷炫一点的 subject，这样的话我们打开视频即使看不到猫星人，也可以看看它的照片之类的交互。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;结束语&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;本文借征文活动，简单入手了解了下 web AR 相关知识，在这几天学习的过程中觉得还是蛮好玩的，此文也当抛砖引玉，希望更多开发者了解 AR 相关的知识。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;AR 在体验上真的很酷，未来值得期待。&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最近几年苹果一直致力于推进 AR 技术体验并带来相关落地产品，例如为了配合提升 AR 体验，带来雷达扫描，空间音频功能。值得一提的是，今年的苹果秋季发布会，苹果的邀请函也是利用到了 AR + 空间音频技术，即使你不是果粉，当你实际上手体验的时候，你依然会真正发自内心的感觉：wow ～ cool。可以&lt;span&gt;点此视频&lt;/span&gt;&lt;sup&gt;[4]&lt;/sup&gt;观看了解。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;而目前的 Web AR 技术相比于苹果自有的 ARkit 技术，在体验上还存在一些差距（如性能问题，识别不稳定），同时缺乏生态圈，希望 Web AR 技术在未来得到快速发展，毕竟 web 端跨平台通用特性，让人人的终端都可以跑起来才是实现 AR 场景大规模应用的前提。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Facebook 押注的元宇宙概念中，其实也包含了 AR 技术，所以在元宇宙世界到来之前，AR 技术值得我们每一个前端开发者关注学习。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;彩蛋&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果你问我最喜欢什么猫，我会说--“房东的猫”，～哈哈哈 🐱 ～&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6671875&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/lP9iauFI73zibte33JQIPGlb53xqvDXsAwXzQJZSLzzsvfOicB2ZV72dkb6ctSMNwvBZIucc6BicrMbiamtaOGwp57A/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;参考资料&lt;/span&gt;&lt;/h3&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;span&gt;[1]&lt;/span&gt;&lt;p&gt;https://github.com/artoolkitx/jsartoolkit5&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[2]&lt;/span&gt;&lt;p&gt;https://docs.agora.io/cn/Video/start_call_web_ng?platform=Web&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[3]&lt;/span&gt;&lt;p&gt;https://webdemo.agora.io/basicVideoCall/index.html&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[4]&lt;/span&gt;&lt;p&gt;https://www.bilibili.com/video/BV1R3411i7LL?from=search&amp;amp;seid=17803327188398196779&amp;amp;spm_id_from=333.337.0.0&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;hr/&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;p&gt;&lt;/p&gt;&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5555555555555556&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/lP9iauFI73zicqIKtS2GZJAscn2mSicDf8VE06OjPC9K6ibFHdqwh1bjnd7wia6ib70giazDoeVoxBg5ibxQl8jq8n1qsw/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;900&quot;/&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>7709e8c30ba410d09232b3c38c69e088</guid>
<title>2.6 万 Star！Shell 脚本静态检测分析工具，支持 VSCode 和 Vim 等</title>
<link>https://toutiao.io/k/fqg2v2v</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;RichText ztext Post-RichText css-hnrfcf&quot; options=&quot;[object Object]&quot;&gt;&lt;p&gt;【导语】：Shell 静态分析工具，无需运行就能发现 sh/bash 的语法、类型等错误。&lt;/p&gt;
&lt;h3&gt;简介&lt;/h3&gt;
&lt;p&gt;ShellCheck 是基于 GPLv3 协议的 shell 脚本静态分析工具，可以为 bash/sh shell 脚本提供警告和建议：&lt;/p&gt;
&lt;p&gt;ShellCheck 的目标是：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;指出导致 shell 出现奇怪错误消息的典型初学者语法问题。&lt;/li&gt;
&lt;li&gt;指出导致 shell 行为异常和违反直觉的典型中级语义问题。&lt;/li&gt;
&lt;li&gt;指出可能导致高级用户的其他工作脚本在未来情况下失败的微妙警告、极端情况和错误。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;项目地址是：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/koalaman/shellcheck&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/koalaman/she&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;llcheck&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;/&gt;&lt;/a&gt; &lt;/p&gt;
&lt;h3&gt;使用方法&lt;/h3&gt;
&lt;h4&gt;通过网页官网&lt;/h4&gt;
&lt;p&gt;可以将 shell 脚本代码黏贴到官网检测页面上，可以即时获得反馈：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;https://www.shellcheck.net&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-f893629e679ff19fca38e184cfd7853c_b.jpg&quot; alt=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;528&quot; class=&quot;origin_image zh-lightbox-thumb&quot; data-original=&quot;https://pic1.zhimg.com/v2-f893629e679ff19fca38e184cfd7853c_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; alt=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;528&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; data-original=&quot;https://pic1.zhimg.com/v2-f893629e679ff19fca38e184cfd7853c_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-f893629e679ff19fca38e184cfd7853c_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4&gt;通过终端命令&lt;/h4&gt;
&lt;p&gt;可以下载 shellcheck，并在终端命令中执行 shellcheck 命令检测脚本：&lt;/p&gt;
&lt;p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-015b2e5df7a5d5e2d50a5eaf3d5a9f46_b.jpg&quot; alt=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;552&quot; data-rawheight=&quot;201&quot; class=&quot;origin_image zh-lightbox-thumb&quot; data-original=&quot;https://pic3.zhimg.com/v2-015b2e5df7a5d5e2d50a5eaf3d5a9f46_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; alt=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;552&quot; data-rawheight=&quot;201&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; data-original=&quot;https://pic3.zhimg.com/v2-015b2e5df7a5d5e2d50a5eaf3d5a9f46_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-015b2e5df7a5d5e2d50a5eaf3d5a9f46_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4&gt;通过编辑器&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;在 VIM 中使用 ALE、Neomake、Syntastic 插件：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-286a1e57e2d578c78611b1707a7df91b_b.jpg&quot; alt=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;552&quot; data-rawheight=&quot;176&quot; class=&quot;origin_image zh-lightbox-thumb&quot; data-original=&quot;https://pic4.zhimg.com/v2-286a1e57e2d578c78611b1707a7df91b_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; alt=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;552&quot; data-rawheight=&quot;176&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; data-original=&quot;https://pic4.zhimg.com/v2-286a1e57e2d578c78611b1707a7df91b_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-286a1e57e2d578c78611b1707a7df91b_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;在 Emacs 中使用 Flycheck、Flymake 插件：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-75e3f85a2ea076b8e056be620acf3cea_b.jpg&quot; alt=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;543&quot; data-rawheight=&quot;196&quot; class=&quot;origin_image zh-lightbox-thumb&quot; data-original=&quot;https://pic3.zhimg.com/v2-75e3f85a2ea076b8e056be620acf3cea_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; alt=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;543&quot; data-rawheight=&quot;196&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; data-original=&quot;https://pic3.zhimg.com/v2-75e3f85a2ea076b8e056be620acf3cea_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-75e3f85a2ea076b8e056be620acf3cea_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;h4&gt;在构建或测试平台中&lt;/h4&gt;
&lt;p&gt;ShellCheck 主要用于交互式使用，但也可以添加到构建或测试套件中，它使用了规范标准的退出代码，因此只需添加 shellcheck 命令作为流程的一部分即可。&lt;/p&gt;
&lt;p&gt;例如在 Makefile 文件中：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;check-scripts:
    # Fail if any of these files have warnings
    shellcheck myscripts/*.sh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;或者在 Tarvis CI 的 .travis.yml 文件中：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;script:
  # Fail if any of these files have warnings
  - shellcheck myscripts/*.sh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;预先安装了 ShellCheck 并可用使用的服务和平台如下：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Travis CI&lt;/li&gt;
&lt;li&gt;Codacy&lt;/li&gt;
&lt;li&gt;Code Climate&lt;/li&gt;
&lt;li&gt;Code Factor&lt;/li&gt;
&lt;li&gt;CircleCI&lt;/li&gt;
&lt;li&gt;Github（仅限 Linux）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;安装&lt;/h3&gt;
&lt;h4&gt;通过包管理器进行本地安装使最简单高效的方法&lt;/h4&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;# 在带有 Cabal 的系统上（安装到~/.cabal/bin）：
cabal update
cabal install ShellCheck

# 在具有 Stack（安装到~/.local/bin）的系统上：
stack update
stack install ShellCheck

# 在基于 Debian 的发行版上：
sudo apt install shellcheck

# 在基于 Arch Linux 的发行版上：
pacman -S shellcheck

# 在基于 Gentoo 的发行版上：
emerge --ask shellcheck

# 在基于 EPEL 的发行版上：
sudo yum -y install epel-release
sudo yum install ShellCheck

# 在基于 Fedora 的发行版上：
dnf install ShellCheck

# 在 FreeBSD 上：
pkg install hs-ShellCheck

# 在带有 Homebrew 的 macOS (OS X) 上：
brew install shellcheck

# 在 OpenBSD 上：
pkg_add shellcheck

# 在 openSUSE 上：
zypper in ShellCheck

# 在 Solus 上：
eopkg install shellcheck

# 在 Windows 上（通过Chocolatey）：
C:\&amp;gt; choco install shellcheck

# 在 Windows 上（通过scoop）：
C:\&amp;gt; scoop install shellcheck

# 通过 Docker：
docker run --rm -v &quot;$PWD:/mnt&quot; koalaman/shellcheck:stable myscript
# Or :v0.4.7 for that version, or :latest for daily builds&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4&gt;pre-commit&lt;/h4&gt;
&lt;p&gt;要通过 pre-commit 运行 ShellCheck ，添加 hooks 到 .pre-commit-config.yaml 文件中：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;repos:
-   repo: https://github.com/koalaman/shellcheck-precommit
    rev: v0.7.2
    hooks:
    -   id: shellcheck
#       args: [&quot;--severity=warning&quot;]  # Optionally only show errors and warnings&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;开源前哨&lt;/code&gt; 日常分享热门、有趣和实用的开源项目。参与维护 10万+ Star 的开源技术资源库，包括：Python、Java、C/C++、Go、JS、CSS、Node.js、PHP、.NET 等。&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>edef6156312b9bad7d5682ae7fbe4217</guid>
<title>开源监控系统 Prometheus 最佳实践</title>
<link>https://toutiao.io/k/sevgdvt</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-fileid=&quot;502281738&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.1575&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/j3gficicyOvasIjZpiaTNIPReJVWEJf7UGpmokI3LL4NbQDb8fO48fYROmYPXUhXFN8IdDqPcI1gA6OfSLsQHxB4w/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;400&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;作者：jimmiehan(韩金明) , 腾讯PCG后台开发工程师, Prometheus/Thanos contributor&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;Prometheus 是目前最流行的开源监控系统之一, 这里以我在基于 Prometheus 构建天机阁 2.0Metrics 子系统的实践谈一谈 Prometheus 的一些最佳实践, 最佳实践的理念是 Prometheus 系统简单稳定高效运行的关键。(注: 天机阁 2.0 是新一代云原生可观测性系统)&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;埋点思路&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最好将原始指标暴露给 Prometheus, 而不是在应用程序端进行计算. 如不需要在应用程序端计算错误率, 而应该埋点总量和错误量两个 counter, 查询时用 PromQL 处理原始数据, 相除得到错误率。&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;在线服务: RED 方法, Requests(请求量), Errors(错误量), Duration(耗时)；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;离线服务: USE 方法, Utilisation(使用率, 如满载程度), Saturation(饱和度, 如排队任务数), Errors 错误量。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;开源项目例子:&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;内部代码例子:&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;天机阁 Go SDK tps-sdk-go&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Opentelemetry Oteam Go 生态 SDK opentelemetry-go-ecosystem&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;卡片服务 we-feed-card&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;指标名字&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;指标命名的整体结构是 name_unit_suffix , 符合正则&lt;code&gt;[a-zA-Z*][a-zA-Z0-9_]\*&lt;/code&gt;&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;name:&lt;/span&gt;&lt;/h4&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;name 要做到望文生义, 类似变量名, 应具有良好的可读性. 如 http_requests_total, process_resident_memory_bytes, queue_size, queue_limit. 可参考 k8s/etcd/prometheus/grafana/tidb 等开源项目；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;指标名称是全局的, 携带命名空间可以有效避免命名冲突. 如 process_xxx 表示进程指标, rpc_xxx 表示 RPC 指标, followsys_xxx 表示关注系统业务指标；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;指标名称不要带环境名/应用名, 这些元信息适合用 label 承载, Prometheus 在抓取指标时自动附加, 不需要在埋点代码中定义. 在接入天机阁时会自动给指标附加 app/server/env_name/container_name/namespace 这些元信息；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Prometheus 自定义指标如果要携带中文指标名, 我们约定放在名字为_name 的 label 中。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;unit:&lt;/span&gt;&lt;/h4&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;指标名可以带上单位, 如 request_bytes_total , request_latency_seconds；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;a href=&quot;https://prometheus.io/docs/practices/naming/#metric-names&quot; data-linktype=&quot;2&quot;&gt;值总是使用基本单位&lt;/a&gt;, 如 秒/米/字节, 单位展示可读性的事情则交给 Grafana 等展示 UI 来处理。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;suffix:&lt;/span&gt;&lt;/h4&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://github.com/OpenObservability/OpenMetrics/blob/main/specification/OpenMetrics.md#counter-1&quot; textvalue=&quot;counter 必须以_total 为后缀，OpenMetrics 规范定义&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;counter 必须以_total 为后缀，OpenMetrics 规范定义&lt;/a&gt;；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;信息类指标以_info 为后缀, 类型为 gauge，值为 1；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;指标名称不要带 _sum _count _bucket 后缀，以免与 histogram/summary 类型生成的指标名混淆。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;指标 label&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;label 对于多维监控非常有用，一个指标的基数是指标中所有 label 枚举值组合的笛卡尔乘积. &lt;strong&gt;一个进程中一个指标一千的基数是合理的上限&lt;/strong&gt;。一个进程的总基数是所有指标的基数之和, &lt;strong&gt;一个进程一万总基数是合理的上限&lt;/strong&gt;，因此:&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;label 中不适合放 用户 ID/设备 ID/URL 参数 等高基数的值. 单个 label 值不超过 128 个字符；&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;避免一个指标过多的 label 组合, 不必要的组合 label 可以拆解为多个指标, 以便降低指标基数, 提高该指标的查询性能. 参考: &lt;a target=&quot;_blank&quot; href=&quot;https://www.robustperception.io/cardinality-is-ke&quot; textvalue=&quot;https://www.robustperception.io/cardinality-is-ke&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;https://www.robustperception.io/cardinality-is-ke&lt;/a&gt;；&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;Metrics 更关注系统级别的高效指标而不是单个请求级别, 不要在 Metrics 中放过多的细节 label, 单独 Metrics 无法解决所有的可观测性问题, 详细的信息应记录 Logs 和 Traces 中, 或者在 Exemplar 带上 traceID, &lt;a href=&quot;https://github.com/cncf/tag-observability/blob/main/whitepaper.md#correlating-observability-signals&quot; data-linktype=&quot;2&quot;&gt;充分利用三大信号 Metrics/Logs/Traces 关联 一起来观测系统&lt;/a&gt;&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;PromQL&lt;/span&gt;&lt;/h3&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;对于 counter, 要先 rate 后 sum, 因为&lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/querying/functions/#rate&quot; data-linktype=&quot;2&quot;&gt;rate/irate/increase 函数才有 counter 跳变检测&lt;/a&gt;；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;聚合语句模式中 &lt;code&gt;&amp;lt;aggr-op&amp;gt;([parameter,] &amp;lt;vector expression&amp;gt;) [without|by (&amp;lt;label list&amp;gt;)]&lt;/code&gt; without 是移除特定标签, by 则是保留某些标签. without 能在聚合移除高基数标签的同时保留更多的上下文信息；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching&quot; data-linktype=&quot;2&quot;&gt;向量匹配&lt;/a&gt; on 语句 join info 类型的指标可以达到在查询结果中附加元信息的效果. 例如下面的 promQL 在查询服务内存占用的同时附加实例的 Go 版本。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;process_resident_memory_bytes{app=&lt;span&gt;&quot;xx&quot;&lt;/span&gt;, server=&lt;span&gt;&quot;xxx&quot;&lt;/span&gt;,namespace=&lt;span&gt;&quot;Production&quot;&lt;/span&gt;}&lt;br/&gt;* on(instance) group_left(version)&lt;br/&gt;go_info{app=&lt;span&gt;&quot;xx&quot;&lt;/span&gt;, server=&lt;span&gt;&quot;xxx&quot;&lt;/span&gt;,namespace=&lt;span&gt;&quot;Production&quot;&lt;/span&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;relabel_configs&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_config&quot; data-linktype=&quot;2&quot;&gt;relabel_configs&lt;/a&gt;是很通用很有用的 metrics label processor:&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;relabel_configs 发生在抓取之前, 可以对目标的每条时间序列附加元数据；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;metrics_relabel_configs 发生在抓取之后, 可以对 label 进行重命名/drop 等操作；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;alert_relabel_configs 发生在执行规则后发送 alert 至 alertmanager 之前, 如 drop 掉 replica 这个 label 用于 alertmanager 去重；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;write_relabel_configs 发生在 remote write 时, 用于 drop 掉 replica label 、drop 某些指标。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;查询性能&lt;/span&gt;&lt;/h3&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;Prometheus 查询性能与查询语句计算所命中的时间序列数量、样本数以及返回的数据大小 强相关. 正常小查询响应是毫秒级的. 界面展示的大查询(涉及时间序列超过 10k 以上的), 如租户内的所有请求量/server 级别的 CPU 使用列表 这些大查询需要用 recording_rule 定时计算好, 将查询所需的时间序列数降低；&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;展示单个信息或表格使用 instantQuery 即时查询, 只返回最新时刻计算的数据即可. 展示时间图形才需要使用 rangeQuery 范围查询, 返回时间区间内计算的所有数据。&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;图表&lt;/span&gt;&lt;/h3&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;自定义 Dashboard 需要避免一个面板图形中太多的线条, 5 条以内比较合理, 以免图表看不清及卡顿. 对于容器实例级别的指标可以用 topk 函数限制曲线数量；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;对于模板变量下拉, 其语句每次打开 Dashboard&lt;em&gt;之前&lt;/em&gt;都会查询 series 接口, 若因为返回结果太大而加载 Dashboard 太慢, 则需要使用 recording_rule 优化；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;a href=&quot;https://grafana.com/grafana/dashboards/&quot; data-linktype=&quot;2&quot;&gt;Grafana 官网面板中心&lt;/a&gt;有大量面板可以导入及参考。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;recording_rule&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;对于页面上展示的热查询, 如果涉及时间序列太多, 则会变得缓慢. 一般涉及时间序列大于 10K 的 InstantQuery 和时间序列大于 1K 的 RangeQuery, 是比较昂贵的。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Prometheus 提供了&lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/configuration/recording_rules/#recording-rules&quot; data-linktype=&quot;2&quot;&gt;recording_rule&lt;/a&gt;功能, 其会定时如 1 分钟对 promQL 表达式定时执行 instantQuery, 执行结果形成新的时间序列, 数据来自内存 TSDB, 完全内存操作, 性能很高。&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;例子 1 &lt;a href=&quot;https://istio.io/latest/docs/ops/best-practices/observability/&quot; data-linktype=&quot;2&quot;&gt;Istio 可观测性最佳实践&lt;/a&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;例子 2 &lt;a href=&quot;https://github.com/camilb/prometheus-kubernetes/blob/master/manifests/prometheus/prometheus-k8s-rules.yaml&quot; data-linktype=&quot;2&quot;&gt;prometheus-kubernetes&lt;/a&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;命名 维度:指标名:聚合方式 , 如 server:rpc_request_started_total:rate5m. 参见：&lt;/section&gt;&lt;/li&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://prometheus.io/docs/practices/rules/#naming-and-aggregation&quot; textvalue=&quot;https://prometheus.io/docs/practices/rules/#naming-and-aggregation&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;https://prometheus.io/docs/practices/rules/#naming-and-aggregation&lt;/a&gt;&lt;/section&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;alert rule&lt;/span&gt;&lt;/h3&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;a href=&quot;https://awesome-prometheus-alerts.grep.to/rules&quot; data-linktype=&quot;2&quot;&gt;Awesome Prometheus alerts&lt;/a&gt; 包含各种 exporter 导出的指标的告警规则例子；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;rule 也遵循 label based 机制, 触发告警时, label 集合是 rule 中自定义的静态 label 加上语句查询结果的 label 组合. 在 alertmanager 中根据 label 进行去重、分组、通知路由、静默、抑制；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;一些告警语句与流量周期相关, 可以在 alertmanager 的配置 route 级别的周期性屏蔽, 也可以在 rule 表达式中使用 on hour/day/month 函数周期屏蔽, 如以下 rule 会在每天 23 点~9 点总是不触发。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;expr:&lt;/span&gt; &lt;span&gt;|&lt;/span&gt;&lt;br/&gt; &lt;span&gt;xxx&lt;/span&gt; &lt;span&gt;&amp;lt;&lt;/span&gt; &lt;span&gt;100&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;# 增加条件每天23点~9点总是不触发, 转换为UTC则 hour 15点~1点&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;and&lt;/span&gt; &lt;span&gt;on()&lt;/span&gt; &lt;span&gt;(hour()&lt;/span&gt; &lt;span&gt;&amp;lt;=&lt;/span&gt; &lt;span&gt;15&lt;/span&gt; &lt;span&gt;and&lt;/span&gt; &lt;span&gt;hour()&amp;gt;=&lt;/span&gt; &lt;span&gt;1&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&quot;4&quot; data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;annotation 中支持 go template 语法, 内置&lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/configuration/template_reference/#queries&quot; data-linktype=&quot;2&quot;&gt;query 函数&lt;/a&gt;可以执行额外的查询语句, 这是丰富告警信息的利器, 比如下方配置的语句可以在异常率告警中带上错误码、数量和错误码描述.&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;annotations:&lt;/span&gt;&lt;br/&gt; &lt;span&gt;description:&lt;/span&gt; &lt;span&gt;|&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;{{-&lt;/span&gt; with printf &quot;sum(increase(rpc_server_handled_total{tenant_id=&#x27;%s&#x27;, app=&#x27;%s&#x27;, server=&#x27;%s&#x27;,namespace=&#x27;%s&#x27;, callee_service=&#x27;%s&#x27;, callee_method=&#x27;%s&#x27;,code_type=&#x27;exception&#x27;}[1m])) by (code_type, code, code_desc)&amp;gt; 0&quot; $labels.teannt_id $labels.app $labels.server $labels.namespace $labels.callee_service $labels.callee_method | query -}}&lt;br/&gt;          &lt;span&gt;{{-&lt;/span&gt; range $i,$v := . -}}&lt;br/&gt;          &lt;span&gt;错误码:{{&lt;/span&gt; $v.Labels.code }},数量:{{ printf &quot;%.0f&quot; $v.Value -}},描述:{{ $v.Labels.code_desc }}&lt;br/&gt;          &lt;span&gt;{{-&lt;/span&gt; end -}}&lt;br/&gt;          &lt;span&gt;{{-&lt;/span&gt; end -}}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&quot;5&quot; data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;可以使用&lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/configuration/unit_testing_rules/#unit-testing-for-rules&quot; data-linktype=&quot;2&quot;&gt;promtool 对 alert rule 进行单元测试&lt;/a&gt;, 用于验证告警规则有效性及 template 渲染。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;存储&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a href=&quot;https://fabxc.org/tsdb/&quot; data-linktype=&quot;2&quot;&gt;Prometheus tsdb&lt;/a&gt;的压缩算法基于&lt;a href=&quot;https://www.vldb.org/pvldb/vol8/p1816-teller.pdf&quot; data-linktype=&quot;2&quot;&gt;Facebook Gorilla 论文&lt;/a&gt;, 可以将每个样本点 time+value 16 字节压缩至平均 1.3~2 字节, time 采用 delta-of-delta 方式压缩率比较稳定, value 采用 XOR 方式压缩率跟真实数据相关, 可通过自身指标计算得到实际的样本点大小值。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;(rate(prometheus_tsdb_compaction_chunk_size_bytes_sum[2h]) / rate(prometheus_tsdb_compaction_chunk_samples_sum[2h]))&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Thanos&lt;/span&gt;&lt;/h3&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;集群中的 Prometheus 需要设置不同的 external-label, 其分片机制依赖 &lt;a href=&quot;https://thanos.io/tip/thanos/sharding.md/#relabelling&quot; data-linktype=&quot;2&quot;&gt;external-label relabel 进行垂直分片&lt;/a&gt;. 历史数据基于&lt;a href=&quot;https://thanos.io/tip/thanos/sharding.md/#time-partitioning&quot; data-linktype=&quot;2&quot;&gt;时间分片&lt;/a&gt;；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;性能优化: Thanos Query 执行 promQL 时通过 gRPC 双向流方法&lt;a href=&quot;https://prometheus.io/blog/2019/10/10/remote-read-meets-streaming/&quot; data-linktype=&quot;2&quot;&gt;流式获取样本数据&lt;/a&gt;, 如果涉及 Store 节点还需 Range 请求对象存储, 而 Prometheus 直接通过内存或磁盘。由于多次网络调用，Thanos Query 性能会比直接查询 Prometheus 要慢一些, 优化手段主要有：&lt;/section&gt;&lt;/li&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Query-Frontend 组件对 RangeQuery 按时间分解并行查询和查询缓存；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Store 节点基于 external-label relabel 分片和基于时间范围的分片；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Store 节点开启 index cache, bucket cache；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Compact 节点压缩合并 block 和降采样。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;参考:&lt;/span&gt;&lt;/h4&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://prometheus.io/docs/practices/naming/&quot; textvalue=&quot;https://prometheus.io/docs/practices/naming/&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;https://prometheus.io/docs/practices/naming/&lt;/span&gt;&lt;/a&gt;&lt;span/&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://github.com/OpenObservability/OpenMetrics/blob/main/specification/OpenMetrics.md&quot; textvalue=&quot;https://github.com/OpenObservability/OpenMetrics/blob/main/specification/OpenMetrics.md&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;https://github.com/OpenObservability/OpenMetrics/blob/main/specification/OpenMetrics.md&lt;/span&gt;&lt;/a&gt;&lt;span/&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;a href=&quot;https://www.oreilly.com/library/view/prometheus-up/9781492034131/&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;《Prometheus: Up &amp;amp; Running》Brian Brazil&lt;/span&gt;&lt;/a&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://www.robustperception.io/blog&quot; textvalue=&quot;https://www.robustperception.io/blog&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;https://www.robustperception.io/blog&lt;/span&gt;&lt;/a&gt;&lt;span/&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://prometheus.io/blog/&quot; textvalue=&quot;https://prometheus.io/blog/&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;https://prometheus.io/blog/&lt;/span&gt;&lt;/a&gt;&lt;span/&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://github.com/cncf/tag-observability/blob/main/whitepaper.md&quot; textvalue=&quot;https://github.com/cncf/tag-observability/blob/main/whitepaper.md&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;https://github.com/cncf/tag-observability/blob/main/whitepaper.md&lt;/span&gt;&lt;/a&gt;&lt;span/&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://github.com/timescale/tsbs&quot; textvalue=&quot;https://github.com/timescale/tsbs&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;https://github.com/timescale/tsbs&lt;/a&gt;&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;最近热文：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5ODYwMjI2MA==&amp;amp;mid=2649765349&amp;amp;idx=1&amp;amp;sn=16fd6fb58f4acc964b16c6818af7ec81&amp;amp;chksm=becca69e89bb2f88e1f4314046434b0470bd002e0065b7b37309b8cd46406dd8f4a121c39493&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;开发常用的缩写 你能看懂几个？&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;开发常用的缩写 你能看懂几个？&lt;/span&gt;&lt;/a&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5ODYwMjI2MA==&amp;amp;mid=2649765315&amp;amp;idx=1&amp;amp;sn=810126e0d720f63c108bf3876d560a95&amp;amp;chksm=becca6b889bb2faec0ad16bd2dcf8fa7cbc5235a6b361a81b37ca1ecb6b86bae018438235291&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;TencentOCR 斩获 ICDAR 2021 三项冠军&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;TencentOCR 斩获 ICDAR 2021 三项冠军&lt;/span&gt;&lt;/a&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;2.3935185185185186&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/j3gficicyOvavwNibaHfxs2h5XnrWxuMA3nUuMK4cfysJGTB8QU01nWXWtH4KGXYNHTyMsK13IERf40L18iccT6Rhg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;section class=&quot;channels_iframe_wrp&quot;&gt;&lt;mpvideosnap class=&quot;js_uneditable custom_select_card channels_live_iframe&quot; data-pluginname=&quot;videosnap&quot; data-headimgurl=&quot;https://wx.qlogo.cn/finderhead/I7awtksbibjQe7RZAy84xESOBAfIZ8xQ9ApXt4uTe8po/0&quot; data-username=&quot;v2_060000231003b20faec8c6e08e1ac1d4cf06ea31b07760a16cba92d83444bd9a5d9d55ffaede@finder&quot; data-nickname=&quot;腾讯程序员&quot; data-desc=&quot;将在11月17日 19:30 直播&quot; data-intro=&quot;对谈鹅厂极限运动算法工程师：唯有热爱，才能抵得过岁月漫长&amp;#10;&quot; data-noticeid=&quot;finderlivenotice-v2_060000231003b20faec8c6e08e1ac1d4cf06ea31b07760a16cba92d83444bd9a5d9d55ffaede@finder-1636708956812872-1430151082&quot; data-type=&quot;live&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;腾讯程序员视频号最新视频&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;channels_iframe_wrp&quot;&gt;&lt;mpvideosnap class=&quot;js_uneditable custom_select_card channels_iframe&quot; data-pluginname=&quot;videosnap&quot; data-id=&quot;export/UzFfAgtgekIEAQAAAAAAh_cW1X0FvwAAAAstQy6ubaLX4KHWvLEZgBPEz6FYRFgpfqf9zNPgMItOFKxaKuC_m_gwM6S311lB&quot; data-url=&quot;https://findermp.video.qq.com/251/20304/stodownload?encfilekey=XGocBFxVWK5dcyOOqpEU47RpBHQIvlhnc81ePuGBwWgUcfUy3LA19mJRk6BNg8WbOe3kE3kqtFMGuFt6IaVMqjdDSUKJNiaHlDIiaHYAZdC0nWcyUjTzdtMxxkibZ6p4rTRjjWAQkhZ0eeFkXkd6IdxUvuxic7ONubdqKDCVsu3PNt1tEkl4zbByGWcRBWpBAQL4&amp;amp;adaptivelytrans=0&amp;amp;bizid=1023&amp;amp;dotrans=0&amp;amp;hy=SH&amp;amp;idx=1&amp;amp;m=d3d65cb4df9cb008820e2b586cd3437c&amp;amp;token=AxricY7RBHdUtZuhjVIpzrUIKAvcYWRia467kHuzIHW1RGxhXA3hsQcgz72Z5hTSBYSAib5wkAWnFM&quot; data-headimgurl=&quot;http://wx.qlogo.cn/finderhead/I7awtksbibjQe7RZAy84xESOBAfIZ8xQ9ApXt4uTe8po/0&quot; data-username=&quot;v2_060000231003b20faec8c6e08e1ac1d4cf06ea31b07760a16cba92d83444bd9a5d9d55ffaede@finder&quot; data-nickname=&quot;腾讯程序员&quot; data-desc=&quot;用这个朋友圈拼图也太简单了&amp;#10;&amp;#10;#朋友圈&amp;#10;&quot; data-nonceid=&quot;13324595909787032563&quot; data-type=&quot;video&quot;/&gt;&lt;/section&gt;&lt;/section&gt;
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>fd5318ea51d65f86654a6b740ec9ffe6</guid>
<title>5G LAN 邀请你加入了群聊</title>
<link>https://toutiao.io/k/t1hbk5a</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;profile_inner&quot;&gt;
                              &lt;strong class=&quot;profile_nickname&quot;&gt;DeepNoMind&lt;/strong&gt;
                              &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;/&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;gh_0eb54daef40a&lt;/span&gt;
                              &lt;/p&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;你好，我是俞凡，在Motorola做过研发，现在在Mavenir做技术工作，对通信、网络、后端架构、云原生、DevOps、CICD、区块链、AI等技术始终保持着浓厚的兴趣，平时喜欢阅读、思考，相信持续学习、终身成长，欢迎一起交流学习。&lt;/span&gt;
                              &lt;/p&gt;
                              
                          &lt;/div&gt;
                          &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>f5f1a7dc4fdfb219597f7357fa3aaec6</guid>
<title>抖音 App 端到端画质提升和评测</title>
<link>https://toutiao.io/k/izme1z1</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;背景介绍&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;抖音投稿和消费&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://mp.weixin.qq.com/s?__biz=MzI1MjU2NDY2MQ==&amp;amp;mid=2247486508&amp;amp;idx=1&amp;amp;sn=e38bebe0106f0cb61b0674b55031ef65&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;2020 抖音数据报告(完整版)&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;2020 抖音数据报告(完整版)&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;262&quot; data-ratio=&quot;1.2657407407407408&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-width=&quot;208&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/3fqDBTibjogxFhic9dQIPvicWYVSFMnT54kuav91SsgHR5qfS8mwvH0yiaNEbDnEiajMV92Whia5cgt91CM14A5icLLMg/640?wx_fmt=png&quot;/&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;256&quot; data-ratio=&quot;1.2356687898089171&quot; data-type=&quot;png&quot; data-w=&quot;1256&quot; data-width=&quot;208&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/3fqDBTibjogxFhic9dQIPvicWYVSFMnT54ksXibbSBUSicRPak9bhcxGyLK1vAqicLHGeXtOZFEdALoK3MNqGtq4VxBw/640?wx_fmt=png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;抖音作为短视频社区，拥有海量的用户和短视频内容，日活用户规模超过 6 亿，日均视频搜索次数突破 4 亿，因此多媒体内容处理的成本与体验之间的平衡，不断为我们带来了新的挑战和新的惊喜。&lt;/span&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;画质对用户影响&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5787037037037037&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUNIxKWia7HOcZiapMYYX6rJJ3TnqoicUic6wysVmxr4rsBewMNzlkXiat9jw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;随着基础设施的提升，5G 的到来，可以看到，2019-2020 一年时间 5G 设备数量翻了 8 倍多，越来越高的画质诉求，目前我们也在不算的提升分辨率；码率，帧率，位深度，以及支持 HDR 等视频全链路采集，编辑，播放等等；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下面我将介绍哪些因素会影响高画质，主要从分辨率，位深度，帧率，色域，亮度五个方向展开介绍。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6930232558139535&quot; data-type=&quot;png&quot; data-w=&quot;430&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUYIxEgf5R0wsNFVUxRgiax4Ejc0Fgmiaujz8m46TU4U0fxCKj177XZg7Q/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;1. 分辨率 = 图像细节的精细程度&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;分辨率指图像中的像素数量。在特定屏幕尺寸下，分辨率越高，像素越多，显示的细节更精细。4K 超高清分辨率是 3840x2160，这意味着显示的图像数据是标准全高清的四倍。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6451612903225806&quot; data-type=&quot;png&quot; data-w=&quot;310&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqU8dfWdib3fRw4uQu2yckxgyDVcBzEibgCBdv9evk5icXxPria1qgv0LMl4A/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6451612903225806&quot; data-type=&quot;png&quot; data-w=&quot;310&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUCo1oMA3TLJKH8YibqcqAJboZK1WxarUicRFs2Fmr2WH94oxk3bY8NKHw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6451612903225806&quot; data-type=&quot;png&quot; data-w=&quot;310&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUfUNicP3aOapb48A7u7JQhaFiaFsdFpiahoAAFQ5u2KoickfW7ibyxrzL5fQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;2. 位深度 = 色彩渐变的精细程度&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;位深度指每个像素可以显示的颜色数量。位深度越大，可显示的颜色越多，从而使渐变更平滑、更自然。例如，8 位显示器可以显示大约 1677 万种颜色，而 10 位显示器可以显示大约 10.7 亿种颜色。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.43010752688172044&quot; data-type=&quot;png&quot; data-w=&quot;465&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUQEk9ibibK8EPs409Ficzd2ACmN9APicrHia17z9CE1dpiaF24gcaicnBD3LTw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.43010752688172044&quot; data-type=&quot;png&quot; data-w=&quot;465&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUGDUHjKD7bW7H3ju5GjY6OHJ7a6miblpKDHjQnZGJIZKabMF8NQ5ia9dw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;3. 帧速率 = 运动的平滑程度&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;帧速率指一秒内显示的图像数量。电影的帧速率一般是 24p（24 张图片，或每秒帧数），而标准电视的帧速率通常是 60i 或 30p（每秒 30 帧）。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;8K 广播标准 BT.2020 包含帧速率（最高可达 120p）的定义，该帧速率下的运动平滑程度几乎和真实世界一样。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.6628099173553719&quot; data-s=&quot;300,640&quot; data-type=&quot;png&quot; data-w=&quot;1210&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUQUb7ibgGambkls5mVP5AAqFalzMiafBLxE8cNbPD0h0wBIPicYWY4EqWg/640?wx_fmt=png&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;4. 色域 = 色彩的生动程度&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;色域指可以显示的所有颜色的范围。右侧图表显示了人眼能够感知的所有 RGB 值的范围。三角形表示色域：三角形越大，可以显示的颜色越多。4K/8K 广播标准 BT.2020（Rec.2020）比现有全高清广播标准 BT.709（Rec.709）涵盖了的颜色范围更广泛。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.8818011257035647&quot; data-type=&quot;png&quot; data-w=&quot;1066&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUQ4t5MvRnph6jdznQWdPj48iauIeD1z8kB37tGvTUQ1uX0C5UebA3G8Q/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;5. 亮度 = 图像照明的强度&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;亮度指可以显示的图像照明强度的范围。人类眼睛所能感知的最暗和最亮物体之间的差异范围（动态范围）通常为 1012，而传统显示设备最多只能显示 103 的动态范围。HDR 将动态范围扩展到 105 — 比目前的显示设备高出 100 倍 — 允许以一种更接近人眼所能感知的方式呈现光与影。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.46153846153846156&quot; data-type=&quot;png&quot; data-w=&quot;715&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUnMDgw55Y25kAiaAsjPBA36I29J0OhanklG1nX9uNBcwtN4U9MB782iaA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;抖音端到端全链路&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5462962962962963&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUMiaGgAoBVMGddXbmCtgHZcGamJic6iaKRBK97edmPdbNmvQcLGK52nvGQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;抖音端到端全链路路径十分复杂，各个环节都会对画质产生很大的影响；下面我们从安卓端大概梳理一下目前的链路，可以看到我们拿到手机拍摄就要经过 sensor 进行光电转换，然后电信号经过 ISP 的处理，这个过程中厂商都会加入很多增强算法，多帧 HDR，超分，降噪等等；然后通过安卓的 camera1，2 API 的采集，一些大的厂商也会提供 SDK，我们可以通过这些 SDK 调用到和系统相机一样的图像处理能力；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在经过抖音的生产端业务逻辑，比如特效 SDK，增强算法 SDK，编辑 SDK，上传 SDK 等等，这里经过了美颜，磨皮等特效算法，以及编辑过程的软硬编解码，还有各类 software ISP 的画质增强算法最终传给了服务端；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;服务端又要经过重重的处理，包括视频的基本信息分析，然后进行增强处理，最后转码成各个档位，通过 CDN 分发下去，这个过程服务端核心处理就是图像增强算法前处理和转码；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下发到消费端有播放器有需要做很多处理，解封装，解码，通过算法增强 SDK 处理，最终上屏渲染处理，比如 HDR，超分等等；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可以看到上面整个大致的链路已经十分复杂了，因此对各个环节的画质效果的线下评测就应运而生，我们会通过多媒体实验室进行主客观评测，提前洞悉用户对算法效果的喜好，及时调整画质调试方向，来保证算法能够在上线之前到达最优效果；目前我们已经在抖音整个链路上线了超分，降噪，插帧，HDR 等画质增强算法，画质上取得了令人瞩目的收益。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;画质评测&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;业界痛点&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前业界的痛点在于客观指标不能很好的映射到主观质量，举个例子，比如 PSNR 高的视频画质一定就好吗，不一定，因为 PSNR 只是一个相对参考的指标，如果视频源的质量很差，PSNR 再高也没什么用，另外很多时候我们看 PSNR 很多时候只是看整体视频所有帧数的均值，但是如果其中某些少数帧出现 badcase，比如转场出现大量的马赛克，也是会非常影响用户的主观体验，而这些从 PSNR 的数值上都不能很好的体现出来，同时如果在服务端经过锐化，超分，降噪，插帧等等一些前处理的算法的话，那么全参考的指标基本无法使用了，综合来看，PSNR 等全参考客观指标有很大的局限性；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;主观质量和用户行为不存在必然正向关系&lt;/strong&gt;。即使在测试阶段对主观质量有了一定的评估，主观质量的变化首先需要被用户感知或感受之后，才会对用户的行为产生影响，这种影响对单个用户或单次行为可能是非常微小的，比如多看了一个视频或者某个视频多看了几秒，但现阶段学术界对人类视觉系统的运作规律依然知之甚少；再举个举个极端的例子，我们现在大幅提高码率和分辨率，用户的画质必然会变好，但是用户的播放流畅度，耗电量等指标必然无法接受；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;所以我们需要通过不断的 AB 实验来观察用户的 QoE/QoS 指标，从侧面反映及理解用户的真实行为，找到一个最佳的平衡点，就是画质带来的视觉体验的正向收益大于对于用户手机性能带来额外消耗的负向体验，使得整体的业务数据整体呈现正向。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;QoE 指标核心：&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;画质正向&amp;gt;其他负向。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;AB 实验的核心 QoE 指标如下：&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用户量、内容浏览量、人均播放时长、人均播放量、人均完播数、人均点赞数、多日留存等等。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4666666666666667&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUeInwy8h8ua94Jek3F8X5szxGSy9zRWyJj4uWPicLFF2QfQ1SqfGwwpQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一般在算法开发阶段我们会分三个阶段：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;算法仿真 tuning 阶段&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;工程化测试阶段&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;线上 AB 实验阶段&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;因此线下算法仿真开发阶段，我们会重度依赖主客观质量的评估，来确保算法各方面的效果尽可能的达到最优状态，后面会展开介绍目前我们的算法迭代流程。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;视频质量评估&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4842592592592593&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUeMN6H6pgVsrJltqpMrOO1WoNHM1C7LUvTP9SYkcLKZ3o8kgTiampPow/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;什么是图像质量？&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;图像信息技术被广泛应用的情况下，对图像质量的评估变成一个广泛而基本的问题。由于图像信息相对于其它信息有着无可比拟的优点，因此对图像信息进行合理处理成为各领域中不可或缺的手段。在图像的获取、处理、传输和记录的过程中，由于成像系统、处理方法、传输介质和记录设备等不完善，加之物体运动、噪声污染等原因,不可避免地带来某些图像失真和降质，这给人们认识客观世界、研究解决问题带来很大的困难。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;比如，在图像识别中，所采集到的图像质量直接影响识别结果的准确性和可靠性；又如，远程会议和视频点播等系统受传输差错、网络延迟等不利因素影响，都需要在线实时的图像质量监控；因此，图像质量的合理评估具有非常重要的应用价值。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;对于图像质量有两种定义。&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;strong&gt;定义一&lt;/strong&gt;：不同成像系统采集，处理，储存，压缩，传输信号的准确度。&lt;/p&gt;&lt;p&gt;&lt;strong&gt;定义二&lt;/strong&gt;：符合人眼感知的角度评价图像质量：图像所有视觉上重要属性的加权混合。&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;定义一是从信号处理的角度，关注成像系统中信号的准确性。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;定义二是从人眼视觉的角度，关注观测者的感受，审美水平不同的观测者，反馈的结果也不同。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;那么从图像质量的定义上，就引申出了两种图像质量的评测方法，从有没有人参与的角度区分，图像质量评价方法有主观评价和客观评价两个分支。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;主观质量评估&lt;/strong&gt;，主观评价以人作为观测者，对图像进行主观评价，力求能够真实地反映人的视觉感知，依赖人眼观看并打分，这种得到的分数比较精确，但是很耗时间，而且不方便大规模部署。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;客观质量评估&lt;/strong&gt;，客观评价方法借助于某种数学模型，反映人眼的主观感知，给出基于数字计算的结果，评价一个算法的好坏就是衡量主观分数和客观分数的相关系数，一般来说系数越高越好。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;客观质量评估算法大概分三类，主要取决于是否使用无损的源视频作为参考。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;全参考&lt;/strong&gt;，比如 PSNR 就是典型的全参考算法，通过与源视频进行各种层面比对，来衡量损伤视频的质量。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;无参考&lt;/strong&gt;，有的算法不使用源视频，只使用接收端的视频，来衡量它自己本身的质量。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;部分参考&lt;/strong&gt;， 比如从源视频中提取一个特征向量，特征向量随着损伤视频一块发送到用户端用来计算质量。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;图卡客观评价&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前世界上主流的图卡测试系统有三家：imatest，DXO 和 Image Engineering。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.22333333333333333&quot; data-type=&quot;png&quot; data-w=&quot;300&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUo83MgcYfZOzS1zPwwds2g2LicXtCa0HsL6s949UIMw8IKfTAAsQSk9Q/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;客观评价的指标下面给大家列出来，下面我主要介绍几种最常用到的指标。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.1&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUO96dUBcHll5GOAQEKrYHCrcSbINmeotfhgcVUFbNyibkr3NoX9R3EtA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;MTF&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;MTF，Modulation Transfer Function。中文为调制传递函数。在各个摄像头镜头中经常采用 MTF 描述镜头的 MTF 曲线，表明镜头的能力。这些曲线是通过理想的测试环境下尽量减少其它系统对镜头的解析力的衰减的情况下测试得出的。当然，MTF 也可以涵盖对整个成像系统的解析力评价。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;SNR 信噪比&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;由于噪声和信号总是混在一起，如果一张图片去除噪声的同时也消除了信号，那么也不是优质的图像。所以为了评判图像的好坏，经常用 SNR 信噪比来表示。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们一般用 dB 表示：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;所以 SNR（dB）= 20 log 10（S / N）。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;SNR 最显著的缺点就是容易被降噪算法作弊。一张 SNR 很高的图片可能涂抹严重。另外相同 SNR 的两张图，噪声感受可能差别很大。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;CIE Lab 中的色差计算&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;建立色彩空间，是为了方便的表示色彩。那么有了两个颜色的坐标，就可以开始进行色差计算。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这时我们遇到了第一个问题，应该如何选择色彩空间。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;标准的制定者考虑了两点。&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;色彩空间必须符合人眼视觉，能够比较线性的色彩。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;要在设备无关的色彩空间中进行计算，不能因为换了个显示方式，影响色差计算。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;于是 CIE Lab 就在这样的需求中诞生了。L 表示亮度，ab 分别表示色彩分量。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当时认为 CIE Lab 是一个如果均匀线性空间，于是初代的色差公式就是两个颜色在色彩空间中的欧式距离：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;delta_Eab = sqrt(delta_L.^2 + delta_a.^2 + delta_b.^2);&lt;br/&gt;delta_Cab = sqrt(delta_a.^2 + delta_b.^2);&lt;br/&gt;其中delta E为整体色彩，deltaC 排除了亮度的影响（不计算L值）&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;之后色差公式在应用中逐渐被认识到一些缺点仍然存在。CIE 2000 年又再次更新了标准。这次的公式更加符合人眼感知。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;公式如下：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;中间变量的计算过程被我省略了，只展示了最终的公式。有兴趣的同学可以到附录下载 CIE 2000 色差公式 matlab 函数。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.2530487804878049&quot; data-type=&quot;png&quot; data-w=&quot;656&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUA2WvTpH3pKnmhKlSgQSN4yURuhVW5ibSyXdibeGHjn9rJsOYuMTMMCPg/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;客观实验室介绍&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;客观实验室相信大家也很熟悉，我们主要依赖标准图卡和可控制的光源环境，来进行可控制变量的重复测试，目前实验室的详细介绍可以看我们之前的文章：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://mp.weixin.qq.com/s?__biz=Mzg3NTU3MzM0MQ==&amp;amp;mid=2247485078&amp;amp;idx=1&amp;amp;sn=85e1a6c33bc4598c0591e53ef78a34d3&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;画质评测实验室简介&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;画质评测实验室简介&lt;/a&gt;&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;24 色卡&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;枯叶图&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;SFRplus 图卡&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ISO12233&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;灯箱&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;图卡支架&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6240740740740741&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUicJLib7zdJMxv0kt0Seia8dk2ejbYtOA8QRs7YW0kQ1EXv1AKbcF1Hqsg/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6129629629629629&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqU5WJF46M4hfzATOlQs0bIJ54lSky4tS9VEFFxKINk9icWcLNBDWlGYwg/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6648148148148149&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUMrGFAwjf4ibIefesmnmia3XEFqK3cQrqptjpUC9X78NjNkrAibkdWGPyw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6666666666666666&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUwH90Jnd4hxLTLvN2YU15TyUJC1G7CGGqKoavT4488icicwFVKsV3cWKw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;无参考打分算法&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前我们自研无参考打分算法也在内部有一定的使用；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;1. 线上视频质量监控&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;海量视频数据的质量监控是不得不面临的棘手问题之一，视频质量服务包括视频质量检测、视频质量评价和视频质量监控。如果可以针对海量视频提供快速正确的审核或监控方案，则可以全天候不间断地检测视频质量，大幅降低人工成本，减少线上服务的风险和事故率。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;抖音生产端发布视频画质监控，服务端转码视频画质监控，线上大盘播放质量监控；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;在其他业务线复用飞书，西瓜，剪映等业务线等短视频，直播，RTC 场景。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;2. 视频前处理检测&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前，在抖音端到端的视频处理技术有：&lt;strong&gt;去块效应、锐化、超分辨率、视频降噪等技术等&lt;/strong&gt;。视频处理技术的最大特点就是很难找到一个客观指标，告诉你参数调到什么程度才能让用户满意。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如下图可以提供对多种来源的图像和视频，进行全面、多维度的场景和画质分析的能力，包括但不限于：场景语义、人脸检测、视频类型、运动程度、噪声、亮度、曝光、清晰度、色彩表现、artifacts 等，可用于 QA 评价监控体系（如画质打分、美学打分、线上画质监控等）和画质修复增强算法体系（如：基于场景的算法路由、动态算法分支、算法自动开启关闭、算法条件输入等）。如下图所示为 AnalysisKit 可能包含的分析检测模块，及其可以服务于的业务或算法场景：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;对场景和画质分析检测算法进行集中规划、开发和看护，形成整套可重复利用的解决方案，可用于不同场景和任务类型，提高算法的适用性，避免各个需求来源重复开发检测算法，有助于需求的对齐澄清，避免需求冷启动。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.8231481481481482&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUhDBqVH606soVYolZDun3agb5Uwc9ib17ogGfJJnzy3HLCJE1mThBd0g/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;目前应用：&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;生产端编辑页一键增强功能降噪算法前置检测；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;夜景检测功能，为其他算法后处理提供信息；&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;3. 推荐提供评分标签&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;短视频正逐渐成为互联网上的一种重要的信息传播方式，为短视频打上各种有用的标签，可以帮助优化推荐系统或搜索引擎，从而为用户提供精准的短视频推荐或搜索服务。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前应用：在抖音线上的质视频筛选，优化推荐权重。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;实景主观评价&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3972222222222222&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUptHsCdibTH9SHhQuoVqKJ6SGTpUGX1F5STSQjg1ibtzf1lkngliaPpQQw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5203703703703704&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUdCSyUicRhDLeSucmJ4mE1rgT4XN432CtrOcTvYZq9G7xoMMuIHjA4hA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.2148148148148148&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqU4FX36zmCgucajViczkAdInDL2wHcSwVAyVKEtJzkRvQsfLibgrfLfybQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;头模-不同肤色
我们通过高仿真的人像头模，来模拟不同肤色群体，进行相关的人像画质测试；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;实景模拟
主观测试最大的难点就是场景的可重复性，如果一旦确认这个场景出现问题，我们很难在自然界再次重复一模一样的场景，所以就需要我们在实验室人为的造就这样的实景，方便我们重复测试；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;灯光环境
光线条件也是非常重要的一环，因此我们搭建了吊光光源，方便我们模拟 D65，D50，A 光等各种光照条件，进行主观场景测试。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6462962962962963&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUELoB6fiaozQ1SysiaicA26h9YpvYJlYe2QtKM7PBibz2icphbPhBlXnxxDA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6601851851851852&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUpbiczEQJPmUNtD03pMMAtf4ichAAx9A0NYThOjpB47P0h6VAyllS2C4w/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6898148148148148&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUtTOiajRLeGVjGKvhgkYaDTdV1rSYWjI54jTNe3TWniacA9UibPUhrb1VA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;画质评测工具&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们也通过很多自研的工具来提升画质评测的效率和自动化方案，目前研发了 24 色卡，SFRplus 图卡分析算法，防抖检测算法，视频基础参数分析，卡顿分析，编码分析等等，下面列一部分的 UI 界面。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4842592592592593&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUJ7yr771gjJFm4JHKyfSqjEqlzbcfYFgoABQibNN5ZGQNkW46WRMMTVw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;画质评测流程&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;内部画质算法的迭代流程中期很长，下面简单介绍一下算法的迭代流程，方便大家清楚了解我们任何一个算法的上线都是经过的研发和评测巨大的努力，最终才在线上呈现给到用户的；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;算法从立项开始，就需要开发和评测 tuning 同学内部闭环，不断进行调试，在这个过程中达到可交付状态之后，然后通过内部的图卡计算和无参考的客观指标计算，在合理的阈值范围内的话，我们才会交付到专家评测组（大概 40 个人）进行评测，专家多维度的评测结论通过之后，我们通过线上的众测平台，发送给到线上的部分内测用户（每次大概 300 人），通过用户众测最终通过之后，我们才会决定工程化落地上线；上述的任何一个环节如果出现负向的话，我们都会打回重新调试。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5675925925925925&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUWrT9lMiclwHAParKE2FRwSvxerxcWmn4n3iaUygWbPIBK8crAI4ZcEMw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;众测方式&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上面说到众测，我们需要重点介绍一下我们的众测系统，目前的众测是集成在抖音线上，内测用户可以通过站内信或者扫描二维码等方式参与到众测过程；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前众测方式分四种方式：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;同屏对比&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4685185185185185&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUm3PAyPKfEibv8fCkqqkH0fiavpq6otwsBFjfEHVkTXKgK038m0Ix7gGQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;ol start=&quot;2&quot; data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;分屏对比&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;2.096026490066225&quot; data-type=&quot;png&quot; data-w=&quot;604&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUEGEEdbjGtibN1cA7s5ONLTWgVvAXJBreQOcuXsicDTKkYictiaXr1Frbpg/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;ol start=&quot;3&quot; data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;单屏对比&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;2.0993377483443707&quot; data-type=&quot;png&quot; data-w=&quot;604&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUicRibNqqw7ia5vhPCdgELCicRLbtUDLXNgezadS64sU1WDk52cR7CvGMcQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;ol start=&quot;4&quot; data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;重叠对比&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;2.109271523178808&quot; data-type=&quot;png&quot; data-w=&quot;604&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUt4ia9Seibbjfk1ibmXA1ADJFSjM7gZM1tQjpNESBEeUx2p8exZEaICiajw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;什么是 JND？&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;众测有一个重要的指标就是 JND，我们通过 JND 量化的方式来决定我们上线的标准；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;举个例子：一根蜡烛的房间，增加一根蜡烛，亮度的增加是明显可感知的。十根蜡烛的房间，增加一根蜡烛，感受不明显。一个铃铛在摇晃，增加一个铃铛，声音变大也是明显可知的。十个铃铛在摇晃，增加一个铃铛，感受不明显。那么物理增加量和心理感知量如何量化呢？&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6656716417910448&quot; data-type=&quot;png&quot; data-w=&quot;670&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUGpyOzibePL69GPnzfxpgeeicEMCsxn2Y4C14yciaGGgINIW3jND35slCA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;韦伯定律是表明心理量和物理量之间关系的定律，即感觉的差别阈限随原来刺激量的变化而变化，而且表现为一定的规律性，用公式来表示，就是 △I/I=K，其中 I 为原刺激量，△I 为此时的差别阈限。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;而可被感知的最小 △I，就被称为 JND，Just noticeable difference，即最小可觉差。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;把最小可觉差（连续的差别阈限）作为感觉量的单位，即每增加一个差别阈限，心理量增加一个单位。感觉量与物理量的对数值成正比，也就是说，感觉量的增加落后于物理量的增加，物理量成几何增长，而心理量成算数级数增长，这个经验公式被称为费希纳定律或韦伯-费希纳定律。适用于中等强度的刺激。S = k lg I + C（S 为感觉量、K 为常数、I 为物理量，C 是积分常数）&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;常见应用：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下面是我们实际使用的一些 case：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUeEvFlOibtkUC35uXqibibWvuuEFEfjgoO4jCicrXNkDo1Emz1XM7l9iciacA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6138888888888889&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqU2dPnUicGndULf6Idh3Taq2t6ia3OOYxxKL214SyIIV2ibN6Hqib6sYfHjw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6083333333333333&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUZ6ceiahkPlS60rOWqKpyDUn9FqblnKFWVckGCpLSO5MaMGeCQNgHgJQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;多媒体评测实验室&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;那么我们主要做什么呢？主要从下面四个方向把控抖音端到端的全链路画质质量：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;工程优化--厂商合作--编解码--算法增强&lt;/strong&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5296296296296297&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqU9IcK7cFsIGjtz30Z9CM86wv4csic8sPTia5nQfZ6tdjbianPIeGmPbD9Q/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;细分下来，主要通过手机厂商新机合作测试，图像增强算法测试；工程迭代优化测试，比如 1080P 全链路测试；编解码画质测试；竞品调研分析；评测视频库；评测平台建设；自动化监控等等。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;画质提升&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前我们将整个内部的评测链路分成 3 个端，生产端，服务端，消费端，下面从这三个端依次介绍一下我们做了哪些画质提升的事情。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;生产端&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;Software ISP&lt;/strong&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5351851851851852&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUUFM4KEwaP9vV9U194GUZR0fV6OYFKQyRIW9gMMFmRnj7TvZxIaicJgw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;各 ISP pipeline 大同小异，主要体现各家不同的处理风格。ISP 复杂度取决于应用场景；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;典型的都是传统算法，现在也有传统+AI 混合的 pipeline；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;比较成熟的 isp 有：&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;相机：佳能，索尼，尼康等；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;手机：高通，苹果，三星，海思，MTK；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;安防 IOT：海思，安霸，ARM 等；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;驾驶：mobileye 等；&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;后处理：&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;各手机厂，Almalence ，Visidon ，morpho，imint ，虹软，商汤，旷世等；&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在画质处理链路上，很多位置都可以用后处理增强。不同位置的画质特点不同，了解这些特点有助于设计更好的后处理增强算法，因此我们自研的后处理算法的 software ISP 应运而生。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.22407407407407406&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqU1ibmaREJlxNibEamYm4jOlv0kiaO2zMjmVPhQ6E1JbpicoiajIcfvJsSD0g/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;Software ISP&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;什么是棱镜系统？&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;目前字节内部提供画质解决方案的系统，棱镜系统提供一站式画质问题解决方案，从业务场景分析，画质问题智能分析，画质增强及优化，测试及部署等一系列能力。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;核心平台能力&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;棱镜系统以 SDK 形式提供核心能力，包括场景策略模块、画质智能分析模块、画质增强模块。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;场景策略模块：业务场景配置，画质参数调试，预设画质风格调试，功能裁剪配置，工作模式配置，算法 pipeline 配置。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;画质智能分析模块：场景变化检测，画质实时监控，画质问题诊断，画质细分维度打分，美学打分。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;画质增强模块：拍照增强能力，视频增强能力，时间序列增强能力。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.48703703703703705&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUyzFGOSQQHjibUtw0ud4O7UkPeibEYsgDGjgrS1eWCmlGdjUR0wYskPAg/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;目前抖音线上的一键增强功能：&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结合用户和图像场景，智能分析并增强其图像和视频的画质，动态调整出更为清晰、绚丽的图像，打造绝佳的视频沉浸体验，从下图可以看到增强之后的效果视觉感官体验明显好于右边。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;左边是增强后的效果，右边是没有增强的效果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.48&quot; data-type=&quot;png&quot; data-w=&quot;1050&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUcF1TLZ0o8muffbZNVAUCb0c3cBMGGE03U3aKt4Tjd3dmRI5ZxW1SRg/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;camera 采集&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;什么是 camera1，camera2？&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;都是 google 官方提供的两套 Camera API，在 Andriod 5.1 之后取消了对 Camera1 的更新，主要维护 Camera2。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Camera1 和与 Camera2 在实现和使用方式有较大的差异，详见下图；&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7361111111111112&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUxJ2GXQErBZ8T2fNjanOubVoJnPps5oy2egAGwibEkqe0iafO8BknAIow/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Camera1 的使用多在存量的旧机型以及部分存在兼容性问题的机型中，Camera2 主要在新机型上使用；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;相对 Camera1，Camera2 增添了许多新特性，功能也更加强大，如：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;支持 30fps 高清连拍；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;支持 RAW 格式的图片拍摄；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;支持 Movie Snapshot；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;支持更多的参数设置，对画质优化，专业能力拓展提供更大的操作空间；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;防抖，广角等功能只在 Camera2 机型上实现；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;手机厂商合作的功能大多也是基于 Camera2 实现；&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前抖音大部分场景已经切换到 camera2，我也通过跟国内的主流手机厂商合作，比如华为，小米，oppo，vivo 等等，使用厂商提供的 SDK 调用更多系统相机才有的能力，进一步提升我们的生产画质。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;编辑 SDK&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前也逐步从软编切换到硬编码，从下图可知，硬编码的功耗低，性能更强大；&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5092592592592593&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUUovN0oHb3dV0EHicxkCE7GibibeazKPHk9bJyEvHichMt5bSUbL625ZqPg/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;通过对客户端的机型进行性能打分和测速，同时对视频内容进行预编码提前感知，综合这些信息，算法抉择出一套最适合当前场景的编码参数；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;对导入的视频支持上屏渲染，转码支持 HDR 显示，同时也支持 HDR tone mapping 到 SDR，避免用户产生 badcase；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前生产端已经最高支持 1080P，60fps 的视频了，后续我们还会继续上探，尽可能为用户提供更高清的视频；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当然我们不是一味的提升画质，目前我们通过各种软硬编码和上传 SDK 结合策略，已经达到画质和码率的均衡，尽可能在提升画质的同事，不影响用户的投稿体验，目前内部评估中生产端的效果在各个竞品表现最优。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;特效 SDK&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在生产端我们特效的 SDK 也做了很多优化工作，下面举几个例子：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;之前我们的磨皮效果会对全局场景进行处理，导致人物后方的背景也不够清晰，同时磨皮的处理导致人物面部的纹理细节太少，缺乏实感，后续我们针对性的上线了人脸磨皮，只对人脸检测区域进行处理，同时上线精致磨皮，能够保留人物质感。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5064814814814815&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUtXP8vqxNwIiazamfELiabIr4gzR5epHuh8P2eeLvDMZFeJ28zLk4QicxQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在夜景的情况下，默认滤镜会放大画面噪声，通过夜景检测算法，自动的对白天和夜晚使用不同效果的滤镜，来尽可能实现滤镜效果最优化。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.649074074074074&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUYnNlXrwJOl0AGEALHsr12ZqhOc5eXXSpOnA1z7NiaSQaiaRd81OmTdIQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上面虽然说到抖音已经支持导入视频上屏渲染支持 HDR，但是加入特效之后，要支持的难度非常大，需要 2W 多个道具进行遍历生产 10bitHDR 的素材，目前我们也在逐步的支持特效的 HDR。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7731481481481481&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUpzNRUicD9ibkSw7zbXpibHiciaWISib2NsicG4u5cEpGOSragAfvoVulz41Ow/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7574074074074074&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUacicNmZA5Q3Yej4YHzHaT4j4yeyTa29xx7MDciatXyIoMFFvdGM72ibOw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;服务端&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;服务端目前处理 pipeline 大致分成三块，视频分析，视频前处理，视频转码。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5388888888888889&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUUjJL1TFc1zYuyePqbK7OBWFUM8aTHz0G9qiack3KCHvnw0g29NjOtew/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;视频分析&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;视频分析上面我们有内部自研的无参考打分算法，详见之前的文章。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://mp.weixin.qq.com/s?__biz=Mzg3NTU3MzM0MQ==&amp;amp;mid=2247483871&amp;amp;idx=1&amp;amp;sn=0a47fcfbb902d60736475aa5d59999ac&amp;amp;token=971346764&amp;amp;lang=zh_CN&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;多媒体质量评价系统简介&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;多媒体质量评价系统简介&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;同时我们还有其他的分析处理，比如 ROI，基础特征分析，复杂度分析，视频基础参数等，依赖上述分析进行最终决策处理。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;视频处理&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;视频前处理上，目前已经和正在研究的算法类型非常多，我们通过端到端数据联合起来进行决策处理，目前主要使用的有超分，插帧，低质增强，去压缩失真等等。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;视频编码&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;编码标准定义的是解码器的格式和流程，而编码端是可以被各家公司各自优化的，如对于运动搜索的模块，可以在范围、大小、模块的选择上再进行算法设计和优化。因此同样一个标准的编码器，是可以有不同的编码器算法的，各个公司都有自己独特的设计。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;同样，我们公司也有自研的编码器算法，目前已经应用到了各个业务中。我们自研的编码器在 MSU 比赛中也取得了不错的成绩，获得了 17 项第一的好成绩。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4564814814814815&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUcibUMy6poTWUCDSxmN3NpuKUNwicpBseibKukW9ic9lNcj8nWBJXjZTUvQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;消费端&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;消费端目前我们也上线了超分和其他画质增强的处理，下面是超分在播放器上简单的 pipeline，这个过程也是经过很长时间的实验，达到性能和画质的平衡。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.24074074074074073&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOgk07b9ibNGKCTwyibeHqtSqUTnfrxn2drXPxbRzqN6onYpA0NMvpicvCj7BiaJtbTjTgXvulaLjgXXzw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个是线上实际超分效果 demo，从视频可以看出，超分带来的清晰度收益十分的显著；内部的数据显示：超分实验组业务核心指标（人均时长、人均 vv 和人均完播率）均显著正向，全用户次日留存波动偏正，人均活跃天数持续正向未显著。&lt;/p&gt;&lt;section/&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前超分在内部的业务应用十分广泛，抖音，点播，直播，西瓜，头条，皮皮虾等等；超分不仅带来了画质的收益，同时通过不同的策略，还能带来卡顿优化，带宽优化等。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;未来展望&lt;/h2&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;持续打磨无参考打分算法，能够更加细粒度的落地日常测试场景；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;探索更准确的主观量化方案，能够给出更准确的结论；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;AR VR MR 等未来场景探索画质评测手段和方案；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;HDR 更全面严谨的测试方案；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;高分辨率，帧率；例如 8K，120fps 等评测方案探索；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;美颜特效如何依赖主观和客观形成体系化标准；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;...&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;加入我们&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;抖音多媒体评测实验室是字节跳动多媒体画质和音质质量保障中台，通过专业的评测人员、实验室设备和业界领先的评测方案，服务于字节内部众多产品，包括抖音、今日头条、剪映、西瓜视频等 App，在端到端的全链路画质上通过手机厂商合作、视频编解码、图像算法增强、工程优化等方向进行画质测评，全面提升用户视听质量体验。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;团队发展迅速，年轻富有朝气，注重技术氛围建设，积极参与国内外各顶尖行业技术会议，输出高质量技术专利和相关论文，工作 Base 地有北京、深圳、杭州、上海等多地可选。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前团队急招图像测试工程师等岗位，加入我们，让你的每一行代码都能服务亿万用户！欢迎 &lt;strong&gt;戳阅读原文&lt;/strong&gt; 加入我们！&lt;/p&gt;&lt;/section&gt;
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>