<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>1b241b77409b0f9aad775cb49326e1ad</guid>
<title>2022 年来了！抓紧啦！</title>
<link>https://toutiao.io/k/rf8ezjy</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;weui-dialog&quot;&gt;
      &lt;p class=&quot;weui-dialog__hd&quot;&gt;&lt;strong class=&quot;weui-dialog__title&quot;&gt;&quot;Top Stories&quot; is disabled&lt;/strong&gt;&lt;/p&gt;
      &lt;p class=&quot;weui-dialog__bd&quot;&gt;
        Enable &quot;Top Stories&quot; in &quot;Settings&quot; &amp;gt; &quot;General&quot; &amp;gt; &quot;Manage Discover&quot;      &lt;/p&gt;
      
    &lt;/div&gt;
  &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>05a7928cb9700aadfe3c3f12e28dbccd</guid>
<title>一文读懂蓝绿发布、A/B 测试和金丝雀发布的优缺点</title>
<link>https://toutiao.io/k/dd76ptd</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p&gt;&lt;span&gt;‍‍‍&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-croporisrc=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/tMJtfgIIibWL1uI2nhcwI5BDO1look3Cj4UaK3F1kXJqD0dW07aiaSzRtUfGcI3VcfPmzjianibQra8KNRQicE5VHtQ/0?wx_fmt=jpeg&quot; data-cropx1=&quot;0&quot; data-cropx2=&quot;1000&quot; data-cropy1=&quot;17.30103806228374&quot; data-cropy2=&quot;453.287197231834&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.435&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjP0rgO7n8I0vRPQHibThvDzTXJia30I0iaT2WKR9dDYD8oJ2HF3d8pNNNw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1000&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;作者 | 扬少&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h1 data-lake-id=&quot;3968f4bcc3cf82abfbc02aed09f69519&quot;&gt;&lt;span&gt;&lt;strong&gt;背景&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;目前，业界已经总结出了几种常见的服务发布策略来解决版本升级过程中带来的流量有损问题。本文首先会对这些普遍的发布策略进行简单的原理解析，最后结合阿里云的云原生网关对这些发布策略进行实践。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h1 data-lake-id=&quot;84a9d12df914a9b17dc17475d1de26c2&quot;&gt;&lt;span&gt;&lt;strong&gt;发布策略&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;被业界广泛采用的服务发布策略包括蓝绿发布、A/B 测试以及金丝雀发布。&lt;/span&gt;&lt;/p&gt;&lt;h3 data-lake-id=&quot;a35743c789db2487c207ec28db344043&quot;&gt;&lt;br/&gt;&lt;/h3&gt;&lt;h2 data-lake-id=&quot;c1955fa8f0e34746b02b6339660bfe1b&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;1.蓝绿发布&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;蓝绿发布需要对服务的新版本进行冗余部署，一般新版本的机器规格和数量与旧版本保持一致，相当于该服务有两套完全相同的部署环境，只不过此时只有旧版本在对外提供服务，新版本作为热备。当服务进行版本升级时，我们只需将流量全部切换到新版本即可，旧版本作为热备。由于冗余部署的缘故，所以不必担心新版本的资源不够。如果新版本上线后出现严重的程序 BUG，那么我们只需将流量全部切回至旧版本，大大缩短故障恢复的时间。待新版本完成 BUG 修复并重新部署之后，再将旧版本的流量切换到新版本。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;蓝绿发布通过使用额外的机器资源来解决服务发布期间的不可用问题，当服务新版本出现故障时，也可以快速将流量切回旧版本。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;如图，某服务旧版本为 v1，对新版本 v2 进行冗余部署。版本升级时，将现有流量全部切换为新版本 v2。&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;362px&quot; data-ratio=&quot;0.22073170731707317&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjPPjmUd9yVtJa5FOEDF9KmImyWSPYLib9PV3RqAHctTIT5L2nhDToKicQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1640&quot; title=&quot;1.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;当新版本 v2 存在程序 BUG 或者发生故障时，可以快速切回旧版本 v1。&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;366px&quot; data-ratio=&quot;0.22509225092250923&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3Cjkibqiamzdyuffk1tXOzzd8FBiciaMyZecRAWlT9JFyjib96DjJNqfdSCMhw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1626&quot; title=&quot;2.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;蓝绿部署的优点：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1.部署结构简单，运维方便；&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2.服务升级过程操作简单，周期短。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;蓝绿部署的缺点：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1.资源冗余，需要部署两套生产环境；&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2.新版本故障影响范围大。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h2 data-lake-id=&quot;fdfec2977dca03a555679f6a04e648c0&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;2.A/B 测试&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;h3 data-lake-id=&quot;47aabaf9f9eb2a0623df816f10f958e6&quot;/&gt;&lt;p&gt;&lt;span&gt;相比于蓝绿发布的流量切换方式，A/B 测试基于用户请求的元信息将流量路由到新版本，这是一种基于请求内容匹配的灰度发布策略。只有匹配特定规则的请求才会被引流到新版本，常见的做法包括基于 Http Header 和 Cookie。基于 Http Header 方式的例子，例如 User-Agent 的值为 Android 的请求 （来自安卓系统的请求）可以访问新版本，其他系统仍然访问旧版本。基于 Cookie 方式的例子，Cookie 中通常包含具有业务语义的用户信息，例如普通用户可以访问新版本，VIP 用户仍然访问旧版本。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;如图，某服务当前版本为 v1，现在新版本 v2 要上线。希望安卓用户可以尝鲜新功能，其他系统用户保持不变。&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;362px&quot; data-ratio=&quot;0.218335343787696&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3Cj3p7GWBCoz1X7iaib1dZenQPlVDoM2CKxmbndHua2gDsSstiaQGRuVP0VQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1658&quot; title=&quot;3.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;通过在监控平台观察旧版本与新版本的成功率、RT 对比，当新版本整体服务预期后，即可将所有请求切换到新版本 v2，最后为了节省资源，可以逐步下线到旧版本 v1。&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;364px&quot; data-ratio=&quot;0.2169249106078665&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3Cj1eVOfSrI2TxIYt6gzoZdAYxwYe2y97qRaVVJjFMh2kE1qp0EqlZuWA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1678&quot; title=&quot;4.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;A/B 测试的优点：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1.可以对特定的请求或者用户提供服务新版本，新版本故障影响范围小；&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2.需要构建完备的监控平台，用于对比不同版本之间请求状态的差异。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;A/B 测试的缺点：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1.仍然存在资源冗余，因为无法准确评估请求容量；&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2.发布周期长。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h2 data-lake-id=&quot;cc414a4c04eeb8f79eafac0a708b94f9&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;3.金丝雀发布&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在蓝绿发布中，由于存在流量整体切换，所以需要按照原服务占用的机器规模为新版本克隆一套环境，相当于要求原来1倍的机器资源。在 A/B 测试中，只要能够预估中匹配特定规则的请求规模，我们可以按需为新版本分配额外的机器资源。相比于前两种发布策略，金丝雀发布的思想则是将少量的请求引流到新版本上，因此部署新版本服务只需极小数的机器。验证新版本符合预期后，逐步调整流量权重比例，使得流量慢慢从老版本迁移至新版本，期间可以根据设置的流量比例，对新版本服务进行扩容，同时对老版本服务进行缩容，使得底层资源得到最大化利用。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;如图，某服务当前版本为 v1，现在新版本 v2 要上线。为确保流量在服务升级过程中平稳无损，采用金丝雀发布方案，逐步将流量从老版本迁移至新版本。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;1334px&quot; data-ratio=&quot;0.802647412755716&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjEjNQ5UlLFfKAyOrmCkKjNTKZQiab0JfNwD8ErWtD4avs5wdGmY0Wwbw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1662&quot; title=&quot;5.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;金丝雀发布的优点：&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1.按比例将流量无差别地导向新版本，新版本故障影响范围小；&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2.发布期间逐步对新版本扩容，同时对老版本缩容，资源利用率高。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;金丝雀发布的缺点：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1.流量无差别地导向新版本，可能会影响重要用户的体验；&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2.发布周期长。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h1 data-lake-id=&quot;5153d649a8741bb1080186e3439e266c&quot;&gt;&lt;span&gt;&lt;strong&gt;实践&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;接下来，我们会基于阿里云的容器运维平台 ACK 以及 MSE 云原生网关对以上介绍的三种发布策略进行实践。这里我们采用最简单的业务架构来展示，即一个云原生网关、一个后端服务（响应中返回当前版本信息）和注册中心。注册中心决定了业务架构中服务发现方式，我们会分别以 K8s 容器服务和 Nacos 两种服务发现机制来实践不同的发布策略。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h2 data-lake-id=&quot;08019d266e031e483e6d1c90970f4d05&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;1.前提条件&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;&lt;/p&gt;&lt;h3 data-lake-id=&quot;bd0136696dabd48e631c9c73730f3b3c&quot;/&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h2 data-lake-id=&quot;88cca6a0d9a1cd13364d819f2031022a&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;2.服务发现方式：K8s 容器服务&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;&lt;/p&gt;&lt;h3 data-lake-id=&quot;9e290c61b8c42854af30af99c9fded15&quot;/&gt;&lt;p&gt;&lt;span&gt;在这个例子中，我们使用 K8s 原生的服务发现方式，即通过声明式 Service API 资源将后端服务注册到 CoreDNS。例子中的后端服务提供一个查询当前版本的接口/version，并且当前版本为 v1。云原生网关深度集成 ACK，可以实时动态地从 ACK 集群中获取服务信息，方便通过云原生网关将该后端服务暴露给外部用户。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;业务架构如下图：&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;780px&quot; data-ratio=&quot;0.6141732283464567&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjYDYz8xkqQNRUfagYkk0k1185ySPe9r3zkjdKSJmPIe7m2MDBibHTbUA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1270&quot; title=&quot;6.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h4 data-lake-id=&quot;3f51412477ee2bbb0345f9735c26dd44&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;1.部署&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;将以下资源（Service和Deployment）应用到 ACK 集群，完成后端服务的部署和发布，当前应用版本为 v1。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;section&gt;&lt;pre&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;apiVersion: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;kind: Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;  name: httpbin&lt;br/&gt;&lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;  ports:&lt;br/&gt;  - port: 8080&lt;br/&gt;    protocol: TCP&lt;br/&gt;  selector:&lt;br/&gt;    app: httpbin&lt;br/&gt;---&lt;br/&gt;&lt;span&gt;apiVersion: apps/v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;kind: Deployment&lt;/span&gt;&lt;br/&gt;&lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;  name: httpbin-v1&lt;br/&gt;&lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;  replicas: 3&lt;br/&gt;  selector:&lt;br/&gt;    matchLabels:&lt;br/&gt;      app: httpbin&lt;br/&gt;      version: v1&lt;br/&gt;  template:&lt;br/&gt;    metadata:&lt;br/&gt;      labels:&lt;br/&gt;        app: httpbin&lt;br/&gt;        version: v1&lt;br/&gt;    spec:&lt;br/&gt;      containers:&lt;br/&gt;      - image: specialyang/spring-cloud-httpbin-k8s:v1&lt;br/&gt;        imagePullPolicy: Always&lt;br/&gt;        name: spring-cloud-httpbin-k8s&lt;br/&gt;        ports:&lt;br/&gt;        - containerPort: 8080&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;&lt;p&gt;&lt;span&gt;在云原生网关的服务管理-&amp;gt;来源管理中，添加目标 ACK 集群。&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;350px&quot; data-ratio=&quot;0.12393767705382436&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjibxyLZAJnTPoTsWtmnQw3Ua44yEgvaggvnruiadaaia7KJaAias4EI8gEg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2824&quot; title=&quot;7.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在服务管理中导入要暴露给云原生网关的服务 httpbin。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;328px&quot; data-ratio=&quot;0.11573747353563868&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjX5bnGV5aEygquaI5KynJia2bY5ZD9voolnBT0ULd7qBia9WwTicoVnQAg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2834&quot; title=&quot;8.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在 httpbin 服务的策略配置中添加服务版本 v1，注意需要选择对应的标签来筛选出 v1 版本的节点，因为目前我们只部署了 v1 版本，所以 v1 版本的节点数占总实例数 100%。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;428px&quot; data-ratio=&quot;0.17398373983739837&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3Cjt3sx2x5tibia8icBtslk6ibnNM4sTds1vrJHZQn84Tick6lFnrYy9kI3TVA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2460&quot; title=&quot;9.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在路由管理中为该服务创建一条路由规则，从而将服务暴露给外部用户。httpbin 服务暴露的 api 的 path 为/version，请求转发至服务 httpbin 的 v1 版本。&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;260px&quot; data-ratio=&quot;0.10492332526230831&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjPIuIZpaDricXicEBVPV4QKnW7Fibibp99HWnJZ6ib0qRFhHAakFQPajo7rw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2478&quot; title=&quot;10.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;执行以下脚本测试请求的响应结果。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;section&gt;&lt;pre&gt;&lt;p&gt;&lt;span&gt;for i in {1..10}; do curl &lt;span&gt;&quot;${GATEWAY_EXTERNAL_IP}/version&quot;&lt;/span&gt;; echo &lt;span&gt;&quot;&quot;&lt;/span&gt;;  done&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;&lt;/section&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;2.蓝绿部署&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;蓝绿部署需要按照服务当前版本所占用的资源状况为服务新版本申请同样的资源规格，部署完毕之后将流量整体切换到服务新版本。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;768px&quot; data-ratio=&quot;0.6075949367088608&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjRqHu0bMI4CZ39DZXTpiaDvR515iboiblzJDgzH8YpqyAj4ZAq6MibibMyDQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1264&quot; title=&quot;11.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;利用 K8s 的声明式 API 资源部署 httpbin 服务的新版本 v2，副本数同样是 3。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;section&gt;&lt;pre&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;apiVersion: apps/v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;kind: Deployment&lt;/span&gt;&lt;br/&gt;&lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;  name: httpbin-v2&lt;br/&gt;&lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;  replicas: 3&lt;br/&gt;  selector:&lt;br/&gt;    matchLabels:&lt;br/&gt;      app: httpbin&lt;br/&gt;      version: v2&lt;br/&gt;  template:&lt;br/&gt;    metadata:&lt;br/&gt;      labels:&lt;br/&gt;        app: httpbin&lt;br/&gt;        version: v2&lt;br/&gt;    spec:&lt;br/&gt;      containers:&lt;br/&gt;      - image: specialyang/spring-cloud-httpbin-k8s:v2&lt;br/&gt;        imagePullPolicy: Always&lt;br/&gt;        name: spring-cloud-httpbin-k8s&lt;br/&gt;        ports:&lt;br/&gt;        - containerPort: 8080&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;&lt;/section&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在 httpbin 服务的策略配置中添加服务版本 v2，注意需要选择对应的标签来筛选出 v2 版本的节点，集群中现在 v1 和 v2 版本的节点数一致，所以各占 50%。&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;446px&quot; data-ratio=&quot;0.18248772504091654&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjTHFoemIUzpklbGtJYLkXL6Wtw1zKicIYv9ZBfx1xWkIG760pU8gp2tA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2444&quot; title=&quot;12.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;现在，我们开始利用蓝绿发布的思想将流量从 v1 整体切换至 v2，仅需要之前修改上面创建的路由规则中目标服务即可。&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;240px&quot; data-ratio=&quot;0.09724473257698542&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjMgLGDJLN1SXVSAa1brwW1y3EvTSaHTtVC2UtVSEwZA6OyYeFiaFoSdw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2468&quot; title=&quot;13.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;执行以下脚本测试请求的响应结果。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;section&gt;&lt;pre&gt;&lt;p&gt;&lt;span&gt;for i in {1..10}; do curl &lt;span&gt;&quot;${GATEWAY_EXTERNAL_IP}/version&quot;&lt;/span&gt;; echo &lt;span&gt;&quot;&quot;&lt;/span&gt;;  done&lt;br/&gt;&lt;span&gt;version: v2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v2&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;/pre&gt;&lt;p&gt;&lt;span&gt;现在我们发现访问 api 资源/version 的请求的流量已经全部从 v1 切换至 v2。&lt;/span&gt;&lt;/p&gt;&lt;h4 data-lake-id=&quot;5da09753caad3a27a91dd6bb139be055&quot;&gt;&lt;br/&gt;&lt;/h4&gt;&lt;h4 data-lake-id=&quot;0acdf656716830eb6b1e548c9a245a06&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;3.A/B测试&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&lt;/p&gt;&lt;h4 data-lake-id=&quot;9473eb0e33352e807bc95d2e277cb6ac&quot;/&gt;&lt;p&gt;&lt;span&gt;A/B 测试基于用户请求的元信息将流量路由到新版本，换句话说，就是可以根据请求内容来动态路由。举个例子，我们希望 User-Agent 的值为 Android 的请求 （来自安卓系统的请求）可以访问新版本，其他系统仍然访问旧版本。&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;766px&quot; data-ratio=&quot;0.6060126582278481&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjbruyqczpMhIweyrOBhg0qfQ4n64Mek1gOiaib5Sia80bet5FmeZ1G2qpg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1264&quot; title=&quot;14.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;我们仍然利用上面实践中部署的 httpbin 的 v1，v2 的 deployment。此外，需要创建两条路由规则：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;322px&quot; data-ratio=&quot;0.13100081366965013&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjIJXzUMmqkdVgKuBncZYFgqPWeqntxN6EHcS5FuQyYTSOuoDyNjRDtg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2458&quot; title=&quot;15.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;注意相比 version 路由规则，version-v2 的路由规则中需要增加请求头匹配规则。&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;276px&quot; data-ratio=&quot;0.19166666666666668&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjSl1U5U8Micf5wBxwubQGicPp2W3icvVbNmU7qc1uYaVYKMicqwwfLaibmoA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1440&quot; title=&quot;16.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;通过以下脚本测试 A/B test 的效果。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;section&gt;&lt;pre&gt;&lt;p&gt;&lt;span&gt;// user agent中不含有 android&lt;br/&gt;curl &lt;span&gt;${GATEWAY_EXTERNAL_IP}&lt;/span&gt;/version&lt;br/&gt;version: v1&lt;br/&gt;// user agent中含有 android&lt;br/&gt;curl -H &lt;span&gt;&quot;User-Agent: Mozilla/5.0 (Linux; Android 4.0.3)&quot;&lt;/span&gt; &lt;span&gt;${GATEWAY_EXTERNAL_IP}&lt;/span&gt;/version&lt;br/&gt;version: v2&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;/pre&gt;&lt;p&gt;&lt;span&gt;可以看出，当前请求会按照来源的操作系统对流量进行分流。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h4 data-lake-id=&quot;82c49434e67e4f1ddce69c7326e0d306&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;4.金丝雀发布&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;金丝雀发布允许引流一小部分流量到服务新版本，待验证通过后，逐步调大流量，直至切流完毕，期间可伴随着新版本的扩容，旧版本的缩容操作，达到资源利用率最大化。&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;768px&quot; data-ratio=&quot;0.6114649681528662&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjxxdB8Z3VV3Wsh1B0MzTcF77Osb4Piaczky6ne43T0oRkTicUzlEMBQjA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1256&quot; title=&quot;17.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在金丝雀发布策略中，服务新版本的副本初始部署数无需与原始保持一致。仅需保持资源始终满足灰度流量，所以我们将新版本的副本数调为 1，可以在服务策略中服务版本模块看到当前各版本节点数的占比情况。&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;444px&quot; data-ratio=&quot;0.18226600985221675&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjthqgdqGdBgTaicdqicrmoY4ibJZXvquVS8qjiaYqm0m426iaFIkmxop7kUA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2436&quot; title=&quot;18.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;清除掉其他发布策略遗留的路由规则，我们新创建一条路由规则，在目标服务中按照权重将流量转发至新旧版本。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;278px&quot; data-ratio=&quot;0.11319218241042345&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjMkZoJuUOvr94l6aIiaQspE4kKrmEAA2gYk1zaKiah0aMpjaZXrLVBlsg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2456&quot; title=&quot;19.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;其中，目标服务需要配置两个目的地，httpbin 的 v1 和 v2 版本，并设置对应的流量比。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;542px&quot; data-ratio=&quot;0.36522911051212936&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3Cjmo2zYrXgDwu2k4zkbVFxLDsD3jCTcvgYPy3lMVWGu3EhEkFumuZLibw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1484&quot; title=&quot;20.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;通过以下脚本测试金丝雀发布的效果。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;section&gt;&lt;pre&gt;&lt;p&gt;&lt;span&gt;for i in {1..10}; do curl &lt;span&gt;&quot;${GATEWAY_EXTERNAL_IP}/version&quot;&lt;/span&gt;; echo &lt;span&gt;&quot;&quot;&lt;/span&gt;;  done&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;&lt;/section&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在以上测试结果中，可以发现 10 个请求中，有 2 个是访问的新版本 v2，其流量比确实符合期望的 8:2。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在真实业务场景中，新版本验证完毕后，就可以继续调大访问新版本的流量权重，期间注意对新版本扩容，按需对旧版本缩容。&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;h2 data-lake-id=&quot;6764cc140fa6990295b053abddb399c6&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;3.服务发现方式：Nacos 注册中心&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;&lt;/p&gt;&lt;h3 data-lake-id=&quot;30d62b2cccc82bd143fefa1fa7cff49e&quot;/&gt;&lt;p&gt;&lt;span&gt;Kubernetes 平台为容器化应用带来了动态弹性，加快了应用交付进程，提高了底层资源的利用率，但在服务发现能力上，相比其他主流注册中心 Nacos、Consul 等，其功能完整性、可用性上略显不足。因此，即使大部分业务应用已经迁移至 Kubernetes 运维平台，但仍然选择为业务保留了原始的注册中心。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;针对这种业务场景，我们额外举例当使用 Nacos 注册中心时，如何为服务进行蓝绿发布、A/B 测试和金丝雀发布。例子中的后端服务提供一个查询当前版本的接口/version，并且当前版本为 v1。云原生网关深度集成 MSE Nacos 注册中心，可以实时动态地从 Nacos 实例中获取服务信息，方便通过云原生网关将该后端服务暴露给外部用户。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;业务架构如下图：&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;h4 data-lake-id=&quot;9fced46ca842387a90c09fb4b4f1d5ac&quot;&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;652px&quot; data-ratio=&quot;0.5158227848101266&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3Cj0EwgMBQ0aGsbRn5kzb24NceiaiacKuHvNmibnD1ibPCP0Hp6dsYPAyfpCg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1264&quot; title=&quot;21.png&quot;/&gt;&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&lt;/p&gt;&lt;h4 data-lake-id=&quot;8caf21c4d1fdb54076e7d55867295590&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;1.部署&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;将以下资源（Deployment）应用到 ACK 集群，完成后端服务的部署，并将服务发布到 Nacos 注册中心，当前应用版本为 v1。需要注意以下几点：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1.该 yaml 资源中变量${NACOS_SERVER_ADDRESS}需要替换为你的 MSE Nacos 地址，如果和网关在一个 VPC，那么内网域名即可；否则，你需要配置公网域名。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2.在 K8s Service 服务发现中，Pod 中 Labels 信息可看做是节点的元数据信息。而在 Nacos 注册中心中，节点的元数据信息取决于服务注册时携带的信息。在 Spring Cloud 框架中，通过环境变量 spring.cloud.nacos.discovery.metadata.xxx 无侵入式为节点添加元数据信息，在该例子中，我们以 version 作为版本标用来区分不同版本的节点。因此，需要为业务容器添加环境变量 spring.cloud.nacos.discovery.metadata.version=v1。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;section&gt;&lt;pre&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;apiVersion: apps/v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;kind: Deployment&lt;/span&gt;&lt;br/&gt;&lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;  name: httpbin-v1&lt;br/&gt;&lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;  replicas: 3&lt;br/&gt;  selector:&lt;br/&gt;    matchLabels:&lt;br/&gt;      app: httpbin&lt;br/&gt;  template:&lt;br/&gt;    metadata:&lt;br/&gt;      labels:&lt;br/&gt;        app: httpbin&lt;br/&gt;    spec:&lt;br/&gt;      containers:&lt;br/&gt;      - image: specialyang/spring-cloud-httpbin-nacos:v1&lt;br/&gt;        imagePullPolicy: Always&lt;br/&gt;        name: spring-cloud-httpbin-nacos&lt;br/&gt;        ports:&lt;br/&gt;        - containerPort: 8080&lt;br/&gt;        env:&lt;br/&gt;        - name: spring.cloud.nacos.discovery.server-addr&lt;br/&gt;          value: ${NACOS_SERVER_ADDRESS}&lt;br/&gt;        - name: spring.cloud.nacos.discovery.metadata.version&lt;br/&gt;          value: v1&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;&lt;/section&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在云原生网关的服务管理-&amp;gt;来源管理中，添加目标 MSE Nacos 注册中心集群。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;286px&quot; data-ratio=&quot;0.11626016260162601&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3Cj5LEDQRj9laLSUtGQ8gicibficjghDuWLCl9Q3gmLHf34wBHs70wkPbZLQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2460&quot; title=&quot;22.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在服务管理中导入要暴露给云原生网关的服务 httpbin，注意服务来源选择 MSE Nacos 注册中心。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;248px&quot; data-ratio=&quot;0.1008130081300813&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjQNPY25Zc7UXFj0fjOKjA1mVC3UPVc8Bn0X17pm4j3L01ykQuH6fficA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2460&quot; title=&quot;23.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;与 K8s Service 服务发现的例子一样，在策略配置中添加服务版本 v1，标签名和标签值可以选择为我们在 httpbin 服务注册时添加的元数据信息 version=v1。之后配置路由匹配 path为/version 的请求转发至 httpbin 服务的 v1 版本。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;执行以下脚本测试请求的响应结果。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;section&gt;&lt;pre&gt;&lt;p&gt;&lt;span&gt;for i in {1..10}; do curl &lt;span&gt;&quot;${GATEWAY_EXTERNAL_IP}/version&quot;&lt;/span&gt;; echo &lt;span&gt;&quot;&quot;&lt;/span&gt;;  done&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;version: v1&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;/pre&gt;&lt;h4 data-lake-id=&quot;a3e5f3f8464e0570044bd7f0ade0f9d5&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;2.蓝绿部署&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&lt;/p&gt;&lt;h4 data-lake-id=&quot;711be72e34e90adbf28ee9aee4d5cd64&quot;/&gt;&lt;p&gt;&lt;span&gt;其发布策略如下图所示：&lt;img data-height=&quot;1px&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjFRwedic9nR73jK8Jb7277dhN36na7icYlvONGO7xfrXmkntfXGiaOYnNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1&quot; title=&quot;image.gif&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;652px&quot; data-ratio=&quot;0.5182829888712241&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3Cjg48pzlNIYhcQ2hfFGNmYmGwNWkN0MJaLfeZiaCE7iay9cKdSbRUgV06w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1258&quot; title=&quot;24.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;部署 httpbin 服务的新版本 v2，注意注册中心与上面保持一致，同时为业务容器增加环境变量 spring.cloud.nacos.discovery.metadata.version=v2，业务应用启动时会向指定 Nacos 注册服务，同时携带上用户自定义的元数据信息。云原生网关可以利用这些元数据信息来对节点区分不同的版本。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;section&gt;&lt;pre&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;apiVersion: apps/v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;kind: Deployment&lt;/span&gt;&lt;br/&gt;&lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;  name: httpbin-v2&lt;br/&gt;&lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;  replicas: 3&lt;br/&gt;  selector:&lt;br/&gt;    matchLabels:&lt;br/&gt;      app: httpbin&lt;br/&gt;  template:&lt;br/&gt;    metadata:&lt;br/&gt;      labels:&lt;br/&gt;        app: httpbin&lt;br/&gt;    spec:&lt;br/&gt;      containers:&lt;br/&gt;      - image: specialyang/spring-cloud-httpbin-nacos:v2&lt;br/&gt;        imagePullPolicy: Always&lt;br/&gt;        name: spring-cloud-httpbin-nacos&lt;br/&gt;        ports:&lt;br/&gt;        - containerPort: 8080&lt;br/&gt;        env:&lt;br/&gt;        - name: spring.cloud.nacos.discovery.server-addr&lt;br/&gt;          value: ${NACOS_SERVER_ADDRESS}&lt;br/&gt;        - name: spring.cloud.nacos.discovery.metadata.version&lt;br/&gt;          value: v2&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;/pre&gt;&lt;p&gt;&lt;span&gt;与 K8s Service 的例子中蓝绿发布操作一样，在 httpbin 服务的策略配置中添加服务版本 v2，然后将路由规则中的目标服务 httpbin 的 v1 版本修改为 v2 版本，发布成功之后，查看请求结果全部为 version: v2。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h4 data-lake-id=&quot;f4f983c0fa52653cbbb6d78e4f19e653&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;3.A/B 测试&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;其发布策略如下图所示：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;656px&quot; data-ratio=&quot;0.5222929936305732&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjHmWCzQofKqvibyHJJ87HT0htHXaE3psoDc70v4ufZkWOznsgM6BBndA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1256&quot; title=&quot;25.png&quot;/&gt;&lt;span&gt;‍&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;‍&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;我们同样用之前的例子，User-Agent 的值为 Android 的请求 （来自安卓系统的请求）可以访问新版本，其他系统仍然访问旧版本。涉及的路由规则的操作、与验证方式与 K8s Service 的例子一致。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h4 data-lake-id=&quot;9138876741d4906d455bbff264946202&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;4.金丝雀发布&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;其发布策略如下图所示：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;648px&quot; data-ratio=&quot;0.5142857142857142&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWL1uI2nhcwI5BDO1look3CjZ0w57CeN5vPk8ibZU40rvRar592KTs5OAIY7nTPzMibiaFYR2sSxmmcCA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1260&quot; title=&quot;26.png&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;同样，涉及的路由规则的操作、与验证方式与 K8s Service 的例子一致。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h1 data-lake-id=&quot;32c9a382c150d7bf28ee463d6d196f6f&quot;&gt;&lt;span&gt;&lt;strong&gt;总结&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;本文对常见的发布策略进行了简单介绍和原理解析，并以图文并茂的方式对每个发布策略进行了详细探讨，总结如下：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;云原生网关以托管的方式来作为您的流量入口，提供了丰富的流量治理能力，支持多种服务发现方式，如 K8s Service、Nacos、Eurake、ECS 和域名，并以统一的模型支持了服务版本以及灰度发布能力。在上面的实践中，可以发现两种服务发现方式仅仅是元数据信息所处的位置不同，但服务版本管理以及路由规则中的灰度发布模型都是一致的，您可以轻松学会为不同服务发现方式的服务进行灰度发布，确保版本升级过程中平滑无损。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;精&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;&lt;span&gt;彩推荐&lt;/span&gt;&lt;/strong&gt;&lt;strong/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzI0NTE4NjA0OQ==&amp;amp;mid=2658380199&amp;amp;idx=1&amp;amp;sn=2990d309df47e7309f23dcd48a245aa1&amp;amp;chksm=f2d562c9c5a2ebdf2b4a08207451bf8a06987149ff141855e773adc383308cb8745cc9f41cd8&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;你已选中了添加链接的内容&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;11&quot; tab=&quot;innerlink&quot; data-linktype=&quot;1&quot;&gt;&lt;span&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4255555555555556&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/tMJtfgIIibWL9gaKlucCgIC9J7TJCDnibeVgqk42RYQwqX1PbqV3sOWBOzbC9Hflibgib2LicLvh8WXf3icJ5O3vXEVQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;900&quot;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzI0NTE4NjA0OQ==&amp;amp;mid=2658380190&amp;amp;idx=1&amp;amp;sn=88e730edc85038fec8105e0a1adfc66a&amp;amp;chksm=f2d562f0c5a2ebe66b6c71d50db53a1c79cc47390af2fe945cedf7bf9ca641527dc1713591b7&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;你已选中了添加链接的内容&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;1&quot; wah-hotarea=&quot;click&quot; hasload=&quot;1&quot;&gt;&lt;span&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4255555555555556&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/tMJtfgIIibWKOZ4n2ia8n3daNicX7HyNcO3plkxsPiaDKtVOfANCCRN7s9xxAnlhk7u5PpDKibkcZCTMNzBJY0ox0kw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;900&quot;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzI0NTE4NjA0OQ==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJZdQ8EicOpoDF9lteAE7gGBotfOe7nZWKicaoH7URJUKISmAkBp7SiakzBrEqib5ZeZYrmIUClJUt1vQ/0?wx_fmt=png&quot; data-nickname=&quot;阿里云云栖号&quot; data-alias=&quot;yunqiinsight&quot; data-signature=&quot;阿里云官网内容平台，汇聚阿里云优质内容（入门、文档、案例、最佳实践、直播等）。&quot; data-from=&quot;1&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;‍&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;点击上方  一键关注&lt;/span&gt;&lt;/strong&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;从现在开始 学习技术&lt;/span&gt;&lt;/strong&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;↓ 新年来临 阿里云最新、最热、最全的活动已全面开启 🔔  &lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>a98e0aaf092a03c63a41b61658a72ecf</guid>
<title>Python再获年度编程语言，微软或成最大赢家</title>
<link>https://toutiao.io/k/22vru46</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;section data-mpa-powered-by=&quot;yiban.io&quot; data-darkmode-bgcolor-16095509242984=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16095509242984=&quot;rgb(255, 255, 255)&quot; data-style=&quot;white-space: normal; max-width: 100%; letter-spacing: 0.544px; text-size-adjust: auto; background-color: rgb(255, 255, 255); font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__0&quot;&gt;&lt;section data-darkmode-bgcolor-16095509242984=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16095509242984=&quot;rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16095509242984=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16095509242984=&quot;rgb(255, 255, 255)&quot;&gt;&lt;section data-id=&quot;85660&quot; data-custom=&quot;rgb(117, 117, 118)&quot; data-darkmode-bgcolor-16095509242984=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16095509242984=&quot;rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16095509242984=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16095509242984=&quot;rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16095509242984=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16095509242984=&quot;rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16095509242984=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16095509242984=&quot;rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16095509242984=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16095509242984=&quot;rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16095509242984=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16095509242984=&quot;rgb(255, 255, 255)&quot;&gt;&lt;section data-id=&quot;85660&quot; data-custom=&quot;rgb(117, 117, 118)&quot; data-darkmode-bgcolor-16095509242984=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16095509242984=&quot;rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16095509242984=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16095509242984=&quot;rgb(255, 255, 255)&quot; data-style=&quot;margin-top: 2em; padding-top: 0.5em; padding-bottom: 0.5em; max-width: 100%; border-style: solid none; text-decoration: inherit; border-top-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-top-width: 1px; border-bottom-width: 1px; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__1&quot;&gt;&lt;section&gt;&lt;span&gt;机器之心报道&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;编辑：蛋酱、小舟&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;blockquote data-type=&quot;2&quot; data-url=&quot;&quot; data-author-name=&quot;&quot; data-content-utf8-length=&quot;21&quot; data-source-title=&quot;&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;这已是 Python 第五次被评为 Tiobe 年度编程语言。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;成立于 2000 年的 Tiobe 公司，二十多年来一直以衡量编程语言流行度而闻名。由 Tiobe 推出的年度编程语言奖项 2021 年再度花落 Python，这是 Python 连续第二年被评为年度编程语言，也是第五次获得该奖项。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;该奖项旨在颁发给一年内使用率增幅最大的编程语言。Tiobe 表示，C# 的增幅原本有望首次夺冠，然而 Python 在 2021 年最后一个月超过了 C#。Python 近年来的流行得益于机器学习、数据科学等领域的推动。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.471875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gWicHQ3ia1WuiaDmJseibjrfDn10zhxLz544Yhgr4rxc27zZJRzoZ4yRqO6qTsbWLoBFwYufxyR1bjEQjw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Tiobe 的排名是基于搜索引擎统计的，根据开发人员搜索的编程语言关键词，按搜索份额划分。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Tiobe 的年度排名也反映出微软对于开发者的重要性。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;微软在 2020 年聘请了 Python 之父 Guido van Rossum，旨在提高 Python 语言的效率。Python 在高端硬件上运行良好，在移动设备上运行滞后，但它为 Azure 等云平台上的开发创造了机会。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;1.2507122507122508&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gWicHQ3ia1WuiaDmJseibjrfDn10UBerZAV6oZ6diaRzQpWtKbaZKYaUg8C6icthJdIN0vphvLIR9MruaDIg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;702&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;Python 之父 Guido van Rossum&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Tiobe 的年度排名中第二受欢迎的语言 C# 则是由微软技术研究员 Anders Hejlsberg 为 .NET Framework 和微软的开发者工具 Visual Studio 设计的语言。 &lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;相比之下，尽管 Java 仍是开发者们学习的基本语言，但企业应用的标准已从 Java 变为 Python。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;「虽然距离 Java 在 2001 年创下 26.49% 的历史记录还很遥远，但 Python 已经成为许多领域事实上的标准编程语言，而这种胜利并不会很快停止，」 Tiobe 主席 Paul Jensen 指出潜在的新竞争者的数量是有限的：「除了 Swift 和 Go 之外，我们预计不会很快有任何新语言进入前 5 名甚至前 3 名。」&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;今年的排行榜中出现了一些搅局者。Rust 是一种处理内存安全漏洞的系统编程语言，目前排名 26 位， 领先于 MIT 的 Julia 和 Kotlin，一种由谷歌认可的用于 Android 应用程序开发的语言。 &lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Rust 在 2021 年的表现很突出，得到了 Facebook、AWS、微软 Azure 和谷歌云的支持。 &lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Tiobe 称，苹果的 Swift（用于 iOS 和 macOS 应用程序开发）从第 13 位跃升至第 10 位，而谷歌的 Go 从第 14 位略微升至第 13 位，Kotlin 从第 40 位上升到第 29 位，谷歌的 Dart 从第 25 位跌至第 37 位，Julia 从第 23 位跌至第 28 位，而微软的 TypeScript 从第 42 位跌至第 49 位。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt; &lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Tiobe 2022 年 1 月榜单中，排名前 10 位的语言是 Python、C、Java、C++、C#、Visual Basic、JavaScript、汇编语言、SQL 和 Swift。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.61171875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gWicHQ3ia1WuiaDmJseibjrfDn10jIpnZlviazIMj0vgGdSDGSaxraE4iaibFqGLzKJuAuhfnQgr2MdBvNWaw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;参考链接：https://www.zdnet.com/article/top-programming-languages-this-developer-favorite-shows-no-sign-of-slowing-down/&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;578&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;192&quot; data-ratio=&quot;1.77734375&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gWicr7bCQicQzg3uKibL9p92bbJcWxMG82TQR0GyDrlMkjhleEev5IJQLx1gbdicjTsZ0daJftAia1krUFQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;© THE END &lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;转载请联系本公众号获得授权&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;投稿或寻求报道：content@jiqizhixin.com&lt;/span&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>1ba65cd5749e9f2d07a0291d3d8a3286</guid>
<title>Hbase构建二级索引的一些解决方案</title>
<link>https://toutiao.io/k/m6v0i1g</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.535931790499391&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/cAoClgx53Vs1Txw7dmxdKshDJdSN0icIHJqDKCe0K3IHeDU7R7QVRKcHDSsYY24OWibqLa6scEIHOSNjukXhDEIg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;821&quot;/&gt;&lt;figcaption&gt;hbase构建二级索引&lt;/figcaption&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;1 为什么需要二级索引&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;HBase的一级索引就是&lt;code&gt;rowkey&lt;/code&gt;，我们仅仅能通过&lt;code&gt;rowkey&lt;/code&gt;进行检索。假设我们相对&lt;code&gt;Hbase&lt;/code&gt;里面列族的列列进行一些组合查询，就只能全表扫描了。表如果较大的话，代价是不可接受的，所以要提出二级索引的方案。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;二级索引的思想&lt;/strong&gt;：简单理解就是，根据列族的列的值，查出&lt;code&gt;rowkey&lt;/code&gt;，再按照&lt;code&gt;rowkey&lt;/code&gt;就能很快从&lt;code&gt;hbase&lt;/code&gt;查询出数据，我们需要构建出根据列族的列的值，很快查出&lt;code&gt;rowkey&lt;/code&gt;的方案。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2 常见的二级索引方案&lt;/h2&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;MapReduce&lt;/code&gt;方案；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;Coprocessor&lt;/code&gt;方案；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;elasticsearch+hbase&lt;/code&gt;方案；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;Solr+hbase&lt;/code&gt;方案；&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2.1 MapReduce方案&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;IndexBuilder：利用MR的方式构建Index
长处：并发批量构建Index
缺点：不能实时构建Index&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;举例：&lt;/strong&gt;原表：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;row  1      f1:name  zhangsan&lt;br/&gt;row  2      f1:name  lisi&lt;br/&gt;row  3      f1:name  wangwu&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;索引表：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;row     zhangsan    f1:id   1&lt;br/&gt;row     lisi        f1:id   2&lt;br/&gt;row     wangwu      f1:id   3&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这种方式的思想是再构建一张&lt;code&gt;hbase&lt;/code&gt;表，列族的列这里的&lt;code&gt;name&lt;/code&gt;作为索引表的&lt;code&gt;rowkey&lt;/code&gt;，根据&lt;code&gt;rowkey&lt;/code&gt;查询出数据hbase是很快的，拿到&lt;code&gt;id&lt;/code&gt;后，也就拿到了原表的&lt;code&gt;rowkey&lt;/code&gt;了，因为源表的&lt;code&gt;rowkey&lt;/code&gt;就是&lt;code&gt;id&lt;/code&gt;，每次查询一共需要查询两张表。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2.2 Coprocessor方案&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;有关协处理器的讲解，Hbase官方文档是最好的，这里大体说一下它的作用与使用方法。&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Coprocessor提供了一种机制可以让开发者直接在RegionServer上运行自定义代码来管理数据。通常我们使用get或者scan来从Hbase中获取数据，使用Filter过滤掉不需要的部分，最后在获得的数据上执行业务逻辑。但是当数据量非常大的时候，这样的方式就会在网络层面上遇到瓶颈。客户端也需要强大的计算能力和足够大的内存来处理这么多的数据，客户端的压力就会大大增加。但是如果使用Coprocessor，就可以将业务代码封装，并在RegionServer上运行，也就是数据在哪里，我们就在哪里跑代码，这样就节省了很大的数据传输的网络开销。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Coprocessor有两种：Observer和Endpoint
EndPoint主要是做一些计算用的，比如计算一些平均值或者求和等等。而Observer的作用类似于传统关系型数据库的触发器，在一些特定的操作之前或者之后触发。学习过Spring的朋友肯定对AOP不陌生，想象一下AOP是怎么回事，就会很好的理解Observer了。Observer Coprocessor在一个特定的事件发生前或发生后触发。在事件发生前触发的Coprocessor需要重写以pre作为前缀的方法，比如prePut。在事件发生后触发的Coprocessor使用方法以post作为前缀，比如postPut。Observer Coprocessor的使用场景如下：&lt;strong&gt;2.1&lt;/strong&gt;. 安全性：在执行Get或Put操作前，通过preGet或prePut方法检查是否允许该操作；&lt;strong&gt;2.2&lt;/strong&gt;. 引用完整性约束：HBase并不直接支持关系型数据库中的引用完整性约束概念，即通常所说的外键。但是我们可以使用Coprocessor增强这种约束。比如根据业务需要，我们每次写入user表的同时也要向user_daily_attendance表中插入一条相应的记录，此时我们可以实现一个Coprocessor，在prePut方法中添加相应的代码实现这种业务需求。&lt;strong&gt;2.3&lt;/strong&gt;. 二级索引：可以使用Coprocessor来维持一个二级索引。正是我们需要的&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;索引设计思想&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;关键部分来了，既然Hbase并没有提供二级索引，那如何实现呢？先看下面这张图&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7004573170731707&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/cAoClgx53Vs1Txw7dmxdKshDJdSN0icIH6icmxEdHsUzFNHYXBg9wssiba0e0QbgjibUMGMTCIibfH2gMXoUtuYbictw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1312&quot;/&gt;&lt;figcaption&gt;Coprocessor&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们的需求是找出满足cf1:col2=c22这条记录的cf1:col1的值，实现方法如图，首先根据cf1:col2=c22查找到该记录的行键，然后再通过行健找到对应的cf1:col1的值。其中第二步是很容易实现的，因为Hbase的行键是有索引的，那关键就是第一步，如何通过cf1:col2的值找到它对应的行键。很容易想到建立cf1:col2的映射关系，即将它们提取出来单独放在一张索引表中，原表的值作为索引表的行键，原表的行键作为索引表的值，这就是Hbase的倒排索引的思想。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2.3 elasticsearch+hbase方案&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;比如说你现在有一行数据&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;id name age ….30 个字段&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但是你现在搜索，只需要根据 id name age 三个字段来搜索&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果你傻乎乎的往 es 里写入一行数据所有的字段，就会导致说 70% 的数据是不用来搜索的，结果硬是占据了 es 机器上的 filesystem cache 的空间，单挑数据的数据量越大，就会导致 filesystem cahce 能缓存的数据就越少&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;仅仅只是写入 es 中要用来检索的少数几个字段就可以了，比如说，就写入 es id name age 三个字段就可以了，然后你可以把其他的字段数据存在 mysql 里面，我们一般是建议用 es + hbase 的这么一个架构。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;hbase 的特点是适用于海量数据的在线存储，就是对 hbase 可以写入海量数据，不要做复杂的搜索，就是做很简单的一些根据 id 或者范围进行查询的这么一个操作就可以了&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;从 es 中根据 name 和 age 去搜索，拿到的结果可能就 20 个 doc id，然后根据 doc id 到 hbase 里去查询每个 doc id 对应的完整的数据，给查出来，再返回给前端。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6362204724409449&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/cAoClgx53Vs1Txw7dmxdKshDJdSN0icIHS48mHKEY8f5CZicLwD6ux0pdAzkDicD43lDDujMrupEBibrS8yxicVfUWw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;635&quot;/&gt;&lt;figcaption&gt;img&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;你最好是写入 es 的数据小于等于，或者是略微大于 es 的 filesystem cache 的内存容量&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然后你从 es 检索可能就花费 20ms，然后再根据 es 返回的 id 去 hbase 里查询，查 20 条数据，可能也就耗费个 30ms，可能你原来那么玩儿，1T 数据都放 es，会每次查询都是 5 ~ 10 秒，现在可能性能就会很高，每次查询就是 50ms。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;四个字总结的话，我觉得就是“各司其职”，HBase 就用来存储，ES 就用来做索引，况且目前的实际情况跟文章中说的也很像，要查询的字段就几个，而其他的字段又很大又没用，没必要都丢到 ES 中，浪费查询效率&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2.4 Solr+hbase方案&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Solr是一个独立的企业级搜索应用server，它对并提供相似干Web-service的API接口。用户能够通过http请求，向搜索引擎server提交一定格式的XML文件，生成索引。也能够通过Http Get操作提出查找请求，并得到XML格式的返回结果。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Solr是一个高性能。採用Java5开发。基干Lucene的全文搜索server。同一时候对其进行了扩展。提供了比Lucene更为丰富的查询语言，同一时候实现了可配置、可扩展并对查询性能进行了优化，而且提供了一个完好的功能节理界面。是一款非常优秀的全文搜索引擎。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;HBase无可置疑拥有其优势，但其本身仅仅对rowkey支持毫秒级的高速检索，对于多字段的组合查询却无能为力。基于Solr的HBase多条件查询原理非常easy。将HBase表中涉及条件过滤的字段和rowkey在Solr中建立索引，通过Solr的多条件查询高速获得符合过滤条件的rowkey值，拿到这些rowkey之后在HBASE中通过指定rowkey进行查询。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6335403726708074&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/cAoClgx53Vs1Txw7dmxdKshDJdSN0icIHoUq7RSYiazGY9T6heibM4eiaib7LWkibiaicw7SZOib5swmcg8QVMvRKEbcluQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;644&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;网上其它还有根据&lt;code&gt;Phoenix&lt;/code&gt;构建的，&lt;code&gt;redis&lt;/code&gt;、&lt;code&gt;mysql&lt;/code&gt;等都是可以尝试的。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;交流群&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;加我微信：&lt;code&gt;ddxygq&lt;/code&gt;，回复“加群”，我拉你进群。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/cAoClgx53VuOLk27mia6b6EtsxvPbMn1XHs449DCUgFg6icHRCat74PztfEwkNj43ohA1wmZibSmLaOiczwS1jIk8w/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;430&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;猜你喜欢&lt;/strong&gt;&lt;br/&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzU5NzAwNDQ4NQ==&amp;amp;mid=2247489298&amp;amp;idx=1&amp;amp;sn=1037230492895fb4ca9387421debc8f4&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;数仓建模—指标体系&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzU5NzAwNDQ4NQ==&amp;amp;mid=2247488928&amp;amp;idx=1&amp;amp;sn=543614dedfe7c84425b26e5adbddbd2b&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;数仓建模—宽表的设计&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzU5NzAwNDQ4NQ==&amp;amp;mid=2247488836&amp;amp;idx=1&amp;amp;sn=b51d8d8b4a8f67d8cab7ea4bb91691bc&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;Spark SQL知识点与实战&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzU5NzAwNDQ4NQ==&amp;amp;mid=2247488710&amp;amp;idx=1&amp;amp;sn=db25932a3374bc87e4310a6ff4bac1aa&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;Hive计算最大连续登陆天数&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzU5NzAwNDQ4NQ==&amp;amp;mid=2247488619&amp;amp;idx=1&amp;amp;sn=2d1ff4b7c396a752882ddf8ba28a36e1&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;Flink计算pv和uv的通用方法&lt;/a&gt;&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>08507fd33be39aba7223f33e24fb783b</guid>
<title>王欢：如何构建好的智能风控工具体系？</title>
<link>https://toutiao.io/k/rowjfmz</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;img class=&quot;rich_pages wxw-img __bg_gif&quot; data-backh=&quot;156&quot; data-backw=&quot;561&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;561&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;156&quot; data-fileid=&quot;100072321&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.2777777777777778&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPjicBGnN2Sv2xfMf0eh07fxe53FSEJr7ogaf9QJMSV0iboV8bKNibavEhvl3VqpqOQVXI1r4kwgIhLjg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;900&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;288&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4983534577387486&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhI5HG6NK85gAZibDhbCTpO5WXziciaFSTuHd94tO4anj46LXpcbGGw0UDg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1822&quot;/&gt;&lt;/p&gt;&lt;section data-width=&quot;100%&quot; data-darkmode-bgcolor-16008590572276=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16008590572276=&quot;rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16008590572276=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16008590572276=&quot;rgb(255, 255, 255)&quot; data-style=&quot;margin-bottom: -10px; margin-left: -8px; max-width: 100%; width: 18px; height: 18px; border-top: 8px solid rgb(54, 65, 173); border-left: 8px solid rgb(54, 65, 173); box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;&quot;&gt;&lt;br data-darkmode-bgcolor-16008590572276=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16008590572276=&quot;rgb(255, 255, 255)&quot;/&gt;&lt;/section&gt;&lt;section data-bgopacity=&quot;50%&quot; data-darkmode-bgcolor-16008590572276=&quot;rgb(33, 33, 33)&quot; data-darkmode-original-bgcolor-16008590572276=&quot;rgb(247, 247, 247)&quot; data-style=&quot;max-width: 100%; width: 543.333px; background: rgb(247, 247, 247); box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;&quot;&gt;&lt;section data-darkmode-bgcolor-16008590572276=&quot;rgb(33, 33, 33)&quot; data-darkmode-original-bgcolor-16008590572276=&quot;rgb(247, 247, 247)&quot;&gt;&lt;p data-darkmode-bgcolor-16008590572276=&quot;rgb(33, 33, 33)&quot; data-darkmode-original-bgcolor-16008590572276=&quot;rgb(247, 247, 247)&quot;&gt;&lt;span&gt;分享嘉宾：王欢&lt;/span&gt;&lt;span&gt; 融360&lt;/span&gt;&lt;/p&gt;&lt;p data-darkmode-bgcolor-16008590572276=&quot;rgb(33, 33, 33)&quot; data-darkmode-original-bgcolor-16008590572276=&quot;rgb(247, 247, 247)&quot;&gt;&lt;span&gt;编辑整理&lt;/span&gt;&lt;span&gt;：李雪倩 北京工业大学&lt;/span&gt;&lt;/p&gt;&lt;p data-darkmode-bgcolor-16008590572276=&quot;rgb(33, 33, 33)&quot; data-darkmode-original-bgcolor-16008590572276=&quot;rgb(247, 247, 247)&quot;&gt;&lt;span&gt;出品平台：DataFunTalk&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-width=&quot;100%&quot; data-darkmode-bgcolor-16008590572276=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16008590572276=&quot;rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16008590572276=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16008590572276=&quot;rgb(255, 255, 255)&quot; data-style=&quot;max-width: 100%; width: 18px; height: 18px; border-bottom: 8px solid rgb(54, 65, 173); border-right: 8px solid rgb(54, 65, 173); box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;导读：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span/&gt;&lt;span&gt;本文由融360&lt;/span&gt;&lt;span&gt;高级数据算法工程师王欢老师带来“构建智能风控工具体系”的分享。将介绍在风控实践中积累起来的一些标准化的工作，包括遇到的问题和采取的解决方案，以期构建一个好的智能风控工具体系。&lt;/span&gt;&lt;span&gt;主要内容包括：&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;01&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;&lt;span&gt;&lt;span/&gt;&lt;span&gt;智能风控体系概览&lt;/span&gt;&lt;span/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;1. 风控服务体系的演进&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhTJ5F1T1Z6Fr6lKNwOM2upk4rWNWNGdApYdZ4LMQbxmTC3hF78PA7EA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;风控服务体系的搭建，我们经历了从纯手工，到一部分环节自动化，再到逐渐形成工具体系的一个过程。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;最初在做风控的特征和模型的时候，是人工逐个根据业务逻辑来解析特征，特征上线的过程就是研发工程师根据需求里边的sql进行特征翻译上线。模型建模就是人工手动调参建模，然后将模型文件和预处理的逻辑提供给研发工程师进行上线。这样会带来下面两个问题：&lt;/span&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;特征线上线下的一致性难以保证&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;模型上线的时间相对较长&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;span&gt;后来我们将一些常用的操作进行抽取，将其形成一些自动化的工具或函数，比如批量特征衍生的工具和模型建模的一些通用函数，逐渐形成工具雏形。&lt;/span&gt;&lt;span&gt;再经过后续迭代优化，以及决策引擎的上线，逐渐构成了智能风控的工具体系。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;2. 智能风控体系的构成&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;① “三件套”&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;智能风控工具核心三件套，包括模型平台，决策引擎和特征平台。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxh8b8akdE8WGkLNZqtvplKwojD9vBjrvY191BCWEL7QPq3R3olZsTczA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;② 两个支撑&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;除核心三件套之外，还有两个支撑，分别是数据平台和监控平台。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhcGhPdMjJQq1QkhJZeRh0wv0LFajxVweoruJGdQFxTAwIQCj0jVbLmw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;图中示意了部分交互过程：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;以上五部分内容——三件套加两个支撑，一起构成了我们智能风控的一套完整的工具体系。接下来从下向上，依次详细介绍每个工具。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;02&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;&lt;span&gt;&lt;span/&gt;&lt;span&gt;智能风控体系详细拆解&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;1. 数据平台&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;数据平台是由三个模块构成的，分别实现外部数据的接入、数据的管理以及数据的校验。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhWdR7YFK0SBlTkTfyw3Rb4iaM329s1N5ygAhaKg6xSq1cJRBBBTwO6jw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span/&gt;&lt;strong&gt;&lt;span&gt;① 外部数据接入模块&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhlfic90kre4hOndqgOcxJuthF4xGECRZTmKtLP5KLux0T87Mgc1iat3bQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;外部数据接入模块主要是实现外部数据接入标准化的工作。一些通用的参数(如URL、请求类型、账号、缓存期和调用量等)通过配置项的方式传到外部数据接入模块，然后存储服务实现源数据存储到数据库中的功能，存储的源数据可以用于建模特征开发、问题定位、以及与数据源公司对账等。该模块还会提供一个数据接口服务供特征引擎调用。具体取数逻辑是先去查缓存，有缓存则直接取数据返回；否则由数据接入层去实时请求数据存储到数据库，并且提供给决策引擎使用。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;② 数据管理模块&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhJQiaLs0bjnAD1zXYqfIyDibZqibRrcYmNbjpzMahtgjTAk2YE0HUrxbSg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;数据管理模块是为了保证数据的规范存储和顺畅流转，包含线上和离线两部分。线上部分会对业务数据做初步的清洗和转换后存储到数据库，并提供在线接口服务。任务调度将线上数据同步到离线，供离线特征开发和回溯使用。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;部署时如果离线批量回溯与线上业务系统共用同一套服务，可能会对线上的业务系统产生影响，所以理想的是设计在线和离线两套接口服务。但是实际操作中为了平衡成本，有时候也会共用一套，对离线回溯做限速，并尽量与线上错峰使用。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;③ 数据校验模块&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhzQ9k3z9pTqrrct8iaDysrmTpQicEmtvXF7vC1QX8QqVvT6emC3JGpFEg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;数据校验模块主要用来校验数据的一致性。为什么要保证数据的在线和离线以及在不同时点的一致性呢？我们在实际中发现特征不一致，大多数情况下是数据不一致造成的，线下建模和线上实际使用的特征不一致会直接导致模型效果的衰减。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;如何校验数据一致性呢？主要是抽样对比计算来做的。根据配置文件去抽样数据、解析，对比线上落表的数据，输出一致性对比的结果。前后一致性的校验也是类似的，主要区别点在另一份数据是通过接口来取得的，从而判断接口两次返回的数据是否一致。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;2. 特征平台&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhBme6on2da3kkNlFFHOv83Um4icW7tv1iaszWxqyNhZyth3o6MqGJNZfg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;特征平台主要是实现了特征工程自动化，支持便捷的特征管理和指标分析。由三个模块构成：自动特征挖掘工具，特征引擎和特征管理模块。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;① 自动特征挖掘工具&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhesk6g87k6NBaAFJL89libLcMmhYZeqQLWfiah41FJf68MeOOs0bdYE9w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;一套完整的自动特征挖掘工具可以方便的实现从源数据到特征的转化。这套工具的输入是原始数据加上参数配置文件（excel文件），基于这两个文件进行数据标准化、自动切分组合、汇总计算来提取特征，再进行效果评估，最终输出特征模块。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhlnKmD2Y7rkvrJoI086PMSCqW1zia8Nsz1uaCcXicmtFu1xEyNicnSvccQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;自动特征挖掘工具针对结构化数据，使用RFM思路构建特征。先确定时间窗口(比如近180天)，然后用分类变量进行筛选(比如上午)，再对数值变量(申请金额)做聚合和统计(比如取最大值)，这样组合起来就能得到一个特征：近180天_上午_最大申请金额。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhBpXStxALyYaGX9w5jU1FZbFT3UVWdibVUzY3IXBvPxicbBhJZiak4HDrA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;具体到工具层面就是根据这个思路，把公共步骤抽取出来，构建核心逻辑。首先根据分类变量对数据集做筛选，但筛选的过细，可能导致特征过于稀疏，所以分类变量个数的设置需要考虑特征粒度和整体稀疏度的平衡。然后基于数值变量汇总计算特征包括聚合、比值和趋势性变量的计算。把功能步骤抽取出来之后，就形成了自动特征挖掘工具的一个完整工作流。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;最终使用时将分类变量、数值变量，组合方式的描述作为参数配置文件，输入自动特征挖掘的工具，自动生成一组特征。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;② 特征引擎&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhlMBQulhSLWHR0jowhibfsog7eIPAuM49SxuibwLJMln3tiarhJIwvU2rA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;特征引擎是为模型引擎和决策&lt;/span&gt;&lt;span&gt;引擎&lt;/span&gt;&lt;span&gt;提供特征支持，其功能分为计算、存储、服务三块。最复杂的是特征计算，原始数据来自业务系统，实时特征对计算的资源要求较高，对实时计算有困难的数据采取提前离线跑批，实际授信时请求预计算好的特征。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;计算完成之后，会把特征存储下来并定期同步到离线，用于建模及特征一致性的校验使用。最后，服务模块将特征输出给模型引擎和决策引擎使用。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;③ 特征管理模块&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxh99NOIlG6VKsgC9eD9FOKF9qnFmIk1U0JwbOON3NibOxSk6DQLUwq8Uw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;特征管理模块包含特征回溯，回溯任务的管理，指标分析和特征模块本身的管理。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;为了方便特征复用，我们进行了回溯任务的管理，包括新建任务、执行中的任务、历史已经回溯任务列表等。指标分析平台是为了方便查看回溯特征的效果。选择结果表之后，指标分析平台可以展示特征的覆盖度、取值分布、效果、时间相关性，以及它在时间维度上的稳定性等。特征管理模块，主要是做特征版本的管理，以及模块的更新和字典维护。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;特征管理模块使用示例：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhdbdsYyplyxORhlkiaTXAF1RvEm70azIOvlS3BBUcbGWe3SaH36TS3uw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxh2Ja5d2SYE0dkKfhPGgdIyDkpEEm062PuSAjxYHw7ibvLdWQiaeT1NeKQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;用自动特征挖掘工具挖掘特征，挖掘出的特征部署到&lt;/span&gt;&lt;span&gt;决策引擎&lt;/span&gt;&lt;span&gt;使用，决策引擎会提供线上的服务，包括计算和存储，特征管理模块负责回溯任务的管理和指标的分析，这样这三个模块结合起来就构成了特征平台的核心功能。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;3. 模型平台&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;模型平台由自动建模工具、模型引擎和模型管理模块这三个模块组成。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxh5icsAz1icI3VWRhBlnsGbWKmMjrl1UPwSzFYCTE38FYfDKSZnVpIs10g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;① 自动建模工具&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhaQ5WvoTjkK5ps9HN495uaKznGQMjvTB9wVZm5XuPpYJIQsyMEXeytg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;通用的建模流程，首先是样本的设计，取值分析，EDA，特征选择，模型构建，之后会做效果评估，并把所有评估结果整理到报告中。我们在建模的过程中将EDA、特征选择、模型构建等常用操作提取出通用函数，生成标准化报告，然后将取数及建模过程封装，从而形成了自动建模平台的雏形。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;首先从Hive获取数据及样本，然后去特征集市取特征，样本和特征拼接形成数据宽表之后调用标准建模模块，走建模的流程（EDA、特征选择，建模以及效果评估），之后根据我们设计的指标，挑选最优模型部署上线，同时输出模型文件和对比报告。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;自动建模适用的场景，比如有新样本需要快速迭代，已确定新样本对模型的增益。自动建模工具主要目的是快速迭代一个baseline出来，具体最终的模型怎么做、样本的设计、标签的选取，这些是需要结合业务做一些判断的，是自动工具无法直接完成的。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;② 模型引擎&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhPy6CtFlKict60IhSmLZexwoRPJyhibvy3zLJSqia5AWArUw8NxFoTNmmw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;模型引擎主要完成模型打分、存储以及对外输出的工作。模型打分会区分决策模型和陪跑模型，所有模型打分及模型依赖的特征都会存到模型跑批结果表里，并同步到离线。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhhsVV3zjMO2icLgbQ8OaVkrYSGySWE7HCJibRvrsCibicsBicD5PRKiaWekKg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;模型管理模块实现了模型的任务调度以及模型的一些管理和分析功能，主要包含创建样本、离线调度、模型分析和模型管理。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;创建样本模块可以支持方便地选择建模样本，比如可以勾选标准样本，或自定义sql来创建样本。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;离线调度模块实现离线特征的批量调度功能。一般是将昨天过授信的用户的所有特征模块的特征存储下来，按天分区存储，形成离线特征集市方便后续建模使用。跑批和实际建模使用之间预留一定时间差，并添加结果检查功能，方便特征跑批失败时及时修补，保证自动建模任务稳定运行。除此之外离线调度模块还支持离线模型任务的调度，比如营销模型、部分贷中模型，是离线批量跑批的形式。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;模型分析的功能是基于抽取平时建模中的常用操作，组合而成的工具集。比如模型置空分析、效果对比、时间维度上的稳定性等。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhHUfhYNPb5Ke0yeZ6kC3HWYADUYtNvH0Sica0yK0F0kFJpnNibNpAa2Kg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;模型平台的三大模块之间的交互关系，自动建模工具用来建模，模型最终部署到模型引擎里提供线上服务，同时模型管理模块提供在线和离线需要的一些模型管理常用的操作和指标分析功能。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;4. 决策引擎&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;决策引擎极大地方便了我们配规则以及决策的上线。决策引擎里边会有规则集配置、决策流配置和上线审批管理这三大模块。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxh12wvibuM4jSar1jD7Fj6Q7ibgNd2uIv3crp3icDm5dX2oYIvTYKMZ5MbA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxho55751Ovn5oEQl5a6KlJYm1zOBFAeUvDFPxwFWN7mZH0Gdj5K9UJjA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;决策引擎的工作流程：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;决策引擎三个模块之间的交互关系如下：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhy0WyHMuPOUE1NiaWIOibUA7hWIZk9vEicicOVx5GSdHvxJCzibtR1reCWDA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhuricaHGsShXd4EyByonedic1dVdIAzursWCbhXxliaVmEV71blWic6etkg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;上图是我们决策引擎配置的一个简单界面，会有不同的节点，开始和结束节点，条件节点，以及一些网关和决策节点，可以通过连接线方便地绘制决策流。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;5. 监控平台&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;监控平台，包含日常监控和预警，主要是为了提供稳定的风控服务。包括业务监控、模型监控、特征监控、数据字段监控，以及数据服务监控。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhgC3ZQMgzZ9Qw9ib1K2Eb0E0kFnX4RDYiaLfVqzhia4IzTDjhzicRXHehPA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxht1JOz5Ufp8US1Uhoexynb722y5znfc7iaQp9icspteSB5kskic6riaDoFw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;这里列了一些主要的监控报表以及监控预警的方式，除此之外，实际业务中还有分级的监控预警。下图是一个监控报表应用示例。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhczwN98h0lNmGUPaARs2U5rfjes6WGOgyr5EJibREdUmj8GT22PAg19A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;我们会监控特征PSI的变化，模型打分的异常等。还有一个分级预警，如果遇到比较严重的模型打分偏移的情况，会做电话通知，甚至熔断授信。以模型分为例，模型上线之前会对模型用到的每个外部数据做重要性的判断。假如数据缺失之后，模型分会偏低，但是对模型排序影响不大，那么我们可能会发一个预警提示，由策略同学评估是否需要调整风控策略，以维持通过率的稳定。但是假如某个数据源对模型很重要，缺失之后模型打分大幅偏高，那么这个数据源缺失对模型的影响就会比较严重，可能会导致风险升高。在这种情况下，我们可能会去设置、做授信的熔断，并且及时发出电话预警，去做数据源的跟进或策略的调整。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;03&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;&lt;span&gt;&lt;span/&gt;&lt;span&gt;总结&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;以上就是几个模块的介绍。&lt;/span&gt;&lt;span&gt;我们再来看一下整体的智能风控工具体系的构成。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;325&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhicJrCUqbx6hmln9u3HgxKlMibetZiaJgWCSDrZ9gn5OJPxDBtbLJm4AqQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span/&gt;&lt;span&gt;左边是业务决策系统，中间是决策系统部分模块的展示，右边是监控系统。&lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;自底向上，决策系统的数据平台给特征平台提供原始数据支持，特征平台给模型平台和决策引擎提供运作规则和运作模型用到的特征支持，模型平台把决策模型分输出给决策引擎，在引擎里去配置模型的网关和决策节点。决策引擎里边去配置决策流、规则集，以及做审批管理以实现整个风控流程的全流程控制。针对每个模块都有相应的监控数据服务，原始字段、特征模型和业务。这些模块就构成了一个完整的智能风控的工具体系。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;04&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;&lt;span&gt;&lt;span/&gt;&lt;span&gt;精彩问答&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;Q：&lt;/span&gt;&lt;span&gt;请问决策引擎是如何保证数据一致性和准确性的，是否有做一些比如温度发布分流实验和流量回放等功能?&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;A：这个是在特征上线之前之后都会有一些相应的校验测试，上线之前可能首先是case级别的校验，case级别校验通过之后会有一些流量的回放，发布的时候也是逐渐分流发布的，因为我们在决策引擎里可以配置分流.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;Q：&lt;/span&gt;&lt;span/&gt;&lt;/span&gt;&lt;span&gt;自动特征挖掘工具是用来自动挖掘新特征的吗？&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;A：自动挖掘工具根据我们的原始数据，去做一些批量特征的衍生，出来的都是新特征。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;今天的分享就到这里，谢谢大家。&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;hr/&gt;&lt;p&gt;&lt;span&gt;在文末分享、点赞、在看，给个3连击呗~&lt;/span&gt;&lt;/p&gt;&lt;hr/&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;分享嘉宾：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;289&quot; data-backw=&quot;578&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/lAStFsJ0Pm2D5mpvliblJPjU86WOZ5wxhjKa4nQg0mJtwPRMuuGIdQB8eaYTKMuomq6ichKuURdEQib5tnO09uxcw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1000&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;福利时刻&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;274&quot; data-backw=&quot;578&quot; data-fileid=&quot;100015920&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.47404255319148936&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/lAStFsJ0Pm0T9eZG6MS4grBiaJAPvOxCo4UA6m2W7GjmnTry6FOuDVobPM7icAmef3IeAP6UjT4rEVicfWJqVjEnQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1175&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;识别二维码&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;，添加小助手微信，回复&lt;/span&gt;&lt;span&gt;&lt;strong&gt;『智能金融典藏版合集』&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;，即可下载。&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;146&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;145&quot; data-fileid=&quot;100072704&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.9927007299270073&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/lAStFsJ0Pm0T9eZG6MS4grBiaJAPvOxCotLBIwWiceTLXicvMa6pq5s7ZmCgDFrQQnlWEvhAG1iaKkicXymMicpeVWFA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;274&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;关于我们：&lt;/span&gt;&lt;/strong&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;DataFun：&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;专注于大数据、人工智能技术应用的分享与交流。发起于2017年，在北京、上海、深圳、杭州等城市举办超过100+线下和100+线上沙龙、论坛及峰会，已邀请近1000位专家和学者参与分享。其公众号 DataFunTalk 累计生产原创文章500+，百万+阅读，12万+精准粉丝。&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzU1NTMyOTI4Mw==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPgiaIKm4YqA09u83TvzKbfsabjfX1TLzaXLAK9MWmC4qI6cuTBJnxygZLZPU49O8g6j8QI9264NMqQ/0?wx_fmt=png&quot; data-nickname=&quot;DataFunTalk&quot; data-alias=&quot;datafuntalk&quot; data-signature=&quot;专注于大数据、人工智能技术应用的分享与交流。致力于成就百万数据科学家。定期组织技术分享直播，并整理大数据、推荐/搜索算法、广告算法、NLP 自然语言处理算法、智能风控、自动驾驶、机器学习/深度学习等技术应用文章。&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;🧐&lt;strong&gt;分享、点赞、在看&lt;/strong&gt;，给个&lt;strong&gt;3连击&lt;/strong&gt;呗！&lt;strong&gt;👇&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>