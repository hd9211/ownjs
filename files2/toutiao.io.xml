<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>be16f0765aab6d3537e62aa94b4c6ed2</guid>
<title>打日志还能打出个线上 Bug，太难了</title>
<link>https://toutiao.io/k/9p8zgng</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;某日中午，收到告警，有一笔订单下单失败了。赶紧去 Cat 看了下错误信息，如下：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.19803063457330417&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/WRLYshvT39xviap51u0HOlEibxddgwK2gmPqbTt7zNicicgLdznlOBrIwPiaErl1JZJxS05U3DJOZzh1s6Ee5HdLzTQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1828&quot;/&gt;&lt;figcaption&gt;异常信息&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Web 应用调用订单服务的 RPC 接口报错了，一看错误很自主的认为这是一个序列化的问题。后面排查下来发现压根就不是，这个错误报的有点。。。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;想着是不是参数中有什么特别的东西，然后发现也没有什么特别的。这个错误是某个商品下单才会出现，不是所有的商品都会出现这个问题。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然后尝试在本地复现，有这么一行关键的代码，贴了一部分，完整的作用是埋点打日志。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;String.format(&quot;UnifiedOrderServiceImpl.makeOrder创建订单, make order, request: MakeOrderRequest= &quot;+ request)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;说实话我是没看懂这里用 String.format 的原因在哪里，不就是想拼接个字符串么？还搞个 format，搞就搞嘛，还没用占位符，骚操作。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;真正 Bug 的原因是 request 对象中有个 String 类型的字段，字段里面的内容有%\，format 内部就报错了，大家可以用下面这段代码复现错误：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;public static void main(String[] args) {&lt;br/&gt;   String.format(&quot;dsdsdsd&quot;+&quot;%\\sdsd&quot;);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;错误信息：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;Exception in thread &quot;main&quot; java.util.UnknownFormatConversionException: Conversion = &#x27;\&#x27;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;原因是在 format 中会校验参数，然后触发了异常。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.2554858934169279&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/WRLYshvT39xviap51u0HOlEibxddgwK2gmtuYmmicp2ao1Yj2gyoXzurQ1OZB23ic2iasFkxQ5QMIxsKrDwoWUWckWQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1276&quot;/&gt;&lt;figcaption&gt;判断文本内容&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;虽然是很小的改动，就记录个日志而已，但也不要轻视，往往就是不够仔细，然后才会出这种问题。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;总结：&lt;/p&gt;&lt;span&gt;- END -&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;关于作者&lt;/strong&gt;：尹吉欢，简单的技术爱好者，《Spring Cloud 微服务-全栈技术与案例解析》, 《Spring Cloud 微服务 入门 实战与进阶》作者, 公众号&lt;strong&gt;猿天地&lt;/strong&gt;发起人。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我整理了一份很全的学习资料，感兴趣的可以微信搜索「&lt;strong&gt;猿天地&lt;/strong&gt;」，回复关键字 「&lt;strong&gt;学习资料&lt;/strong&gt;」获取我整理好了的 Spring Cloud，Spring Cloud Alibaba，Sharding-JDBC 分库分表，任务调度框架 XXL-JOB，MongoDB，爬虫等相关资料。&lt;/p&gt;&lt;p&gt;后台回复 &lt;strong&gt;&lt;span&gt;学习资料&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt; &lt;/strong&gt;领取学习视频&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.511002444987775&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/WRLYshvT39zWmaics1nAAwT4NCD77uDcf6vcXE1DAHybibTY0V3XDmf4YX1q9qYibIwz9xmRVTkEvTjP87gaKEZrQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;818&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;如有收获，点个在看，诚挚感谢&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;
                &lt;/div&gt;

                

                



                
                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot;&gt;
                                &lt;p class=&quot;tips_global&quot;&gt;Long-press QR code to transfer me a reward&lt;/p&gt;
                                                                &lt;p class=&quot;reward_tips&quot;&gt;我不差钱啊&lt;/p&gt;
                                &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;/&gt;&lt;/span&gt;
                                &lt;p class=&quot;tips_global&quot;&gt;As required by Apple&#x27;s new policy, the Reward feature has been disabled on Weixin for iOS. You can still reward an Official Account by transferring money via QR code.&lt;/p&gt;
                            &lt;/div&gt;
                                                                            
                              
            &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>e5983bb4b338a6d5971c9f888bf95985</guid>
<title>啥，听说你用了 Spring Boot，但是开发的接口还在裸奔？</title>
<link>https://toutiao.io/k/gtkn1lp</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;file_content markdown-body&quot;&gt;
&lt;h1&gt;
&lt;a id=&quot;popular-mvc框架&quot; class=&quot;anchor&quot; href=&quot;#popular-mvc%E6%A1%86%E6%9E%B6&quot;/&gt;Popular MVC框架&lt;/h1&gt;
&lt;h1&gt;
&lt;a id=&quot;传送门&quot; class=&quot;anchor&quot; href=&quot;#%E4%BC%A0%E9%80%81%E9%97%A8&quot;/&gt;传送门&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://gitee.com/danyuanblog/PopularMVC&quot;&gt;Gitee源码地址：https://gitee.com/danyuanblog/PopularMVC&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;http://www.danyuanblog.com:8181/doc.html&quot; rel=&quot;nofollow&quot;&gt;演示地址：http://www.danyuanblog.com:8181/doc.html&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;http://www.danyuanblog.com/blog/app/blog/blogDetail.html?id=5fe86eb74c636312f4b70955&quot; rel=&quot;nofollow&quot;&gt;官方文档地址：http://www.danyuanblog.com/blog/app/blog/blogDetail.html?id=5fe86eb74c636312f4b70955&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;
&lt;a id=&quot;1应用场景&quot; class=&quot;anchor&quot; href=&quot;#1%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF&quot;/&gt;1、应用场景&lt;/h1&gt;
&lt;h2&gt;
&lt;a id=&quot;简介&quot; class=&quot;anchor&quot; href=&quot;#%E7%AE%80%E4%BB%8B&quot;/&gt;简介&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;啥，听说你用了springboot，但是开发的接口还在裸奔？快来试试这个PopularMVC吧，它也许是你想要找的神器！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;神器亮相&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;springboot叫一键启动，popularmvc为你的springboot项目插上翅膀，力求一键起飞！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/logo.jpg&quot; alt=&quot;popularmvc logo&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;
&lt;a id=&quot;11-项目架构说明&quot; class=&quot;anchor&quot; href=&quot;#11-%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E8%AF%B4%E6%98%8E&quot;/&gt;1.1 项目架构说明&lt;/h2&gt;
&lt;h3&gt;
&lt;a id=&quot;111-popularmvc跟springboot的关系&quot; class=&quot;anchor&quot; href=&quot;#111-popularmvc%E8%B7%9Fspringboot%E7%9A%84%E5%85%B3%E7%B3%BB&quot;/&gt;1.1.1 PopularMVC跟Springboot的关系&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;说明&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PopularMVC是基于springboot开发的，自然强依赖于springboot和springmvc&lt;/li&gt;
&lt;li&gt;PopularMVC在springboot提供的能力之上，为开发者编写API接口提供了很多额外的便利性&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;示意图&lt;/p&gt;

&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;
&lt;a id=&quot;112-popularmvc项目组件架构解析&quot; class=&quot;anchor&quot; href=&quot;#112-popularmvc%E9%A1%B9%E7%9B%AE%E7%BB%84%E4%BB%B6%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90&quot;/&gt;1.1.2 PopularMVC项目组件架构解析&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;架构图&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/PopularMVC%E5%86%85%E9%83%A8%E7%BB%84%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg&quot; alt=&quot;PopularMVC内部组件架构图&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;组件介绍&lt;/p&gt;
&lt;p&gt;主要分为以下几类组件&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;API调用拦截器&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;基于AOP切面设计的一套API请求、响应拦截处理流程。提供了在调用接口前后做一些通用的预处理，比如说参数校验、参数装饰、访问控制、日志输出、会话控制等等。目前内置的拦截器有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;系统参数校验器&lt;/li&gt;
&lt;li&gt;请求参数校验器&lt;/li&gt;
&lt;li&gt;数字签名请求验签器、响应加签器&lt;/li&gt;
&lt;li&gt;接口防重复提交控制器&lt;/li&gt;
&lt;li&gt;接口用户会话控制器&lt;/li&gt;
&lt;li&gt;接口日志打印器&lt;/li&gt;
&lt;li&gt;接口访问控制器&lt;/li&gt;
&lt;li&gt;请求、响应内容装饰器&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;也支持业务灵活定制通用的API调用拦截器。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;参数装饰器&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;参数装饰器机制通过遍历参数内容，逐个字段进行修饰，具体修饰规则由特定的装饰器制定。常见的使用场景有，对请求参数解密、响应参数加密、响应参数国际化、响应参数脱敏等等&lt;/p&gt;
&lt;p&gt;注意：参数装饰器只能对参数内容做修饰，而无法改变参数类型。&lt;/p&gt;
&lt;p&gt;目前内置的参数装饰器有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;请求参数解密器&lt;/li&gt;
&lt;li&gt;响应参数加密器&lt;/li&gt;
&lt;li&gt;系统参数自动填充器&lt;/li&gt;
&lt;li&gt;响应参数国际化翻译器&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;也支持业务灵活拓展参数装饰器。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;API响应序列化预处理器&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;响应预处理器机制可以在接口返回内容给调用者之前进行额外的处理，此时可以更灵活的修饰返回内容，可以突破无法修改参数类型的限制，适用于对整个响应结构定制化处理的场景。&lt;/p&gt;
&lt;p&gt;目前内置的响应预处理器有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;API响应自动包装预处理器&lt;/li&gt;
&lt;li&gt;API响应错误码和系统参数定制化转换器&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;当然，也支持业务灵活拓展。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;方法查询缓存拦截器&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;提供对查询类方法调用的结果进行缓存。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;API异常统一处理器&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;接口调用过程中任何步骤出现异常，均能自动处理，并反馈信息给调用者。&lt;/p&gt;
&lt;p&gt;支持对特定异常自定义处理，如果未处理，统一交由内置的默认异常处理器进行护理。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;统一国际化翻译管理器&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;接口返回内容均支持国际化翻译能力。&lt;/p&gt;
&lt;p&gt;已整合了spring i18n国际化翻译能力，也支持拓展业务自定义国际化翻译器。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;统一错误码管理器&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;研发人员无需再关注业务错误码的定义和国际化翻译工作，可以做到定义简单、使用简单、易于理解、配置灵活&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;支持自定义系统错误码、业务错误码&lt;/li&gt;
&lt;li&gt;支持业务错误码自动生成&lt;/li&gt;
&lt;li&gt;支持业务错误码以异常的方式抛出，系统自动处理&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;自动接口文档生成器&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;已内置swagger+knif4j，只需指定API包路径即可实现接口文档的自动生成。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;
&lt;a id=&quot;12-其他说明&quot; class=&quot;anchor&quot; href=&quot;#12-%E5%85%B6%E4%BB%96%E8%AF%B4%E6%98%8E&quot;/&gt;1.2 其他说明&lt;/h2&gt;

&lt;h1&gt;
&lt;a id=&quot;2项目模块&quot; class=&quot;anchor&quot; href=&quot;#2%E9%A1%B9%E7%9B%AE%E6%A8%A1%E5%9D%97&quot;/&gt;2、项目模块&lt;/h1&gt;

&lt;h1&gt;
&lt;a id=&quot;3入门demo&quot; class=&quot;anchor&quot; href=&quot;#3%E5%85%A5%E9%97%A8demo&quot;/&gt;3、入门demo&lt;/h1&gt;
&lt;h2&gt;
&lt;a id=&quot;31-项目结构&quot; class=&quot;anchor&quot; href=&quot;#31-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84&quot;/&gt;3.1 项目结构&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;项目结构&lt;/p&gt;
&lt;div class=&quot;white&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span id=&quot;LC1&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;├─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC2&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;  &lt;span class=&quot;err&quot;&gt;└─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC3&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;├─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC4&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;  &lt;span class=&quot;err&quot;&gt;└─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;com&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC5&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;      &lt;span class=&quot;err&quot;&gt;└─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;danyuanblog&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC6&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;          &lt;span class=&quot;err&quot;&gt;└─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;framework&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC7&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;              &lt;span class=&quot;err&quot;&gt;└─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;demo&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC8&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;                  &lt;span class=&quot;err&quot;&gt;└─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;popularmvc&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC9&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;                      &lt;span class=&quot;err&quot;&gt;├─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;controller&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC10&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;                      &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;  &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;      &lt;/span&gt;
&lt;span id=&quot;LC11&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;                      &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;  &lt;span class=&quot;err&quot;&gt;└─&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;TestController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;java&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC12&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;                      &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;          &lt;/span&gt;
&lt;span id=&quot;LC13&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;                      &lt;span class=&quot;err&quot;&gt;└─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;startup&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC14&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;                              &lt;span class=&quot;no&quot;&gt;StartDemoApplication&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;java&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#项目启动类&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC15&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;                              &lt;/span&gt;
&lt;span id=&quot;LC16&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;└─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resources&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC17&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;         &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;application&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;yml&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;#项目配置信息，可省略&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC18&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;         &lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;  &lt;/span&gt;
&lt;span id=&quot;LC19&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;         &lt;span class=&quot;err&quot;&gt;└─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i18n&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#自定义国际化支持，可省略&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC20&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;             &lt;span class=&quot;err&quot;&gt;└─&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;messages&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#项目自定义国际化翻译信息&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC21&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;                     &lt;span class=&quot;n&quot;&gt;messages&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;properties&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC22&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;                     &lt;span class=&quot;n&quot;&gt;messages_en_US&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;properties&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC23&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;                     &lt;span class=&quot;n&quot;&gt;messages_zh_CN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;properties&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC24&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;│&lt;/span&gt;                     &lt;span class=&quot;c1&quot;&gt;#还可添加其他国际化翻译内容&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC25&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;err&quot;&gt;└─&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;pom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;xml&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;引入模块依赖，在&lt;code&gt;pom.xml&lt;/code&gt;添加&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;white&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span id=&quot;LC1&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC2&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.danyuanblog.framework&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC3&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;popular-web-mvc&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC4&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;${popular-web-mvc.version}&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC5&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2&gt;
&lt;a id=&quot;32-启用popularmvc框架&quot; class=&quot;anchor&quot; href=&quot;#32-%E5%90%AF%E7%94%A8popularmvc%E6%A1%86%E6%9E%B6&quot;/&gt;3.2 启用PopularMvc框架&lt;/h2&gt;
&lt;div class=&quot;white&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span id=&quot;LC1&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;/**  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC2&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;* Title StartDemoApplication.java  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC3&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;* Description  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC4&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;* @author danyuan&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC5&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;* @date Oct 31, 2020&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC6&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;* @version 1.0.0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC7&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;* site: www.danyuanblog.com&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC8&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;*/&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;LC9&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.danyuanblog.framework.demo.popularmvc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC10&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC11&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.boot.SpringApplication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC12&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.boot.autoconfigure.SpringBootApplication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC13&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.danyuanblog.framework.popularmvc.annotation.EnablePopularMvc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC14&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC15&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@SpringBootApplication&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC16&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@EnablePopularMvc&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC17&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StartDemoApplication&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC18&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC19&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC20&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nc&quot;&gt;SpringApplication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;StartDemoApplication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC21&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC22&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC23&quot; class=&quot;line&quot;/&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2&gt;
&lt;a id=&quot;33-测试接口代码示例&quot; class=&quot;anchor&quot; href=&quot;#33-%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B&quot;/&gt;3.3 测试接口代码示例&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;代码如下，&lt;code&gt;TestController.java&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;white&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span id=&quot;LC1&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;/**  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC2&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;* Title TestController.java  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC3&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;* Description  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC4&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;* @author danyuan&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC5&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;* @date Dec 27, 2020&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC6&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;* @version 1.0.0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC7&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;* site: www.danyuanblog.com&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC8&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;*/&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;LC9&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.danyuanblog.framework.demo.popularmvc.controller&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC10&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC11&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.util.HashMap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC12&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.util.Map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC13&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC14&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.validation.Valid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC15&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.validation.constraints.NotBlank&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC16&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.validation.constraints.NotEmpty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC17&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.validation.constraints.Size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC18&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC19&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.validation.annotation.Validated&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC20&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.web.bind.annotation.GetMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC21&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.web.bind.annotation.PostMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC22&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.web.bind.annotation.RequestParam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC23&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.web.bind.annotation.RestController&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC24&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC25&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.danyuanblog.framework.popularmvc.exception.BusinessException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC26&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC27&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@RestController&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC28&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@Validated&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC29&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TestController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC30&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC31&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC32&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt; * 参数自动校验、响应内容自动包装功能示例&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC33&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt; * @author danyuan&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC34&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt; */&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC35&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@GetMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;queryUserInfo&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC36&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;queryUserInfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Valid&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@NotBlank&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@RequestParam&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC37&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC38&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nc&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;查询用户[&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;]的信息!&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC39&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC40&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;c1&quot;&gt;//TODO: 执行业务逻辑&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC41&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC42&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;c1&quot;&gt;//mock数据&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC43&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nc&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userInfos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;HashMap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;();&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC44&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;n&quot;&gt;userInfos&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC45&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;n&quot;&gt;userInfos&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;23&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC46&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;n&quot;&gt;userInfos&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sex&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;男&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC47&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;n&quot;&gt;userInfos&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;desc&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;阳光乐观外向，喜欢唱歌、打篮球！&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC48&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC49&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;c1&quot;&gt;//返回数据&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC50&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userInfos&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC51&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC52&quot; class=&quot;line&quot;/&gt;
&lt;span id=&quot;LC53&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC54&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt; * 业务异常的使用示例&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC55&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt; * @author danyuan&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC56&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;cm&quot;&gt; */&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC57&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@PostMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user/regist&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC58&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;userRegist&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Valid&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@NotEmpty&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;LC59&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@Valid&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@NotEmpty&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC60&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;c1&quot;&gt;//TODO: 执行业务逻辑，发现账号已存在，直接通过抛出异常的方式提示用户&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC61&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;BusinessException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;用户名[{0}]已存在，请更换!&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setParam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC62&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC63&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;
&lt;a id=&quot;34-测试接口结果&quot; class=&quot;anchor&quot; href=&quot;#34-%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3%E7%BB%93%E6%9E%9C&quot;/&gt;3.4 测试接口结果&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;接口文档访问地址：&lt;a href=&quot;http://localhost:8080/doc.html&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8080/doc.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/get-start-demo/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E9%A6%96%E9%A1%B5.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;
&lt;a id=&quot;341-测试参数校验&quot; class=&quot;anchor&quot; href=&quot;#341-%E6%B5%8B%E8%AF%95%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C&quot;/&gt;3.4.1 测试参数校验&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;请求参数&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/get-start-demo/%E6%B5%8B%E8%AF%95%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C_%E8%AF%B7%E6%B1%821.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/get-start-demo/%E6%B5%8B%E8%AF%95%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C_%E8%AF%B7%E6%B1%822.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;结果&lt;/p&gt;
&lt;div class=&quot;white&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span id=&quot;LC1&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC2&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;msg&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;[参数异常]&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;#错误信息概览&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC3&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;120002&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;#系统错误码&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC4&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;data&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC5&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;subErrors&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC6&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC7&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;error&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;javax.validation.constraints.Size.message&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;#业务错误码&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC8&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;msg&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;[queryUserInfo.username]个数必须在6和20之间&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;#详细错误信息&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC9&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC10&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC11&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC12&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;
&lt;a id=&quot;342-测试正常响应信息返回&quot; class=&quot;anchor&quot; href=&quot;#342-%E6%B5%8B%E8%AF%95%E6%AD%A3%E5%B8%B8%E5%93%8D%E5%BA%94%E4%BF%A1%E6%81%AF%E8%BF%94%E5%9B%9E&quot;/&gt;3.4.2 测试正常响应信息返回&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;请求参数&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/get-start-demo/%E6%B5%8B%E8%AF%95%E6%AD%A3%E5%B8%B8%E5%93%8D%E5%BA%94%E4%BF%A1%E6%81%AF%E8%BF%94%E5%9B%9E_%E8%AF%B7%E6%B1%82.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;结果
&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/get-start-demo/%E6%B5%8B%E8%AF%95%E6%AD%A3%E5%B8%B8%E5%93%8D%E5%BA%94%E4%BF%A1%E6%81%AF%E8%BF%94%E5%9B%9E_%E7%BB%93%E6%9E%9C.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;white&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span id=&quot;LC1&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC2&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC3&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;data&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC4&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;sex&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;男&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC5&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;23&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC6&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Jone Lacy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC7&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;desc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;阳光乐观外向，喜欢唱歌、打篮球！&quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC8&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC9&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;
&lt;a id=&quot;343-测试业务异常的使用&quot; class=&quot;anchor&quot; href=&quot;#343-%E6%B5%8B%E8%AF%95%E4%B8%9A%E5%8A%A1%E5%BC%82%E5%B8%B8%E7%9A%84%E4%BD%BF%E7%94%A8&quot;/&gt;3.4.3 测试业务异常的使用&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;请求参数&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/get-start-demo/%E6%B5%8B%E8%AF%95%E4%B8%9A%E5%8A%A1%E5%BC%82%E5%B8%B8%E7%9A%84%E4%BD%BF%E7%94%A8_%E8%AF%B7%E6%B1%82.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;结果&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/get-start-demo/%E6%B5%8B%E8%AF%95%E4%B8%9A%E5%8A%A1%E5%BC%82%E5%B8%B8%E7%9A%84%E4%BD%BF%E7%94%A8_%E5%93%8D%E5%BA%94.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;white&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span id=&quot;LC1&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC2&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;msg&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;用户名[test]已存在，请更换!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC3&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200000&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;LC4&quot; class=&quot;line&quot;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;
&lt;a id=&quot;35-更多功能示例&quot; class=&quot;anchor&quot; href=&quot;#35-%E6%9B%B4%E5%A4%9A%E5%8A%9F%E8%83%BD%E7%A4%BA%E4%BE%8B&quot;/&gt;3.5 更多功能示例&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;系统内置接口&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/%E7%B3%BB%E7%BB%9F%E5%86%85%E7%BD%AE%E6%8E%A5%E5%8F%A3.png&quot; alt=&quot;系统内置接口&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;业务系统接口&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3.png&quot; alt=&quot;业务系统接口&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;接口文档示例&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E7%A4%BA%E4%BE%8B.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;接口测试示例&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;接口参数校验失败测试结果示例&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/%E6%8E%A5%E5%8F%A3%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E5%BC%82%E5%B8%B8%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.png&quot; alt=&quot;接口参数校验失败测试结果&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;接口访问成功结果示例&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/%E6%8E%A5%E5%8F%A3%E6%AD%A3%E5%B8%B8%E5%93%8D%E5%BA%94%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.png&quot; alt=&quot;接口正常响应测试结果&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;国际化接口访问示例（英文）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/%E5%9B%BD%E9%99%85%E5%8C%96%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0_en_US.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/%E5%9B%BD%E9%99%85%E5%8C%96%E7%BF%BB%E8%AF%91%E5%93%8D%E5%BA%94%E4%BF%A1%E6%81%AF_en_US.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;国际化接口访问示例（中文）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/%E5%9B%BD%E9%99%85%E5%8C%96%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0_zh_CN.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/danyuanblog/PopularMVC/raw/master/doc/imgs/%E5%9B%BD%E9%99%85%E5%8C%96%E7%BF%BB%E8%AF%91%E5%93%8D%E5%BA%94%E4%BF%A1%E6%81%AF_zh_CN.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;
&lt;a id=&quot;4更多特性介绍与使用示例&quot; class=&quot;anchor&quot; href=&quot;#4%E6%9B%B4%E5%A4%9A%E7%89%B9%E6%80%A7%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B&quot;/&gt;4、更多特性介绍与使用示例&lt;/h1&gt;
&lt;h2&gt;
&lt;a id=&quot;41-参数校验示例&quot; class=&quot;anchor&quot; href=&quot;#41-%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E7%A4%BA%E4%BE%8B&quot;/&gt;4.1 参数校验示例&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;/danyuanblog/PopularMVC/blob/master/doc/MORE.md&quot;&gt;请参考使用示例&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;
&lt;a id=&quot;42-自动填充api响应参数示例&quot; class=&quot;anchor&quot; href=&quot;#42-%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85api%E5%93%8D%E5%BA%94%E5%8F%82%E6%95%B0%E7%A4%BA%E4%BE%8B&quot;/&gt;4.2 自动填充API响应参数示例&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;/danyuanblog/PopularMVC/blob/master/doc/MORE.md&quot;&gt;请参考使用示例&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;
&lt;a id=&quot;43-业务错误码使用示例&quot; class=&quot;anchor&quot; href=&quot;#43-%E4%B8%9A%E5%8A%A1%E9%94%99%E8%AF%AF%E7%A0%81%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B&quot;/&gt;4.3 业务错误码使用示例&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;/danyuanblog/PopularMVC/blob/master/doc/MORE.md&quot;&gt;请参考使用示例&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;
&lt;a id=&quot;44-接口响应国际化翻译示例&quot; class=&quot;anchor&quot; href=&quot;#44-%E6%8E%A5%E5%8F%A3%E5%93%8D%E5%BA%94%E5%9B%BD%E9%99%85%E5%8C%96%E7%BF%BB%E8%AF%91%E7%A4%BA%E4%BE%8B&quot;/&gt;4.4 接口响应国际化翻译示例&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;/danyuanblog/PopularMVC/blob/master/doc/MORE.md&quot;&gt;请参考使用示例&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;
&lt;a id=&quot;45-使用数字签名示例&quot; class=&quot;anchor&quot; href=&quot;#45-%E4%BD%BF%E7%94%A8%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E7%A4%BA%E4%BE%8B&quot;/&gt;4.5 使用数字签名示例&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;/danyuanblog/PopularMVC/blob/master/doc/MORE.md&quot;&gt;请参考使用示例&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;
&lt;a id=&quot;46-接口数据加解密示例&quot; class=&quot;anchor&quot; href=&quot;#46-%E6%8E%A5%E5%8F%A3%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%A7%A3%E5%AF%86%E7%A4%BA%E4%BE%8B&quot;/&gt;4.6 接口数据加解密示例&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;/danyuanblog/PopularMVC/blob/master/doc/MORE.md&quot;&gt;请参考使用示例&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;
&lt;a id=&quot;47-接口防重复提交功能示例&quot; class=&quot;anchor&quot; href=&quot;#47-%E6%8E%A5%E5%8F%A3%E9%98%B2%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4%E5%8A%9F%E8%83%BD%E7%A4%BA%E4%BE%8B&quot;/&gt;4.7 接口防重复提交功能示例&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;/danyuanblog/PopularMVC/blob/master/doc/MORE.md&quot;&gt;请参考使用示例&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;
&lt;a id=&quot;48-接口查询缓存使用示例&quot; class=&quot;anchor&quot; href=&quot;#48-%E6%8E%A5%E5%8F%A3%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B&quot;/&gt;4.8 接口查询缓存使用示例&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;/danyuanblog/PopularMVC/blob/master/doc/MORE.md&quot;&gt;请参考使用示例&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;
&lt;a id=&quot;49-接口用户会话功能使用示例&quot; class=&quot;anchor&quot; href=&quot;#49-%E6%8E%A5%E5%8F%A3%E7%94%A8%E6%88%B7%E4%BC%9A%E8%AF%9D%E5%8A%9F%E8%83%BD%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B&quot;/&gt;4.9 接口用户会话功能使用示例&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;/danyuanblog/PopularMVC/blob/master/doc/MORE.md&quot;&gt;请参考使用示例&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;
&lt;a id=&quot;410-静态资源使用示例&quot; class=&quot;anchor&quot; href=&quot;#410-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B&quot;/&gt;4.10 静态资源使用示例&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;/danyuanblog/PopularMVC/blob/master/doc/MORE.md&quot;&gt;请参考使用示例&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;
&lt;a id=&quot;5业务定制化&quot; class=&quot;anchor&quot; href=&quot;#5%E4%B8%9A%E5%8A%A1%E5%AE%9A%E5%88%B6%E5%8C%96&quot;/&gt;5、业务定制化&lt;/h1&gt;
&lt;h2&gt;
&lt;a id=&quot;51-配置定制化&quot; class=&quot;anchor&quot; href=&quot;#51-%E9%85%8D%E7%BD%AE%E5%AE%9A%E5%88%B6%E5%8C%96&quot;/&gt;5.1 配置定制化&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;接口文档个性化&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;系统参数定制化&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;系统公共请求参数名自定义&lt;/li&gt;
&lt;li&gt;添加额外的系统公共请求参数&lt;/li&gt;
&lt;li&gt;系统公共响应参数名自定义&lt;/li&gt;
&lt;li&gt;添加额外的系统响应参数&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;业务国际化内容&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;可以通过springboot i18n添加或者定制国际化内容&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;
&lt;a id=&quot;52-组件定制化&quot; class=&quot;anchor&quot; href=&quot;#52-%E7%BB%84%E4%BB%B6%E5%AE%9A%E5%88%B6%E5%8C%96&quot;/&gt;5.2 组件定制化&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;PopularMVC提供了灵活定制通用组件的能力。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;内置的几大管理器都可以替换成自定义的管理器，如：
&lt;ul&gt;
&lt;li&gt;缓存管理器&lt;/li&gt;
&lt;li&gt;会话管理器&lt;/li&gt;
&lt;li&gt;国际化管理器&lt;/li&gt;
&lt;li&gt;数字签名管理器&lt;/li&gt;
&lt;li&gt;秘钥管理器&lt;/li&gt;
&lt;li&gt;应用管理器&lt;/li&gt;
&lt;li&gt;接口日志管理器&lt;/li&gt;
&lt;li&gt;接口调用频次控制管理器&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;可以添加自定义接口调用拦截器，实现一些通用业务&lt;/li&gt;
&lt;li&gt;可以添加自定义接口请求、响应参数装饰器，对参数进行加工&lt;/li&gt;
&lt;li&gt;可以添加自定义响应序列化预处理器，根据业务需要定制化返回信息&lt;/li&gt;
&lt;li&gt;可以添加自定义异常处理器，为目标类型的异常做额外的处理&lt;/li&gt;
&lt;li&gt;可以灵活定制和使用自定义的加解密处理器&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h1&gt;
&lt;a id=&quot;6交流与答疑&quot; class=&quot;anchor&quot; href=&quot;#6%E4%BA%A4%E6%B5%81%E4%B8%8E%E7%AD%94%E7%96%91&quot;/&gt;6、交流与答疑&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;​      此项目的设计初衷源于本人在多年API接口开发经验上，从接口规范、开发便捷易用、配置简单这些角度出发而总结出来的一套API解决方案。通过简单引入PopularMVC组件，可以快速搭建一套规范易用的API开发系统。&lt;/p&gt;
&lt;p&gt;​      开源的目的在于，一则希望此项目能帮助更多的研发人员提升API开发质量，提供大量易用的开发套件提升研发人员的开发效率；二则希望更多的人加入到开源中，促进开源项目的成长，然后服务于更多的开发者；其次希望觉得此项目不错的朋友给个Star，分享给更多的朋友，让大家一起进步！&lt;/p&gt;
&lt;p&gt;​      如果在使用此框架的过程中有任何疑问或者好的建议可以通过以下联系方式找到大部队，大家一起交流一起进步！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>b561f9bb140d08cce309d8cd9d2c7f38</guid>
<title>深入理解 Flutter 的图形图像绘制原理：图形库 skia 剖析</title>
<link>https://toutiao.io/k/v57wvqz</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p cid=&quot;n2&quot; mdtype=&quot;paragraph&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;span&gt;Flutter是目前流行的高性能跨平台UI框架，图形库skia是其跨平台的基石。本文将深入分析skia的图形、字体、图片的渲染原理，如何挖掘硬件特性，为UI性能优化提供思路。&lt;/span&gt;&lt;/p&gt;&lt;h2 cid=&quot;n4&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;1. 引言&lt;/span&gt;&lt;/h2&gt;&lt;p cid=&quot;n5&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Flutter是目前非常流行的跨平台UI开发框架，不仅支持Android、iOS，还支持Windows、Linux等操作系统。Flutter的性能非常高，拥有120fps的刷新率。那么flutter是如何实现在不同平台上高性能绘制图形图像的呢？首先我们分析下Flutter App和原生Android App、原生iOS App的UI绘制原理。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.7388059701492538&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/ECThdibSVDxg8MJWE7VFSOYEDMqHzahjXX7oI8QhzlPCKOgib48S4NOgZqzGvj3tCnibmmD47KrFBL8aicrChwoo2g/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;670&quot;/&gt;&lt;/p&gt;&lt;p cid=&quot;n7&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;移动App的整体UI框架大致分成下面4个层次：&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n8&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;1）UI库&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n9&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;跟Android、iOS原生开发类似，Flutter用dart语言实现一整套UI控件。Flutter先将控件树转成渲染树，然后交由skia库绘制界面。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n10&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;2）图形库&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n11&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Skia图形库跟iOS平台的CoreAnimation等库功能类似，不仅提供了图形渲染功能，还提供文字绘制和图片显示功能。高级图形图像库将需要绘制的图形转成点、线、三角形等图元，再调用底层图形接口实现绘制。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n12&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;3）低级图形接口&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n13&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;OpenGL是使用最广的低级图形接口，兼容性最好，基本上支持市面上的所有GPU。Vulkan是最近几年新推出的图形API，除了iPhone的GPU，其他厂家的GPU基本都支持。Metal是苹果新推出的图形API，只支持自家GPU。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n14&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;4）硬件设备层&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n15&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;目前的移动设备出于性能考虑，大部分图形都是通过GPU渲染，少数情况也会使用CPU渲染，后文会介绍skia使用CPU和GPU渲染的具体场景。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n16&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;iPhone 在A11芯片以前使用power vr系列GPU，之后采用自研GPU。安卓手机大部分采用高通Adreno GPU或ARM mail GPU。GPU渲染完一帧图像后送FrameBuffer，最后在合适的时机展示在屏幕上。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n17&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Skia应用广泛并且跨平台，不仅用于Flutter和Android操作系统，还用于Google Chrome浏览器，同时支持windows、Mac、iOS操作系统。Skia由C++编写，代码开源，通过研究skia有助于理解图形图像的绘制原理，为UI性能优化提供思路。&lt;/span&gt;&lt;/p&gt;&lt;h2 cid=&quot;n18&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;2. skia 框架分析&lt;/span&gt;&lt;/h2&gt;&lt;h3 cid=&quot;n19&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;2.1 Skia外部组件依赖&lt;/span&gt;&lt;/h3&gt;&lt;p cid=&quot;n20&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Skia依赖的第三方库众多，包括字体解析库freeType,图片编解码库libjpeg-turbo、libpng、libgifocode、libwebp和pdf文档处理库fpdfemb等。Skia支持多种软硬件平台，既支持ARM和x86指令集，也支持OpenGL、Metal和Vulkan低级图形接口。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.5723350253807107&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/ECThdibSVDxg8MJWE7VFSOYEDMqHzahjXJge0keibrVLM2jfibOuDU7ETcWURnR7GlET4Un4hbOzvCoU4G61dAeDg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;788&quot;/&gt;&lt;/p&gt;&lt;h3 cid=&quot;n22&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;2.2 Skia 层次分析&lt;/span&gt;&lt;br/&gt;&lt;/h3&gt;&lt;p cid=&quot;n23&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Skia在结构上大致分成三层：画布层，渲染设备层和封装适配层。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.4991364421416235&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/ECThdibSVDxg8MJWE7VFSOYEDMqHzahjX9an0NNZqFUW5YN4D7vHvKHY8vSv1b1yqaFqcQpk5VKlQvnjJriaJHpw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;579&quot;/&gt;&lt;/p&gt;&lt;h4 cid=&quot;n26&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;2.2.1 画布层&lt;/span&gt;&lt;/h4&gt;&lt;p cid=&quot;n27&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;画布层可以理解成提供给开发者在一个设备无关的画布，可以在上面绘制各种图形，且不用关心硬件细节，功能如下：&lt;/span&gt;&lt;/p&gt;&lt;figure cid=&quot;n28&quot; mdtype=&quot;table&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr cid=&quot;n29&quot; mdtype=&quot;table_row&quot;&gt;&lt;th&gt;&lt;span&gt;类别&lt;/span&gt;&lt;/th&gt;&lt;th&gt;&lt;span&gt;函数名&lt;/span&gt;&lt;/th&gt;&lt;th&gt;&lt;span&gt;含义&lt;/span&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr cid=&quot;n33&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;画图形&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;drawPoints&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;画点&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n37&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;画图形&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;drawRect&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;画矩形&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n41&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;画图形&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;drawVertices&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;画多边形&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n45&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;画图形&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;drawRoundRect&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;画圆角矩形&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n49&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;画图形&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;drawArc&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;画圆弧&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n53&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;画图形&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;drawOval&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;画椭圆&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n57&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;画图形&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;drawPath&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;画矢量图&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n61&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;绘制文字&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;drawText&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;显示文字&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n65&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;显示图片&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;drawBitmap&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;显示位图&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 cid=&quot;n69&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;左右滑动查看完整表格&lt;/span&gt;&lt;/h4&gt;&lt;h4 cid=&quot;n69&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;2.2.2 渲染设备层&lt;/span&gt;&lt;/h4&gt;&lt;p cid=&quot;n70&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;渲染设备层负责画布层的硬件实现，skia将设备封装成下面三个类：&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n71&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;1）SKBitmapDevice&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n72&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;CPU渲染模式绘图，用于没有显卡或者显卡驱动的设备。此模式下，最后会将需要绘制的图形转成位图数据（RGB）写入指定内存，故称为BitmapDevice。写内存操作通过AVX或者NEON指令集实现。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n73&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;2）SKGPUDevice&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n74&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;GPU渲染方式绘图。目前大部分移动设备和个人电脑都有GPU，GPU比CPU的运算单元多，并行计算能力强，通过GPU绘图可降低CPU占用，性能更好。Flutter、最新版本的chrome和android系统默认设置为GPU渲染模式。Chrome中的配置截图如下，可看到默认采用GPU渲染。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.26987951807228916&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ECThdibSVDxg8MJWE7VFSOYEDMqHzahjX4qZ69a4uMNRE3hjGGpibwOL4mJ8EtUHpCoKicZBnMvAyArC1H6ibHsdjw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;415&quot;/&gt;&lt;/p&gt;&lt;p cid=&quot;n76&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;3）SKPDFDevice&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n77&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;选用此设备时，渲染结果不是输出到显示器的画面，而是输出为pdf文件。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n78&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;可以通过skia官网在线体验不同设备的渲染结果：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://fiddle.skia.org/c/@shapes&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;h4 cid=&quot;n79&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;2.2.3封装适配层&lt;/span&gt;&lt;/h4&gt;&lt;p cid=&quot;n80&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Skia为了屏蔽不同依赖库的接口差异，对依赖库进行了封装和适配。例如基于图片编解码库libjpeg-turbo、libpng、libwebp 封装了类SKJpegCodec、SKPngCodec、SKWebpCodec。基于底层图形库OpenGL、Metal、Vulkan封装了GrGLOpsRenderPass， GrMTOpsRenderPass, GrVKOpsRenderPass三个类。基于苹果平台CoreText字体库和开源字体FreeType封装了类SkScalerContext_Mac和SkScalerContext_FreeType。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n81&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Skia的外部依赖和层级结构讲解完毕，下面重点讲解skia的图形、文字和图片的绘制原理。&lt;/span&gt;&lt;/p&gt;&lt;h2 cid=&quot;n82&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;3. 图形绘制原理&lt;/span&gt;&lt;/h2&gt;&lt;p cid=&quot;n83&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Skia支持绘制的图形众多，包括圆形、椭圆、矩形、贝塞尔曲线等。下文重点分析图形的CPU和GPU两种渲染模式的原理。&lt;/span&gt;&lt;/p&gt;&lt;h3 cid=&quot;n84&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;3.1 图形CPU渲染原理&lt;/span&gt;&lt;/h3&gt;&lt;p cid=&quot;n85&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;曲线的绘制涉及的数学知识较多，本文不再展开，下面以绘制实心矩形为例说明原理进行剖析。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.9265734265734266&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/ECThdibSVDxg8MJWE7VFSOYEDMqHzahjX4icPT1AO3Wc9ibFfugWhXwtr4gXmKjje0ibUaiaKfNIG7Pib2ZlXicvau8VQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;572&quot;/&gt;&lt;/p&gt;&lt;p cid=&quot;n87&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;1）调用画布的绘图API&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n88&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;应用层调用画布SKCanvas的drawRect函数，传入左上角和右下角顶点坐标。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n89&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;2）选用对应的设备的绘图API&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n90&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;由于选择的是CPU渲染模式，故调用SKBitmapDevice的矩形绘图函数drawRect实现。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n91&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;3）图形表示&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n92&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;所有的图形可分解成下面几种基本矢量图形的组合，矩形可表示成四条直线的组合。&lt;/span&gt;&lt;/p&gt;&lt;figure cid=&quot;n93&quot; mdtype=&quot;table&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr cid=&quot;n94&quot; mdtype=&quot;table_row&quot;&gt;&lt;th&gt;&lt;span&gt;曲线类型&lt;/span&gt;&lt;/th&gt;&lt;th&gt;&lt;span&gt;参数&lt;/span&gt;&lt;/th&gt;&lt;th&gt;&lt;span&gt;用途&lt;/span&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr cid=&quot;n98&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;直线（一次贝塞尔曲线）&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;起点坐标，终点坐标&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;可表示绘制三角形、四边形等多边形&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n102&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;圆锥曲线&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;起点坐标，终点坐标，椭圆参数&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;表示椭圆、圆弧、圆形&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n106&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;二次贝塞尔曲线&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;三个控制点&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;表示TrueType字体、抛物线等曲线&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n110&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;三次贝塞尔曲线&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;四个控制点&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;表示OpenType字体和其他曲线&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 cid=&quot;n69&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;左右滑动查看完整表格&lt;/span&gt;&lt;/h4&gt;&lt;p cid=&quot;n114&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;4）绘制算法实现&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n115&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;矢量图转成位图的过程称为光栅化。带填充的矩形光栅化过程比较简单，可以分解成绘制多条横线。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n116&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;5）横线线绘制算法&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n117&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;每条横向的画法通过SKBlitter:: blitH实现。接口定义如下：&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n255&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;virtual void blitH(int x, int y, int width);&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n257&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;功能：从坐标x,y开始，连续写入宽度为width的RGB颜色值。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n118&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;6）内存中写颜色数据&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n119&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;通过追踪代码，发现上文中的横线绘制函数调用的是memsetT函数（内存赋值）实现。参数如下：&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n120&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;static void memsetT(T buffer[], T value, int count)&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n121&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;目前x86和ARM处理器是32或者64位，普通的指令一次最多写入32位 或者64位数据，一个带透明通道的点通常占4个字节，相当于一次只能绘制1到2个点，效率比较低。Skia从性能角度考虑，采用的SIMD指令集来加速内存操作。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n122&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;在X86平台，调用SSE、AVX、AVX2等指令集实现内存赋值，SSE支持一次操作128位操作，AVX/AVX2支持一次操作256位数据，ARM处理器的NEON指令集支持一次操作128位数据。&lt;/span&gt;&lt;/p&gt;&lt;h3 cid=&quot;n123&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;3.2 图形GPU渲染原理&lt;/span&gt;&lt;/h3&gt;&lt;p cid=&quot;n124&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;GPU的并行运算能力强，目前大部分移动设备都采用的是GPU渲染。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n260&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;skia GPU渲染流程如下：&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n125&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;1）发起绘图，先调用SKCanvas的绘图函数drawRect，传入左上角和右下角顶点坐标。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n126&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;2）调用GPU设备的绘图函数SKGPUDevice::drawRect。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n127&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;3）采用命令模式，将GPU绘图操作封装成类GrOpsTask的实例。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n128&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;4）根据软硬件平台的不同选用不同的底层API。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n129&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;OpenGL（Open Graphics Library”）是目前使用最广泛的跨平台图形变成接口，跨平台特性好，大部分操作系统和GPU。Skia在大部分平台采用OpenGL实现GPU绘图，少部分平台调用Metal和vulkan。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n130&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Metal是苹果公司2014年推出的和 OpenGL类似的面向底层的图形编程接口，只支持iOS。对软硬件有要求，要求硬件苹果A7及以后，操作系统iOS 10及以上。Metal理论上性能比OpenGL性能强，故新设备中开启Metal可提高性能。例如Flutter中已启用了metal支持，详情参考&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://github.com/flutter/flutter/wiki/Metal-on-iOS-FAQ&lt;/span&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n131&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Vulkan是新一代跨平台的2D和3D绘图应用程序接口（API）,旨在取代OpenGL，理论上性能强于OpenGL。自 Android 7.0 开发者预览版开始，Google便在系统平台中添加了对Vulkan的API支持。目前Skia的GPU渲染模式已用vulkan实现了一套，但存在一些bug。具体参考&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://skia.org/user/special/vulkan&lt;/span&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n132&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Skia对上述三种图形接口进行了封装，屏蔽了不同底层图形API接口的差异。OpenGL接口的封为GrGLOpsRenderPass，Metal的封装层为GrMTOpsRenderPass,Vuklan的封装层为 GrVKOpsRenderPass。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.7763157894736842&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/ECThdibSVDxg8MJWE7VFSOYEDMqHzahjXl8NeQgFa4t0s5qzs27KtV6pqKBI4u3FzqCr05ibmGTabIOALVmGE8gw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;608&quot;/&gt;&lt;/p&gt;&lt;p cid=&quot;n136&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;5）通过GPU完成剩余绘图操作。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n266&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;下面以OpenGL为例说明。接口封装层调用OpenGL glDrawArray绘制矩形，之后在渲染流水线中完成顶点变换、光栅化和着色，最后送帧缓冲显示。渲染流水线如下图所示：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.6578947368421053&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ECThdibSVDxg8MJWE7VFSOYEDMqHzahjXqNRTVXwkh9xobpLcLOEFVtouN63iciaHoahEa9YUE8A8UicVMhRBoLsoA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;304&quot;/&gt;&lt;/p&gt;&lt;p cid=&quot;n138&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Metal、vulkan的渲染流水线这里不再展开。&lt;/span&gt;&lt;/p&gt;&lt;h2 cid=&quot;n139&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;4. 字体绘制原理&lt;/span&gt;&lt;/h2&gt;&lt;p cid=&quot;n140&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;字体无法直接显示在屏幕上，需要解析成位图或者矢量图才能绘制。Skia的字体解析实现跟进平台差异有所不同，mac和iOS平台调用coreText库,安卓平台调用开源库freeType。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n141&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;FreeType是一个用C语言实现的，免费的高质量可移植字体引擎，支持点阵字体PCF、BDF和矢量字体TrueType、freeType等字体。&lt;/span&gt;&lt;/p&gt;&lt;h3 cid=&quot;n142&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;4.1 skia点阵字体绘制原理&lt;/span&gt;&lt;/h3&gt;&lt;p cid=&quot;n143&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Skia支持的点阵字体有PCF、BDF格式。点阵存储的是多张位图，常见的有16&lt;em&gt;16，24&lt;/em&gt;24，32*32等尺寸，解码和显示简单，缺点是放大后有锯齿。&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n144&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;1) skia点阵文字显示代码：&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;cpp&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;SkFont font;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;font.setEdging(SkFont::Edging::kAlias);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;font.setSize(40);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;const char text[] = &quot;Click this link!&quot;;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;size_t byteLength = strlen(static_cast&amp;lt;const char*&amp;gt;(text));&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;canvas-&amp;gt;drawSimpleText(text, byteLength, SkTextEncoding::kUTF8, x, y, font, SkPaint());&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p cid=&quot;n144&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;文字绘制流程如下：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;1.0201342281879195&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/ECThdibSVDxg8MJWE7VFSOYEDMqHzahjX8JMjOdpsicDoruWFbBPiciakc1pmUSwhPY4W8b26Lu13WRMiaWqcmkhKtA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;447&quot;/&gt;&lt;/p&gt;&lt;p cid=&quot;n283&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;点阵字体最后解析成了位图，然后根据平台不同选用CPU或者GPU渲染出来。Skia为了提高字体显示速度，对字体的解析结果做了内存缓存。&lt;/span&gt;&lt;/p&gt;&lt;h3 cid=&quot;n154&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;4.2 矢量字体绘制原理&lt;/span&gt;&lt;/h3&gt;&lt;p cid=&quot;n155&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;矢量字体主要通过贝塞尔曲线描述字体，存储空间小，但渲染复杂，还需要导入字体库文件。Skia支持的矢量字体有tff(true type font)和otf(open true type)格式。前者采用二次贝塞尔曲线表示，后者采用三次贝塞尔曲线表示。Skia中矢量文字绘制代码如下：&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;cpp&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;SkPaint p;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    p.setStyle(SkPaint::kStroke_Style);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    p.setStrokeWidth(10);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    p.setARGB(0xff, 0xbb, 0x00, 0x00);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;   sk_sp&amp;lt;SkTypeface&amp;gt; ttf = MakeResourceAsTypeface(&quot;fonts/Stroking.ttf&quot;);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;SkFont font(ttf, 100);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;if (ttf) {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        SkFont font(ttf, 100);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        canvas-&amp;gt;drawString(&quot;○◉  ⁻₋⁺₊&quot;, 10, 100, font, p);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p cid=&quot;n155&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;绘制流程如下：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;1.025&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/ECThdibSVDxg8MJWE7VFSOYEDMqHzahjXNq83QcoZFdXefCHr36H6KHmC9ibfpIejRWQ8MuxxtkU73iaXic7rHzTHA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;440&quot;/&gt;&lt;/p&gt;&lt;p cid=&quot;n168&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;矢量字体的绘制流程跟点阵字体大部分一样，不同之处在于解析结果为贝塞尔曲线。贝塞尔曲线的渲染算法稍微复杂，参考文章&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://www3.cs.stonybrook.edu/~qin/courses/geometry/4.pdf&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;h2 cid=&quot;n169&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;5. 图片绘制原理&lt;/span&gt;&lt;/h2&gt;&lt;h3 cid=&quot;n170&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;5.1 Skia位图绘制原理&lt;/span&gt;&lt;/h3&gt;&lt;p cid=&quot;n171&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;skia提供了showBitmap函数可直接显示位图。位图渲染模式跟矢量图形类似，分为CPU渲染和GPU渲染。位图的CPU渲染跟实心矩形的渲染原理类似，通过SIMD指令集将位图内存一行一行拷贝到指定内存缓存中。GPU渲染模式通过调用OpenGL、Metal、vulkan的纹理贴图函数实现。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.5407503234152652&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/ECThdibSVDxg8MJWE7VFSOYEDMqHzahjXb9OD6vmJ1ksk7G5XFic8UW4Al6aUIeDJIoVkcIQUAJ8o7kibTxyFlHUQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;773&quot;/&gt;&lt;/p&gt;&lt;h3 cid=&quot;n292&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;5.2 Skia压缩格式图片绘制原理&lt;/span&gt;&lt;/h3&gt;&lt;p cid=&quot;n174&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;位图由于占用空间大，使用频率低，大部分情况下使用压缩格式图片。Skia支持的压缩格式图片如下：&lt;/span&gt;&lt;/p&gt;&lt;figure cid=&quot;n175&quot; mdtype=&quot;table&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr cid=&quot;n176&quot; mdtype=&quot;table_row&quot;&gt;&lt;th&gt;&lt;span&gt;格式&lt;/span&gt;&lt;/th&gt;&lt;th&gt;&lt;span&gt;优点&lt;/span&gt;&lt;/th&gt;&lt;th&gt;&lt;span&gt;缺点&lt;/span&gt;&lt;/th&gt;&lt;th&gt;&lt;span&gt;场景&lt;/span&gt;&lt;/th&gt;&lt;th&gt;&lt;span&gt;依赖解码库&lt;/span&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr cid=&quot;n182&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;gif&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;文件小，支持动画、透明，无兼容性问题&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;只支持种颜色，且透明度只有1位，有白边和锯齿&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;简单的动图&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;libgifcodec&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n188&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;jpg&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;支持位真彩色，压缩率高&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;有损压缩，不支持透明通道&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;色彩丰富的图片&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;libjpeg-turbo&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n194&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;png&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;无损压缩，支持透明，简单图片尺寸小&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;不支持动画，压缩率低&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;logo/icon/透明图&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;libpng&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr cid=&quot;n200&quot; mdtype=&quot;table_row&quot;&gt;&lt;td&gt;&lt;span&gt;webp&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;比jpeg压缩率更高，支持有损和无损压缩，支持动画、透明通道&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;谷歌自研格式，部分平台不支持。&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;支持有损和无损压缩格式，支持动画&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;libwebp&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 cid=&quot;n69&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;左右滑动查看完整表格&lt;/span&gt;&lt;/h4&gt;&lt;p cid=&quot;n206&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;压缩格式图片使用代码如下：&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;cpp&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;SkCanvas c(dst);  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    SkBitmap src;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    SkImageDecoder::DecodeFile(“test.jpg”, &amp;amp;src);//  图片解码&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    c.drawBitmap(src, 0, 0, NULL);  //图片显示&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p cid=&quot;n206&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;显示流程如下图所示：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.8160377358490566&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/ECThdibSVDxg8MJWE7VFSOYEDMqHzahjXPvg5u1dxIicsTkWsVFq1y2M6XRQB2lNh4StHJCwRlvibyUlKmgBN5jEQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;424&quot;/&gt;&lt;/p&gt;&lt;p cid=&quot;n213&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;读取文件后，先通过文件头判断图片类型，然后送相应的图片库解码成位图图像后，再通过CPU或者GPU渲染。&lt;/span&gt;&lt;/p&gt;&lt;h2 cid=&quot;n214&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;6. skia小结&lt;/span&gt;&lt;/h2&gt;&lt;p cid=&quot;n215&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;Skia是一个功能强大的跨平台图形库，能绘制矩形、圆形、贝塞尔曲线等矢量图，绘制点阵字体和矢量字体，显示jpeg、png、gif、webp等图片，同时性能好，从算法和硬件两个层面进行了优化。skia支持多种软硬件平台，除了Android、chrome、Flutter等产品直接将其作为图形引擎，也支持iOS、windows等操作系统。Skia功能较多，还支持lottie动画，图像特效，还引入了中间语言SKGL，限于篇幅，这里不再展开。&lt;/span&gt;&lt;/p&gt;&lt;h4 cid=&quot;n216&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;参考文档：&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&lt;span&gt;1. iOS高性能绘图：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://medium.com/@almalehdev/high-performance-drawing-on-ios-part-1-f3a24a0dcb31&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2. Core Animation 编程指南：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40004514-CH1-SW1&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3. skia编译方法：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://skia.org/user/build&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;4&lt;span&gt;. &lt;/span&gt;Skia技术路线：https://docs.google.com/document/d/1C9w8qpPpdgNGThqmgNnTToLZ5UYK4TsUGl5X3B_q6oM/edit&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;5&lt;span&gt;. &lt;/span&gt;SKGL说明：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://github.com/google/skia/blob/master/src/sksl/README&lt;/span&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;6&lt;span&gt;. &lt;/span&gt;Skia源码：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://skia.googlesource.com/skia.git&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;7&lt;span&gt;. &lt;/span&gt;Skia 百科：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://zh.wikipedia.org/zh-cn/Skia_Graphics_Library&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;8&lt;span&gt;. &lt;/span&gt;字体介绍：http://www.klayge.org/wiki/index.php/%E5%AD%97%E4%BD%93%E7%B3%BB%E7%BB%9F&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;9&lt;span&gt;. &lt;/span&gt;FreeType官网：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://www.freetype.org/&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;10&lt;span&gt;. &lt;/span&gt;png压缩原理：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://www.jianshu.com/p/5ad19825a3d0&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;11&lt;span&gt;. &lt;/span&gt;GPU渲染流水线：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://zhuanlan.zhihu.com/p/61949898&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;12&lt;span&gt;. &lt;/span&gt;Vukan介绍：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://www.khronos.org/assets/uploads/developers/library/overview/Vk_201602_Overview_Feb16.pdf&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;13&lt;span&gt;. &lt;/span&gt;ARM Mali GPU介绍：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://developer.arm.com/solutions/graphics-and-gaming/apis/vulkan&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;14&lt;span&gt;. &lt;/span&gt;Vulkan和OpenGL ES比较：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://community.arm.com/developer/tools-software/graphics/b/blog/posts/initial-comparison-of-vulkan-api-vs-opengl-es-api-on-arm&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;15&lt;span&gt;. &lt;/span&gt;Qualcomm宣布Adreno 530 GPU支持vulkan：&lt;span md-inline=&quot;url&quot; spellcheck=&quot;false&quot;&gt;https://www.qualcomm.cn/news/releases-2016-02-18-0&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;16&lt;span&gt;. &lt;/span&gt;https://www.adobe.com/content/dam/acom/en/devnet/font/pdfs/5005.BDF_Spec.pdf&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong mpa-from-tpl=&quot;t&quot;&gt;☆ &lt;/strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;END&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;strong mpa-from-tpl=&quot;t&quot;&gt; ☆&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;招聘信息&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section label=&quot;Copyright Reserved by PLAYHUDONG.&quot; donone=&quot;shifuMouseDownCard(&#x27;shifu_c_008&#x27;)&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section label=&quot;Copyright Reserved by PLAYHUDONG.&quot; donone=&quot;shifuMouseDownCard(&#x27;shifu_c_008&#x27;)&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section label=&quot;Copyright Reserved by PLAYHUDONG.&quot; donone=&quot;shifuMouseDownCard(&#x27;shifu_c_008&#x27;)&quot;&gt;&lt;p&gt;&lt;span&gt;OPPO互联网基础技术团队招聘一大波岗位，涵盖&lt;strong&gt;C++、Go、OpenJDK、Java、DevOps、Android、ElasticSearch&lt;/strong&gt;等多个方向，&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4MzE2MzY1OA==&amp;amp;mid=2247484254&amp;amp;idx=2&amp;amp;sn=bccee04adfd2c2e7d72b427c32f5891c&amp;amp;chksm=cf4ad43bf83d5d2d0d4ced10e8b047565e8fb765ab1ea62a5fb1c4d5b77a1ac8248a9afca96f&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;请点击这里查看详细信息及JD&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;&lt;strong&gt;请点击这里查看详细信息及JD&lt;/strong&gt;&lt;/a&gt;。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;你可能还喜欢&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section label=&quot;Copyright Reserved by PLAYHUDONG.&quot; donone=&quot;shifuMouseDownCard(&#x27;shifu_c_008&#x27;)&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section label=&quot;Copyright Reserved by PLAYHUDONG.&quot; donone=&quot;shifuMouseDownCard(&#x27;shifu_c_008&#x27;)&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section label=&quot;Copyright Reserved by PLAYHUDONG.&quot; donone=&quot;shifuMouseDownCard(&#x27;shifu_c_008&#x27;)&quot;&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4MzE2MzY1OA==&amp;amp;mid=2247485081&amp;amp;idx=1&amp;amp;sn=aaf43d2b82145a9c07c94ae6d024654e&amp;amp;chksm=cf4ad1fcf83d58ea7e77b359e2e4c19d52d8f18d80ad3c23c8f7f950f10efc1d326270e0279e&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;前端插件化架构的探索和实践&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4MzE2MzY1OA==&amp;amp;mid=2247484222&amp;amp;idx=1&amp;amp;sn=51f2c71fef5ffe6441a173e02bab9464&amp;amp;chksm=cf4ad45bf83d5d4d77f2b0e098067f2e00d54568f7a7ef7be89927c7d6de9afc1714310a0d71&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;JavaScript 异步之路&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4MzE2MzY1OA==&amp;amp;mid=2247484945&amp;amp;idx=1&amp;amp;sn=f3bbc20122db55510e03576e96da728a&amp;amp;chksm=cf4ad174f83d586279eddd4d30c077b3505467f7c50eb69f530fc7ca6edbff517d94fdb5c0b3&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;微服务全链路异步化实践&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4MzE2MzY1OA==&amp;amp;mid=2247484902&amp;amp;idx=1&amp;amp;sn=34904f4f3af88bed24a7e052f3526044&amp;amp;chksm=cf4ad283f83d5b959ca17d2560c1ba4c360bda3595418708a7898b1ed27c1b0331f3e2a54b1c&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;Dubbo协议解析与ESA RPC实践&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4MzE2MzY1OA==&amp;amp;mid=2247485454&amp;amp;idx=1&amp;amp;sn=ccb0ff7f6230ea8049a5a842f71a6f40&amp;amp;chksm=cf4adf6bf83d567d84f35b0b6058c0b0afb8eded93e32ff5f71de7cfb8c7d08af5b3b2f3a8b8&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;qiankun 微前端原理与实践&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;&lt;span&gt;更多技术干货&lt;/span&gt;&lt;/p&gt;&lt;p data-mid=&quot;&quot;&gt;&lt;span&gt;扫码关注&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;&lt;span&gt;OPPO互联网技术&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-cropselx1=&quot;0&quot; data-cropselx2=&quot;120&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;120&quot; data-ratio=&quot;1&quot; data-type=&quot;jpeg&quot; data-w=&quot;258&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/ECThdibSVDxjYDM1fnDY1N9LLUp4gJV8ulKxP20jO66gHdE8q9DgFIB5hvxfBxEERyWeSxpc6nor8SPgiadWNVsQ/640?wx_fmt=jpeg&quot;/&gt; &lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;95172&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section mpa-from-tpl=&quot;t&quot;&gt;&lt;section mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-brushtype=&quot;text&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;span&gt;我就知道你“在看”&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;section mpa-from-tpl=&quot;t&quot;&gt;&lt;section mpa-from-tpl=&quot;t&quot;&gt;&lt;img class=&quot;__bg_gif&quot; data-ratio=&quot;1.0377358490566038&quot; data-type=&quot;gif&quot; data-w=&quot;53&quot; data-width=&quot;100%&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/ECThdibSVDxjYDM1fnDY1N9LLUp4gJV8uk9kQ2Hw3Ucae5fnjEfVb2noBlx2NuTgMwzuiceEL19F9prbiaKnZZd3A/640?wx_fmt=gif&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>0ae9e4b9eaa12632bc6ce7c2d309e392</guid>
<title>静态博客如何高性能插入评论</title>
<link>https://toutiao.io/k/ezkvu3s</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;content&quot;&gt;
            &lt;h2 id=&quot;-前言&quot;&gt;🌏 前言&lt;/h2&gt;
&lt;p&gt;我们知道，静态博客由于不带有动态功能，所以针对评论这种动态需求比较大众的做法就是使用第三方评论系统。第三方评论的本质其实就是使用 JS 去调取第三方服务接口获取评论后动态渲染到页面中。虽然它很好的解决了这个问题，但是由于需要请求接口，在体验上远比动态博客的直出效果要差很多。所以当我把博客从动态博客 Typecho 迁移到静态博客 Hugo 上来时，就一直在思考这个问题。直到我看到了 Hugo 的 &lt;code&gt;getJSON&lt;/code&gt; 方法，发现原来静态博客也是能够像动态博客一样直出评论的。&lt;/p&gt;
&lt;p&gt;大部分的静态博客的原理是解析存储内容的文件夹，使用一些模板语言遍历数据生成一堆 HTML 文件。而 Hugo 除了解析 Markdown 内容之外，还支持额外的数据获取方法 &lt;code&gt;getJSON&lt;/code&gt;。由于有了 &lt;code&gt;getJSON&lt;/code&gt; 方法的出现，我们可以实现在博客编译构建过程中动态的去获取评论接口数据，将其渲染到页面中，实现评论数据的直出效果。关于 &lt;code&gt;getJSON&lt;/code&gt; 的更多介绍，可以查看 Hugo 文档&lt;a href=&quot;https://gohugo.io/templates/data-templates/&quot;&gt;数据模板&lt;/a&gt;一节。&lt;/p&gt;
&lt;h2 id=&quot;-方案&quot;&gt;🎃 方案&lt;/h2&gt;
&lt;p&gt;高性能方案基本思路是在需要评论数据的地方通过 &lt;code&gt;getJSON&lt;/code&gt; 方法调用接口获取评论数据并进行模板渲染。当评论更新的时候，我们需要触发重新构建。实现这个方案依赖三个关键要素：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;构建过程支持调取接口获取数据&lt;/li&gt;
&lt;li&gt;评论服务提供 HTTP 接口返回数据&lt;/li&gt;
&lt;li&gt;博客部署服务支持钩子触发重新构建&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;我的博客使用的是 Hugo 静态博客系统，如上文所说通过 &lt;code&gt;getJSON&lt;/code&gt; 即可解决第一个问题。而我的评论服务使用的是自研的 &lt;a href=&quot;https://waline.js.org&quot;&gt;Waline&lt;/a&gt; 评论系统，它提供了评论数、评论列表、最近评论等基础接口满足我们的数据获取需求。并且 Waline 提供了丰富的&lt;a href=&quot;https://waline.js.org/server/basic.html#%E8%AF%84%E8%AE%BA-hooks&quot;&gt;钩子功能&lt;/a&gt;，支持在评论发布的时候触发自第一方法。我的博客部署在 Vercel 上，它提供了 &lt;a href=&quot;https://vercel.com/docs/more/deploy-hooks&quot;&gt;Deploy Hooks&lt;/a&gt; 功能，通过 URL 即可触发重新构建。也就是说我只要在 Waline 评论发布的钩子中调用 Vercel 的钩子 URL 触发重新构建即可解决第三个问题。&lt;/p&gt;
&lt;h2 id=&quot;-实现&quot;&gt;🥪 实现&lt;/h2&gt;
&lt;p&gt;我的博客上有三处地方和评论有关，分别是首页侧边栏的最近评论，文章标题下方的评论数，以及文章详情页底部的评论列表展示。&lt;/p&gt;
&lt;h3 id=&quot;-最近评论&quot;&gt;🍞 最近评论&lt;/h3&gt;
&lt;p&gt;Waline 最近评论接口：&lt;a href=&quot;https://waline.js.org/api.html#%E8%AF%84%E8%AE%BA%E6%8E%A5%E5%8F%A3&quot;&gt;文档&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;chroma&quot;&gt;&lt;code class=&quot;language-fallback&quot; data-lang=&quot;fallback&quot;&gt;{{ $walineURL := .Site.Params.comment.waline.serverURL }}
&amp;lt;h2 class=&quot;widget-title &quot;&amp;gt;最近回复&amp;lt;/h2&amp;gt;
&amp;lt;ul class=&quot;widget-list recentcomments&quot;&amp;gt;
  {{ $resp := getJSON $walineURL &quot;/comment?type=recent&quot; }}
  {{ range $resp }}
  &amp;lt;li class=&quot;recentcomments&quot;&amp;gt;
    &amp;lt;a href=&quot;{{.Site.BaseURL}}{{ .url }}&quot;&amp;gt;{{ .nick }}&amp;lt;/a&amp;gt;：{{ .comment | safeHTML | truncate 22 }}
  &amp;lt;/li&amp;gt;
  {{ end }}
&amp;lt;/ul&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&quot;-文章评论数&quot;&gt;🧀 文章评论数&lt;/h3&gt;
&lt;p&gt;Waline 获取文章对应的评论数接口：&lt;a href=&quot;https://waline.js.org/api.html#%E8%AF%84%E8%AE%BA%E6%95%B0&quot;&gt;文档&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;chroma&quot;&gt;&lt;code class=&quot;language-fallback&quot; data-lang=&quot;fallback&quot;&gt;{{ $walineURL := .Site.Params.comment.waline.serverURL }}
{{ $count := getJSON $walineURL &quot;/comment?type=count&amp;amp;url=/&quot; .Slug &quot;.html&quot; }}
&amp;lt;a href=&quot;{{ .Permalink }}#comments&quot; title=&quot;{{ .Title }}&quot;&amp;gt;
  &amp;lt;i class=&quot;fas fa-comment mr-1&quot;&amp;gt;&amp;lt;/i&amp;gt;
  &amp;lt;span&amp;gt;{{- if gt $resp 0}}{{$resp}} 条评论{{else}}暂无评论{{end -}}&amp;lt;/span&amp;gt;
&amp;lt;/a&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&quot;-评论列表&quot;&gt;🍯 评论列表&lt;/h3&gt;
&lt;p&gt;评论列表由于有分页的存在，不像最近评论和评论数一样简单的调用接口即可。先获取评论数，发现有评论时先获取第一页的评论，主要是用来获取总共有多少页评论。之后再从第二页开始循环获取评论数据。最终将获取到的数据全部存到 &lt;code&gt;{{$scratch.Get &quot;comments&quot;}}&lt;/code&gt; 数组中，使用模板语法渲染该数组数据即可。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;chroma&quot;&gt;&lt;code class=&quot;language-fallback&quot; data-lang=&quot;fallback&quot;&gt;{{$baseUrl := .Site.Params.comment.waline.serverURL}}
{{$slug := .Slug}}
{{$count := getJSON $baseUrl &quot;/comment?type=count&amp;amp;url=/&quot; $slug &quot;.html&quot; }}
{{$scratch := newScratch}}
{{$scratch.Add &quot;comments&quot; slice}}

{{if gt $count 0}}
  {{$comments := getJSON $baseUrl &quot;/comment?path=/&quot; $slug &quot;.html&amp;amp;page=1&amp;amp;pageSize=100&quot;}}
  {{range $cmt := $comments.data}}
    {{$scratch.Add &quot;comments&quot; $cmt}}
  {{end}}

  {{$totalPages := $comments.totalPages}}
  {{if gt $totalPages 1}}
    {{range $page := seq 2 $totalPages}}
      {{$comments := getJSON $baseUrl &quot;/comment?path=/&quot; $slug &quot;.html&amp;amp;pageSize=100&amp;amp;page=&quot; $page}}
      {{range $cmt := $comments.data}}
        {{$scratch.Add &quot;comments&quot; $cmt}}
      {{end}}
    {{end}}
  {{end}}
{{end}}

&amp;lt;div class=&quot;vcards&quot;&amp;gt;
  {{range $cmt := $scratch.Get &quot;comments&quot;}}
  &amp;lt;div class=&quot;vcard&quot; id={{$cmt.objectId}}&amp;gt;
    &amp;lt;img class=&quot;vimg&quot; src=&quot;https://gravatar.loli.net/avatar/{{$cmt.mail}}?d=mp&quot;&amp;gt;
    &amp;lt;div class=&quot;vh&quot;&amp;gt;
      &amp;lt;div class=&quot;vhead&quot;&amp;gt;
        &amp;lt;a class=&quot;vnick&quot; rel=&quot;nofollow&quot; href=&quot;{{$cmt.link}}&quot; target=&quot;_blank&quot;&amp;gt;{{$cmt.nick}}&amp;lt;/a&amp;gt;
        &amp;lt;span class=&quot;vsys&quot;&amp;gt;{{$cmt.browser}}&amp;lt;/span&amp;gt;
        &amp;lt;span class=&quot;vsys&quot;&amp;gt;{{$cmt.os}}&amp;lt;/span&amp;gt;
      &amp;lt;/div&amp;gt;
      &amp;lt;div class=&quot;vmeta&quot;&amp;gt;
        &amp;lt;span class=&quot;vtime&quot;&amp;gt;{{dateFormat $cmt.insertedAt &quot;2006-01-02 03:04:05&quot;}}&amp;lt;/span&amp;gt;
        &amp;lt;span class=&quot;vat&quot;&amp;gt;回复&amp;lt;/span&amp;gt;
      &amp;lt;/div&amp;gt;
      &amp;lt;div class=&quot;vcontent&quot; data-expand=&quot;查看更多...&quot;&amp;gt;
        {{$cmt.comment | safeHTML}}
      &amp;lt;/div&amp;gt;
      &amp;lt;div class=&quot;vreply-wrapper&quot;&amp;gt;&amp;lt;/div&amp;gt;
      &amp;lt;div class=&quot;vquote&quot;&amp;gt;
        {{range $cmt := $cmt.children}}
        &amp;lt;div class=&quot;vh&quot; id=&quot;{{$cmt.objectId}}&quot;&amp;gt;
          &amp;lt;div class=&quot;vhead&quot;&amp;gt;
            &amp;lt;a class=&quot;vnick&quot; rel=&quot;nofollow&quot; href=&quot;{{$cmt.link}}&quot; target=&quot;_blank&quot;&amp;gt;{{$cmt.nick}}&amp;lt;/a&amp;gt;
            &amp;lt;span class=&quot;vsys&quot;&amp;gt;{{$cmt.browser}}&amp;lt;/span&amp;gt;
            &amp;lt;span class=&quot;vsys&quot;&amp;gt;{{$cmt.os}}&amp;lt;/span&amp;gt;
          &amp;lt;/div&amp;gt;
          &amp;lt;div class=&quot;vmeta&quot;&amp;gt;
            &amp;lt;span class=&quot;vtime&quot;&amp;gt;{{dateFormat $cmt.insertedAt &quot;2006-01-02 03:04:05&quot;}}&amp;lt;/span&amp;gt;
            &amp;lt;span class=&quot;vat&quot;&amp;gt;回复&amp;lt;/span&amp;gt;
          &amp;lt;/div&amp;gt;
          &amp;lt;div class=&quot;vcontent&quot; data-expand=&quot;查看更多...&quot;&amp;gt;
            {{$cmt.comment | safeHTML}}
          &amp;lt;/div&amp;gt;
          &amp;lt;div class=&quot;vreply-wrapper&quot;&amp;gt;&amp;lt;/div&amp;gt;
        &amp;lt;/div&amp;gt;
        {{end}}
      &amp;lt;/div&amp;gt;
    &amp;lt;/div&amp;gt;
  &amp;lt;/div&amp;gt;
  {{end}}
&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&quot;-构建触发&quot;&gt;🍳 构建触发&lt;/h3&gt;
&lt;p&gt;Waline 在评论发布、更新和删除阶段都支持自定义钩子，在钩子中触发 Vercel 的构建钩子即可完成发布评论重新构建的流程。&lt;/p&gt;
&lt;p&gt;按照如下内容修改服务端部署的 &lt;code&gt;index.js&lt;/code&gt; 文件，&lt;a href=&quot;https://waline.js.org/server/basic.html#%E8%AF%84%E8%AE%BA-hooks&quot;&gt;查看文档&lt;/a&gt;了解全部的 Waline 钩子。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;chroma&quot;&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Waline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#x27;@waline/vercel&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;https&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#x27;https&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;buildTrigger&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;https&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#x27;https://api.vercel.com/v1/integrations/deploy/xxxxx&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Waline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
  &lt;span class=&quot;kr&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;postSave&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;comment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;comment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#x27;approved&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;buildTrigger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
  &lt;span class=&quot;kr&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;postUpdate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;buildTrigger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
  &lt;span class=&quot;kr&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;postDelete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;buildTrigger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&quot;-后记&quot;&gt;🍾 后记&lt;/h2&gt;
&lt;p&gt;通过以上操作，就能在不损失用户体验的情况下实现评论数据的动态支持了。有些人可能会担心是否会在构建阶段造成超多的接口请求。这里大可不用担心，Hugo 自己会在构建的时候做接口的缓存，同 URL 的接口调用会走缓存数据而不会重新调用。&lt;/p&gt;
&lt;p&gt;除了用户体验之外，由于只会在构建的时候触发数据的获取，针对有调用次数配额的第三方评论服务也能节省额度。当然，理论上构建次数是远小于访问次数的，所以额度节省的结论是能成立的。如果说你的构建次数要比访问次数还要大的话，那这种方法就无法节省额度了。&lt;/p&gt;
&lt;p&gt;当然这种方式也会有带来些问题，主要是评论的更新没那么快。好在 Hugo 的构建速度非常快，一两分钟的时间也能接受。而针对用户评论的发布，则可以通过评论发布后先假插入缓解该问题。&lt;/p&gt;

        &lt;/div&gt;

        
          &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>dc00ded59ead3e8d5d59a6d49e7ff30b</guid>
<title>广告系统架构解密</title>
<link>https://toutiao.io/k/3ydgnwy</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;p class=&quot;original_area_primary&quot;&gt;
                                                                                                &lt;/p&gt;

                    
                                            &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NTIwOTYxMw==&amp;amp;mid=2447527693&amp;amp;idx=1&amp;amp;sn=d3814222ed9f57edd44883b9f7074f1f&amp;amp;chksm=8b62e1efbc1568f9e8350118d88b713c961dc8f700190062abc6e43f421c00139cd4dd1409f6&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;博客园 x 丝芙兰 , build 更美的你&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;博客园 x 丝芙兰 , build 更美的你&lt;/span&gt;&lt;strong&gt;&lt;span/&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;&lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;img data-ratio=&quot;0.563725471496582&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/AaabKZjib2kbg4zuIEDFjUSR9O7Q7ZVMXmdjb8ib6icBL8BfbK2WdIswiaDib85gSMweYBNqficFE0WdpqDkM3TEdqNA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;408&quot; data-backw=&quot;578&quot; data-backh=&quot;325&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;广告、增值服务、佣金，是互联网企业最常见的三种盈利手段。在这3大经典中，又以广告所占的市场份额最大，几乎是绝大部分互联网平台最主要的营收途径，业务的重要性不言而喻。&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;从技术角度来说，广告业务涉及到 &lt;/span&gt;&lt;span&gt;AI算法、大数据处理、检索引擎、高性能和高可用的工程架构 &lt;/span&gt;&lt;span&gt;等多个方向，同样有着不错的技术吸引力。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;我从去年开始接触广告业务，到现在差不多一年时间了。这篇文章将结合我的个人经验，同时参考业界的优秀案例，阐述下广告系统的&lt;span&gt;架构&lt;/span&gt;实践方案，希望让大家有所收获。&lt;/span&gt;&lt;span&gt;内容包括以下3部分&lt;/span&gt;&lt;span&gt;：&lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;01 广告业务简介&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;广告，&lt;span&gt;可以说无处不在。&lt;/span&gt;微信、&lt;span&gt;抖&lt;/span&gt;&lt;span&gt;音&lt;/span&gt;、B站、&lt;span&gt;百度、&lt;/span&gt;淘宝等等&lt;span&gt;，这些占据用户时间最长的 APP， 到处都能看到广告的影子。&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;我们每天随处可见的广告，它背后的业务逻辑到底是什么样的呢？&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;在分享广告系统的架构之前，先给大家&lt;span&gt;快速&lt;/span&gt;普及下业务知识。&lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;1. 广告业务的核心点是平衡&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;为什么说广告业务的核心点是&lt;span&gt;「&lt;/span&gt;&lt;/span&gt;&lt;span&gt;平衡&lt;/span&gt;&lt;span&gt;&lt;span&gt;」&lt;/span&gt;？可以从广告的标准定义来理解。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;广告被定义为：&lt;/span&gt;&lt;span&gt;广告主以付费方式通过互联网平台向用户传播商品或者服务信息的手段&lt;/span&gt;&lt;span&gt;。这个定义中涉及到 &lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;广告主、平台、用户&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;span&gt;3个主体，但是这3个主体的利益关注点各不相同。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.5833333333333334&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/AaabKZjib2kbzcFiaxB4bdlqYY4icsLGmwc6dib6ATqjCjr0Fibwq2SWiaic49j95GZse1cAet8ouT3RiciaxrABC2LXLBw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;504&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;图1：&lt;/span&gt;&lt;span&gt;广告业务的三角平衡&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span/&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;有时候&lt;/span&gt;这三者的利益是冲突的，比如平台增加了广告位数量，收益肯定增加，但用户体验可能变差，因此广告业务最终要寻找的是三方的平衡&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;站在平台的角度来看广告业务，它在&lt;/span&gt;&lt;span&gt;保证用户体验的同时，要兼顾绝大部分广告主的ROI（确保他们是可以赚到钱的），在此基础上再考虑将平台的收入最大化，这样才是一个健康的广告生态。&lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;2. 从收入的分解公式认清广告的本质&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;p&gt;广告业务发展了几十年，广告费用的结算方式也诞生了很多种，我们最常见的有以下几种：&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;CPT&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;&lt;strong&gt;：&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;按时间计费，独占性包时段包位置&lt;/span&gt;&lt;span/&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;CPM：&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;按照每千次曝光计费&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;CPC：&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;按照点击计费&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;CPA：&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;按照行为计费（比如下载、注册等）&lt;/span&gt;&lt;strong&gt;&lt;span/&gt;&lt;/strong&gt;&lt;br/&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.6308186195826645&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/AaabKZjib2kbg4zuIEDFjUSR9O7Q7ZVMXl2o6YibrWHckSWpeicibltosFibU8XrrtzEYUW797mGzJff71zLt2PbL3g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;623&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;图2：&lt;/span&gt;&lt;span&gt;广告费用的结算方式演进&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;之所以有不同的结算方式，其实也是随着广告市场的发展逐渐衍生出来的，最开始流量稀缺，平台占优势，再到今天逐渐成了买方市场，广告主作为需求方的谈判权变大。&lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;上面这个图可以看出，由于CPA代表了广告主最终想要的转化效果，因此按CPA结算时对广告主最有利，但是对平台最不利。结算方式演进到今天，其实也是一种平衡，所以处于平衡点附近的CPM和CPC是最常见的结算方式。&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;以CPC为例，收入可分解成下面这个公式：&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.1674074074074074&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/AaabKZjib2kbg4zuIEDFjUSR9O7Q7ZVMXyS1s2v518qvSBic2AsTpOqAxS7qcVbibdczOSibrXLr0Kg3K0EZNWX3tw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;675&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;其中，PV表示系统的访问量，PVR和ASN表示广告的填充率，CTR表示广告的点击率，ACP表示广告的平均点击价格。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;上述各个指标都可以通过一系列的广告策略来提升。&lt;/span&gt;&lt;span&gt;比如填充率可通过开发更多的广告主来实现，&lt;/span&gt;&lt;span&gt;CTR可通过AI算法做到精准投放来提升，&lt;/span&gt;&lt;span&gt;ACP可通过精准流量溢价或者提升广告主ROI来完成。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;掌握上面这个收入分解公式，对于理解广告业务至关重要，任何业务上的动作几乎都能关联到这个公式的某个指标上。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;3. 广告的核心业务流程&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;广告业务发展到今天，随着广告主对投放效果的诉求不断加强，精准定向以及实时竞价是目前最主流的业务形态。&lt;/span&gt;&lt;span/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;对互联网平台来说，初期一般都是采用&lt;span&gt;「&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;自营的竞价广告网络&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;」&lt;/span&gt;来实现商业变现，简单理解：就是利用平台自有的流量以及自主开发的广告主来实现业务闭环。&lt;/span&gt;&lt;span&gt;本文所分享的广告架构主要针对这种业务形态&lt;/span&gt;&lt;span&gt;，它的核心业务流程如下图所示。&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img data-ratio=&quot;0.6225489974021912&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/AaabKZjib2kaFibAspYXvmgJZic0c9KBdTnciaykibBnVuRiaIjdldljOXbSCSgSLRVbGL4u28ttERyvnaI1Pdkcoiaicg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;408&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;图3：&lt;/span&gt;&lt;span&gt;广告的核心业务流程&lt;/span&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;广告主先通过投放平台发布广告，可设置一系列的定向条件，比如投放城市、投放时间段、人群标签、出价等。&lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;span/&gt;&lt;/strong&gt;&lt;span&gt;投放动作完成后，广告会被存放到广告库、同时进入索引库，以便能被广告检索引擎召回&lt;/span&gt;。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;C端请求过来后，广告引擎会完成召回、算法策略、竞价排序等一系列的逻辑，最终筛选出Top N个广告，实现广告的千人千面。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;用户点击广告后，会触发广告扣费流程，这时候平台才算真正获得收益。&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;上面是广告业务的核心流程，随着平台流量以及广告主规模进一步增大，往往会从&lt;span&gt;「&lt;/span&gt;自营型竞价网络&lt;span&gt;」&lt;/span&gt;逐渐向&lt;span&gt;「&lt;/span&gt;联盟广告以及RTB实时竞价&lt;span&gt;」&lt;/span&gt;方向发展，类似于&lt;span&gt;阿里妈妈&lt;/span&gt;、&lt;/span&gt;&lt;span&gt;腾讯广点通、头条巨量引擎，此时业务复杂度和技术架构&lt;span&gt;会再上一个台阶&lt;/span&gt;，本文不作展开，后续再跟大家详细分享&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;02 面临的技术挑战&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;对广告业务有了初步了解后，再来看下广告系统面临的技术挑战：&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;1、&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;&lt;strong&gt;高并发&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;：广告引擎和C端流量对接，请求量大（平峰往往有上万QPS），要求&lt;span&gt;实时&lt;span&gt;响应&lt;/span&gt;&lt;/span&gt;，必须在几十毫秒内返回结果。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;2、&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;&lt;strong&gt;业务逻辑复杂&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;：一次广告请求，涉及到多路召回、算法模型打分、竞价排序等复杂的业务流程，策略多，执行链路长。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;3、&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;&lt;span&gt;稳定性要求高&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：广告系统直接跟收入挂钩，广告引擎以及计费平台等核心系统的稳定性要求很高，可用性至少要做到3个9。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;4、&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;&lt;strong&gt;大数据存储和计算&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;：随业务发展，推广数量以及扣费订单数量很容易达到千万甚至上亿规模，另外收入报表的聚合维度多，单报表可能达到百亿级别的记录数。&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;5、&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;&lt;span&gt;账务的准确性&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：广告扣费属于金融性质的操作，需要做到不丢失、不重复，否则会损害某一方的利益。另外，如果收入数据不准确，还可能影响到业务决策。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;03 广告系统架构详解&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;了解了广告业务的目标和技术挑战后，接下来详细介绍下广告系统的整体架构和技术方案。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-backh=&quot;346&quot; data-backw=&quot;578&quot; data-ratio=&quot;0.5990338164251208&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/AaabKZjib2kbzcFiaxB4bdlqYY4icsLGmwctPemBL4dpqZoxHXnCc92SSAvtSJkqhuSDKC2YjFIv4RwSLYWGqP7iaQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1035&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;图4：广告系统的整体架构&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;上面是我们公司&lt;span&gt;目&lt;/span&gt;&lt;span&gt;前&lt;/span&gt;的广告系统架构图，&lt;span&gt;这个架构适用于广告业务初期，&lt;/span&gt;&lt;span&gt;针对的是&lt;/span&gt;&lt;span/&gt;&lt;span&gt;「&lt;/span&gt;&lt;span&gt;自营型的竞价网络和站内流量&lt;/span&gt;&lt;span&gt;」，不涉及联盟广告。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;下面针对各个子系统做下说明：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;广告投放系统&lt;/strong&gt;&lt;/span&gt;：供广告主使用，核心功能包括会员续费、广告库管理、设定推广条件、设置广告出价、查看投放效果等。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;广告运营后台&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：供平台的产品运营使用，核心功能包括广告位管理、广告策略管理、以及各种运营工具。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;广告检索平台&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：承接C端的高并发请求，负责从海量广告库中筛选出几个或者几十个广告，实时性要求高，这个平台通常由多个微服务组成。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;AB实验平台&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：广告业务的稳定器，任何广告策略上的调整均可以通过此平台进行灰度实验，观察收入指标的变化。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;广告计费平台&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;：面向C端，负责实时扣费，和收入直接挂钩，&lt;span&gt;可用性要求高。&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;账务管理中心&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：广告业务中的财务系统，统管金额相关的业务，包括充值、冻结、扣费等。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;大数据平台&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：整个广告系统的底盘，需要聚合各种异构数据源，完成离线和实时数据分析和统计，产出业务报表，生产模型特征等。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;下面再针对架构中的技术难点展开做下介绍。&lt;/span&gt;&lt;span/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;1. 广告数据的存储&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;广告系统要存储的数据多种多样，特点各不相同，采用的&lt;span&gt;是&lt;/span&gt;&lt;span&gt;多模的数据存储方式。&lt;/span&gt;&lt;span/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-backh=&quot;393&quot; data-backw=&quot;552&quot; data-ratio=&quot;0.7119565217391305&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/AaabKZjib2kbzcFiaxB4bdlqYY4icsLGmwczqqNQgCezYouibQnvFX3axIPUj4SNFpzTSwdm5KUvYTwhYicicgoS6DPg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;552&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;图5：广告数据的多模存储&lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;OLTP场景，包括广告库、创意库、会员库、广告产品库、广告策略库等，这些都存储在MySQL中，数据规模较大的广告库和创意库，按照广告主ID Hash做分库分表。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;OLAP场景，涉及到非常多的报表，聚合维度多，单表的记录数可能达到百亿级别，底层采用HDFS和HBase存储&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;面向广告检索场景的索引数据，包括正排索引和倒排索引，采用Redis和ES来存储。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;存储上还需要解决的一个问题是：广告的同步问题。广告投放完成后，首先会存储在MySQL数据库中，接下来需要把广告实时传输到检索系统中，完成正排索引以及倒排索引的更新。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;img class=&quot;rich_pages&quot; data-backh=&quot;330&quot; data-backw=&quot;578&quot; data-ratio=&quot;0.5709969788519638&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/AaabKZjib2kbzcFiaxB4bdlqYY4icsLGmwcHAiaWa7KPvHZo78cgplGOPhT4Gyns5skz3UKu8TKG2kjqLicXuvT7jGw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;662&quot;/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;图6：广告索引的&lt;span&gt;更新&lt;/span&gt;&lt;/span&gt;&lt;span&gt;流程&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;索引更新服务，有几个要点说明下：&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;span/&gt;&lt;/span&gt;&lt;span&gt;2. 广告检索平台的整体流程&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;广告检索平台负责承接C端的流量请求，从海量广告库中筛选出最合适的前N个广告，并在几十毫秒内返回结果，它是一个多级筛选和排序的过程。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;img class=&quot;rich_pages&quot; data-backh=&quot;437&quot; data-backw=&quot;578&quot; data-ratio=&quot;0.7564766839378239&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/AaabKZjib2kbg4zuIEDFjUSR9O7Q7ZVMXkaibrkAasMmmymvDxyoBcUFXtesryqZxDgICY3mwIQM8U0cwRLcSdVA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;772&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;图7：广告检索平台的整体&lt;/span&gt;&lt;span&gt;流程&lt;/span&gt;&lt;span/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;Recall层侧重算法模型，Search层侧重业务。从下到上，计算复杂度逐层增加，候选集逐层减少。（说明：&lt;span&gt;搜索广告场景和推荐广告场景在某些子模块上存在差异，但整体流程基本一致，这里不作展开）&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;性能设计是检索平台的重点，通常有以下手段：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;做好服务分层，各层均可水平扩展。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;采用Redis缓存，避免高并发请求直接打到数据库，缓存可按业务规划多套，进行分流。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;采用多线程并行化某些子流程，比如多路召回逻辑、多模型打分逻辑。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;热点数据进行本地缓存，比如广告位的配置信息以及策略配置信息，在&lt;span&gt;服务启动时就可以预加载到本地，然后定时进行同步。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;非核心流程&lt;/span&gt;设置超时熔断走降级逻辑，比如溢价策略（不溢价只是少赚了，不影响广告召回）。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;和&lt;span&gt;主流程无关的逻辑异步执行&lt;/span&gt;，&lt;span&gt;比如扣费信息&lt;span&gt;缓&lt;/span&gt;&lt;span&gt;存&lt;/span&gt;、召回结果缓存等。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;精简RPC返回结果或者Redis缓存对象的结构，去掉不必要的字段，减少IO数据包大小。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;GC优化，包括JVM堆内存的&lt;span&gt;设置&lt;/span&gt;、垃圾收集器的选择、GC频次优化和GC耗时优化。&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;span&gt;3. 计费平台的技术方案&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;计费平台也是一个核心系统，主要完成实时扣费功能。比如CPC结算方式下，广告主设置的预算是50元，每次点击扣1元，当扣费金额达到预算时，需要将广告及时下线。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;除此之外，计费平台还需要支持CPM、CPT等多种结算方式，以及支持反作弊、余额撞线处理、扣费订单的摊销和对账等功能。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;计费平台的特点是：并发高、数据量大、同时可用性要求高，需要做到不少扣，不重复扣。下面以CPC实时点击扣费为例，详细说下技术方案。&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-backh=&quot;521&quot; data-backw=&quot;578&quot; data-ratio=&quot;0.9013452914798207&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/AaabKZjib2kbzcFiaxB4bdlqYY4icsLGmwcYhRXGvaTJg3icM4yn8MJ1ia3Xn7LVBkWukvXdLxdOM6S9XPGXT2V8ZibA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;669&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;图8：CPC实时扣费流程&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;首先，整个扣费流程做了异步化处理，当收到实时扣费请求后，系统先将扣费时用到的信息缓存到Redis，然后发送MQ消息，这两步完成后扣费动作就算结束了。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;这样做的好处是：能确保扣费接口的性能，同时利用MQ的可靠性投递和重试机制确保整个扣费流程的最终一致性。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;为了提高可用性，针对Redis和MQ不可用的情况均采用了降级方案。Redis不可用时，切换到TiKV进行持久化；MQ投递失败时，改成线程池异步处理。&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;另外，每次有效点击都需要生成1条扣费订单，面临大数据量的存储问题。目前我们采用的是MySQL分库分表，后期会考虑使用HBase等分布式存储。另外，订单和账务系统之间的数据一致性，采用大数据平台做天级别的增量抽取，通过Hive任务完成对账和监控。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;4. OLAP海量数据报表的技术方案&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;数据报表是也是广告平台的核心业务，它是广告主、平台运营人员进行投放优化、业务决策的依据。&lt;/span&gt;&lt;span&gt;先来看下广告数据仓库的分层结构：&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-backh=&quot;353&quot; data-backw=&quot;578&quot; data-ratio=&quot;0.6103151862464183&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/AaabKZjib2kbzcFiaxB4bdlqYY4icsLGmwcUUdgq9DmJPyXHEM8OL33aRFr9TcfClXeibzcJg1sMrKoCibE8oDrluyQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;698&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;图9：广告数据仓库的分层结构&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;源数据层&lt;/strong&gt;&lt;/span&gt;：对应各种源数据，包括&lt;span&gt;HDFS中实时采集的&lt;/span&gt;前后端日志，增量或者全量同步的MySQL业务数据表。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;数据仓库层&lt;/strong&gt;&lt;/span&gt;：包含维度表和事实表，通常是对源数据进行清洗后的数据宽表，比如行为日志表、推广宽表、用户宽表等。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;数据集市层&lt;/strong&gt;&lt;/span&gt;：对数据进行轻粒度的汇总表，比如广告效果表、用户行为的全链路表、用户群分析表等。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;数据应用层&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;：上层应用场景直接使用的数据表，包括多维分析生成的各种收入报表、Spark任务产出的算法模型特征和画像数据等。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;采用这样的分层结构，和软件分层思想类似，提高了数据的维护性和复用性&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;再来看应用层报表部分面临的挑战：&lt;/span&gt;&lt;/span&gt;&lt;span&gt;聚合维度多，&lt;/span&gt;&lt;span&gt;需要分时、分广告位、分推广等几十个维度；&lt;/span&gt;&lt;span&gt;&lt;span&gt;单表最大达到百亿级别；支持时间范围的实时查询。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;span/&gt;&lt;/span&gt;&lt;span&gt;这部分由公司的大数据部门维护，采用了开源的技术方案，离线部分使用Kylin，数据存储在HBase中；实时部分使用Flink和Spark Streaming，数据存储在Druid中。&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;写在最后&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;本文详细介绍了广告系统的初期架构和核心技术方案。随着业务演进，架构也会随之变得更加复杂，但是&lt;/span&gt;&lt;span&gt;大数据存储、&lt;span&gt;高&lt;/span&gt;&lt;span&gt;并发、&lt;/span&gt;高可用，始终是广告业务的技术难点&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;关于广告系统的稳定性保障、广告策略的可扩展性设计、RTB实时竞价的系统架构等有价值的内容，后续再分享给大家，欢迎关注我的公号。&lt;/span&gt;&lt;span&gt;针对本篇文章，如果有任何疑问或者建议，可以留言讨论&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&amp;lt;END&amp;gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote class=&quot;js_blockquote_wrap&quot; data-type=&quot;2&quot; data-url=&quot;&quot; data-author-name=&quot;&quot; data-content-utf8-length=&quot;56&quot; data-source-title=&quot;&quot;&gt;&lt;section class=&quot;js_blockquote_digest&quot;&gt;&lt;p&gt;&lt;span&gt;作者：IT人的职场进阶&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;博客园文章地址： &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;cnblogs.com/luojunwu/p/14113473.html&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;&lt;em&gt;&lt;span&gt;阅读更多&lt;/span&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.8333333333333334&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/WlIksv5EUJllR9ukZuZLccXHWbYMNSicJwNJSMvHZ8iacblib9ztmjCnRJ4nkxicqP8eDQ8ibIx1HejCSPWUrJicoTcQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;600&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;&lt;img class=&quot;__bg_gif&quot; data-ratio=&quot;0.6197183&quot; data-type=&quot;gif&quot; data-w=&quot;71&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/WlIksv5EUJk8tE5ud0tIZDibXsrImVibSlrLkUBQWqf0MTWKC1XVPKK6d0tysrjFLoianv0f8MwTjbnr1F5fibGcUg/640?wx_fmt=gif&quot;/&gt;&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;&lt;span&gt;查看「博客园12月活动」及每日中奖名单&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>