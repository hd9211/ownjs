<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>bbb0d10a629aabf54249f9f820ea4596</guid>
<title>一文教你如何学会写 Shell 脚本</title>
<link>https://toutiao.io/k/88px9ws</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4576612903225806&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/tWOhQMr1wdAZfVhlQjibm04ySHUqmracVj9e4j5VwFOnjzaTAvbiczcPiby1rBmZOjOMTbMpzic2rPiaibpg7vZVpMag/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;992&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;做 Java 的肯定都接触过 Linux 系统，那么很多时候我们在开发的过程中都是把我们项目打成一个jar包，或者是war包的形式，然后通过 XFTP 上传到我们服务器的指定目录，然后运行一端启动脚本，让我们&lt;/span&gt;的&lt;span&gt;项目变得可以访问 就像 &lt;/span&gt;&lt;code&gt;./sh service.sh start&lt;/code&gt;&lt;span&gt; 然后启动我们写好的 &lt;/span&gt;&lt;code&gt;sh&lt;/code&gt;&lt;span&gt; 的shell脚本。&lt;/span&gt;&lt;span&gt;接下来我们就来学习一下关于 Shell 脚本是如何写出来的。&lt;/span&gt;&lt;/p&gt;&lt;h4&gt;&lt;span&gt;Shell 脚本&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;Shell 脚本是什么？Shell是一个命令解释器，它的作用是解释执行用户输入的命令及程序等，也就是说，我们用户每输入一条命令，Shell 就会相对应的执行一条命令。当命令或程序语句不在命令行下执行，而是通过一个程序文件来执行时，该程序文件就被称为Shell脚本。&lt;/p&gt;&lt;p&gt;在我们的 Shell 脚本中，会有各种各样的内容，赋值，计算，循环等一系列的操作，接下来我们就来看看这个 Shell 脚本怎么写吧&lt;/p&gt;&lt;p&gt;1.查看自己当前系统默认的 Shell&lt;/p&gt;&lt;p&gt;&lt;code&gt;echo $SHELL&lt;/code&gt;&lt;/p&gt;&lt;p&gt;输出：/bin/bash&lt;/p&gt;&lt;p&gt;2.查看系统支持的Shell&lt;/p&gt;&lt;p&gt;&lt;code&gt;cat /etc/shells&lt;/code&gt;&lt;/p&gt;&lt;p&gt;输出：&lt;/p&gt;&lt;p&gt;/bin/sh /bin/bash /usr/bin/sh /usr/bin/bash&lt;/p&gt;&lt;p&gt;也就是说，我们的云服务器是支持我们在这里给他安排 Shell 脚本的&lt;/p&gt;&lt;h5&gt;&lt;span&gt;Shell 脚本怎么写出来的&lt;/span&gt;&lt;/h5&gt;&lt;p&gt;我们这时候先来安排一下 &lt;code&gt;sh&lt;/code&gt; 的文件,创建一个文件夹，然后在其中创建一个 &lt;code&gt;sh&lt;/code&gt; 的文件。&lt;/p&gt;&lt;p&gt;&lt;code&gt;mkdir /usr/local/shelltest&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;touch test.sh&lt;/code&gt;&lt;/p&gt;&lt;p&gt;创建完成我们编辑一下内容&lt;/p&gt;&lt;p&gt;&lt;code&gt;vim test.sh&lt;/code&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;#!/bin/bash&lt;/span&gt;&lt;br/&gt;&lt;span&gt;echo&lt;/span&gt; &lt;span&gt;&quot;Hello World Shell&quot;&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后我们出来运行一下我们的 Shell 的第一个脚本&lt;/p&gt;&lt;p&gt;&lt;code&gt;bash test.sh&lt;/code&gt;&lt;/p&gt;&lt;p&gt;出来的结果是 &lt;code&gt;Hello World Shell&lt;/code&gt;&lt;/p&gt;&lt;p&gt;一个及其简单的脚本出现了，接下我们就分析一波我们写了点啥？&lt;/p&gt;&lt;p&gt;&lt;code&gt;#!/bin/bash&lt;/code&gt;&lt;/p&gt;&lt;p&gt;#! 是一个约定的标记，它告诉系统这个脚本需要什么解释器来执行，即使用哪一种 Shell&lt;/p&gt;&lt;p&gt;我们在之前也使用了 &lt;code&gt;echo $SHELL&lt;/code&gt; 来查看了自己系统默认的是哪一种 &lt;code&gt;sh&lt;/code&gt; 解析器，之前看到的是/bin/bash，所以我们在写 Shell 脚本的时候，我们在开头默认的约定中，我们写了这个是用 /bin/bash 来进行解释的，&lt;/p&gt;&lt;p&gt;那么我们如何像之前调用我们的当前目录中的 Shell 脚本一样去调用他呢？就像这个样子的 &lt;code&gt;./sh service.sh start&lt;/code&gt;&lt;/p&gt;&lt;p&gt;1.授权，&lt;/p&gt;&lt;p&gt;我们先不授权试一下看看能通过 ./test.sh 进行调用么&lt;/p&gt;&lt;p&gt;bash: ./test.sh: Permission denied 会提示这个，也就是没有授权定义，&lt;/p&gt;&lt;p&gt;授权命令：chmod +x test.sh&lt;/p&gt;&lt;p&gt;2.执行 ./test.sh&lt;/p&gt;&lt;p&gt;然后调用就能正常输出了,就是说，在当前的目录下执行这个脚本命令。&lt;/p&gt;&lt;h5&gt;&lt;span&gt;Shell 脚本的变量&lt;/span&gt;&lt;/h5&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;定义变量和使用&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;变量命名实际上很简单，我们先来试一下&lt;/p&gt;&lt;p&gt;&lt;code&gt;name=zhiyikeji&lt;/code&gt;&lt;/p&gt;&lt;p&gt;这时候我们怎么使用变量呢？实际上只要在前面加上一个符号就可以 $&lt;/p&gt;&lt;p&gt;&lt;code&gt;echo $name&lt;/code&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# echo $name&lt;/span&gt;&lt;br/&gt;zhiyikeji&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# echo ${name}&lt;/span&gt;&lt;br/&gt;zhiyikeji&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;上面的两种写法都是可以的，外面的大括号加和不加区别不大，可以省略，直接就&lt;code&gt;$name&lt;/code&gt; 就可以使用你定义的变量&lt;/p&gt;&lt;p&gt;&lt;span&gt;使用括号的意义一般在于区别某些变量，比如你写了一串的内容，可能写的是 &lt;code&gt;echo $nameismyfriend&lt;/code&gt;,如果连在一起，是不是有点尴尬，这时候就可以使用括号区别一下，&lt;code&gt;echo ${name}ismyfriend&lt;/code&gt; 不&lt;/span&gt;使&lt;span&gt;用括号的时候，他就去找nameismyfriend这个变量了，就无法出来我们要的效果。&lt;/span&gt;&lt;/p&gt;&lt;ol start=&quot;2&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;删除自己定义的变量&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;code&gt;unset name&lt;/code&gt;&lt;/p&gt;&lt;p&gt;这时候我们就把我们刚才定义的 &lt;code&gt;name=zhiyikeji&lt;/code&gt; 这个变量给去掉了，我们可以调用一下我们的变量看是什么？&lt;/p&gt;&lt;p&gt;&lt;code&gt;echo $name&lt;/code&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# unset name&lt;/span&gt;&lt;br/&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# echo $name&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这是不是就证明我们自己定义的变量已经删除了&lt;/p&gt;&lt;ol start=&quot;3&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;只读变量&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;那么我们需要一个关键字，大家肯定能想到是什么关键字 &lt;code&gt;readonly&lt;/code&gt;&lt;/p&gt;&lt;p&gt;我们先给name赋值，然后使用 readonly 设置只读，然后再改变一下试试，&lt;/p&gt;&lt;pre&gt;&lt;code&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# name=zhiyikeji&lt;/span&gt;&lt;br/&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# echo $name&lt;/span&gt;&lt;br/&gt;zhiyikeji&lt;br/&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# readonly name&lt;/span&gt;&lt;br/&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# echo $name&lt;/span&gt;&lt;br/&gt;zhiyikeji&lt;br/&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# name=ceshi&lt;/span&gt;&lt;br/&gt;-bash: name: &lt;span&gt;readonly&lt;/span&gt; variable&lt;br/&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# &lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;竟然是真的，如果不设置只读，是不是会重新可以进行赋值，我们测试个年龄，&lt;/p&gt;&lt;pre&gt;&lt;code&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# age=10&lt;/span&gt;&lt;br/&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# echo $age&lt;/span&gt;&lt;br/&gt;10&lt;br/&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# age=20&lt;/span&gt;&lt;br/&gt;[root@iZbp10j01t7sgfqekyefpoZ ~]&lt;span&gt;# echo $age&lt;/span&gt;&lt;br/&gt;20&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;所以我们就可以肯定，readonly就是设置只读的关键词，记住了么？&lt;/p&gt;&lt;p&gt;那么设置只读的变量可以删除么？毕竟总有杠精的面试官会提问这个棘手的问题，但是，阿粉试过的所有方式好像都是不行的，阿粉就直接重启了自己的服务器，这样临时的变量就不存在了！&lt;/p&gt;&lt;h5&gt;&lt;span&gt;Shell 脚本的流程控制&lt;/span&gt;&lt;/h5&gt;&lt;p&gt;说真的，Shell脚本的流程控制数一般才是yyds，为什么这么说，因为你在写大部分的脚本的时候，流程控制的地方永远是最多的，判断，选择，等等一系列的函数，当时熟练使用的时候，就发现这东西确实很有意思。&lt;/p&gt;&lt;h5&gt;&lt;span&gt;IF&lt;/span&gt;&lt;/h5&gt;&lt;p&gt;我们先说最简单的 &lt;code&gt;if else&lt;/code&gt; 这也是我们最经常使用的判断，在写 &lt;code&gt;Shell&lt;/code&gt; 脚本的时候,就不像我们的 Java 中直接写&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;if&lt;/span&gt;(...){&lt;br/&gt;    &lt;br/&gt;}&lt;span&gt;else&lt;/span&gt;{&lt;br/&gt;    ....&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;Xshell&lt;/code&gt; 中的语法就不是这个样子的，&lt;code&gt;Xshell&lt;/code&gt;语法：&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;if&lt;/span&gt; ...&lt;br/&gt;&lt;span&gt;then&lt;/span&gt;&lt;br/&gt;    &lt;br/&gt;    ...&lt;br/&gt;&lt;span&gt;else&lt;/span&gt;&lt;br/&gt;    ...&lt;br/&gt;&lt;span&gt;fi&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;末尾的 fi 就是 if 倒过来拼写,我们可以写一个 &lt;code&gt;if&lt;/code&gt; 的脚本试一下这个流程能否理解。&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;#! /bin/bash&lt;br/&gt;  &lt;/span&gt;&lt;br/&gt;&lt;span&gt;if&lt;/span&gt; [ &lt;span&gt;$1&lt;/span&gt; -gt 2 ];&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;then&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;echo&lt;/span&gt; &lt;span&gt;&quot;值大于2&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;else&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;echo&lt;/span&gt; &lt;span&gt;&quot;值小于2&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;        &lt;span&gt;exit&lt;/span&gt;&lt;br/&gt;&lt;span&gt;fi&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里申明一下，&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;&lt;code&gt;-ge&lt;/code&gt;标识的是大于等于符号;&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;&lt;code&gt;-le&lt;/code&gt;表示的是小于等于符号;&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;&lt;code&gt;-gt&lt;/code&gt; 表示大于符号;&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;&lt;code&gt;-lt&lt;/code&gt; 表示小于符号;&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;&lt;code&gt;-eq&lt;/code&gt; 表示等于符号;&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;&lt;code&gt;-ne&lt;/code&gt; 表示不等于符号;&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;我们在上面这段脚本中写就是内容就是，我们给脚本传入一个值，然后比对这个值和2的大小关系，然后输出我们指定的内容。&lt;/p&gt;&lt;p&gt;运行后就能看到&lt;/p&gt;&lt;pre&gt;&lt;code&gt;[root@iZbp10j01t7sgfqekyefpoZ shelltest]&lt;span&gt;# sh test2.sh 1&lt;/span&gt;&lt;br/&gt;值小于2&lt;br/&gt;[root@iZbp10j01t7sgfqekyefpoZ shelltest]&lt;span&gt;# sh test2.sh 3&lt;/span&gt;&lt;br/&gt;值大于2&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;$1&lt;/code&gt; 表示我们给 Shell 脚本输入的第一个参数, &lt;code&gt;$0&lt;/code&gt;就是你写的shell脚本本身的名字,$2 是我们给 Shell 脚本传的第二个参数&lt;/p&gt;&lt;p&gt;大家在部署某些项目的时候，是不是启动命令就很简洁，就是 &lt;code&gt;sh service.sh start&lt;/code&gt; 类似这种的，那我们来看看一般这种是怎么写的，这就用到了另外一块的内容，和 &lt;code&gt;if&lt;/code&gt; 类似，在 Java 中也有，那就是 &lt;code&gt;Case&lt;/code&gt;.&lt;/p&gt;&lt;h5&gt;&lt;span&gt;Case&lt;/span&gt;&lt;/h5&gt;&lt;p&gt;我们先来看看 &lt;code&gt;Case&lt;/code&gt; 的语法，&lt;/p&gt;&lt;p&gt;&lt;code&gt;case ... esac&lt;/code&gt; 实际上就和 Java 中的 Case 是非常相似的，case 语句匹配一个值与一个模式，如果匹配成功，执行相匹配的命令.&lt;code&gt;esac&lt;/code&gt;是一个结束的标志。&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;case&lt;/span&gt; 值 &lt;span&gt;in&lt;/span&gt;&lt;br/&gt;匹配值1)&lt;br/&gt;    command1&lt;br/&gt;    command2&lt;br/&gt;    &lt;br/&gt;    ;;&lt;br/&gt;&lt;span&gt;匹配值2&lt;/span&gt;）&lt;br/&gt;    command1&lt;br/&gt;    command2&lt;br/&gt;    ;;&lt;br/&gt;&lt;span&gt;esac&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;光说不练，假把式，我们来搞一下试试写一个脚本来搞一下。就用我们刚才说的 &lt;code&gt;sh servic.sh start&lt;/code&gt; 来进行测试。&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;$1&lt;/span&gt; &lt;span&gt;in&lt;/span&gt;&lt;br/&gt;  &lt;br/&gt;start)&lt;br/&gt;        &lt;span&gt;#输出启动命令&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;echo&lt;/span&gt; &lt;span&gt;&quot;start已经开始&quot;&lt;/span&gt;&lt;br/&gt;        ;;&lt;br/&gt;stop)&lt;br/&gt;        &lt;span&gt;#输出停止命令&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;echo&lt;/span&gt; &lt;span&gt;&quot;stop命令执行&quot;&lt;/span&gt;&lt;br/&gt;        ;;&lt;br/&gt;&lt;span&gt;esac&lt;/span&gt;&lt;br/&gt;&lt;span&gt;exit&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我们来看看运行结果&lt;/p&gt;&lt;pre&gt;&lt;code&gt;[root@iZbp10j01t7sgfqekyefpoZ shelltest]&lt;span&gt;# sh service.sh start&lt;/span&gt;&lt;br/&gt;start已经开始&lt;br/&gt;[root@iZbp10j01t7sgfqekyefpoZ shelltest]&lt;span&gt;# sh service.sh stop&lt;/span&gt;&lt;br/&gt;stop命令执行&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;那么这段 Shell 脚本是什么意思呢？其实很简单，匹配我们传入的第一个字符，和 &lt;code&gt;start&lt;/code&gt; 还有 &lt;code&gt;stop&lt;/code&gt; 进行比较，如果匹配上之后，输出命令，最后退出即可。&lt;/p&gt;&lt;p&gt;是不是感觉没有那么复杂了呢？&lt;/p&gt;&lt;h5&gt;&lt;span&gt;For&lt;/span&gt;&lt;/h5&gt;&lt;p&gt;说到流程控制,那么肯定不能不说 for , 毕竟 for 循环在 Java 中那可是重头戏。&lt;/p&gt;&lt;p&gt;我们先看他的格式&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;for&lt;/span&gt; i &lt;span&gt;in&lt;/span&gt; item1 item2 ... itemN&lt;br/&gt;&lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    command1&lt;br/&gt;    command2&lt;br/&gt;    ...&lt;br/&gt;    commandN&lt;br/&gt;&lt;span&gt;done&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;那么我们有没有说像是 Java 中那种 for 循环一样的方式呢？比如说这个&lt;code&gt;for ((i=1; i&amp;lt;=j; i++))&lt;/code&gt;&lt;/p&gt;&lt;p&gt;实际上也是支持这种的，我们来写一个试试。&lt;/p&gt;&lt;pre&gt;&lt;code&gt;j=&lt;span&gt;$1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;for&lt;/span&gt; ((i=1;i&amp;lt;=j;i++))&lt;br/&gt;&lt;span&gt;do&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;echo&lt;/span&gt; &lt;span&gt;$i&lt;/span&gt;&lt;br/&gt;&lt;span&gt;done&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;执行一下看看&lt;/p&gt;&lt;pre&gt;&lt;code&gt;[root@iZbp10j01t7sgfqekyefpoZ shelltest]&lt;span&gt;# sh fortest.sh 6&lt;/span&gt;&lt;br/&gt;1&lt;br/&gt;2&lt;br/&gt;3&lt;br/&gt;4&lt;br/&gt;5&lt;br/&gt;6&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;既然有 for 那是不是就有 while 呢？是的，没错，确实是有 while ，也是循环的意思，但是写法有略微不一样的地方&lt;/p&gt;&lt;h5&gt;&lt;span&gt;While&lt;/span&gt;&lt;/h5&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;while&lt;/span&gt; condition&lt;br/&gt;&lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;command&lt;/span&gt;&lt;br/&gt;&lt;span&gt;done&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我们来举个尝试打印九九乘法表来看一下&lt;/p&gt;&lt;pre&gt;&lt;code&gt;a=1&lt;br/&gt;b=1&lt;br/&gt;&lt;span&gt;while&lt;/span&gt; ((a &amp;lt;=9))&lt;br/&gt;&lt;span&gt;do&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;while&lt;/span&gt; ((b&amp;lt;=a))&lt;br/&gt;                &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;                        &lt;span&gt;let&lt;/span&gt; &lt;span&gt;&quot;c=a*b&quot;&lt;/span&gt;   &lt;span&gt;#声明变量c&lt;/span&gt;&lt;br/&gt;                        &lt;span&gt;echo&lt;/span&gt; -n  &lt;span&gt;&quot;&lt;span&gt;$a&lt;/span&gt;*&lt;span&gt;$b&lt;/span&gt;=&lt;span&gt;$c&lt;/span&gt; &quot;&lt;/span&gt;&lt;br/&gt;                        &lt;span&gt;let&lt;/span&gt; b++&lt;br/&gt;                &lt;span&gt;done&lt;/span&gt;&lt;br/&gt;                        &lt;span&gt;let&lt;/span&gt; a++&lt;br/&gt;&lt;br/&gt;     &lt;span&gt;let&lt;/span&gt; b=1  &lt;span&gt;#因为每个乘法表都是1开始乘，所以b要重置&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;             &lt;span&gt;echo&lt;/span&gt; &lt;span&gt;&quot;&quot;&lt;/span&gt; &lt;span&gt;#显示到屏幕换行&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;     &lt;span&gt;done&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;[root@iZbp10j01t7sgfqekyefpoZ shelltest]&lt;span&gt;# sh whileTest.sh &lt;/span&gt;&lt;br/&gt;1*1=1 &lt;br/&gt;2*1=2 2*2=4 &lt;br/&gt;3*1=3 3*2=6 3*3=9 &lt;br/&gt;4*1=4 4*2=8 4*3=12 4*4=16 &lt;br/&gt;5*1=5 5*2=10 5*3=15 5*4=20 5*5=25 &lt;br/&gt;6*1=6 6*2=12 6*3=18 6*4=24 6*5=30 6*6=36 &lt;br/&gt;7*1=7 7*2=14 7*3=21 7*4=28 7*5=35 7*6=42 7*7=49 &lt;br/&gt;8*1=8 8*2=16 8*3=24 8*4=32 8*5=40 8*6=48 8*7=56 8*8=64 &lt;br/&gt;9*1=9 9*2=18 9*3=27 9*4=36 9*5=45 9*6=54 9*7=63 9*8=72 9*9=81 &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;是不是也挺简单的？&lt;/p&gt;&lt;p&gt;其实 Shell 脚本的编写一般都是在实际应用中提升，单纯的写测试脚本，也是可以让自己对知识的掌握比较充分，而我们一般都是写一些比较简单的脚本，复杂的不是还有运维么？&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;&lt;br/&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&amp;lt; END &amp;gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;告诉大家一个好消息，Java极客技术读者交流群（摸鱼为主），时隔 2 年后再次开放了，感兴趣的朋友，可以在公号回复：&lt;strong&gt;999&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;267&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;198&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1.3693333333333333&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/tWOhQMr1wdDUPe5kG8qNUeSVZwfYRMjGpjiaiczm9oTmUPwicVxxW4TsLOjibicP0WMaAib4lhYfkf4v4voMZic36KeBw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;750&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;&lt;br/&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;&lt;br/&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;喜欢就&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;分享&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;认同就&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;点赞&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;支持就&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;在看&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;一键四连，你的offer也四连&lt;/strong&gt;&lt;/span&gt;&lt;img class=&quot;rich_pages __bg_gif&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;539&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;105&quot; data-ratio=&quot;0.1949685534591195&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/ianc8gowe95SWT9QpjR1RWJoYvwicx4prnZMR2NxgzMNg7zCJTO7YR2CmgwPmHdfz8xNWMw2WxljnnJjU5PHsnSw/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;636&quot;/&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>0ddcc0a0c03505a97ab426f8cd457328</guid>
<title>三分钟快速上手 Spring 事件机制</title>
<link>https://toutiao.io/k/304f3j8</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;小伙伴们好呀~ 今天来和大家分享下这个 &lt;strong&gt;Spring事件机制&lt;/strong&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;内容概览&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.45977011494252873&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27AYgomKNKiceUw6ibeGs7oJllDnxKjlQrN6Dths8icvQnx8ZfQJ2unErLfQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;522&quot;/&gt;&lt;figcaption&gt;image-20210829132019387&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;原理&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.3425034387895461&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27AXsSrxiamlypk68PzEGkqkpibsaBJkJg6guDn7cO96vuWBlIOlEumN3FQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;727&quot;/&gt;&lt;figcaption&gt;image-20210828184103069&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个熟悉 &lt;strong&gt;观察者模式&lt;/strong&gt; 的小伙伴应该一眼就看出来啦~&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其实就是个简单版的 &lt;strong&gt;发布-订阅模式&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;有三个核心类👇&lt;/strong&gt;&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;事件&lt;/strong&gt; &lt;code&gt;ApplicationEvent&lt;/code&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;事件发布器&lt;/strong&gt; &lt;code&gt;ApplicationEventPublisher&lt;/code&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;事件监听器&lt;/strong&gt; &lt;code&gt;ApplicationListener&lt;/code&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;用途👇&lt;/strong&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;事件发布器发布事件，监听器监听到对应的事件后做出相应的反应~&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;为什么使用&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;因为需求也不确定 🙄&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;场景&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;领导：想在用户操作完后发个邮件通知下A&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我：好的&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;几天后……&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;领导：算了，先站内提醒就好了，后面再考虑发短信通知啥的，看看哪个效果好点&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我：……好的&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一开始我也没用这个事件机制的，没多想就写一起了&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;后面觉得有点不对劲，才想起来用这招的😄&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;优点👇&lt;/strong&gt;&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;解耦&lt;/strong&gt; 可以将业务代码和发邮件，站内提醒，短信等进行分离&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;异步通知&lt;/strong&gt; 不用等待这些事件的完成&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;提高扩展性&lt;/strong&gt; 后面再扩展其他操作也方便多啦&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;提醒&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;体量小的系统还可以用，大点的还是直接用消息中间件去解决靠谱&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;项目实战&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27AdJ2DEFPYMaUgicIYcAo8bKDebJTk7uF6h0FcWUHerR6iaPZJ0Eo9Skxg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.6508563899868248&quot; data-w=&quot;759&quot;/&gt;&lt;figcaption&gt;image-20210829102043376&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;功能&lt;span/&gt;&lt;/h4&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;根据小伙伴反馈事件去发送短信和邮件&lt;/p&gt;&lt;/blockquote&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;主要源码&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一. 小伙伴反馈事件 &lt;code&gt;ReaderFeedbackEvent&lt;/code&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27Axf17HibYBYnx7BThloCtKvHUtxIss4XWzvuW4wcjlZ1YHsIDY6DYbWw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.4794520547945205&quot; data-w=&quot;803&quot;/&gt;&lt;figcaption&gt;image-20210829094311899&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;特点和作用👇&lt;/strong&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;继承 &lt;code&gt;ApplicationEvent&lt;/code&gt; ，保存反馈信息的DTO&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;二. 事件发布器 &lt;code&gt;ReaderFeedbackEventPublisher&lt;/code&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27AfxX4MibT7iaOfFE7sZkwjfY6wMrXdyrl0iarRTZHgXy9DC5cJEOpjID3Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.5361875637104995&quot; data-w=&quot;981&quot;/&gt;&lt;figcaption&gt;image-20210829102353506&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;特点和作用👇&lt;/strong&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;实现 &lt;code&gt;ApplicationEventPublisherAware&lt;/code&gt; 这个接口，获取 &lt;code&gt;ApplicationEventPublisher&lt;/code&gt; 事件发布器去发布事件&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;三. 监听 &lt;code&gt;ReaderFeedbackEvent&lt;/code&gt; 事件并发送邮件&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27AIsiczFMOqsneibATGibEuaLORF2icaKjlpCE9aV8sKFqFVgfnsVu3HfJKw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.8741633199464525&quot; data-w=&quot;747&quot;/&gt;&lt;figcaption&gt;image-20210829102540185&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;特点和作用👇&lt;/strong&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;实现 &lt;code&gt;ApplicationListener&lt;/code&gt; 这个接口，获取事件中的反馈信息，并发送邮件&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;四. 当反馈信息有点赞时才发送短信通知😄&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27AyuE0fiaw06oicm1tG116FYbHFEJ5W5YeQbynya17ZtPVIU9yCyiaoDA1g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.6862170087976539&quot; data-w=&quot;682&quot;/&gt;&lt;figcaption&gt;image-20210829102736577&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;特点和作用👇&lt;/strong&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;监听器的第二种写法—— &lt;strong&gt;注解&lt;/strong&gt; ，比较方便，这里监听并判断是不是点赞，再去发送短信😝&lt;/p&gt;&lt;/blockquote&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;测试&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里直接在 &lt;code&gt;IDEA&lt;/code&gt; 中进行测试，&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27AExkhibcfN8L58cDOYnrBkibxzp2oPNwZqEvVfA0FouqN4rebLdocITiaw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.5962910128388017&quot; data-w=&quot;701&quot;/&gt;&lt;figcaption&gt;image-20210829111125716&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;效果如下👇&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;like = false&lt;/code&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27AmAUibOK3CBic0hSQwpBKQHl7w2fVBSHITibOsMlZKvr89fMfn7bibN4H4w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.22592592592592592&quot; data-w=&quot;1080&quot;/&gt;&lt;figcaption&gt;image-20210829111409325&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;like = true&lt;/code&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27AjXhz7LjIQxuibKdC969YrkCBXAVzfr5Muz6eaIzJkbyicibibw6y9ZUTgQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.21296296296296297&quot; data-w=&quot;1080&quot;/&gt;&lt;figcaption&gt;image-20210829124910499&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;收到的短信&lt;/strong&gt;&lt;/p&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27ApRJH7El1RFmyt5gJKpiaHSlw7AZ2j26eIDkfzgspEez73WLKyke2PVg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.3690596562184024&quot; data-w=&quot;989&quot;/&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;小结&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可以看到功能模块很简单，监听反馈事件，然后去发送短信和邮件~&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27A8q8Ef1CGzDMPWyXuUflmgdyfVcq3yZmialrkpqlEvfxY4uNkvvTUyqw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.4883177570093458&quot; data-w=&quot;856&quot;/&gt;&lt;figcaption&gt;image-20210829130532523&lt;/figcaption&gt;&lt;/figure&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;这部分代码上传到我的 &lt;code&gt;GitHub&lt;/code&gt; 仓库啦 （&lt;strong&gt;地址在文末&lt;/strong&gt;）😝&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Spring源码解读&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;异步/同步&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里我们打个断点，就可以轻易的来到这里啦 👇&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27ALTYIiczFYHns6axOO5LibyjYib3amVKibkAmspicBwWH4tice6uLz3upICRQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.3034934497816594&quot; data-w=&quot;916&quot;/&gt;&lt;figcaption&gt;image-20210829104327436&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个方法在&lt;strong&gt;事件多播器&lt;/strong&gt; &lt;code&gt;SimpleApplicationEventMulticaster&lt;/code&gt; 中，可以看到当有配置这个&lt;strong&gt;线程池&lt;/strong&gt;时，是走&lt;strong&gt;异步&lt;/strong&gt;通知路线的&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;那怎么调用监听器的呢？&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可以看到就这简单&lt;strong&gt;3步&lt;/strong&gt; ，最后就是回到我们的 &lt;code&gt;onApplicationEvent&lt;/code&gt; 方法中去处理的&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;invokeListener&lt;/code&gt; ——&amp;gt; &lt;code&gt;doInvokeListener&lt;/code&gt; ——&amp;gt; &lt;code&gt;onApplicationEvent&lt;/code&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27AXWVAMeTJhKWNY2aa9APC2uZYPRqjY5a2rSR31cjwrHARCMIqHxWzOg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.12761020881670534&quot; data-w=&quot;862&quot;/&gt;&lt;figcaption&gt;image-20210829104759111&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;总结&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;活学活用，快去试试叭！😆&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;项目地址👉&lt;/strong&gt;：https://github.com/Java4ye/springboot-demo-4ye&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;喜欢的话，点个小星星呀⭐⭐😝&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27AlLpbOhpMwRIdpn1TwsiaScXZYjw0Y8hJj8DhlrbedEcD86miaXTcHbYg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.4898148148148148&quot; data-w=&quot;1080&quot;/&gt;&lt;figcaption&gt;image-20210829144304728&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;本期思维导图如下👇&lt;/strong&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYEbNXYvTfT3ZtGErmLIW27AAejyonRiazYF1XrsfLxdR8vgwXV0DeWsO8BjBnicAMJVoBTZKjRpRphg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.5638888888888889&quot; data-w=&quot;1080&quot;/&gt;&lt;figcaption&gt;image-20210829132531501&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;ps：最近忙起来啦，更文速度会慢一些哦~ 🐷&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;我是4ye 咱们下期应该……很快再见！！&lt;/strong&gt; 😆&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;喜欢的话可以关注下公众号 &lt;strong&gt;Java4ye&lt;/strong&gt; 支持下 &lt;strong&gt;4ye&lt;/strong&gt; 呀😝&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;Mzg2MjUzODc5Mw==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/zIjiaGEEKdYFUAO47rDkQycV4q8RTDe4kKXORDlaNmjGLiaxZxbHdOJ32ict5W0wEejBficWOLqDYELibIe5IEdtzeA/0?wx_fmt=png&quot; data-nickname=&quot;Java4ye&quot; data-alias=&quot;Java4ye&quot; data-signature=&quot;定个小目标，写个3年先 ！！&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;section data-recommend-type=&quot;list-title&quot; data-recommend-tid=&quot;6&quot; data-mpa-template=&quot;t&quot; data-mid=&quot;&quot; data-from=&quot;yb-recommend&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;往期推荐&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-title&quot; data-recomment-template-id=&quot;6&quot; data-recommend-article-id=&quot;2247488696_1&quot; data-recommend-article-time=&quot;1629331740&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/zIjiaGEEKdYGqvAqme7rHsR0aJib5pwwQIfYbqqAxIX5re6ibwLamHyPUMzH0LNYuzxXcdzoABREicGwskgQqpkibbQ/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;Spring的这七大模块你了解吗？&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247488696&amp;amp;idx=1&amp;amp;sn=ba2f3f2e2ae2c646c0d3f5d149ec65dc&amp;amp;chksm=ce0709fef97080e86a5a0b0a8a102e21eb3636b55b757845dd5602ed4e916122b13a7f90add2#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247488696&amp;amp;idx=1&amp;amp;sn=ba2f3f2e2ae2c646c0d3f5d149ec65dc&amp;amp;chksm=ce0709fef97080e86a5a0b0a8a102e21eb3636b55b757845dd5602ed4e916122b13a7f90add2&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;&lt;section data-recommend-title=&quot;t&quot; data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;Spring的这七大模块你了解吗？&lt;/p&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-title&quot; data-recomment-template-id=&quot;6&quot; data-recommend-article-id=&quot;2247488663_1&quot; data-recommend-article-time=&quot;1628390239&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/zIjiaGEEKdYFLt03csToVvV7xiaGPViaa8uVeTcVibUuQvJZYHBRPnRpEn27Fj8ibgDQYhNsQmVNxnRsrgCf82cRG6w/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;这5个GitHub项目+3个网站，助你一飞冲天！&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247488663&amp;amp;idx=1&amp;amp;sn=577fde8f514b13b001ce53f9417280c6&amp;amp;chksm=ce0709d1f97080c7fbef1345d4efb025d2bfcc90b54cccaa367a3f2f0617b7a7ebf7b931366a#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247488663&amp;amp;idx=1&amp;amp;sn=577fde8f514b13b001ce53f9417280c6&amp;amp;chksm=ce0709d1f97080c7fbef1345d4efb025d2bfcc90b54cccaa367a3f2f0617b7a7ebf7b931366a&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;&lt;section data-recommend-title=&quot;t&quot; data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;这5个GitHub项目+3个网站，助你一飞冲天！&lt;/p&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-title&quot; data-recomment-template-id=&quot;6&quot; data-recommend-article-id=&quot;2247488639_1&quot; data-recommend-article-time=&quot;1628089489&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/zIjiaGEEKdYGedsiaeO9EMGW92cZR1bCiblQ6zDZYZF8x9zqfiaicKaENv02xTEia7fwYapiaI4g0oQmYrbcARzIVsOCg/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;三分钟快速了解Spring中的工厂模式&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247488639&amp;amp;idx=1&amp;amp;sn=e772f1c8ba3110b4311df9ce39837966&amp;amp;chksm=ce070939f970802ff4610e4cddbd90ca65ad2405eb0d63ddf7f6271e80922fbab5d432fbbce5#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247488639&amp;amp;idx=1&amp;amp;sn=e772f1c8ba3110b4311df9ce39837966&amp;amp;chksm=ce070939f970802ff4610e4cddbd90ca65ad2405eb0d63ddf7f6271e80922fbab5d432fbbce5&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;&lt;section data-recommend-title=&quot;t&quot; data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;三分钟快速了解Spring中的工厂模式&lt;/p&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-title&quot; data-recomment-template-id=&quot;6&quot; data-recommend-article-id=&quot;2247488545_1&quot; data-recommend-article-time=&quot;1626591737&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/zIjiaGEEKdYFbuTaDJFr2GVFwExLIgiaia8Jz3TP9R3cs5eZ3UV4lOk0Oia0iaNELsxWV1tP8WKXQR5AYRcQhr6emibA/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;简单两步搞定Springboot自定义starter&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247488545&amp;amp;idx=1&amp;amp;sn=7edd49f9ad5b105289fb8ab42abfe7e2&amp;amp;chksm=ce070967f97080717fd22e94bd7dc0b1f7ae45b63917e4b3fa43d38d3f41026056add4b9a79a#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247488545&amp;amp;idx=1&amp;amp;sn=7edd49f9ad5b105289fb8ab42abfe7e2&amp;amp;chksm=ce070967f97080717fd22e94bd7dc0b1f7ae45b63917e4b3fa43d38d3f41026056add4b9a79a&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;&lt;section data-recommend-title=&quot;t&quot; data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;简单两步搞定Springboot自定义starter&lt;/p&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-title&quot; data-recomment-template-id=&quot;6&quot; data-recommend-article-id=&quot;2247488498_1&quot; data-recommend-article-time=&quot;1625619303&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/zIjiaGEEKdYHkK4EImyKiaVSKlAAoLoE4xZvs0xgPvV1ICdefyibL4xHfD5ibdq8hohe1X4ib3zsgXCKib4Oibaibo3wjw/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;花了2个钟才搞懂这AOP为啥没生效，水友却睡着了……&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247488498&amp;amp;idx=1&amp;amp;sn=928ceffb140a9b9ae49a6dd50a8ccbf1&amp;amp;chksm=ce070eb4f97087a290ea52ee027c7c41aa3464e0bb4fc1b95591cbbba8d587e2db4f7c5313d7#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247488498&amp;amp;idx=1&amp;amp;sn=928ceffb140a9b9ae49a6dd50a8ccbf1&amp;amp;chksm=ce070eb4f97087a290ea52ee027c7c41aa3464e0bb4fc1b95591cbbba8d587e2db4f7c5313d7&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;&lt;section data-recommend-title=&quot;t&quot; data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;花了2个钟才搞懂这AOP为啥没生效，水友却睡着了……&lt;/p&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-title&quot; data-recomment-template-id=&quot;6&quot; data-recommend-article-id=&quot;2247487868_1&quot; data-recommend-article-time=&quot;1624252157&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/zIjiaGEEKdYGGu1JGcLyrfM0fWECBsfibFicOHEXnAvibG3AhMcR8oR5ZbnhK8mm6s0tjG7jo4l4ibobto8sA06tmag/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;四种引用类型在Springboot中的使用&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247487868&amp;amp;idx=1&amp;amp;sn=715f982805871beca12e4891a810015c&amp;amp;chksm=ce070c3af970852cc8e9690a4bc1bf5818d4a708245c8fd2cd6c258be867e581d4dea8c92a57#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247487868&amp;amp;idx=1&amp;amp;sn=715f982805871beca12e4891a810015c&amp;amp;chksm=ce070c3af970852cc8e9690a4bc1bf5818d4a708245c8fd2cd6c258be867e581d4dea8c92a57&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;&lt;section data-recommend-title=&quot;t&quot; data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;四种引用类型在Springboot中的使用&lt;/p&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-title&quot; data-recomment-template-id=&quot;6&quot; data-recommend-article-id=&quot;2247487780_1&quot; data-recommend-article-time=&quot;1623893808&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/zIjiaGEEKdYFJAKHwk0A4UZ6aR7icNwR53KBN4p7PQCkia1pKspJNac5hvgWFlsXfXUvAiakujW6ibhKadqEeBHvUmQ/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;Springboot自动装配原理探索&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247487780&amp;amp;idx=1&amp;amp;sn=618b88be9f5e81659a6a6ce4450972e8&amp;amp;chksm=ce070c62f97085742a3e26a376065229be04e5527f89de599b71c33c5f9a1735c6fa74b698f7#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247487780&amp;amp;idx=1&amp;amp;sn=618b88be9f5e81659a6a6ce4450972e8&amp;amp;chksm=ce070c62f97085742a3e26a376065229be04e5527f89de599b71c33c5f9a1735c6fa74b698f7&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;&lt;section data-recommend-title=&quot;t&quot; data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;Springboot自动装配原理探索&lt;/p&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-title&quot; data-recomment-template-id=&quot;6&quot; data-recommend-article-id=&quot;2247488415_1&quot; data-recommend-article-time=&quot;1625155144&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/zIjiaGEEKdYFpO5v3RblLZrj2iaCVlp98I17MxfbNGgqu8HWB1AibSgeb2VFKCm25V3NgHf4My8WWziaVIdHia8Jiaiag/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;Cglib动态代理探索（ASM，Spring）&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247488415&amp;amp;idx=1&amp;amp;sn=2ac254a9862f49a7bb1d3b94cba27b86&amp;amp;chksm=ce070ed9f97087cf182f3ab4c49e5cfdfa7cb5a1b16a3f573302d991a919adbc23f62da0d56e#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247488415&amp;amp;idx=1&amp;amp;sn=2ac254a9862f49a7bb1d3b94cba27b86&amp;amp;chksm=ce070ed9f97087cf182f3ab4c49e5cfdfa7cb5a1b16a3f573302d991a919adbc23f62da0d56e&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;&lt;section data-recommend-title=&quot;t&quot; data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;Cglib动态代理探索（ASM，Spring）&lt;/p&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-title&quot; data-recomment-template-id=&quot;6&quot; data-recommend-article-id=&quot;2247487968_1&quot; data-recommend-article-time=&quot;1624725156&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/zIjiaGEEKdYGSDNAfYKqerWkVR1icWzYw1VricWhIc650yrxvK6T4fkRiboYfQDrMqmTbicWxXE3HRMn9aWQI4XZutw/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;Java代理模式和字节码的探索&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247487968&amp;amp;idx=1&amp;amp;sn=c2dbbdc444461b3568712119c170242e&amp;amp;chksm=ce070ca6f97085b01100a97994836e4f92b24395dfb2ffd3fbbf75ef8c511b1df4fa25522ce4#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247487968&amp;amp;idx=1&amp;amp;sn=c2dbbdc444461b3568712119c170242e&amp;amp;chksm=ce070ca6f97085b01100a97994836e4f92b24395dfb2ffd3fbbf75ef8c511b1df4fa25522ce4&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;&lt;section data-recommend-title=&quot;t&quot; data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;Java代理模式和字节码的探索&lt;/p&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-title&quot; data-recomment-template-id=&quot;6&quot; data-recommend-article-id=&quot;2247487726_1&quot; data-recommend-article-time=&quot;1623420490&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/zIjiaGEEKdYHicGhYCpJhx1lCWAZKWBvrXE8rUTZBZ8U96P7nKfZI7wKe5GnoKEpibicAfUB4nrkbiaEexOkPSHJRNw/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;服务发现机制SPI居然是破坏者？！&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247487726&amp;amp;idx=1&amp;amp;sn=6bf3c4599c77152895d8684e842b0469&amp;amp;chksm=ce070da8f97084be2399915e747e291e088da0a91b28d4c469a3b0d358958a0393bbcafd0536#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg2MjUzODc5Mw==&amp;amp;mid=2247487726&amp;amp;idx=1&amp;amp;sn=6bf3c4599c77152895d8684e842b0469&amp;amp;chksm=ce070da8f97084be2399915e747e291e088da0a91b28d4c469a3b0d358958a0393bbcafd0536&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;&lt;section data-recommend-title=&quot;t&quot; data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;服务发现机制SPI居然是破坏者？！&lt;/p&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot;&gt;
                                &lt;p class=&quot;tips_global&quot; aria-hidden=&quot;true&quot; id=&quot;js_a11y_reward_qr_title&quot;&gt;Long-press QR code to transfer me a reward&lt;/p&gt;
                                                                &lt;p role=&quot;option&quot; aria-labelledby=&quot;js_a11y_reward_qr_word js_a11y_comma js_a11y_reward_qr_title js_a11y_reward_qr_money&quot; aria-describedby=&quot;js_a11y_reward_qr_tips &quot; class=&quot;reward_tips&quot; id=&quot;js_a11y_reward_qr_word&quot;/&gt;
                                &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img alt=&quot;赞赏二维码&quot; class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;/&gt;&lt;/span&gt;
                                &lt;p aria-hidden=&quot;true&quot; id=&quot;js_a11y_reward_qr_tips&quot; class=&quot;tips_global&quot;&gt;As required by Apple&#x27;s new policy, the Reward feature has been disabled on Weixin for iOS. You can still reward an Official Account by transferring money via QR code.&lt;/p&gt;
                            &lt;/div&gt;
                                                                            
                              
            &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>81a232a014bb814b50b4e0d171bbe118</guid>
<title>Flink 吐血总结，学习与面试收藏这一篇就够了</title>
<link>https://toutiao.io/k/r1phx01</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;/h1&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzI4MjU4MzkwOQ==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dRCmOAs1H8E7QUDiaFQv0m4w2P7f4EkiacNxALJM0S7jPa7uL2a9sibAsHC6SzKZjZvylEhm4feUjlTQ/0?wx_fmt=png&quot; data-nickname=&quot;大数据左右手&quot; data-alias=&quot;ykc20161218&quot; data-signature=&quot;大数据开发工作者。致力于大数据技术学习与工作。实时，离线，面试与总结，或者生活小矫情类文章，总有适合你的那一篇。&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Flink&lt;/span&gt;&lt;br/&gt;&lt;/h1&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;Flink 核心特点&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;批流一体&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;所有的数据都天然带有时间的概念，必然发生在某一个时间点。把事件按照时间顺序排列起来，就形成了一个事件流，也叫作数据流。&lt;strong&gt;「无界数据」&lt;/strong&gt;是持续产生的数据，所以必须持续地处理无界数据流。&lt;strong&gt;「有界数据」&lt;/strong&gt;，就是在一个确定的时间范围内的数据流，有开始有结束，一旦确定了就不会再改变。&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;可靠的容错能力&lt;span/&gt;&lt;/h4&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;集群级容错&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;集群管理器集成（Hadoop YARN、Mesos或Kubernetes）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;高可用性设置（HA模式基于ApacheZooKeeper）&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;应用级容错（ Checkpoint）&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;一致性（其本身支持Exactly-Once 语义）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;轻量级（检查点的执行异步和增量检查点）&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;高吞吐、低延迟&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;运行时架构&lt;span/&gt;&lt;/h4&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.6221562809099901&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LQEn41Z2GS02O6O7hHCibq5BXomrtdW1cS2VZA43BSfIaAAZoazia96Vw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1011&quot;/&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;figcaption&gt;运行时架构图&lt;/figcaption&gt;&lt;/figure&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Flink 客户端&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;提交Flink作业到Flink集群&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Stream Graph 和 Job Graph构建&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;JobManager&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;TaskManager&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;接收JobManager 分发的子任务，管理子任务&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;任务处理（消费数据、处理数据）&lt;span/&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;mpcpc js_editor_cpcad=&quot;&quot; class=&quot;js_cpc_area cpc_iframe&quot; src=&quot;/cgi-bin/readtemplate?t=tmpl/cpc_tmpl#1625624437541&quot; data-category_id_list=&quot;41|5|7&quot; data-id=&quot;1625624437541&quot;/&gt;&lt;/h2&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Flink 应用&lt;/span&gt;&lt;/h2&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;数据流&lt;span/&gt;&lt;/h4&gt;&lt;h5 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;DataStream 体系&lt;span/&gt;&lt;/h5&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;DataStream(每个DataStream都有一个Transformation对象)&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;DataStreamSource（DataStream的起点）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;DataStreamSink（DataStream的输出）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;KeyedStream（表示根据指定的Key记性分组的数据流）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;WindowdeStream &amp;amp; AllWindowedStream（根据key分组且基于WindowAssigner切分窗口的数据流）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;JoinedStreams &amp;amp; CoGroupedStreams&lt;/section&gt;&lt;/li&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;JoinedStreams底层使用CoGroupedStreams来实现&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;CoGrouped侧重的是Group，对数据进行分组，是对同一个key上的两组集合进行操作&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Join侧重的是数据对，对同一个key的每一对元素进行操作&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;li&gt;&lt;section&gt;ConnectedStreams（表示两个数据流的组合）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;BroadcastStream &amp;amp; BroadcastConnectedStream（DataStream的广播行为）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;IterativeStream（包含IterativeStream的Dataflow是一个有向有环图）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;AsyncDataStream（在DataStream上使用异步函数的能力）&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h5 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;处理数据API&lt;span/&gt;&lt;/h5&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.6847290640394089&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LIMnTCqaiaSmTbrAwabCRU6xKRhRy6CVxoSzBFjzmpHgkZ3krNLPyLYQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1015&quot;/&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;figcaption&gt;处理数据API&lt;/figcaption&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;核心抽象&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;环境对象&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.6360078277886497&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26L038j26g5tAyeTOeY18NdmAz7hibOHl8ibQPDViaDMAFLJvly9B86668Ag/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1022&quot;/&gt;&lt;/p&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;数据流元素&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.20421052631578948&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LBFQ1PJShI7v90l7PCtvTgviabSdebOykwfzyiaTGEq6KARHp3f7CpYyA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;950&quot;/&gt;&lt;/p&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;StreamRecord（数据流中的一条记录｜事件）&lt;/section&gt;&lt;/li&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;数据的值本身&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;时间戳（可选）&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;li&gt;&lt;section&gt;LatencyMarker（用来近似评估延迟）&lt;/section&gt;&lt;/li&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;周期性的在数据源算子中创造出来的时间戳&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;算子编号&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;数据源所在的Task编号&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;li&gt;&lt;section&gt;Watemark（是一个时间戳，用来告诉算子所有时间早于等于Watermark的事件或记录都已经到达，不会再有比Watermark更早的记录，算子可以根据Watermark触发窗口的计算、清理资源等）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;StreamStatus（用来通知Task是否会继续接收到上游的记录或者Watermark）&lt;/section&gt;&lt;/li&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;空闲状态（IDLE）。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;活动状态（ACTIVE）。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;Flink 异步IO&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;原理&lt;span/&gt;&lt;/h4&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.6149312377210217&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LlwicEq338A0YXNcOvx7ibnU7J04FOUibice7OG2x7vDXt73WSKvDhSMHcQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;509&quot;/&gt;&lt;/p&gt;&lt;/figure&gt;&lt;section&gt;&lt;p&gt;顺序输出模式（先收到的数据元素先输出，后续数据元素的异步函数调用无论是否先完成，都需要等待）&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.41536614645858344&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LKYSMNI0t0ibsvYKrsFJZc5mvkdMEgPUb5tn2zjJvng4tnhHPYJamnKw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;833&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;p&gt;无序输出模式（先处理完的数据元素先输出，不保证消息顺序）&lt;/p&gt;&lt;figure&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.6344743276283619&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LPB81fHJTfLz3YkvJyYpmR2bTvg7BsDZJm01HBQqMs4aUica6hIXkeXA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;818&quot;/&gt;&lt;/p&gt;&lt;/figure&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;数据分区&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;ForwardPartitioner（用于在同一个OperatorChain中上下游算子之间的数据转发，实际上数据是直接传递给下游的）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ShufflePartitioner（随机将元素进行分区，可以确保下游的Task能够均匀地获得数据）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ReblancePartitioner（以Round-robin的方式为每个元素分配分区，确保下游的Task可以均匀地获得数据，避免数据倾斜）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;RescalingPartitioner（用Round-robin选择下游的一个Task进行数据分区，如上游有2个Source，下游有6个Map，那么每个Source会分配3个固定的下游Map，不会向未分配给自己的分区写入数据）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;BroadcastPartitioner（将该记录广播给所有分区）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;KeyGroupStreamPartitioner（KeyedStream根据KeyGroup索引编号进行分区，该分区器不是提供给用户来用的）&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;窗口&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;实现原理&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.9043010752688172&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LWSPibcS2UTAoI5KdkFShmxBGiaZMHpITwEoqeSOjctmP2K0ep3XO7hkA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;930&quot;/&gt;&lt;/p&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;WindowAssigner（用来决定某个元素被分配到哪个/哪些窗口中去）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;WindowTrigger（决定一个窗口何时能够呗计算或清除，每一个窗口都拥有一个属于自己的Trigger）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;WindowEvictor（窗口数据的过滤器，可在Window Function 执行前或后，从Window中过滤元素）&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;CountEvictor：计数过滤器。在Window中保留指定数量的元素，并从窗口头部开始丢弃其余元素&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;DeltaEvictor：阈值过滤器。丢弃超过阈值的数据记录&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;TimeEvictor：时间过滤器。保留最新一段时间内的元素&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;Watermark （水印）&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;作用&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用于处理乱序事件，而正确地处理乱序事件，通常用Watermark机制结合窗口来实现&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;DataStream Watermark 生成&lt;span/&gt;&lt;/h4&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Source Function 中生成Watermark&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;DataStream API 中生成Watermark&lt;/section&gt;&lt;/li&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;AssingerWithPeriodicWatermarks （周期性的生成Watermark策略，不会针对每个事件都生成）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;AssingerWithPunctuatedWatermarks （对每个事件都尝试进行Watermark的生成，如果生成的结果是null 或Watermark小于之前的，则不会发往下游）&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;内存管理&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;自主内存管理&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;原因&lt;span/&gt;&lt;/h4&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;JVM内存管理的不足&lt;/section&gt;&lt;/li&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;有效数据密度低&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;垃圾回收（大数据场景下需要消耗大量的内存，更容易触发Full GC ）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;OOM 问题影响稳定性&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;缓存未命中问题（Java对象在堆上存储时并不是连续的）&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;li&gt;&lt;section&gt;自主内存管理&lt;/section&gt;&lt;/li&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;堆上内存的使用、监控、调试简单，堆外内存出现问题后的诊断则较为复杂&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Flink有时需要分配短生命周期的MemorySegment，在堆外内存上分配比在堆上内存开销更高。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;在Flink的测试中，部分操作在堆外内存上会比堆上内存慢&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;大内存（上百GB）JVM的启动需要很长时间，Full GC可以达到分钟级。使用堆外内存，可以将大量的数据保存在堆外，极大地减小堆内存，避免GC和内存溢出的问题。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;高效的IO操作。堆外内存在写磁盘或网络传输时是zero-copy，而堆上内存则至少需要1次内存复制。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;堆外内存是进程间共享的。也就是说，即使JVM进程崩溃也不会丢失数据。这可以用来做故障恢复（Flink暂时没有利用这项功能，不过未来很可能会去做）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;堆外内存的优势&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;堆外内存的不足&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;内存模型&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;内存模型图&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5321701199563795&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26L5Dv8ow41oNApdkCuW1hQInYGhCc5McZT5iafQxbWStMfH5YVVJ0lXiaQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;917&quot;/&gt;&lt;span/&gt;&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;MemorySegment（内存段）&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一个MemorySegment对应着一个32KB大小的内存块。这块内存既可以是堆上内存（Java的byte数组），也可以是堆外内存（基于Netty的DirectByteBuffer）&lt;/p&gt;&lt;h5 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;图解&lt;span/&gt;&lt;/h5&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5969162995594713&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26Lvhm7oviaADm2fJVNxfuGHoMnPt6wzWvct0gX1CwY2pgdcB7Dh9ACnBw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;908&quot;/&gt;&lt;/p&gt;&lt;/figure&gt;&lt;h5 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;结构&lt;span/&gt;&lt;/h5&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;BYTE_ARRAY_BASE_OFFSET（二进制字节数组的起始索引）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;LITTLE_ENDIAN（判断是否为Little Endian模式的字节存储顺序，若不是，就是Big Endian模式）&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Big Endian：低地址存放最高有效字节（MSB）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Little Endian：低地址存放最低有效字节（LSB）X86机器&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;HeapMemory（如果MemeorySegment使用堆上内存，则表示一个堆上的字节数组（byte［］），如果MemorySegment使用堆外内存，则为null）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;address（字节数组对应的相对地址）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;addressLimit（标识地址结束位置）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;size（内存段的字节数）&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h5 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;实现&lt;span/&gt;&lt;/h5&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;HybirdMemorySegment：用来分配堆上和堆外内存和堆上内存，Flink 在实际使用中只使用了改方式。原因是当有多个实现时，JIT无法直接在编译时自动识别优化&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;HeapMemorySegment：用来分配堆上内存，实际没有实现&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;MemroyManager（内存管理器）&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;实际申请的是堆外内存，通过RocksDB的Block Cache和WriterBufferManager参数来限制，RocksDB使用的内存量&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;State（状态）&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;状态管理需要考虑的因素：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;状态数据的存储和访问&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;状态数据的备份和恢复&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;状态数据的划分和动态扩容&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;状态数据的清理&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;分类&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5858585858585859&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LB4ib6ZWEQCfeicWNqEAg0EEuBnFsMTXYIWDMHHKEAjJAViaanKpyUbLHg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;891&quot;/&gt;&lt;/p&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;状态存储&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;MemoryStateBackend：纯内存，适用于验证、测试，不推荐生产环境&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;FsStateBackend：内存+文件，适用于长周期大规模的数据&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;RocksDBStateBackend：RocksDB，适用于长周期大规模的数据&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;重分布&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;ListState：并行度在改变的时候，会将并发上的每个List都取出，然后把这些List合并到一个新的List,根据元素的个数均匀分配给新的Task&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;UnionListState:把划分的方式交给用户去做，当改变并发的时候，会将原来的List拼接起来，然后不做划分，直接交给用户&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;BroadcastState:变并发的时候，把这些数据分发到新的Task即可&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;KeyState：Key-Group数量取决于最大并行度（MaxParallism）&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;作业提交&lt;/span&gt;&lt;/h2&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5074786324786325&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LMacAsdC92FR7PgPEwInorbEiaa1qSZQMsiaPjM782zXhDC54h4yqwgzg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;936&quot;/&gt;&lt;/p&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;资源管理&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;关系图&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.646551724137931&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LxPKtq81wrJkMuDp2cngPo251B5r4WdRB2lIibFKAOXyQjPHxibloaDAA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;928&quot;/&gt;&lt;/p&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;Slot选择策略&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;LocationPreferenceSlotSelectionStrategy（位置优先的选择策略）&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;DefaultLocationPreferenceSlotSelectionStrategy（默认策略），该策略不考虑资源的均衡分配，会从满足条件的可用Slot集合选择第1个&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;EvenlySpreadOutLocationPreferenceSlotSelectionStrategy（均衡策略），该策略考虑资源的均衡分配，会从满足条件的可用Slot集合中选择剩余资源最多的Slot，尽量让各个TaskManager均衡地承担计算压力&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;PreviousAllocationSlotSelectionStrategy（已分配Slot优先的选择策略），如果当前没有空闲的已分配Slot，则仍然会使用位置优先的策略来分配和申请Slot&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;调度&lt;/span&gt;&lt;/h2&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;DefaultScheduler（使用ScchedulerStrategy来实现）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;LegacyScheduler（实际使用了原来的ExecutionGraph的调度逻辑）&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;作业的生命周期管理（开始调度、挂起、取消）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;作业执行资源的申请、分配、释放&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;作业状态的管理（发布过程中的状态变化、作业异常时的FailOver&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;作业的信息提供，对外提供作业的详细信息&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;SchedulingStrategy（调度策略）&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;EagerSchelingStrategy（该调度策略用来执行流计算作业的调度）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;LazyFromSourceSchedulingStrategy（该调度策略用来执行批处理作业的调度）&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;startScheduling：调度入口，触发调度器的调度行为&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;restartTasks：重启执行失败的Task，一般是Task执行异常导致的&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;onExecutionStateChange：当Execution的状态发生改变时&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;onPartitionConsumable：当IntermediateResultParitititon中的数据可以消费时&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;ScheduleMode（调度模式）&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Eager调度（该模式适用于流计算。一次性申请需要所有的资源，如果资源不足，则作业启动失败。）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Lazy_From_Sources分阶段调度（适用于批处理。从Source Task开始分阶段调度，申请资源的时候，一次性申请本阶段所需要的所有资源。上游Task执行完毕后开始调度执行下游的Task，读取上游的数据，执行本阶段的计算任务，执行完毕之后，调度后一个阶段的Task，依次进行调度，直到作业执行完成）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Lazy_From_Sources_With_Batch_Slot_Request分阶段Slot重用调度（适用于批处理。与分阶段调度基本一样，区别在于该模式下使用批处理资源申请模式，可以在资源不足的情况下执行作业，但是需要确保在本阶段的作业执行中没有Shuffle行为）&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;关键组件&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;JobMaster&lt;span/&gt;&lt;/h4&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;调度执行和管理（将JobGraph转化为ExecutionGraph，调度Task的执行，并处理Task的异常）&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;InputSplit 分配&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;结果分区跟踪&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;作业执行异常&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;作业Slot资源管理&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;检查点与保存点&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;监控运维相关&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;心跳管理&lt;/section&gt;&lt;/li&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Task&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结构&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5909090909090909&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LdcrpItwLZd9K0wmrfnewMN6eIJkr3LNVgry2xkf9XtDQqh0OBibTUzw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;946&quot;/&gt;&lt;/p&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;作业调度失败&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;失败异常分类&lt;span/&gt;&lt;/h4&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;NonRecoverableError：不可恢复的错误。此类错误意味着即便是重启也无法恢复作业到正常状态，一旦发生此类错误，则作业执行失败，直接退出作业执行&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;PartitionDataMissingError：分区数据不可访问错误。下游Task无法读取上游Task产生的数据，需要重启上游的Task&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;EnvironmentError：环境的错误。这种错误需要在调度策略上进行改进，如使用黑名单机制，排除有问题的机器、服务，避免将失败的Task重新调度到这些机器上。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;RecoverableError：可恢复的错误&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;容错&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;容错保证语义&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;At-Most-Once（最多一次）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;At-Leat-Once（最少一次）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Exactly-Once（引擎内严格一次）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;End-to-End Exaacly-Once （端到端严格一次）&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;保存点恢复&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;算子顺序的改变，如果对应的UID没变，则可以恢复，如果对应的UID变了则恢复失败。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;作业中添加了新的算子，如果是无状态算子，没有影响，可以正常恢复，如果是有状态的算子，跟无状态的算子一样处理。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;从作业中删除了一个有状态的算子，默认需要恢复保存点中所记录的所有算子的状态，如果删除了一个有状态的算子，从保存点恢复的时候被删除的OperatorID找不到，所以会报错，可以通过在命令中添加-allowNonRestoredState （short: -n）跳过无法恢复的算子。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;添加和删除无状态的算子，如果手动设置了UID，则可以恢复，保存点中不记录无状态的算子，如果是自动分配的UID，那么有状态算子的UID可能会变（Flink使用一个单调递增的计数器生成UID，DAG改版，计数器极有可能会变），很有可能恢复失败。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;恢复的时候调整并行度，Flink1.2.0及以上版本,如果没有使用作废的API，则没问题；1.2.0以下版本需要首先升级到1.2.0才可以。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;端到端严格一次&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;前提条件&lt;span/&gt;&lt;/h4&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;数据源支持断点读取&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;外部存储支持回滚机制或者满足幂等性&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;图解&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1.1101813110181311&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LRp7O1DO4k7bkNnza4W6icV8FjleMoia9EVvqw99ibrAuQCYGd12TFnGIg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;717&quot;/&gt;&lt;/p&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;figcaption/&gt;&lt;/figure&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;实现&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;TwoPhaseCommitSinkFunction&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;beginTransaction，开启一个事务，在临时目录中创建一个临时文件，之后写入数据到该文件中。此过程为不同的事务创建隔离，避免数据混淆。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;preCommit。预提交阶段。将缓存数据块写出到创建的临时文件，然后关闭该文件，确保不再写入新数据到该文件，同时开启一个新事务，执行属于下一个检查点的写入操作。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;commit。在提交阶段，以原子操作的方式将上一阶段的文件写入真正的文件目录下。如果提交失败，Flink应用会重启，并调用TwoPhaseCommitSinkFunction#recoverAndCommit方法尝试恢复并重新提交事务。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;abort。一旦终止事务，删除临时文件。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;Flink SQL&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;关系图&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.8524822695035461&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LYZvzDVB6tRWDtUavgrjNgLPPW4YSib3uWC4PYicvI3PRz1DMh2hQO3kw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;705&quot;/&gt;&lt;/p&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;FLINK API&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;DataStrem JOIN&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Window JOIN&lt;span/&gt;&lt;/h4&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;stream.join(otherStream)&lt;br/&gt;    .where(&amp;lt;KeySelector&amp;gt;)&lt;br/&gt;    .equalTo(&amp;lt;KeySelector&amp;gt;)&lt;br/&gt;    .window(&amp;lt;WindowAssigner&amp;gt;)&lt;br/&gt;    .apply(&amp;lt;JoinFunction&amp;gt;)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;Tumbling Window Join&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;DataStream&amp;lt;Integer&amp;gt; orangeStream = ...&lt;br/&gt;DataStream&amp;lt;Integer&amp;gt; greenStream = ...&lt;br/&gt;&lt;br/&gt;orangeStream.join(greenStream)&lt;br/&gt;    .where(&amp;lt;KeySelector&amp;gt;)&lt;br/&gt;    .equalTo(&amp;lt;KeySelector&amp;gt;)&lt;br/&gt;    .window(TumblingEventTimeWindows.of(Time.milliseconds(&lt;span&gt;2&lt;/span&gt;)))&lt;br/&gt;    .apply (&lt;span&gt;new&lt;/span&gt; JoinFunction&amp;lt;Integer, Integer, String&amp;gt; (){&lt;br/&gt;        &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;&lt;span&gt;public&lt;/span&gt; String &lt;span&gt;join&lt;/span&gt;&lt;span&gt;(Integer first, Integer second)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; first + &lt;span&gt;&quot;,&quot;&lt;/span&gt; + second;&lt;br/&gt;        }&lt;br/&gt;    });&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;Sliding Window Join&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;DataStream&amp;lt;Integer&amp;gt; orangeStream = ...&lt;br/&gt;DataStream&amp;lt;Integer&amp;gt; greenStream = ...&lt;br/&gt;&lt;br/&gt;orangeStream.join(greenStream)&lt;br/&gt;    .where(&amp;lt;KeySelector&amp;gt;)&lt;br/&gt;    .equalTo(&amp;lt;KeySelector&amp;gt;)&lt;br/&gt;    .window(SlidingEventTimeWindows.of(Time.milliseconds(&lt;span&gt;2&lt;/span&gt;) &lt;span&gt;/* size */&lt;/span&gt;, Time.milliseconds(&lt;span&gt;1&lt;/span&gt;) &lt;span&gt;/* slide */&lt;/span&gt;))&lt;br/&gt;    .apply (&lt;span&gt;new&lt;/span&gt; JoinFunction&amp;lt;Integer, Integer, String&amp;gt; (){&lt;br/&gt;        &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;&lt;span&gt;public&lt;/span&gt; String &lt;span&gt;join&lt;/span&gt;&lt;span&gt;(Integer first, Integer second)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; first + &lt;span&gt;&quot;,&quot;&lt;/span&gt; + second;&lt;br/&gt;        }&lt;br/&gt;    });&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;Session Window Join&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;DataStream&amp;lt;Integer&amp;gt; orangeStream = ...&lt;br/&gt;DataStream&amp;lt;Integer&amp;gt; greenStream = ...&lt;br/&gt;&lt;br/&gt;orangeStream.join(greenStream)&lt;br/&gt;    .where(&amp;lt;KeySelector&amp;gt;)&lt;br/&gt;    .equalTo(&amp;lt;KeySelector&amp;gt;)&lt;br/&gt;    .window(EventTimeSessionWindows.withGap(Time.milliseconds(&lt;span&gt;1&lt;/span&gt;)))&lt;br/&gt;    .apply (&lt;span&gt;new&lt;/span&gt; JoinFunction&amp;lt;Integer, Integer, String&amp;gt; (){&lt;br/&gt;        &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;&lt;span&gt;public&lt;/span&gt; String &lt;span&gt;join&lt;/span&gt;&lt;span&gt;(Integer first, Integer second)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; first + &lt;span&gt;&quot;,&quot;&lt;/span&gt; + second;&lt;br/&gt;        }&lt;br/&gt;    });&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;hr data-tool=&quot;mdnice编辑器&quot;/&gt;&lt;/section&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;FLINK 往期&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzI4MjU4MzkwOQ==&amp;amp;mid=2247484537&amp;amp;idx=1&amp;amp;sn=cae4fba6fdc1478e4ab6badb229e1f01&amp;amp;chksm=eb96f273dce17b650e80c4a916e321502192b76f9edbbf968567b22010134c0df931081c7532&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;Flink最锋利的武器Flink SQL（入门篇）&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzI4MjU4MzkwOQ==&amp;amp;mid=2247484549&amp;amp;idx=1&amp;amp;sn=0fd300b771d3e7f1f1398401022896df&amp;amp;chksm=eb96f28fdce17b99bf0f2629ca963405a8b9291df1e35eb3a5e36d93c377ba4a521bd7b5f3a3&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;FlinkSQL窗口，让你眼前一亮，是否可以大吃一惊呢&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzI4MjU4MzkwOQ==&amp;amp;mid=2247484566&amp;amp;idx=1&amp;amp;sn=b412696f3eeecae5863fcd47203abc65&amp;amp;chksm=eb96f29cdce17b8a57cfc19ce907034fbbebd45c2b4139f8003ecc529e8463efa18df9e2174d&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;FlinkSQL自带Sink无法满足需求，自定义实现Sink&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzI4MjU4MzkwOQ==&amp;amp;mid=2247484454&amp;amp;idx=1&amp;amp;sn=99a39e2bccf4ddd3bd39187088fde917&amp;amp;chksm=eb96f22cdce17b3a122146a77096a97dcb0a0b5b61ce99d3c707876adf8f68c37436706316a3&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;Flink的Checkpoint机制详解&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzI4MjU4MzkwOQ==&amp;amp;mid=2247484404&amp;amp;idx=1&amp;amp;sn=e384864bb6cf2bc7e029580d95706163&amp;amp;chksm=eb96f5fedce17ce854d6768525fdab8bcaa2bc0409ebc40d8907dd8ef171da5e948dfd68c2c0&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;Flink的一致性保证&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzI4MjU4MzkwOQ==&amp;amp;mid=2247484384&amp;amp;idx=1&amp;amp;sn=8ec253c52feed1b33e89b56820157bf2&amp;amp;chksm=eb96f5eadce17cfc9f16983bf7736c3b756b0d2fe24487513ad8c9879e95d23b48240a5bfe5d&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;Flink CEP - Flink的复杂事件处理&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzI4MjU4MzkwOQ==&amp;amp;mid=2247484362&amp;amp;idx=1&amp;amp;sn=d3e4463606984dfa30fa5354def828cc&amp;amp;chksm=eb96f5c0dce17cd63e907e18904d9c0375e31a3e4bf86e1783a3c7364be6b22ccaf936afb32e&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;Flink的状态与容错&lt;/a&gt;&lt;/p&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzI4MjU4MzkwOQ==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dRCmOAs1H8E7QUDiaFQv0m4w2P7f4EkiacNxALJM0S7jPa7uL2a9sibAsHC6SzKZjZvylEhm4feUjlTQ/0?wx_fmt=png&quot; data-nickname=&quot;大数据左右手&quot; data-alias=&quot;ykc20161218&quot; data-signature=&quot;大数据开发工作者。致力于大数据技术学习与工作。实时，离线，面试与总结，或者生活小矫情类文章，总有适合你的那一篇。&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;同&lt;/span&gt;&lt;span&gt;学&lt;/span&gt;&lt;span&gt;共进，点赞，转发，在看，关注，是我学习之动力。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;和我联系吧，交流大数据知识,一起成长~~~&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>a07c04f31e69f3487a34bb28b564ee2f</guid>
<title>微服务的几个陷阱</title>
<link>https://toutiao.io/k/cm0o91b</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;微服务的陷阱&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.6823529&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ElshSw7NB0fUN0ZvPEZvtfDdHeaBvKZFmH2ic9lljHgB4PWSZ9dIKc4t45JdggGUV9dnf7ic3uxq3qxRfsPUKJZQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1020&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;微服务架构（Microservice Architect）是一种架构模式，微服务架构是个很有趣的思维方式，其主要作用是将功能分解到离散的各个服务当中，从而降低系统的耦合性，并提供更加灵活的服务支持，每个服务运行在其独立的进程中，服务与服务间采用轻量级的通信机制互相沟通，每个服务都围绕着具体业务进行构建，并且能够被独立的部署到生产环境、类生产环境等。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;参考维基百科英文版，我们简单梳理一下微服务的历史：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2005年:Dr. PeterRodgers在Web ServicesEdge大会上提出了“Micro-Web-Services”的概念。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2011年:一个软件架构工作组使用了“microservice”一词来描述一种架构模式。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2012年:同样是这个架构工作组，正式确定用“microservice”来代表这种架构。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2012年:ThoughtWorks的James Lewis针对微服务概念在QCon San Francisco 2012发表了演讲。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2014年:James Lewis和Martin Flower合写了关于微服务的一篇学术性的文章，详细阐述了微服务。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;由于微服务的理念中也包含了“服务”的概念，而 SOA 中也有“服务”的概念，在“架构思维之集成”中我也讲了单体服务、SOA服务、微服务的区别，喜欢看的小伙伴可以查看。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;01&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;概述&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;过去的10-20年企业面临着一系列具有挑战性的情况，包括过多的异构和分散的应用程序平台（如 ERP、互联网门户）以及大量孤立的单体定制应用程序，缺乏统一的企业视图。业务流程分散在多个产品上，数据重复且不一致。当与刚性架构相结合时，交互变得效率低下，处理速度缓慢。当复杂的信息交互分布在不同的 IT 系统中时，这些问题就会加剧。最重要的是，提高竞争力和快速变化需要业务敏捷性，同时保持较低的拥有成本。借助面向服务的架构 (SOA) 计划，企业可以简化和简化复杂的交互，使他们能够专注于盈利增长。SOA技术架构如下：&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.6703704&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/ElshSw7NB0fUN0ZvPEZvtfDdHeaBvKZFFZoY6kibGjFxZs5yia9BDDJuECCGeY8ELAFVRQXiaLWeAtkKGVq9hHLVw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1080&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;SOA将应用系统抽象成一个个粗粒度的服务，构建松耦合服务架构，可以通过业务流程对服务进行灵活组合，提升企业 IT 资产复用，提高了系统的适应性、灵活性和扩展性，解决“信息孤岛”问题。SOA帮助工程师们站在一个新的高度理解企业级架构中各种组件的开发和部署形式，它可以帮助企业系统架构师以更迅速、可靠和可重用的形式规划整个业务系统。相比于传统的垂直架构，SOA能够更加从容的应对复杂企业系统集成和需求的快速变化。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;随着互联网的发展，尤其是移动互联时代的到来，整个世界的经济形态发生了巨大的变化改变。企业 IT 的重点从传统的 System of Record(交易系统，如 ERP、SCM 等)演化到 System of Engagement(互动系统，如全渠道营销)。这些系统需要能够应对互联网规模的快速增长，并且能够快速迭代，低成本试错。企业 IT 已经成为创新驱动的引擎之一，技术拓展商业边界的理想也帮助 IT 团队更有使命感，进一步加速推动了企业 IT 的进化。以 Netflix、阿里为首的一系列互联网公司主导了企业架构新的变革 - 微服务架构。Apache Dubbo, Spring Cloud 等微服务框架得到了广泛应用。微服务的核心思想便是应用功能拆分与解耦，降低业务系统实现复杂性。微服务强调将应用功能拆解为一组松耦合服务，每个服务遵守单一责任原则(Single Responsibility Principle)。微服务架构解决了传统单体式架构存在的几个固有问题：每个服务可以独立部署和交付，大大提升了业务敏捷性;每个服务可以独立横向扩展/收缩，应对互联网规模的挑战。任何事物都有其两面性，如果使用不当，反而会进入另一个极端，下面是从事架构设计多年来对于微服务架构设计和实施中总结出来的一些经验教训，分享给大家。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;02&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;认知陷阱&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;在进行架构重构，进行微服务化之前作为架构设计者需要认证考虑一些问题？&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;微服务化是为了业务还是为了自己&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;微服务化的目标是什么？&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;是所有的都微服务化还是部分微服务化？&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;微服务化的粒度的参考维度是什么？&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;2-1&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;微服务化时间陷阱&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;在企业发展的初期，一般公司的网站流量都比较小，只需要一个应用，将所有的功能代码打包成一个服务，部署到服务器上就能支撑公司的业务。这样也能够减少开发、部署和维护的成本。比如，大家都很熟悉的电商系统，里面涉及的业务主要有：用户管理、商品管理、订单管理、支付管理、库存管理、物流管理等等模块，初期我们会将所有模块写到一个Web项目中，然后统一部署到一个Web服务器中。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;由于微服务架构的流行，现在很多中小型企业，甚至是互联网初创公司，也跃跃欲试，打算将老的单体架构向微服务架构迁移。在这个过程中，很容易范的一个错误就是技术决策者过分关注新技术的先进性，而忽略商业目标及新技术的最佳应用场景。对于商业公司而言，技术的本质就是支撑商业的成功，它主要体现在如下3个方面。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;响应公司战略，技术架构保障商业成功，例如互联网的秒杀和大促场景，使用基于Docker的秒级弹性伸缩特性，可以在业务高峰期快速地自动扩容，保障业务的正常运行，采用“传统的物理机 + 人工扩容”方式，显然无法满足业务诉求。该场景下，我们可以认为引入Docker容器技术，保障了大促业务的稳定性，为商业成功保驾护航。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;控制成本，技术架构降低研发成本，例如引入新的自动化测试技术，可以实现前后台的自动化测试，将测试成本由10人月降低到1人月。通过新技术的引进，降低开发、测试、维护等成本。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;企业品牌，主要针对非自营类的产品，例如电信行业、企业市场等，招标方对技术架构的先进性通常会有要求，比如支持Docker容器加10分，采用微服务架构加5分等，为了提升技术竞争力，产品往往会采用最新、最时髦的技术架构，例如“微服务 + Docker容器”技术。技术架构团队在做技术选择和决策时，需要优先考虑商业目标和业务场景，而不能只考虑技术先进性。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;span&gt;从单体到微服务的进化过程&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.4549675&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ElshSw7NB0fUN0ZvPEZvtfDdHeaBvKZFUcoUiamQGP58K0ia0oXgwhK14ocsFiavtdjpiaUnXSuAH5XhHQ9SH14png/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1077&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;快速开发和验证想法，证明产品思路是否可行，投入资源和成本，包括人力和物力相对比较节约&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;随着业务的复杂度增加，单体的灵活度会逐渐下降，比如：&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;IDE过载：随着代码量增加，代码整体编译效率下降。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;规模化：无法满足团队规模化高效开发。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;系统开发、测试、部署的冲突和效率低下等问题&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;只能关注一套技术栈&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;应用扩展性比较差&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;海量用户高并发访问数量有限&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;span&gt;架构设计的三大原则告诉我们，架构需要的是简单、适度、演化。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;对于项目起步阶段，单体是最高效也是最节省成本的方式。因为初期阶段，由于人力，成本，业务熟悉程度，微服务技术积累等因素，如何过度设计可能工期和复杂度会急剧上升，造成交付困难，问题百出，从而错过了时间窗口。最合适，简单的方式还是单体优先，这是创业公司的特点决定的。当然设计面向微服务的单体架构也是一种聪明的方法，这遵守了系统演化的法则。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;无论采取何种维度的架构分层，分层的最核心目的是保证各层之间的差异足够清晰，边界足够明显，为将来可能产生的变化提供最容易、最小化的修改。比如客户端要从安卓替换为IOS，底层无须任何改动，就像替换积木一样。又比如，设备需要接入新的设备或协议，其他层也不需要做任何变化，可以无缝平滑接入任何设备。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;如果前期在业务不十分清晰，求的是验证想法，证明产品思路是否可行性，并且业务量不大，仅限于省级范围，建议只要对当前架构稍加改良升级就可以了，这样改动量相对较小，且至少能支撑一定时间段的业务增长。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;支撑的业务更加庞大，可以支撑海量用户高并发和海量设备接入，支持分布式多机房，多区域部署，支持服务器无限扩容。支持私有云，公有云，混合云等部署方式。所以微服务是大多数互联网公司的首选。&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;技术门槛高：微服务包括，服务描述，注册中心，服务框架，服务监控，服务追踪，服务治理等几大基本组件，以上每个组件缺一不可，每个组件展开又包括很多技术门槛，比如，容器技术，持续部署，DevOps等相关概念。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;复杂性增加：相对单体架构将所有功能打包部署在一起，集中地进行开发、测试和运维，微服务会将这些单体的服务进行拆分部署，业务拆分粒度是一个难点，拆分后服务聚合也是一个麻烦。因为服务粒度增加后，相互调用，相互依存，所以问题排查难度会增加，就需要一套完整的服务监控，服务跟踪和治理的系统。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;观念变化：微服务不仅仅是技术的升级，更是开发方式、组织架构、开发观念的转变。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;前期投入成本较高&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;span&gt;事实上，微服务并非银弹，微服务架构的理念看似美好，但是在微服务实施的过程中，稍有不慎就会跌入坑中，最终以失败告终，微服务架构的产品都经历了一个自然演进的过程，并不是断代式的重构，技术革新的目标还是为了支撑业务的快速发展，而并非单纯为了追求新技术。在业务发展的不同阶段，有适合它的不同架构。没有最好只有最适合，当业务规模和研发团队人数有限时，切勿过早的实施微服务架构。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;2-2&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;成本陷阱&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;在微服务化的过程中硬件成本和代码重构成本是最需要注意，不合理的架构设计就可能给企业带来重大的经济负担和架构负担。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img data-ratio=&quot;1.1445783&quot; data-w=&quot;83&quot; data-type=&quot;png&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/FCxBvbuaS5ODMOjlrZSBKawErV58QxAxDtibFSJbibtPaWHQASVCj2GmyK0Zwibb6Trut3zF2ThMk0OLUjibIQR5tA/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;硬件成本&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;在服务化之前，业务通常都是本地API调用，本地方法调用性能损耗较小。服务化之后，服务提供者和消费者之间采用远程网络通信，增加了额外的性能损耗，业务调用的时延将增大，性能也将降低。由本地方法调用到远程RPC调用，增加的性能消耗点如下所示：&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;客户端需要对消息进行序列化，主要占用CPU计算资源。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;序列化时需要创建二进制数组，耗费JVM堆内存或者堆外内存。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;客户端需要将序列化之后的二进制数组发送给服务端，占用网络带宽资源。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;服务端读取到码流之后，需要将请求数据报反序列化成请求对象，占用CPU计算资源。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;服务端通过反射的方式调用服务提供者实现类，反射本身对性能影响就比较大。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;服务端将响应结果序列化，占用CPU计算资源。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;服务端将应答码流发送给客户端，占用网络带宽资源。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;客户端读取应答码流，反序列化成响应消息，占用CPU资源。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;span&gt;有本地调用变成RPC调用之后，业务数据流如下所示（黑色加粗部分是主要增加的性能开销）：&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.8510101&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ElshSw7NB0fUN0ZvPEZvtfDdHeaBvKZF0SG1JyN4n2tAv8NYCgAibm0BUcJVoU3cWyTq1iamvmqwJm77mlxe31uw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;792&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;RPC调用相比于本地方法调用，性能对比如下（测试场景，1K的请求消息，200字节应答，请求和应答数据类型为字符串）：&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr opera-tn-ra-comp=&quot;_$.pages:0.layers:0.comps:19.classicTable1:0&quot; powered-by=&quot;xiumi.us&quot;&gt;&lt;td colspan=&quot;1&quot; rowspan=&quot;1&quot; opera-tn-ra-cell=&quot;_$.pages:0.layers:0.comps:19.classicTable1:0.td@@0&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;调用类型&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/td&gt;&lt;td colspan=&quot;1&quot; rowspan=&quot;1&quot; opera-tn-ra-cell=&quot;_$.pages:0.layers:0.comps:19.classicTable1:0.td@@1&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;CAPS&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/td&gt;&lt;td colspan=&quot;1&quot; rowspan=&quot;1&quot; opera-tn-ra-cell=&quot;_$.pages:0.layers:0.comps:19.classicTable1:0.td@@2&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;平均延时&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr opera-tn-ra-comp=&quot;_$.pages:0.layers:0.comps:19.classicTable1:1&quot; powered-by=&quot;xiumi.us&quot;&gt;&lt;td colspan=&quot;1&quot; rowspan=&quot;1&quot; opera-tn-ra-cell=&quot;_$.pages:0.layers:0.comps:19.classicTable1:1.td@@0&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;本地调用&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/td&gt;&lt;td colspan=&quot;1&quot; rowspan=&quot;1&quot; opera-tn-ra-cell=&quot;_$.pages:0.layers:0.comps:19.classicTable1:1.td@@1&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;6739万&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/td&gt;&lt;td colspan=&quot;1&quot; rowspan=&quot;1&quot; opera-tn-ra-cell=&quot;_$.pages:0.layers:0.comps:19.classicTable1:1.td@@2&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;31纳秒&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr opera-tn-ra-comp=&quot;_$.pages:0.layers:0.comps:19.classicTable1:2&quot; powered-by=&quot;xiumi.us&quot;&gt;&lt;td colspan=&quot;1&quot; rowspan=&quot;1&quot; opera-tn-ra-cell=&quot;_$.pages:0.layers:0.comps:19.classicTable1:2.td@@0&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;RPC调用&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/td&gt;&lt;td colspan=&quot;1&quot; rowspan=&quot;1&quot; opera-tn-ra-cell=&quot;_$.pages:0.layers:0.comps:19.classicTable1:2.td@@1&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;12万&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/td&gt;&lt;td colspan=&quot;1&quot; rowspan=&quot;1&quot; opera-tn-ra-cell=&quot;_$.pages:0.layers:0.comps:19.classicTable1:2.td@@2&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;1.88毫秒&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;根据经验，在实际业务场景中，微服务化改造之后，采用远程跨进程通信，业务整体平均性能下降约 50%+左右。这就意味着在同等条件下，需要新增1倍的硬件成本来部署微服务，保障原来业务的SLA和性能指标。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;如果业务无法接受硬件成本增加的现实，技术决策的时候就需要考虑：到底是要鱼还是熊掌？两者兼得，显然是不可能的，这个决策不仅仅涉及技术架构，还需要业务产品方和投资方做商业策略的决策：是否愿意为新技术架构买单，接受短期硬件成本增加的现实。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;一种折衷的策略是：微服务做进程内合设，利用微服务的本地路由短路策略，将RPC调用转换成进程内的方法调用，采用该模式部署后，可以绕过网络开销、序列化开销等，性能基本上可以与单体架构持平。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;采用进程内合设的方式部署微服务，也会带来很多弊端，诸如：&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;微服务自治性下降。无法独立部署、独立伸缩和独立升级。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;微服务之间的隔离性变差。由于不同的微服务部署在同一个进程之内，故障隔离性下降，一个微服务的OOM可能导致整个进程core down。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;微服务技术灵活性下降。微服务的一个原则之一就是语言中立，不同的业务，适合不同的语言构建，例如对异步并行处理要求高的模块，可以采用其他语言构建，对开发效率要求高的模块，采用Java语言构建。如果采用进程内合设的方式，基本上会丧失微服务的语言中立性。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img data-ratio=&quot;1.1445783&quot; data-w=&quot;83&quot; data-type=&quot;png&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/FCxBvbuaS5ODMOjlrZSBKawErV58QxAxDtibFSJbibtPaWHQASVCj2GmyK0Zwibb6Trut3zF2ThMk0OLUjibIQR5tA/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;代码重构成本&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;在做微服务架构重构的时候，业务团队往往会设立一些目标，例如：&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;最大程度保护已有的代码资产，尽量不修改原有的代码，可以接受新增开发一些配置文件，就可以将现有的接口发布成微服务。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;微服务架构对业务的侵入足够低，最好能够做到零侵入。即开发态业务代码不依赖微服务架构提供的API类库。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;span&gt;设定这样的目标本身没有问题，服务框架的一个目标就是：像使用本地接口一样使用远程的微服务，对业务使用者并不感知。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;微服务框架可以将一个Java接口发布成微服务，如果原有的业务代码已经采用接口式编程，则将已有接口改造成微服务，确实成本很低。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;但事实上，微服务化远远没有这么简单，微服务化本质是对单体架构的分布式改造，以及业务由大到小，分而治之的拆分。分布式系统与传统单体架构的差异，并不能通过技术框架而解决，它一定会涉及到编程习惯、以及代码的改造。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;3&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;开发陷阱&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;开发类陷阱如下&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;3-1&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;微服务拆分的粒度越小越好&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;微服务实施的第一步就是对已有业务的微服务化拆分，常见的错误有两种：&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;以代码量作为衡量标准，例如500行以内。由于语言不同、业务功能复杂度不同、个人编码水平不同等，微服务的代码量存在较大差异，从几十行到上千行都有可能。以代码行数作为拆分标准，在实施的时候效果较差。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;拆分的粒度越小越好。不仅仅是原子服务，甚至以method为粒度进行拆分，这种拆分策略破坏了业务语义的完整性和封装性，不仅维护成本增加，对于消费者而言，使用起来也非常繁琐，成本较高。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;span&gt;一种比较好的微服务拆分实践是围绕业务功能进行垂直和水平拆分，具体原则如下：&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;功能完整性、职责单一性。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;拆分粒度适中，团队可接受。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;迭代演进，非一蹴而就。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;span&gt;微服务接口API的版本兼容性，需要优先考虑。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;3-2&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;业务系统全盘微服务化&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;以游戏架构为例，系统全部微服务化后，给系统带来挑战是什么呢？&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.8065934&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ElshSw7NB0fUN0ZvPEZvtfDdHeaBvKZFnvUIeFBRXjiak3aVJGmS5LfkcaW7s7yrbK7FRnmRovJT0MD9qrXkHuw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;910&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;1.客户端开发体验差。一堆原子微服务，需要通过微服务编排来实现特定的业务功能。从前台看，后台提供的原子API是足够灵活，但是前台大部分场景下需要的是具备完整业务功能的大颗粒服务，后台只提供原子微服务无法满足前台需求。因此，微服务的业务流程编排只能放到客户端来做。由于存在多种类型的客户端，甚至还有第三方渠道客户端，把所有的编排逻辑放到客户端，会给客户端增加大量的开发适配工作。同时，大量重复的编排逻辑被不同客户端重复实现，也造成了工作量的浪费。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2.微服务迭代和演进受到很大限制。一旦把后台的微服务直接开放给前台，后续就需要考虑API的兼容性。由于微服务的划分和实现很难一步到位，因此，微服务API的重构在所难免，而且在一些场景下，也很难做到100%前向兼容。为了避免强制所有的客户端做级联升级，需要采用多版本和灰度发布的方式上线新的微服务版本。经过几轮这样的迭代之后，线上的微服务版本将膨胀到一个数量级，维护和测试工作量激增。对于开发而言，需要维护多个代码分支，代码管理的成本也将非常高。微服务的迭代式重构和优化将很难进行。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3.微服务复杂度增高。微服务直接开放出去之后，不同的客户端，授权访问的微服务、数据等不同，需要按照不同的消费者做权限管控、流量控制、统一接入等，这些API接入层的职责下沉到微服务之后，微服务会变得臃肿不堪，这与微服务的轻量级、自治性等特征存在矛盾。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;后台业务系统全盘微服务化之后，存在的各种副作用将严重制约微服务化的推进和长期演进，微服务架构的优势也将很难发挥。如何解决？&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;用API来集成微服务&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;基于API Gateway + 服务框架协同构建微服务架构。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;如果是一个纯粹的后台系统，微服务只在内部系统之间使用，不需要开放给合作伙伴、第三方渠道、以及前台门户和客户端，则不需要经过API Gateway再绕一圈，就像之前企业架构中的ESB那样。但是大部分的系统实际上都会开放能力给前台以及第三方来使用，内部和外部使用的能力需要共享，而不是构建多套，此时，基于API Gateway系统构建微服务架构，是一种比较好的选择。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;底层的微服务注册到API Gateway中，基于API Gateway的微服务编排能力，将多个微服务编排成一个新的、具有业务语义的API，通过Restful接口开放给前台和第三方使用。同时，API Gateway对外部的消息接入统一做安全认证、流控、接口日志、动态路由等，保护后端微服务集群的安全、可靠运行。它的原理如下图所示：&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.9341518&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ElshSw7NB0fUN0ZvPEZvtfDdHeaBvKZFk9JYPrAIZ86GFn0fYicgNHAr8pjpwmB9IHK983soerwtQVSz2rFwPBg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;896&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;基于API Gateway构建微服务体系具有更大的优势，原因如下：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1. 有利于践行API First理念：基于API Gateway，可以站在消费者的角度去规划和设计API，而不是由微服务提供者自己设计开放给消费者的API。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2. 让微服务架构更聚焦，避免架构腐化：API Gateway架构天生具备API的统一多协议接入、安全控制、流量控制、敏感信息模糊化处理等特性，不需要微服务架构长成一个类似ESB的大胖子，当一个架构脱离自己核心职责时，就是架构腐化的开始。通过与API Gateway协同，可以让微服务框架聚聚在内部的高效服务调用和治理上，各司其职。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3. 定制能力提升：如果后台提供的API接口无法满足需求，API的消费者，例如第三方渠道，可以基于API Gateway提供的全在线API构建和运行环境，定制开发自己所需的API。通过API Gateway的开发Portal，可以在线编排底层的微服务，组合形成新的API，并可以在线测试和发布。API Gateway为第三方消费者提供了开箱即用的API构建、测试和运行环境，可以方便的满足第三方的差异化需求，保障后端微服务集群的稳定性。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;API有关说明&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;微服务治理方面的一个最大误解是认为：API管理平台可以通过其API发布工具和开发者门户来治理微服务。而事实上，只有当某个后端微服务团队决定利用API管理平台，将其微服务公开给其他组件上时，平台才会开始使用那些与API有关的生命周期、标准和策略，与微服务进行交互。也就是说，它无法提供在API开发之前所需的管理功能。对此，人们倾向于将平台扩展到API生命周期之外，含括后端微服务的“设计”、“审阅”、“实施”等阶段。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;不过，即使在API平台上公开了所有微服务，这些平台也无法处理有关微服务开发的治理问题(API代理部分除外)。对此，最好的解决方案是：在微服务治理平台和API管理平台之间架起一座桥梁，让API管理成为微服务治理的扩展。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;微服务治理捕获了独立于API开发的周期过程。在一个瀑布式的开发模型中，微服务团队会负责微服务的实现和API的开发。这样很好地促进了两者的“桥接”。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在大多数情况下，当定义了API接口后，微服务开发和API开发这两项任务就可以并行开展，而无需相互等待了。这就是我们经常听到的所谓“API优先(API first)”的开发方法。如上图所示，架构师将定义API并作为生命周期的初始输出，然后分拆给两个微服务团队，分别进行后端实现的开发，以及API创建等相关活动。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;此外，API管理平台通常会在微服务之外创建API代理，并向运行时架构添加另一个组件。当然，并非每个微服务都需要如此。微服务团队使用诸如服务网格之类的技术，让其微服务的内部已经具有了QoS，而且只需要将其元数据发布给其他用户，因此无需在现有的服务上，引入任何其他的运行时。此外，API管理平台也无法使用诸如依赖关系分析等功能，来识别给定服务与生态系统中其他部分的关系，毕竟它只关注特定的API及其相关的端点。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;4&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;测试陷阱&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.6666667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/ElshSw7NB0fUN0ZvPEZvtfDdHeaBvKZFo6exnVicBagUUk6Z9ZTbncKjYbb52s9xqOL0vajMiblNib3MxaMfkeUvw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1080&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;微服务架构的复杂性使测试工作本身变得更加困难。测试挑战包括测试环境、测试技术与工具、测试方法以及测试结果。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1. 测试环境&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;通常来说，一个业务有多个微服务，每个团队的测试工程师仅对其负责的微服务负责，没有统一的角色来管理整体的测试环境。这种情况下可能出现一个微服务不可用时，依赖它的服务均无法正常提供能力，进而会导致其他 QA 人员的测试任务阻塞。基于此，常见的做法可能是分时段使用环境或者维护多套测试环境。但如果所有 QA 团队对测试环境分时段使用，相当于轮流进行测试，那么整体的测试效率会低很多。如果各自维护一套完整的测试环境，那么诸如“谁来修复”，“谁来协调”和“谁来维护”等问题可能无法得到解答，且会带来较多的服务器成本和沟通成本 。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2. 测试技术和工具&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;微服务架构允许为每种服务使用不同的技术基础，这可能导致需要使用不同工具来实现相同的功能，如使用不同的编程语言、数据存储与同步、部署环境等。技术的多样性会导致 QA 人力资源难以培养或增加人力成本，同时很难构建和维护一个涵盖所有内容的良好测试环境。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3. 测试方法&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;直接用单体应用架构下的测试方法来测试微服务并不可行。单体应用架构下，测试方法往往需要理解用户需求的背景，用端到端测试的方式对业务功能进行整体验证。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;而在微服务架构下，虽然端到端测试可以在软件开发生命周期的后期起到作用，但因为测试对象发生了非常多的变化，需要对测试对象进行重新分析，那么就需要对测试策略进行整体变更，也就是说，原有的测试方法不再完全适用。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;4. 测试结果&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;微服务通常是分布式系统，这意味着服务之间通过网络调用进行通信，那么数据在网络上传输时不可避免地会出现网络延时、超时、带宽不足等因素，这将导致不稳定的测试结果。主要表现在如下方面。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;可靠性：为了尽可能降低微服务间通信对网络情况的高度依赖，降低因网络不稳定引起的故障率，设计微服务架构时会设计隔离机制，这虽然可以缩小故障点的影响范围，但因为做了架构层面的设计，所以需要针对其进行测试，这无疑增加了测试难度。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;数据一致性：分布式系统的数据需要具有一致性，但做到这一点需要付出的成本是非常高的，特别是涉及数据存储和外部通信的部分，测试过程中也常常会出现因为数据不一致而导致的缺陷误报、无效 Bug 等情况。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;关联性：微服务通常情况下会与多个微服务进行交互。因此当某服务发生变化时，会直接影响到依赖的其他服务，进而影响用户体验、非功能性要求，如性能、可访问性、可靠性等。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;5&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;运维陷阱&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;在进行微服务化的进程中，很容易把精力和重心放在运行态的功能上，例如微服务调用的性能指标、微服务的注册和发布、微服务的路由、微服务调用等，微服务治理往往会被忽略。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;结果上线之后，发现无法有效监控微服务的运行状态、性能指标，也无法对运行态的微服务进行修改和治理，导致任何针对微服务的修改操作都需要重启进程，相比于传统的单体架构，缺失有效治理手段的微服务架构运行质量更差，也更难维护。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;随着业务的发展，服务越来越多，如何协调线上运行的各个服务，保障服务的SLA，对服务架构和运维人员是一个很大的挑战。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;随着业务规模的不断扩大，小服务资源浪费等问题逐渐显现，需要能够基于服务调用的性能KPI数据进行容量管理，合理分配各个服务的资源占用，提高机器的利用率。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;线上业务发生故障时，需要对故障业务做服务降级、流量控制、流量迁移等，快速恢复业务。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;随着开发团队的不断扩大，服务的上线越来越随意，甚至发生功能相同、服务名不同的服务同时上线。上线容易下线难，为了规范服务的上线和下线，在服务发布前，需要走服务预发布流程，由架构师或者项目经理对需要上线的服务做发布审核，审核通过的才能够上线。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;为了满足服务线下管控、保障线上高效运行，需要有一个统一的服务治理框架对服务进行统一、有效管控，保障服务的高效、健康运行。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;服务治理&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;服务治理包含服务限流、服务路由、服务鉴权、服务熔断、故障注入、故障隔离、透明劫持、服务拓扑和实时监控相关服务治理。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;服务限流&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在高并发场景下，为保证在现有资源条件下服务正常运行，您可以使用服务限流让请求和并发在应用可接受的范围内，达到高可用的目的。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;服务路由&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;当服务消费者面临多个服务提供者时，需要通过路由规则来确定具体的服务提供者。服务路由功能提供了灵活的路由功能，允许您定义多条服务路由规则，可以帮助您解决多个场景下的难题。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;服务熔断&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;当为服务中的服务端接口不稳定，出现频繁超时或错误时，可能会引起服务调用雪崩。您可以对应用开启服务熔断功能，使有故障的服务端及时返回错误，并释放系统资源，提高用户体验和系统性能。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;故障注入&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;您可以通过故障注入功能向测试应用注入故障，检测应用面对异常时的处理情况。您可以根据检测的情况调整您的应用，以减少应用在正式使用时出现的异常问题。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;服务鉴权&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;服务提供者提供服务后，您可以通过服务鉴权功能对服务调用方进行鉴权。更多信息，请参见 服务鉴权。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;故障隔离&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;某个服务故障或者异常时，如果该服务触发熔断会造成整个服务的不可用。而故障隔离能够定位到异常的服务实例，实现实例级别精细化的隔离和摘流，使故障影响的范围更小、更可控。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;透明劫持&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;应用开启透明劫持功能后，出入应用的业务流量将会被 Sidecar Proxy 自动拦截，继而按照您在控制台配置的规则进行观测与治理。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;服务拓扑&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;实际业务中，应用之间的关联与依赖非常复杂，需要通过全局视角检查具体的局部异常。您可以在服务拓扑页面查看应用在指定时间内的调用及其性能状况。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;实时监控&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;您可以通过实时监控功能查看应用服务各项指标的总体统计数据，包括应用服务响应时间、错误率及请求量。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;微服务只是一种架构设计思想，包括了分析、设计、实现、测试、验证、部署、运维等多个环节。这些方法、理念在摩尔定律、业务创新、技术发展面前都被一一验证了以下观点：我们可以通过诸多方式去接近“银弹”，但很遗憾，架构设计中没有“银弹”。一个成功的架构设计最重要因素就是设计，架构师需要在业务需求和IT技术中寻找到一个平衡点。个人觉得，对这个平衡点的把握，就是架构设计中的取舍问题。而这种决策大部分是靠技术，但是一定程度上也依赖于架构师的“艺术”，技术可以依靠新工具、方法论、管理模式去提升，但是“艺术”无法量化 ，是一种权衡。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>d289b324d8f92e04c8884f927381c9c7</guid>
<title>写了一个没啥用的文件传输工具</title>
<link>https://toutiao.io/k/szucx0p</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;h1 data-mpa-powered-by=&quot;yiban.io&quot;&gt;这是在干嘛？&lt;/h1&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.75&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/dlEwIVcKGs4DibtWgPia9FFLKUwlibgOfNsrw6TOI7KjYxzLRicIYL5jdibJlcVFEXbvZkUOVW53VsxxjrT1b4QNzjA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;h1&gt;起因&lt;br/&gt;&lt;/h1&gt;&lt;p&gt;之前看到有开发者使用二维码+tun/tap, 实现了使用二维码扫码作为物理传输的IP网络。大家感兴趣的话传送门在这里 https://hackaday.com/2016/11/22/ip-over-qr-codes/&lt;/p&gt;&lt;p&gt;p叔觉得很 cool 。于是我也想用二维码来做点啥。之前也想搞想 &lt;code&gt;tun/tap&lt;/code&gt;，无奈node.js 上 &lt;code&gt;tun/tap&lt;/code&gt; 的库在 macOS上不是很友好，再加上 pshu 智商和时间都不够，就没再折腾。退而求其次，在假期就用二维码做一个文件传输的工具。&lt;/p&gt;&lt;p&gt;搜了下资料，单个二维码能承载的最大信息量是3k左右，用来做信息传输还是有可能的。（实际情况来看，由于 pshu 用的摄像头质量比较差，超过1k 的二维码就很难识别出来）&lt;/p&gt;&lt;p&gt;用二维码来传输文件背后的原理十分地简单，把需要传输的文件切割成合适大小的片段，然后每一段文件转换成二维码，依次显示二维码；接收端识别这些二维码，等所有的片段都收集完整之后，重新组合成文件即可。&lt;/p&gt;&lt;h1&gt;也不是这么简单&lt;/h1&gt;&lt;p&gt;但是注意这里有个限制条件就是：文件的发送方和接收方之间没有任何通信方式的；如果有其他任何通信方式的话，就不用这么费劲用二维码来传输文件了。所以文件的发送方只能按照一定的频率切换不同分段对应的二维码，而接收方也只能尽量快地识别二维码，以尽快组装成原来的文件。&lt;/p&gt;&lt;p&gt;由于二维码的识别是需要时间的，而发送双方无法做流控，所以如果接收方丢失了一个分段的数据，就是要发送方全部显示完一轮之后，才“有机会”看到，等这个机会来临的时候接收方也不一定能识别到。所以朴素地按照一定顺序显示文件片段的二维码的方式来传输文件实际传送时效率是非常低的。&lt;/p&gt;&lt;h1&gt;喷泉码&lt;/h1&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.45674740484429066&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/dlEwIVcKGs4DibtWgPia9FFLKUwlibgOfNsfGUn7icwBHRQBkicpcrCuLS1loVhmJ3TEguck9qalrC9u1r0xMzDKnew/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;867&quot;/&gt;&lt;/p&gt;&lt;p&gt;后来 pshu 看到一个叫做“喷泉码”的编码方式，它所带来的好处就是，只要接收方收集足够多不同的片段，就能恢复出原始的文件。就像在喷泉附近放置一个水桶，只要放的时间足够久，喷泉溅起的水珠会盛满这个水桶。喷泉码一个比较简单的实现就是 LT码（ &lt;span&gt;&lt;strong&gt;Luby transform codes&lt;/strong&gt;&lt;/span&gt; ），这个实现也是pshu 要用的。&lt;/p&gt;&lt;p&gt;&lt;span&gt;LT码的背后的原理非常地简单：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;1.&lt;/span&gt;将需要传输的数据等分成N分段，并编号&lt;/span&gt;&lt;span&gt;&lt;span&gt;2.&lt;/span&gt;根据预先设定的概率分布，生成一个k（k在区间：[1,N]），然后取k个片段，将这个k 片段的数据做异或操作，发送异或后的数据，和k个片段的编号信息。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;其中 k 的概率分布主要集中在1和2附近。&lt;/p&gt;&lt;p&gt;3.在接收方根据收到的异或后的数据和片段信息，通过异或的特性，可以逐个恢复出原本的数据片段。&lt;/p&gt;&lt;p&gt;举个例子，假设我们需要发送数据只有三个字节，我们区间分成3段，分别是 0x11, 0x22,0x44, &lt;/p&gt;&lt;p&gt;第一批发送的数据是：0,1号片段的异或，即 0x33。&lt;/p&gt;&lt;p&gt;第二批发送的数据是：1,2号片段的异或，即 0x66。&lt;/p&gt;&lt;p&gt;第三批发送的数据是：0号片段:0x11。&lt;/p&gt;&lt;p&gt;在接收方，首先知道0号片段是 0x11,  接着通过异或运算知道1号片段为 0x22（0x33^0x11），最后使用相同的方法计算出2号片段 0x44 (0x66^0x22)。&lt;/p&gt;&lt;p&gt;数据传输的大致原理就是如此。但是这里还有一个很有趣的细节，就是在选取k个数据片段的时候，需要发送方和接收方能够采用一致的方式选取k的数值和如何随机地选取这k个片段。如果直接发送k和相应选取片段的k 个编号，这种同步方法是最简单的，但是也带来了一个问题就是，这样的通信效率太低，除了发送k ，还要额外发送k个编号信息，如果k 的随机值较大这样的效率就很低。&lt;/p&gt;&lt;p&gt;LT码实现的时候，通信双方协商好了一个随机数生成的函数，那么确定好这个随机函数的随机种子，那么就能唯一地确定好 k，以及k个分片的编号。通过这样的协议就能大大地提高传输的效率。&lt;/p&gt;&lt;h1&gt;上代码&lt;/h1&gt;&lt;p&gt;原理讲清楚了，直接上代码地址 https://github.com/stormslowly/lt-node.js&lt;/p&gt;&lt;h2&gt;如何使用&lt;/h2&gt;&lt;p&gt;先 clone  代码，安装依赖后，执行&lt;/p&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;npx ts&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;node src&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;bin&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;send&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;ts &lt;/span&gt;&lt;span&gt;&amp;lt;需要发送的文件名&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;建议发500k以下的文件，如果你时间足够多足够无聊，可以帮我测测大文件的传输时间，哈哈。&lt;/p&gt;&lt;p&gt;这个时候命令行上就会出现，不停变化的二维码，这个就是文件喷泉码编码后的文件碎片。调整下命令行程序的字体大小，让二维码尽量大的显示。&lt;/p&gt;&lt;p&gt;在另外一台有摄像头的电脑上，执行 &lt;/p&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;npx ts&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;node src&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;bin&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;wsRecev&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;ts&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;然后打开本地8080端口的页面，申请摄像头权限，使用摄像头拍摄二维码，尽量让二维码占满画面，增加解码成功率。这个时候你大概会出现一个类似网站开头的的画面了。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.43337334933973587&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/dlEwIVcKGs4DibtWgPia9FFLKUwlibgOfNsQemIAvsjlpcJicyakJIgdd3B3fTxvvdurEAHrYKjWkWNpWd5TdACib8Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;833&quot;/&gt;&lt;/p&gt;&lt;p&gt;然后等上“亿点点”时间，接收程序会自动退出，说明文件接收完毕，当前目录下就会有一个 a.out 的文件，就是接收到的文件，重命名你想要的文件名即可。&lt;/p&gt;&lt;p&gt;如果想更加详细的了解背后的原理和时效，关注代码里面 &lt;code&gt;Encoder&lt;/code&gt; 和 &lt;code&gt;Decoder&lt;/code&gt; 两个类，也可以参考下test目录下的用例。&lt;/p&gt;&lt;h1&gt;完&lt;/h1&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/dlEwIVcKGs7DV2ibxf0bvmnR6fbnx9mZ3MduXGhaiasb3KxjEUBteJ7AszE5f3hSh3lhYvZH1qdibM5ibB8UxEFeRw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;258&quot;/&gt;&lt;/p&gt;&lt;p&gt;欢迎点赞转发！&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>