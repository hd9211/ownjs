<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>91e75588a2319593515719ba33a047d2</guid>
<title>Spring框架详解 - SpringMVC处理请求的原理分析</title>
<link>https://toutiao.io/k/5rid6le</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;theme-default-content content__default&quot;&gt;&lt;h1 id=&quot;spring进阶---springmvc实现原理之dispatcherservlet处理请求的过程&quot;&gt;&lt;a href=&quot;#spring进阶---springmvc实现原理之dispatcherservlet处理请求的过程&quot; class=&quot;header-anchor&quot;&gt;¶&lt;/a&gt; Spring进阶 - SpringMVC实现原理之DispatcherServlet处理请求的过程&lt;/h1&gt; &lt;blockquote&gt;&lt;p&gt;前文我们有了IOC的源码基础以及SpringMVC的基础，我们便可以进一步深入理解SpringMVC主要实现原理，包含DispatcherServlet的初始化过程和DispatcherServlet处理请求的过程的源码解析。本文是第二篇：DispatcherServlet处理请求的过程的源码解析。@pdai&lt;/p&gt;&lt;/blockquote&gt;  &lt;h2 id=&quot;dispatcherservlet处理请求的过程&quot;&gt;&lt;a href=&quot;#dispatcherservlet处理请求的过程&quot; class=&quot;header-anchor&quot;&gt;¶&lt;/a&gt; DispatcherServlet处理请求的过程？&lt;/h2&gt; &lt;blockquote&gt;&lt;p&gt;一个请求发出，经过DispatcherServlet进行了什么样的处理，最后将内容返回的呢？&lt;/p&gt;&lt;/blockquote&gt; &lt;h3 id=&quot;回顾整理处理流程&quot;&gt;&lt;a href=&quot;#回顾整理处理流程&quot; class=&quot;header-anchor&quot;&gt;¶&lt;/a&gt; 回顾整理处理流程&lt;/h3&gt; &lt;p&gt;首先让我们整体看一下Spring Web MVC 处理请求的流程：&lt;/p&gt; &lt;p&gt;&lt;img alt=&quot;&quot; data-src=&quot;/_images/spring/springframework/spring-springframework-mvc-5.png&quot; loading=&quot;lazy&quot; class=&quot;lazy&quot;/&gt;&lt;/p&gt; &lt;p&gt;&lt;strong&gt;核心架构的具体流程步骤&lt;/strong&gt;如下：&lt;/p&gt; &lt;ol&gt;&lt;li&gt;&lt;strong&gt;首先用户发送请求——&amp;gt;DispatcherServlet&lt;/strong&gt;，前端控制器收到请求后自己不进行处理，而是委托给其他的解析器进行
处理，作为统一访问点，进行全局的流程控制；&lt;/li&gt; &lt;li&gt;&lt;strong&gt;DispatcherServlet——&amp;gt;HandlerMapping&lt;/strong&gt;， HandlerMapping 将会把请求映射为 HandlerExecutionChain 对象（包含一
个Handler 处理器（页面控制器）对象、多个HandlerInterceptor 拦截器）对象，通过这种策略模式，很容易添加新
的映射策略；&lt;/li&gt; &lt;li&gt;&lt;strong&gt;DispatcherServlet——&amp;gt;HandlerAdapter&lt;/strong&gt;，HandlerAdapter 将会把处理器包装为适配器，从而支持多种类型的处理器，
即适配器设计模式的应用，从而很容易支持很多类型的处理器；&lt;/li&gt; &lt;li&gt;&lt;strong&gt;HandlerAdapter——&amp;gt;处理器功能处理方法的调用&lt;/strong&gt;，HandlerAdapter 将会根据适配的结果调用真正的处理器的功能处
理方法，完成功能处理；并返回一个ModelAndView 对象（包含模型数据、逻辑视图名）；&lt;/li&gt; &lt;li&gt;&lt;strong&gt;ModelAndView 的逻辑视图名——&amp;gt; ViewResolver&lt;/strong&gt;，ViewResolver 将把逻辑视图名解析为具体的View，通过这种策
略模式，很容易更换其他视图技术；&lt;/li&gt; &lt;li&gt;&lt;strong&gt;View——&amp;gt;渲染&lt;/strong&gt;，View 会根据传进来的Model 模型数据进行渲染，此处的Model 实际是一个Map 数据结构，因此
很容易支持其他视图技术；&lt;/li&gt; &lt;li&gt;&lt;strong&gt;返回控制权给DispatcherServlet&lt;/strong&gt;，由DispatcherServlet 返回响应给用户，到此一个流程结束。&lt;/li&gt;&lt;/ol&gt; &lt;h3 id=&quot;doget入口&quot;&gt;&lt;a href=&quot;#doget入口&quot; class=&quot;header-anchor&quot;&gt;¶&lt;/a&gt; doGet入口&lt;/h3&gt; &lt;blockquote&gt;&lt;p&gt;我们以上个demo中这个GET请求为例，请求URL是http://localhost:8080/011_spring_framework_demo_springmvc_war_exploded/user&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;我们知道servlet处理get请求是doGet方法，所以我们去找DispatcherServlet类结构中的doGet方法。&lt;/p&gt; &lt;div class=&quot;language-java line-numbers-mode&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doGet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServletException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;processRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt; &lt;p class=&quot;line-numbers-wrapper&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;processRequest处理请求的方法如下：&lt;/p&gt; &lt;div class=&quot;language-java line-numbers-mode&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;&lt;span class=&quot;token comment&quot;&gt;/**
  * Process this request, publishing an event regardless of the outcome.
  * &amp;lt;p&amp;gt;The actual event handling is performed by the abstract
  * {@link #doService} template method.
  */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;processRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServletException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// 计算处理请求的时间&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; startTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentTimeMillis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;Throwable&lt;/span&gt; failureCause &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token class-name&quot;&gt;LocaleContext&lt;/span&gt; previousLocaleContext &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LocaleContextHolder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getLocaleContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;LocaleContext&lt;/span&gt; localeContext &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;buildLocaleContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token class-name&quot;&gt;RequestAttributes&lt;/span&gt; previousAttributes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RequestContextHolder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getRequestAttributes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;ServletRequestAttributes&lt;/span&gt; requestAttributes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;buildRequestAttributes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; previousAttributes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token class-name&quot;&gt;WebAsyncManager&lt;/span&gt; asyncManager &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WebAsyncUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAsyncManager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  asyncManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;registerCallableInterceptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;FrameworkServlet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RequestBindingInterceptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// 初始化context&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;initContextHolders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; localeContext&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; requestAttributes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 看这里&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;doService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ServletException&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    failureCause &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Throwable&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    failureCause &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NestedServletException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Request processing failed&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 重置context&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;resetContextHolders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; previousLocaleContext&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; previousAttributes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;requestAttributes &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      requestAttributes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;requestCompleted&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;logResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; failureCause&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; asyncManager&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;publishRequestHandledEvent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; startTime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; failureCause&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt; &lt;p class=&quot;line-numbers-wrapper&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;37&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;38&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;39&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;40&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;41&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;42&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;43&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;44&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;45&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;46&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;47&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;本质上就是调用doService方法，由DispatchServlet类实现&lt;/p&gt; &lt;div class=&quot;language-java line-numbers-mode&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;&lt;span class=&quot;token comment&quot;&gt;/**
  * Exposes the DispatcherServlet-specific request attributes and delegates to {@link #doDispatch}
  * for the actual dispatching.
  */&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;logRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// 保存下请求之前的参数.&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt; attributesSnapshot &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;WebUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isIncludeRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    attributesSnapshot &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashMap&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Enumeration&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt; attrNames &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAttributeNames&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;attrNames&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasMoreElements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; attrName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; attrNames&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;nextElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cleanupAfterInclude &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; attrName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;startsWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;DEFAULT_STRATEGIES_PREFIX&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        attributesSnapshot&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;attrName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAttribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;attrName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// 方便后续 handlers 和 view 要使用它们.&lt;/span&gt;
  request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;WEB_APPLICATION_CONTEXT_ATTRIBUTE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getWebApplicationContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;LOCALE_RESOLVER_ATTRIBUTE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;localeResolver&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;THEME_RESOLVER_ATTRIBUTE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;themeResolver&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;THEME_SOURCE_ATTRIBUTE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getThemeSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;flashMapManager &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;FlashMap&lt;/span&gt; inputFlashMap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;flashMapManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieveAndUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inputFlashMap &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;INPUT_FLASH_MAP_ATTRIBUTE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Collections&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unmodifiableMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inputFlashMap&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;OUTPUT_FLASH_MAP_ATTRIBUTE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FlashMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;FLASH_MAP_MANAGER_ATTRIBUTE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;flashMapManager&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token class-name&quot;&gt;RequestPath&lt;/span&gt; previousRequestPath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parseRequestPath&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    previousRequestPath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;RequestPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAttribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ServletRequestPathUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;PATH_ATTRIBUTE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ServletRequestPathUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;parseAndCache&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 看这里，终于将这个请求分发出去了&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;doDispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;WebAsyncUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAsyncManager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isConcurrentHandlingStarted&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// Restore the original attribute snapshot, in case of an include.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;attributesSnapshot &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;restoreAttributesAfterInclude&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; attributesSnapshot&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parseRequestPath&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;ServletRequestPathUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setParsedRequestPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;previousRequestPath&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt; &lt;p class=&quot;line-numbers-wrapper&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;37&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;38&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;39&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;40&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;41&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;42&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;43&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;44&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;45&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;46&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;47&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;48&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;49&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;50&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;51&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;52&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;53&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;54&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;55&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;56&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;57&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;58&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;h3 id=&quot;请求分发&quot;&gt;&lt;a href=&quot;#请求分发&quot; class=&quot;header-anchor&quot;&gt;¶&lt;/a&gt; 请求分发&lt;/h3&gt; &lt;p&gt;doDispatch方法是真正处理请求的核心方法&lt;/p&gt; &lt;div class=&quot;language-java line-numbers-mode&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;&lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doDispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; processedRequest &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;HandlerExecutionChain&lt;/span&gt; mappedHandler &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; multipartRequestParsed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token class-name&quot;&gt;WebAsyncManager&lt;/span&gt; asyncManager &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WebAsyncUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAsyncManager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ModelAndView&lt;/span&gt; mv &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; dispatchException &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// 判断是不是文件上传类型的request&lt;/span&gt;
      processedRequest &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;checkMultipart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      multipartRequestParsed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;processedRequest &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;// 根据request获取匹配的handler.&lt;/span&gt;
      mappedHandler &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;processedRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mappedHandler &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;noHandlerFound&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;processedRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;// 根据handler获取匹配的handlerAdapter&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;HandlerAdapter&lt;/span&gt; ha &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getHandlerAdapter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mappedHandler&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;// 如果handler支持last-modified头处理&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; method &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; isGet &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GET&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;matches&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;method&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isGet &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HEAD&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;matches&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;method&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; lastModified &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ha&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getLastModified&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mappedHandler&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServletWebRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;checkNotModified&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lastModified&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; isGet&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;mappedHandler&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;applyPreHandle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;processedRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;// 真正handle处理，并返回modelAndView&lt;/span&gt;
      mv &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ha&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;processedRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mappedHandler&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;asyncManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isConcurrentHandlingStarted&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;// 通过视图的prefix和postfix获取完整的视图名&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;applyDefaultViewName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;processedRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;// 应用后置的拦截器&lt;/span&gt;
      mappedHandler&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;applyPostHandle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;processedRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      dispatchException &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Throwable&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// As of 4.3, we&#x27;re processing Errors thrown from handler methods as well,&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// making them available for @ExceptionHandler methods and other scenarios.&lt;/span&gt;
      dispatchException &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NestedServletException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Handler dispatch failed&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 处理handler处理的结果，显然就是对ModelAndView 或者 出现的Excpetion处理&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;processDispatchResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;processedRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mappedHandler&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mv&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dispatchException&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;triggerAfterCompletion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;processedRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mappedHandler&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Throwable&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;triggerAfterCompletion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;processedRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mappedHandler&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NestedServletException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Handler processing failed&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;asyncManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isConcurrentHandlingStarted&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// Instead of postHandle and afterCompletion&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mappedHandler &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        mappedHandler&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;applyAfterConcurrentHandlingStarted&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;processedRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// Clean up any resources used by a multipart request.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;multipartRequestParsed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;cleanupMultipart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;processedRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt; &lt;p class=&quot;line-numbers-wrapper&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;37&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;38&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;39&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;40&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;41&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;42&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;43&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;44&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;45&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;46&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;47&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;48&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;49&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;50&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;51&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;52&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;53&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;54&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;55&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;56&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;57&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;58&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;59&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;60&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;61&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;62&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;63&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;64&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;65&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;66&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;67&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;68&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;69&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;70&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;71&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;72&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;73&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;74&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;75&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;76&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;77&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;78&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;79&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;80&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;81&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;82&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;83&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;84&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;85&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;86&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;87&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;h3 id=&quot;映射和适配器处理&quot;&gt;&lt;a href=&quot;#映射和适配器处理&quot; class=&quot;header-anchor&quot;&gt;¶&lt;/a&gt; 映射和适配器处理&lt;/h3&gt; &lt;p&gt;对于真正的handle方法，我们看下其处理流程&lt;/p&gt; &lt;div class=&quot;language-java line-numbers-mode&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;&lt;span class=&quot;token comment&quot;&gt;/**
  * This implementation expects the handler to be an {@link HandlerMethod}.
  */&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Nullable&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ModelAndView&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; handler&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleInternal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HandlerMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; handler&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt; &lt;p class=&quot;line-numbers-wrapper&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;交给handleInternal方法处理，以RequestMappingHandlerAdapter这个HandlerAdapter中的处理方法为例&lt;/p&gt; &lt;div class=&quot;language-java line-numbers-mode&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ModelAndView&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleInternal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HandlerMethod&lt;/span&gt; handlerMethod&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token class-name&quot;&gt;ModelAndView&lt;/span&gt; mav&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;checkRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Execute invokeHandlerMethod in synchronized block if required.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;synchronizeOnSession&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;HttpSession&lt;/span&gt; session &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getSession&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;session &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; mutex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WebUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getSessionMutex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;session&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mutex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        mav &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;invokeHandlerMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handlerMethod&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// No HttpSession available -&amp;gt; no mutex necessary&lt;/span&gt;
      mav &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;invokeHandlerMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handlerMethod&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// No synchronization on session demanded at all...&lt;/span&gt;
    mav &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;invokeHandlerMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handlerMethod&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;containsHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;HEADER_CACHE_CONTROL&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getSessionAttributesHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;handlerMethod&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasSessionAttributes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;applyCacheSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cacheSecondsForSessionAttributeHandlers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;prepareResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; mav&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt; &lt;p class=&quot;line-numbers-wrapper&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;37&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;img alt=&quot;&quot; data-src=&quot;/_images/spring/springframework/spring-springframework-mvc-27.png&quot; loading=&quot;lazy&quot; class=&quot;lazy&quot;/&gt;&lt;/p&gt; &lt;p&gt;然后执行invokeHandlerMethod这个方法，用来对RequestMapping（usercontroller中的list方法）进行处理&lt;/p&gt; &lt;div class=&quot;language-java line-numbers-mode&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;&lt;span class=&quot;token comment&quot;&gt;/**
  * Invoke the {@link RequestMapping} handler method preparing a {@link ModelAndView}
  * if view resolution is required.
  * @since 4.2
  * @see #createInvocableHandlerMethod(HandlerMethod)
  */&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Nullable&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ModelAndView&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;invokeHandlerMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HandlerMethod&lt;/span&gt; handlerMethod&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token class-name&quot;&gt;ServletWebRequest&lt;/span&gt; webRequest &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServletWebRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    
    &lt;span class=&quot;token class-name&quot;&gt;WebDataBinderFactory&lt;/span&gt; binderFactory &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDataBinderFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;handlerMethod&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ModelFactory&lt;/span&gt; modelFactory &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getModelFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;handlerMethod&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; binderFactory&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 重要：设置handler(controller#list)方法上的参数，返回值处理，绑定databinder等&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ServletInvocableHandlerMethod&lt;/span&gt; invocableMethod &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createInvocableHandlerMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;handlerMethod&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;argumentResolvers &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      invocableMethod&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setHandlerMethodArgumentResolvers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;argumentResolvers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;returnValueHandlers &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      invocableMethod&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setHandlerMethodReturnValueHandlers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;returnValueHandlers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    invocableMethod&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setDataBinderFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;binderFactory&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    invocableMethod&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setParameterNameDiscoverer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parameterNameDiscoverer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token class-name&quot;&gt;ModelAndViewContainer&lt;/span&gt; mavContainer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ModelAndViewContainer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    mavContainer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addAllAttributes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;RequestContextUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getInputFlashMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    modelFactory&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;initModel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;webRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mavContainer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; invocableMethod&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    mavContainer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setIgnoreDefaultModelOnRedirect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ignoreDefaultModelOnRedirect&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    
    &lt;span class=&quot;token class-name&quot;&gt;AsyncWebRequest&lt;/span&gt; asyncWebRequest &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WebAsyncUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createAsyncWebRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    asyncWebRequest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;asyncRequestTimeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token class-name&quot;&gt;WebAsyncManager&lt;/span&gt; asyncManager &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WebAsyncUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAsyncManager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    asyncManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setTaskExecutor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;taskExecutor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    asyncManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAsyncWebRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;asyncWebRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    asyncManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;registerCallableInterceptors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;callableInterceptors&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    asyncManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;registerDeferredResultInterceptors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;deferredResultInterceptors&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;asyncManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasConcurrentResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; asyncManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getConcurrentResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      mavContainer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ModelAndViewContainer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; asyncManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getConcurrentResultContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      asyncManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clearConcurrentResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;LogFormatUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;traceDebug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;logger&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; traceOn &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; formatted &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LogFormatUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;formatValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;traceOn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Resume with async result [&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; formatted &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;]&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      invocableMethod &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; invocableMethod&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;wrapConcurrentResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 执行controller中方法&lt;/span&gt;
    invocableMethod&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invokeAndHandle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;webRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mavContainer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;asyncManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isConcurrentHandlingStarted&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getModelAndView&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mavContainer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; modelFactory&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; webRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    webRequest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;requestCompleted&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt; &lt;p class=&quot;line-numbers-wrapper&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;37&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;38&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;39&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;40&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;41&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;42&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;43&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;44&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;45&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;46&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;47&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;48&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;49&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;50&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;51&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;52&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;53&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;54&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;55&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;56&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;57&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;58&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;59&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;60&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;61&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;62&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;63&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;64&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;65&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;invokeAndHandle交给UserController中具体执行list方法执行&lt;/p&gt; &lt;p&gt;&lt;img alt=&quot;&quot; data-src=&quot;/_images/spring/springframework/spring-springframework-mvc-29.png&quot; loading=&quot;lazy&quot; class=&quot;lazy&quot;/&gt;&lt;/p&gt; &lt;p&gt;后续invoke执行的方法，直接看整个请求流程的调用链即可&lt;/p&gt; &lt;p&gt;&lt;img alt=&quot;&quot; data-src=&quot;/_images/spring/springframework/spring-springframework-mvc-30.png&quot; loading=&quot;lazy&quot; class=&quot;lazy&quot;/&gt;&lt;/p&gt; &lt;p&gt;执行后获得视图和Model&lt;/p&gt; &lt;p&gt;&lt;img alt=&quot;&quot; data-src=&quot;/_images/spring/springframework/spring-springframework-mvc-31.png&quot; loading=&quot;lazy&quot; class=&quot;lazy&quot;/&gt;&lt;/p&gt; &lt;h3 id=&quot;视图渲染&quot;&gt;&lt;a href=&quot;#视图渲染&quot; class=&quot;header-anchor&quot;&gt;¶&lt;/a&gt; 视图渲染&lt;/h3&gt; &lt;p&gt;接下来继续执行processDispatchResult方法，对视图和model（如果有异常则对异常处理）进行处理（显然就是渲染页面了）&lt;/p&gt; &lt;div class=&quot;language-java line-numbers-mode&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;&lt;span class=&quot;token comment&quot;&gt;/**
  * Handle the result of handler selection and handler invocation, which is
  * either a ModelAndView or an Exception to be resolved to a ModelAndView.
  */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;processDispatchResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Nullable&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HandlerExecutionChain&lt;/span&gt; mappedHandler&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token annotation punctuation&quot;&gt;@Nullable&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ModelAndView&lt;/span&gt; mv&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Nullable&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; errorView &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// 如果处理过程有异常，则异常处理&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;exception &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;exception &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ModelAndViewDefiningException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;ModelAndViewDefiningException encountered&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      mv &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ModelAndViewDefiningException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getModelAndView&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; handler &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mappedHandler &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; mappedHandler&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      mv &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;processHandlerException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handler&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      errorView &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mv &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// 是否需要渲染视图&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mv &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;mv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;wasCleared&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mv&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 渲染视图&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorView&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;WebUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clearErrorRequestAttributes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isTraceEnabled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;trace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;No view rendering, null ModelAndView returned.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;WebAsyncUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAsyncManager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isConcurrentHandlingStarted&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Concurrent handling started during a forward&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mappedHandler &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Exception (if any) is already handled..&lt;/span&gt;
    mappedHandler&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;triggerAfterCompletion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt; &lt;p class=&quot;line-numbers-wrapper&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;37&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;38&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;39&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;40&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;41&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;42&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;43&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;44&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;45&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;46&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;接下来显然就是渲染视图了, spring在initStrategies方法中初始化的组件（LocaleResovler等）就派上用场了。&lt;/p&gt; &lt;div class=&quot;language-java line-numbers-mode&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code&gt;&lt;span class=&quot;token comment&quot;&gt;/**
  * Render the given ModelAndView.
  * &amp;lt;p&amp;gt;This is the last stage in handling a request. It may involve resolving the view by name.
  * @param mv the ModelAndView to render
  * @param request current HTTP servlet request
  * @param response current HTTP servlet response
  * @throws ServletException if view is missing or cannot be resolved
  * @throws Exception if there&#x27;s a problem rendering the view
  */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ModelAndView&lt;/span&gt; mv&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Determine locale for request and apply it to the response.&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;Locale&lt;/span&gt; locale &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;localeResolver &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;localeResolver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolveLocale&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getLocale&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setLocale&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;locale&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token class-name&quot;&gt;View&lt;/span&gt; view&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; viewName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getViewName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;viewName &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// We need to resolve the view name.&lt;/span&gt;
    view &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;resolveViewName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;viewName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getModelInternal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; locale&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;view &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServletException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Could not resolve view with name &#x27;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; mv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getViewName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&quot;&#x27; in servlet with name &#x27;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getServletName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&#x27;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// No need to lookup: the ModelAndView object contains the actual View object.&lt;/span&gt;
    view &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getView&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;view &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServletException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;ModelAndView [&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; mv &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;] neither contains a view name nor a &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&quot;View object in servlet with name &#x27;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getServletName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&#x27;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Delegate to the View object for rendering.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isTraceEnabled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;trace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Rendering view [&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; view &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;] &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    view&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getModelInternal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isDebugEnabled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Error rendering view [&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; view &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;]&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt; &lt;p class=&quot;line-numbers-wrapper&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;37&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;38&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;39&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;40&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;41&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;42&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;43&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;44&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;45&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;46&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;47&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;48&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;49&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;50&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;51&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;后续就是通过viewResolver进行解析了，这里就不再继续看代码了，上述流程基本上够帮助你构建相关的认知了。&lt;/p&gt; &lt;p&gt;最后无非是返回控制权给DispatcherServlet，由DispatcherServlet 返回响应给用户。&lt;/p&gt; &lt;p&gt;最后的最后我们看下请求的日志：&lt;/p&gt; &lt;div class=&quot;language-bash line-numbers-mode&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code&gt;&lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;:45:53.390 &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;http-nio-8080-exec-6&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; DEBUG org.springframework.web.servlet.DispatcherServlet - GET &lt;span class=&quot;token string&quot;&gt;&quot;/011_spring_framework_demo_springmvc_war_exploded/user&quot;&lt;/span&gt;, &lt;span class=&quot;token assign-left variable&quot;&gt;parameters&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;:45:53.400 &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;http-nio-8080-exec-6&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; DEBUG org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping - Mapped to tech.pdai.springframework.springmvc.controller.UserController&lt;span class=&quot;token comment&quot;&gt;#list(HttpServletRequest, HttpServletResponse)&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:51:14.504 &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;http-nio-8080-exec-6&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; DEBUG org.springframework.web.servlet.view.JstlView - View name &lt;span class=&quot;token string&quot;&gt;&#x27;userList&#x27;&lt;/span&gt;, model &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;dateTime&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Fri Apr &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;:45:53 CST &lt;span class=&quot;token number&quot;&gt;2022&lt;/span&gt;, &lt;span class=&quot;token assign-left variable&quot;&gt;userList&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;tech.pdai.springframework.springmvc.entity.User@7b8c8dc&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:51:14.550 &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;http-nio-8080-exec-6&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; DEBUG org.springframework.web.servlet.view.JstlView - Forwarding to &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;/WEB-INF/views/userList.jsp&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:51:44.395 &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;http-nio-8080-exec-6&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; DEBUG org.springframework.web.servlet.DispatcherServlet - Completed &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt; OK
&lt;/code&gt;&lt;/pre&gt; &lt;p class=&quot;line-numbers-wrapper&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>4d4021c28bc477b1ea811c52f226d0fe</guid>
<title>从0到1建设智能灰度数据体系：以vivo游戏中心为例</title>
<link>https://toutiao.io/k/q77o28w</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;作者：&lt;/p&gt;&lt;p&gt;vivo 互联网数据分析团队-Dong Chenwei&lt;/p&gt;&lt;p&gt;vivo 互联网大数据团队-Qin Cancan、Zeng Kun&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;本文介绍了vivo游戏中心在灰度数据分析体系上的实践经验，从“实验思想-数学方法-数据模型-产品方案”四个层面提供了一套较为完整的智能灰度数据解决方案，以保障版本评估的科学性、项目进度以及灰度验证环节的快速闭环。该方案的亮点在于，指标异动根因分析方法的引入和全流程自动化产品方案的设计。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;一、引言&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;游戏业务的用户规模体量大，业务链路长，数据逻辑繁杂。游戏中心作为游戏业务平台端的核心用户产品，版本迭代非常频繁，每次版本上线前都必须进行小量级的灰度验证。2021年以来，平均每1~2周都会有重要版本开始灰度，而且线上有时会同时有多个版本在灰度测试。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;灰度的整个过程在数据层面主要涉及3个问题：&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-1&quot; powered-by=&quot;xiumi.us&quot;&gt;&lt;li&gt;&lt;p&gt;如何确保版本灰度评估的科学性？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如何提升灰度数据的产出效率，保障项目进度？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;当灰度版本出现指标异常问题时，如何快速定位问题完成闭环？&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;近两年来，我们逐步将灰度评估方法体系化地落地到敏捷BI等数据产品上，目前灰度数据体系已经较好地解决了这3个问题。本文首先以版本灰度数据体系的基本概念和发展历程为铺垫，接着以“&lt;strong&gt;方法论+解决方案&lt;/strong&gt;”为主线阐述游戏中心在灰度数据体系上的实践，并展望未来。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;二、灰度数据体系的发展&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;2.1 什么是灰度发版&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;当游戏中心开发了全新的首页界面，应该如何验证新的首页是否被用户所接受，并且功能是否完善、性能是否稳定？&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;答：&lt;strong&gt;灰度发版&lt;/strong&gt;。就是在新版本推送给全量用户使用之前，按照一定策略选取部分用户，让他们先行体验新版首页，以获得他们关于“新的首页好用或不好用”以及“如果不好用，是哪里出了问题”的使用反馈。如果出现重大问题，则及时回滚旧版本；反之则根据反馈结果进行查漏补缺，并适时继续放大新版本投放范围直至全量升级。&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;2.2 灰度评估方案发展阶段&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;判断灰度发版是否科学的关键在于控制变量，这一问题的解决过程，也是灰度评估方案迭代和发展的过程。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.31666666666666665&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/4g5IMGibSxt713f11iaViabMkQhb6HBK3J0LMkFUwTbPibPlIjcwLO6l1pKksxCONdO4maAVib5hhyKeudnnqTkmG5w/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;阶段一：&lt;/strong&gt;确保了对比的时间相同，但升级速度差异意味着优先升级的用户和未升级的用户非同质用户，未能规避样本差异对数据结果差异的影响。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;阶段二：&lt;/strong&gt;确保了对比的人群相同，但用户行为可能随时间而变化，无法剔除前后时间因素的差异。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;阶段三：&lt;/strong&gt;同时确保了时间和人群相同，有以下三方面优势：&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;将旧版本打包为对比包，与新版本的灰度包一起，分别对两批同质用户发布，保证了灰度包和对比包的样本属性、时间因素一致；&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;依据产品目标计算合理的样本量，避免样本过少导致结果不可信、过多导致资源浪费；&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;依托静默安装功能快速升级，缩短灰度验证阶段的时间。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;2.3 灰度数据体系内容    &lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;灰度数据体系通常涉及&lt;strong&gt;前期流量策略&lt;/strong&gt;和&lt;strong&gt;后期数据检验&lt;/strong&gt;2个部分。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;前者包括样本量计算和灰度时长控制，后者包括新老版本核心指标对比、产品优化处的指标变化或新增功能的数据表现。在常规的灰度评估之外，引入根因分析的方法可以提升灰度结果的解释性。&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;2.4 vivo游戏中心的做法&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;我们搭建了“&lt;strong&gt;游戏中心智能灰度数据体系&lt;/strong&gt;”，并通过三版迭代逐步解决了本文开头提到的3个问题。数据体系由指标检验结果、维度下钻解读、用户属性校验、指标异常诊断等主题看板以及自动化推送的灰度结论报告组成。&lt;/p&gt;&lt;p&gt;完整方案部署上线后，基本实现了灰度评估阶段的自动化数据生产、效果检验、数据解读和决策建议的闭环，极大地释放了人力。&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;三、灰度数据体系中的方法论&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;在介绍数据方案设计前，先介绍一下灰度数据体系中涉及的背景知识和方法论，帮助大家更好地理解本文。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;3.1 灰度实验&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;灰度实验包括&lt;strong&gt;抽样&lt;/strong&gt;和&lt;strong&gt;效果检验&lt;/strong&gt;两个部分，对应的是假设检验的思想以及样本历史差异性验证。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;3.1.1 假设检验&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;假设检验是先对总体参数提出一个假设值，然后利用样本表现判断这一假设是否成立。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4425925925925926&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt713f11iaViabMkQhb6HBK3J0vwjiaayMB2hNMWJ1LL4LPITNTkXZdTVoZp3bcenLxFFQ2WZ6GSfgkEQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;3.1.2 样本历史差异性验证&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;虽然灰度前事先已通过hash算法进行抽样，但由于抽样的随机性，一般会在统计检验和效果检验的同时，对样本的历史差异性进行验证，剔除样本本身差异带来的指标波动。灰度周期通常为7天，我们采用了7天滑动窗口取样的方法。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4425925925925926&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt713f11iaViabMkQhb6HBK3J0HQ3aXXCYr6cvD0M5vibyTr1sAupaWvYzIyjWibuXsI5AkXECUaiaxzQiag/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;3.2 根因分析&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;灰度指标往往与多维属性（如用户属性、渠道来源、页面模块等）存在关联，当指标的检验结果发生异常的显著差异时，想要解除异常，定位出其根因所在是关键一步。然而，这一步常常是充满挑战的，尤其当根因是多个维度属性值的组合时。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;为了解决这一问题，我们引入了根因分析的方法，&lt;strong&gt;以弥补了灰度检验结果解释性不足的问题&lt;/strong&gt;。我们结合了指标逻辑分析法和Adtributor算法2种方法，以确保分析结果的可靠性。&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;3.2.1 指标逻辑分析法&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;由于灰度实验中构建的指标体系基本都是率值类指标或均值类指标，这两类指标都可以通过指标公式拆解为分子和分母两个因子，而指标的分子和分母均是由各个维度下的维度值相加得到。因此提出了&lt;strong&gt;指标逻辑分析法&lt;/strong&gt;，基于一定的拆解方法，从指标因子和指标维度2个层次对指标值进行逻辑拆解。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4425925925925926&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt713f11iaViabMkQhb6HBK3J06xoRPqVtowyBibAdiagLRUWAZnUdSBicUm8d1VN95IRXvlkl3cqyxsDjA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;3.2.2 Adtributor算法&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;除了根因分析比较常见的维度下钻方法以外，我们引入了Adtributor算法，以更好地应对多维度组合影响指标的情况，并通过两种方法的交叉验证来确保分析结果的可靠性。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;Adtributor算法是微软研究院于2014年提出的一种多维时间序列异常根因分析方法，在多维度复杂根因的场景下具有良好的可靠性。算法完整过程包括数据预处理、异常检测、根因分析和仿真可视化4个步骤，我们主要借鉴了根因分析环节的方法。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4425925925925926&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt713f11iaViabMkQhb6HBK3J0CnoBoCfv7kbjtDyHZVAnb47nngGhv4vzznV92p7zITddBPhFSK7xJg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;四、灰度智能解决方案&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;4.1 整体框架 &lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;版本灰度可以分为灰度前-灰度中-灰度后3个阶段，产品化整体框架如下：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.75&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt713f11iaViabMkQhb6HBK3J0abvKJS7mm1YmkpOuDYQqcWSibQjOQK4PqTTSlWhJbiar7EUyricIXic5AA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;4.2 流程设计&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;基于以上框架，我们是如何设计实现的？&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;以下是描述整个过程的流程图：&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1.5148247978436657&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt713f11iaViabMkQhb6HBK3J0YWfGxQ5n4D2JTfiaGE0xjdMSr0UqWgxEjhSxkSg4BiaHUZVicc3pyyjiaQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;742&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;4.3 方案核心内容&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;4.3.1 样本量预估方案&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;看板提供：在多套置信水平跟检验效能标准下（默认显示95%置信度、80%检验效能），根据指标最近表现，预估出指标在不同预期变化幅度下能被检测出显著与否的最低样本量。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt; 该方案具有3大特点：&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;ol class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;输出多套标准，灵活调整预期幅度；&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;自动选取最近一个全量版本的数据作为数据输入；&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;均值类指标和率值类指标采用差异化的计算逻辑。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4462962962962963&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt713f11iaViabMkQhb6HBK3J0nWuHf97VMTOCXaSSibRrMYWFbpSW0p24W9r3GSVLBqF2TCttJ8BPaZg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;4.3.2 效果指标显著性检验方案&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;指标显著性检验模型需要回答的问题是：灰度版本相较对比版本，指标变化在统计意义上是置信的还是不置信的。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;目前，实现了三种置信水平下灰度版本与对比版本在20个业务指标上的显著性判断。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;实现过程如下：&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;率值类指标&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;python&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__meta&quot;&gt;... &lt;/span&gt;...&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    variation_visitors  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    control_visitors  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    variation_p  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    control_p  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    z  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    variation_se = math.sqrt(variation_p * (&lt;span class=&quot;code-snippet__number&quot;&gt;1&lt;/span&gt; - variation_p))&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    control_se = math.sqrt(control_p * (&lt;span class=&quot;code-snippet__number&quot;&gt;1&lt;/span&gt; - control_p))&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    gap = variation_p - control_p&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    rate = variation_p / control_p - &lt;span class=&quot;code-snippet__number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    gap_interval_sdown = gap - z * math.sqrt(math.pow(control_se, &lt;span class=&quot;code-snippet__number&quot;&gt;2&lt;/span&gt;) / control_visitors + math.pow(variation_se, &lt;span class=&quot;code-snippet__number&quot;&gt;2&lt;/span&gt;) / variation_visitors)  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    gap_interval_sup = gap + z * math.sqrt(math.pow(control_se, &lt;span class=&quot;code-snippet__number&quot;&gt;2&lt;/span&gt;) / control_visitors + math.pow(variation_se, &lt;span class=&quot;code-snippet__number&quot;&gt;2&lt;/span&gt;) / variation_visitors)  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    confidence_interval_sdown = gap_interval_sdown / control_p  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    confidence_interval_sup = gap_interval_sup / control_p  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    &lt;span class=&quot;code-snippet__keyword&quot;&gt;if&lt;/span&gt; (confidence_interval_sdown &amp;gt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;and&lt;/span&gt; confidence_interval_sup &amp;gt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;code-snippet__keyword&quot;&gt;or&lt;/span&gt; (confidence_interval_sdown &amp;lt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;and&lt;/span&gt; confidence_interval_sup &amp;lt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt;):&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;       print(&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;显著&quot;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    &lt;span class=&quot;code-snippet__keyword&quot;&gt;elif&lt;/span&gt; (confidence_interval_sdown &amp;gt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;and&lt;/span&gt; confidence_interval_sup &amp;lt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;code-snippet__keyword&quot;&gt;or&lt;/span&gt; (confidence_interval_sdown &amp;lt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;and&lt;/span&gt; confidence_interval_sup &amp;gt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt;):&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;       print(&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;不显著&quot;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__meta&quot;&gt;... &lt;/span&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;均值类指标&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;python&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__meta&quot;&gt;... &lt;/span&gt;...&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    variation_visitors  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    control_visitors  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    variation_p  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    control_p  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    variation_x  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    control_x  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    z  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    variation_se = np.std(variation_x, ddof = &lt;span class=&quot;code-snippet__number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    control_se = np.std(control_x, ddof = &lt;span class=&quot;code-snippet__number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    gap = variation_p - control_p&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    rate = variation_p / control_p - &lt;span class=&quot;code-snippet__number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    gap_interval_sdown = gap - z * math.sqrt(math.pow(control_se, &lt;span class=&quot;code-snippet__number&quot;&gt;2&lt;/span&gt;) / control_visitors + math.pow(variation_se, &lt;span class=&quot;code-snippet__number&quot;&gt;2&lt;/span&gt;) / variation_visitors)  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    gap_interval_sup = gap + z * math.sqrt(math.pow(control_se, &lt;span class=&quot;code-snippet__number&quot;&gt;2&lt;/span&gt;) / control_visitors + math.pow(variation_se, &lt;span class=&quot;code-snippet__number&quot;&gt;2&lt;/span&gt;) / variation_visitors)  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    confidence_interval_sdown = gap_interval_sdown / control_p  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    confidence_interval_sup = gap_interval_sup / control_p  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    &lt;span class=&quot;code-snippet__keyword&quot;&gt;if&lt;/span&gt; (confidence_interval_sdown &amp;gt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;and&lt;/span&gt; confidence_interval_sup &amp;gt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;code-snippet__keyword&quot;&gt;or&lt;/span&gt; (confidence_interval_sdown &amp;lt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;and&lt;/span&gt; confidence_interval_sup &amp;lt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt;):&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;       print(&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;显著&quot;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    &lt;span class=&quot;code-snippet__keyword&quot;&gt;elif&lt;/span&gt; (confidence_interval_sdown &amp;gt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;and&lt;/span&gt; confidence_interval_sup &amp;lt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;code-snippet__keyword&quot;&gt;or&lt;/span&gt; (confidence_interval_sdown &amp;lt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;and&lt;/span&gt; confidence_interval_sup &amp;gt; &lt;span class=&quot;code-snippet__number&quot;&gt;0&lt;/span&gt;):&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;       print(&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;不显著&quot;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__meta&quot;&gt;... &lt;/span&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;看板展示如下：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.3287037037037037&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt713f11iaViabMkQhb6HBK3J0bLsOzTq0nkrCzYoGqcm0cibzs0PtOw9KL0t3DA39AwbNI4xDGEykjrQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;4.3.3 负向指标自动根因分析方案&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;灰度场景的负向指标自动化根因分析方案包括异动检测、样本历史差异性验证、指标逻辑拆解和Adtributor自动根因分析4个步骤。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1.2572706935123044&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt713f11iaViabMkQhb6HBK3J0lcniah6ud9WutSpIXENU53AoDD4t1LkrjkWaSy0n0T7vZVrWkTLTaeQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;894&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;其中，Adtributor自动根因分析能计算出同一层级的维度中对指标异动贡献最大的那个因素，我们通过对指标维度进行分层和设置相互关系来适应具体的指标业务场景，构建起多层级归因算法逻辑模型，从而实现业务层面根因结论的自动化输出。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.49672591206735267&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt713f11iaViabMkQhb6HBK3J0aiaFS2VIABaQiagibTvWqAFnA9l6xd07cXEicZwcPpqFVsia04hsm3XbWoQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1069&quot;/&gt;&lt;/p&gt;&lt;p&gt;看板展示如下：&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5148148148148148&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt713f11iaViabMkQhb6HBK3J01NLbeyxPYB0YXc9AG3uEDdRLlOXmTCb6icOsW9ic3uTR4ibq4Z4Awwdxg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;4.3.4 灰度报告智能拼接推送方案&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.8861111111111111&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt713f11iaViabMkQhb6HBK3J0NyNI1fD38PQMvuwoSoF2ABacjy7Q4xFkUKwQwZXOIjfADzbgj2bmdw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;版本信息内容的自动获取：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;通过打通发版平台获取版本号、实际在装量、发版累计天数以及版本相关内容，作为灰度报告的开头。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;结论呈现：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;根据指标是否全正向/部分负向/全负向、是否样本不均匀等各种统计结果自动组合对应到预设的结论文案中，一共预设了10多种结论模版。  &lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;核心指标显著性检验解读&lt;/strong&gt;（根据灰度阶段不同，解读不同类型指标）：&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section/&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;下钻一级模块维度归因解读：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;如果灰度版本前期已明确输入具体到某个一级模块的改动点，会自动进行该模块的解读，以及输出其他有指标差异的模块的数据；如果灰度版本没有输入模块层面的改动点，就输出指标效果显著（正向显著、负向显著）的一级模块的解读结论。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;样本量均匀性解读：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;业务类指标，通过显著性检验判断是否分布均匀；非业务类指标，通过分布差异来判断。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;负向诊断解读：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;根据多层级自动化根因模型输出的结果，按照不同维度类型映射的修饰词、维度数量定位（单维度/多维度）以及样本历史差异性验证结论，对应不同的模版，最终拼接出负向诊断文案。&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;五、写在最后&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;对于业务灰度发版中科学评估和快速决策的要求，我们结合了多种方法，从“实验思想-数学方法-数据模型-产品方案”四个层面提供了一套较为完整的智能灰度数据体系解决方案。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;本文希望能为业务中的灰度数据体系建设提供参考，但仍应结合各业务自身的特点进行合理设计。方案中涉及的数据模型设计在这里不详细介绍，感兴趣的同学欢迎和笔者一起探讨学习。&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;此外，灰度数据体系仍有待改进之处，这里先抛出来，有一些也已经在研究解决中：&lt;/p&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;在灰度流量分组的时候，通常采用随机分组的方式。但是由于完全随机的不确定性，分完组后，2组样本在某些指标特性上可能天然就分布不均。相较于后置的样本均匀性验证的方法，也可考虑分层抽样的方式来避免这一问题；&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;在灰度指标分析的流程中，自动多维根因分析模型还存在提升的空间，目前模型非常依赖于本身数据源中维度的全面性，且只能检测出定量部分的原因。后续希望把定量的根因模型，结合定性因素进行更全面更准确的解读；&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;游戏中心目前整个灰度的解决方案本质上还是基于2 sample-test的检验模型，但该模型需要根据灰度版本相较于对比版本在核心指标上的预期提升，来提前估算最小样本量，实际灰度过程中可能会出现核心指标未达如预期的情况。未来可尝试mSPRT等检验方法，削弱最小样本量对显著性结果的限制。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;参考文献：&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;ol class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;茆诗松, 王静龙, 濮晓龙. 《高等数理统计（第二版）》&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;是老李没错了. 《五分钟掌握AB实验和样本量计算原理》. CSDN博客&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Ranjita Bhagwan, Rahul Kumar, Ramachandran Ramjee, et al. 《Adtributor: Revenue Debugging in Advertising Systems》&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;END&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;span title=&quot;&quot; opera-tn-ra-cell=&quot;_$.pages:0.layers:0.comps:124.title1&quot;&gt;&lt;p&gt;猜你喜欢&lt;/p&gt;&lt;/span&gt; &lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>8480e08c08381dab632cbf5af2843d14</guid>
<title>如何管理分布式团队？</title>
<link>https://toutiao.io/k/m8adr69</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content                                       &quot; id=&quot;js_content&quot;&gt;
            &lt;fieldset data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzkyNTI5NTQ1NQ==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/wxcY9TH8dPsYAnrjaZktBe0iahF8ic9QkF26cAw8pK6HPR1bfFEImdyJspvkQvQwmnYxP4eEVW60ewVVickcWXnrQ/0?wx_fmt=png&quot; data-nickname=&quot;架构文摘&quot; data-alias=&quot;ArchDigest&quot; data-signature=&quot;每天一篇架构领域重磅好文，涉及一线互联网公司应用架构（高可用、高性能、高稳定）、大数据、机器学习、Java架构等各个热门领域。&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;/fieldset&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;如今，寻找和雇用所有必要的人才来建立你的数字产品是具有挑战性的。因此，许多企业选择替代解决方案，并将其项目的某些部分外包。因此，他们可以扩大专业知识，实现更大的灵活性，提高生产力，并降低成本。在外包模式中，分布式软件开发团队是值得考虑的。这种模式涉及在其他地区、国家或大陆雇用远程专家。它使你能够进入全球IT人才库。因此，你可以选择可靠的技术合作伙伴，不受地域限制。分布式团队使用多种工具和技术进行沟通、规划和管理项目。这篇文章将分享管理分布式软件开发团队的工作流程时使用的见解、有价值的提示和高效的技术。   &lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YK9e7vHy9IQATwibKVicOpXZibX8VOvBrnF39NdpXQMwdpyIgN0ibicEwRdge0mXthxjHagHgwpWhrsibvMZFibaQC6vQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;14&quot;/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot; mpa-is-content=&quot;t&quot;&gt;分布式团队和远程工人之间的区别是什么？&lt;/p&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/orc2J6rib40bATuJM23UiaHQ0tsVpvjgyuhk7To5zFqb2fyL9pCr1U7hfeKJELCht0KxWnuias6TLibMdcRhM7QhyQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;14&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;在外包数字产品开发时，许多人对企业可以选择的各种模式之间的区别感到困惑。那么，建立一个分布式软件开发团队和雇用远程专家之间有什么区别？让我们澄清这些术语来了解一下。&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;远程团队&lt;/strong&gt;&lt;br/&gt;远程软件开发或虚拟团队是一群不在你办公室的员工，但被认为是你内部团队的一部分。他们通过聊天、视频通话和在线会议进行工作沟通。在大多数情况下，你仍然可以把你的核心团队留在办公室，把特定的任务委托给远程工人。因此，对工作流程的管理和控制仍然是你的责任。这意味着，你应该确保你的远程员工适应其文化。此外，你还必须进行入职培训，控制专家的职业发展，并与人力资源管理部门打交道，以保留你的团队成员。同时，对于分布式团队，你将不需要直接参与上述所有过程。相反，为你提供团队的供应商会承担起所有这些责任。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;分布式团队&lt;/strong&gt;&lt;br/&gt;分布式开发团队是一个典型的外包模式。它涉及到雇用几个供应商或独立承包商在不同地点工作。与虚拟团队不同，分布式团队不是集中的。他们中的每一个人都可能在项目的一个特定方面工作。项目经理确保良好的组织和对工作流程的控制。另外，分布式团队应该使用有效的沟通和协作工具，让所有的利益相关者和团队成员都能在同一起跑线上。简而言之，一个分布式团队与两家公司合作，每个人都做自己最擅长的事情。创业公司负责创意、战略、资金和其他商业流程，而供应商则负责人员配置、保留和实施你的创意。这样的角色分配往往是相当有帮助的。为什么呢？因为对最佳人才的竞争是非常激烈的。所以初创企业缺乏雇用和保留合适候选人的能力。 &lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YK9e7vHy9IQATwibKVicOpXZibX8VOvBrnF39NdpXQMwdpyIgN0ibicEwRdge0mXthxjHagHgwpWhrsibvMZFibaQC6vQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;14&quot;/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot; mpa-is-content=&quot;t&quot;&gt;&lt;strong&gt;分布式开发团队的好处是什么？&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/orc2J6rib40bATuJM23UiaHQ0tsVpvjgyuhk7To5zFqb2fyL9pCr1U7hfeKJELCht0KxWnuias6TLibMdcRhM7QhyQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;14&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;分布式模式可以获得更广泛的人员配置机会，对工作过程采取灵活的方法，以及团队的敏捷性，这在今天是非常需要的。为你的软件产品开发建立一个分布式团队的主要优势在这里。增加灵活性。分布式模式本身在人员配置和项目管理方面是灵活的。雇佣的供应商可以在没有客户参与的情况下增加所需的专业知识，因此在扩大项目规模时，你不会浪费时间和精力。广泛的人才库。快速增长的IT人才短缺是当今企业面临的关键挑战之一。而你可以通过分布式团队模式来解决这个问题，该模式提供了进入全球人才库的机会。敏捷的方法。敏捷方法涉及设定目标，并通过进行短期但高效的冲刺来更快地实现目标。分布式团队经常转向这种方法，争取更好地组织和适应需求的变化。成本效益。转向离岸供应商或建立一个分布式团队要比内部解决方案便宜得多。你可以投资于更紧急的业务需求，而不是大量的劳动力支出。生产力。分布式团队通过多种软件和工具组织充分的沟通流。它还可以促进各种流程，从项目管理到文件维护。有效的项目管理。分布式团队模式使客户不需要浪费时间来处理众多的管理问题。许多与人员配置、团队扩展、风险管理、积压更新等相关的小需求都在供应商那边执行。&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YK9e7vHy9IQATwibKVicOpXZibX8VOvBrnF39NdpXQMwdpyIgN0ibicEwRdge0mXthxjHagHgwpWhrsibvMZFibaQC6vQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;14&quot;/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot; mpa-is-content=&quot;t&quot;&gt;&lt;strong&gt;分布式团队管理的秘诀和黑科技&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/orc2J6rib40bATuJM23UiaHQ0tsVpvjgyuhk7To5zFqb2fyL9pCr1U7hfeKJELCht0KxWnuias6TLibMdcRhM7QhyQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;14&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;我们的团队在众多的项目中工作，以满足客户的期望和个人要求。我们的主要原则之一是让客户感觉到他们的内部团队和我们加入项目的远程专业人员之间没有区别。特别是，我们有在分布式软件开发团队模式下工作的经验。在处理这类项目时，我们已经开发了特定的战术和项目管理技术，并已证明其有效性。我想分享一些关于管理分布式开发团队的最有价值的见解。&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;最佳经验&lt;/strong&gt;&lt;br/&gt;我们所做的产品是用于监控和管理云资源的复杂软件。简而言之，这是一个努力促进DevOps工作的产品，为他们提供多种指标、系统健康检查、调试功能等。我们已经在这个项目上工作了两年多了。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;分布式团队由三部分组成：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;客户在美国的内部团队（超过20位专家，其中5或6位与我们保持联系）&lt;br/&gt;我们的团队（10名专家，包括5名开发人员）&lt;br/&gt;另一个来自东欧的团队（7名专家）&lt;br/&gt;我们的团队负责项目的用户界面和前端开发。因此，整体的分布式团队是相当大的，而项目是复杂的，并经历定期的变化。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;挑战和解决方案&lt;/strong&gt;&lt;br/&gt;由于客户的项目是一个初创公司，任务的分配造成了特殊的物流问题，直接影响到团队的互动。这很可能发生在项目的早期阶段，当时各团队还不习惯对方的方法，而且还存在具体的沟通问题。因此，我们的关键目标之一是与其他团队协调所有的计划和期望，以避免不必要的工作和给其他参与者带来麻烦。为了解决这个挑战，值得在像Swagger这样的工具中提前准备规范。它可以让所有分布在各地的团队成员更好地了解彼此的目标，从而解决一个有组织的工作流程。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;沟通流程&lt;/strong&gt;&lt;br/&gt;在最初的开发阶段，从事该项目的各团队之间存在着某些误解。然而，我们通过高质量的沟通和妥协解决了所有这些问题。为了工作流程的效率，团队成员应该尽其所能。建立良好的沟通是分布式团队成功的关键。我们开始使用电子邮件和Discord，但这些沟通方式被证明是不方便的，所以我们转移到Slack的共享工作空间。我们为以下目的创建了频道。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;我们团队的内部频道&lt;/strong&gt;&lt;br/&gt;一个用于与后台和API团队沟通的频道&lt;br/&gt;额外的频道，用于与经理们进行小组聊天。&lt;br/&gt;Slack是一个非常有益的工具，它可以帮助分布式团队把所有的东西放在一个地方，快速解决问题，并在所有的渠道中保持联系。此外，我们在客户方面使用Jira进行有效的项目管理。它还通过减少额外的电话和会议帮助我们节省时间。此外，我们没有把时间浪费在不必要的官僚主义上，而是直接给那些从事具体工作的人打上标签，没有决策者和等级制度的参与。此外，我们在聊天中调整了特定的机器人。它们在工作日结束时被触发，唤起跨团队的沟通。因此，问题在渠道中被立即讨论，这减少了对定期耗时会议的需求。最后，产品负责人向我们提供所有必要的信息并澄清问题点，包括与后台有关的要求和更新。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;会议和电话&lt;/strong&gt;&lt;br/&gt;在产品的测试版发布之前，我们每天都进行会议，提出问题，得到需求的澄清，并分享我们阻碍开发过程的问题。这种会议的主要目标是在挑战出现时立即解决，并立即报告开发进度。同时，这也是我们商定发布日期、冲刺计划、里程碑等的地方。此外，每隔两三天，我们会进行冲刺审查。这是必要的，因为工作范围的不断变化。在这样的会议上，我们实时纠正和更新冲刺计划。最后，我们定期与其他团队进行同步会议。我们在这些会议上讨论我们的共同问题，以确保每个人都在同一起跑线上。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;内部沟通流程&lt;/strong&gt;&lt;br/&gt;至于我们的内部沟通，我们一直保持着联系，并每天进行会议。其中两个是语音或视频电话，其他的是聊天，这样可以节省很多时间。此外，为了讨论一些小问题，必要时我们会发短信或打电话给对方。我们的团队成员在每周的技术会议上讨论所有的技术决定、库、方法等等。通常情况下，我们在聊天中钉上相关的问题，之后每个人都会讲述他们的进展、成就和失败。这使我们能够跟上与快速发展的项目有关的最新事件。还会设计一个两周的冲刺计划，钉在频道上，标明最后期限和负责该任务的团队成员。冲刺计划的审查每两三天就会进行一次。此外，开发人员讨论工作流程的挑战，建立重构计划，并在回顾性会议上讨论基本问题。如果需要的话，也可以召开讨论新功能、需求和任务分解的会议。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;以下是我们应用的其他一些做法，以改善我们团队中的沟通：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;blockquote&gt;&lt;section&gt;&lt;span&gt;在Github上设置带有标签的行动，以加速审查&lt;br/&gt;打私人电话来讨论紧急和关键的任务&lt;br/&gt;在聊天中告知其他团队成员我们的缺席或日程变化&lt;br/&gt;在项目的中间阶段展示当前的成果，以减少对工作范围的误解&lt;br/&gt;明确表达我们对冲刺阶段的期望&lt;br/&gt;对已实施的未达成一致的变化给出理由&lt;/span&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;团队管理&lt;/strong&gt;&lt;br/&gt;为了保持团队成员的工作效率和参与度，我们为他们的发展组织计划。每位员工每三个月与团队领导和经理有一次1-2-1的会议。我们讨论他们对当前任务的兴趣和在项目中发展的愿望。为每个新的团队成员提供一个负责他们有效入职的导师也是值得的。导师应该向新人解释业务逻辑、项目、团队和内部流程。这个指导过程可能会持续两个月之久。它可以帮助新成员感到更有信心和了解项目的具体情况。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;录制视频&lt;/strong&gt;&lt;br/&gt;最后，使用视频向分散的团队成员传递信息是有价值的。我们经常使用这种方法来向新员工解释项目的具体内容。项目经理录制视频，描述知识库应用程序的工作方式。我们将视频与关键团队的通话和关于新功能的讨论存储在一个私人的YouTube频道，而带有所有链接的基地则在Confluence中。&lt;span&gt;&lt;span&gt;我们选择YouTube是因为它有方便的标签，可以快速搜索。这种方法适用于任何任务。例如，你可以为未来的项目制作一个视频，演示设计布局的功能。然后，将制作布局的人可以观看这些功能是如何工作的，看到一些交互场景，并得到按钮的描述。&lt;/span&gt;&lt;/span&gt;&lt;span/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;另外，这种方法对于回顾会议来说也很方便。它可以帮助跟踪一个特定的功能是如何变化的，有哪些实现的想法被考虑过。其中一些可能没有被用于MVP，但对接下来的开发阶段是有帮助的。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;以下是录制此类视频的几个关键原因：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;blockquote&gt;&lt;section&gt;&lt;span&gt;它能够存储任何数据，不管接受这些数据的人是否还在公司工作。&lt;br/&gt;它有助于回答一般在开始时出现的问题，并引出更详细的问题，有助于新团队成员的沉浸感。&lt;br/&gt;问答环节能够在观看特定视频后实时提出更多问题。&lt;/span&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;section&gt;&lt;span&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YK9e7vHy9IQATwibKVicOpXZibX8VOvBrnF39NdpXQMwdpyIgN0ibicEwRdge0mXthxjHagHgwpWhrsibvMZFibaQC6vQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;14&quot;/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot; mpa-is-content=&quot;t&quot;&gt;&lt;strong&gt;如何让分布式开发团队的工作变得有利，而不是有压力&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/orc2J6rib40bATuJM23UiaHQ0tsVpvjgyuhk7To5zFqb2fyL9pCr1U7hfeKJELCht0KxWnuias6TLibMdcRhM7QhyQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;14&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;管理一个分布式开发团队需要一个完善的、细致的方法。乍一看，这样的模式可能看起来相当复杂和具有挑战性。然而，通过适当的组织、有效的项目管理以及强大的工具和技术，分布式团队模式为现代企业提供了许多机会和好处。有了经验丰富的技术伙伴和正确的管理方法，转向分布式团队模式将可能帮助你无痛而有效地实现你的商业目标。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section mp-original-font-size=&quot;16&quot; mp-original-line-height=&quot;28&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;section data-recommend-type=&quot;list-normal&quot; data-recommend-tid=&quot;2&quot; data-mpa-template=&quot;t&quot; data-mid=&quot;&quot; data-from=&quot;yb-recommend&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-normal&quot; data-recomment-template-id=&quot;2&quot; data-recommend-article-id=&quot;2247501257_1&quot; data-recommend-article-time=&quot;1636251616&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/zc3KLDBfJlm8bD2WBlwbvnsktMdtfSudNaJWbHr1Iyr6HkwCxETHiaiceaWYLmq7tWmHV29U8Xv8UnoeCAOYNj9Q/0?wx_fmt=jpeg&amp;amp;amp;random=0.27521905775014543&quot; data-recommend-article-title=&quot;强势开源一款小程序！&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501257&amp;amp;idx=1&amp;amp;sn=7b4e27cdb1d3146a5e7e1951b5bdc9e8&amp;amp;chksm=c1ca33f9f6bdbaefd3874fa6313e422c8fb6b2799b40d09f36620f0ceaed4fd63c820da1f3ff#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501257&amp;amp;idx=1&amp;amp;sn=7b4e27cdb1d3146a5e7e1951b5bdc9e8&amp;amp;chksm=c1ca33f9f6bdbaefd3874fa6313e422c8fb6b2799b40d09f36620f0ceaed4fd63c820da1f3ff&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;1&quot; wah-hotarea=&quot;click&quot;&gt;&lt;section data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;p data-recommend-title=&quot;t&quot; data-mid=&quot;&quot;&gt;强势开源一款小程序！&lt;/p&gt;&lt;p data-recommend-date=&quot;t&quot; data-mid=&quot;&quot;&gt;2021-11-07&lt;/p&gt;&lt;/section&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.42592592592592593&quot; data-type=&quot;jpeg&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zc3KLDBfJlm8bD2WBlwbvnsktMdtfSudNaJWbHr1Iyr6HkwCxETHiaiceaWYLmq7tWmHV29U8Xv8UnoeCAOYNj9Q/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-normal&quot; data-recomment-template-id=&quot;2&quot; data-recommend-article-id=&quot;2247501242_1&quot; data-recommend-article-time=&quot;1634952613&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7UWibGeSzVdcKHzDRdVHusb9CJicA5FdhDVPAiaicdTbibx5XoRkhKA3O7Q727cTSurBkJpciczjLrF2wkA/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;强力推荐一个完善的物流（WMS）管理项目（附代码）&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501242&amp;amp;idx=1&amp;amp;sn=aa2297b69874de0993f62ea404376bab&amp;amp;chksm=c1ca338af6bdba9cf3e051ff3001e1f31f9fa97350f3851c797d6486eca360df537196dbe67b#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501242&amp;amp;idx=1&amp;amp;sn=aa2297b69874de0993f62ea404376bab&amp;amp;chksm=c1ca338af6bdba9cf3e051ff3001e1f31f9fa97350f3851c797d6486eca360df537196dbe67b&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;1&quot; wah-hotarea=&quot;click&quot;&gt;&lt;section data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;p data-recommend-title=&quot;t&quot; data-mid=&quot;&quot;&gt;强力推荐一个完善的物流（WMS）管理项目（附代码）&lt;/p&gt;&lt;p data-recommend-date=&quot;t&quot; data-mid=&quot;&quot;&gt;2021-10-23&lt;/p&gt;&lt;/section&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.425&quot; data-type=&quot;jpeg&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7UWibGeSzVdcKHzDRdVHusb9CJicA5FdhDVPAiaicdTbibx5XoRkhKA3O7Q727cTSurBkJpciczjLrF2wkA/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-normal&quot; data-recomment-template-id=&quot;2&quot; data-recommend-article-id=&quot;2247501238_1&quot; data-recommend-article-time=&quot;1634606700&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7VduLA9tc9dQkaw5HWIV6pqNrOiciaE17jeIeTtoLfgLbyu67dWkRj3tjKX7AFIMrV0rKD5ic6kwicyxg/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;推荐一个 Spring Boot + MyBatis + Vue 音乐网站&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501238&amp;amp;idx=1&amp;amp;sn=d7e873d752a28b582d70bc9f7a981ddb&amp;amp;chksm=c1ca3386f6bdba9031ce115e734ce04c9b6728e8e027fbcf17d8d07f1e029ea5bea04f4a6273#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501238&amp;amp;idx=1&amp;amp;sn=d7e873d752a28b582d70bc9f7a981ddb&amp;amp;chksm=c1ca3386f6bdba9031ce115e734ce04c9b6728e8e027fbcf17d8d07f1e029ea5bea04f4a6273&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;1&quot; wah-hotarea=&quot;click&quot;&gt;&lt;section data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;p data-recommend-title=&quot;t&quot; data-mid=&quot;&quot;&gt;推荐一个 Spring Boot + MyBatis + Vue 音乐网站&lt;/p&gt;&lt;p data-recommend-date=&quot;t&quot; data-mid=&quot;&quot;&gt;2021-10-19&lt;/p&gt;&lt;/section&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.42592592592592593&quot; data-type=&quot;jpeg&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7VduLA9tc9dQkaw5HWIV6pqNrOiciaE17jeIeTtoLfgLbyu67dWkRj3tjKX7AFIMrV0rKD5ic6kwicyxg/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-normal&quot; data-recomment-template-id=&quot;2&quot; data-recommend-article-id=&quot;2247501208_1&quot; data-recommend-article-time=&quot;1632101100&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7VibcP3PNgQvXGZ7UJkVeu0JZsrldvF1urHlmNwhUP89IeKHz1PfJ12es2ArTwkYibAh3Y0soOib2rjA/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;分享一套家庭理财系统（附源码）&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501208&amp;amp;idx=1&amp;amp;sn=44fcdfe2d7f81a26845faf33750ea9bb&amp;amp;chksm=c1ca33a8f6bdbabec8ff34719f438465adf745cbef30bfb92be53897c714d8c13bdd01989d17#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501208&amp;amp;idx=1&amp;amp;sn=44fcdfe2d7f81a26845faf33750ea9bb&amp;amp;chksm=c1ca33a8f6bdbabec8ff34719f438465adf745cbef30bfb92be53897c714d8c13bdd01989d17&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;1&quot; wah-hotarea=&quot;click&quot;&gt;&lt;section data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;p data-recommend-title=&quot;t&quot; data-mid=&quot;&quot;&gt;分享一套家庭理财系统（附源码）&lt;/p&gt;&lt;p data-recommend-date=&quot;t&quot; data-mid=&quot;&quot;&gt;2021-09-20&lt;/p&gt;&lt;/section&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.42407407407407405&quot; data-type=&quot;jpeg&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7VibcP3PNgQvXGZ7UJkVeu0JZsrldvF1urHlmNwhUP89IeKHz1PfJ12es2ArTwkYibAh3Y0soOib2rjA/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-normal&quot; data-recomment-template-id=&quot;2&quot; data-recommend-article-id=&quot;2247501192_1&quot; data-recommend-article-time=&quot;1630718700&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7UG0pYPldneUCCVsPia3Rtr9j3hlFHakhItFlOXuwLicUqQvP1PhkTM28CUU9BpRCWfWPfHYredCBiaA/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;推荐一个互联网企业级别的开源支付系统&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501192&amp;amp;idx=1&amp;amp;sn=444404a565f02a8c532d291d99678a7b&amp;amp;chksm=c1ca33b8f6bdbaaeb7c65d9f6f0c399f609fb203f065b6e88a3ad5431473713dbb5ae3507b32#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501192&amp;amp;idx=1&amp;amp;sn=444404a565f02a8c532d291d99678a7b&amp;amp;chksm=c1ca33b8f6bdbaaeb7c65d9f6f0c399f609fb203f065b6e88a3ad5431473713dbb5ae3507b32&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;1&quot; wah-hotarea=&quot;click&quot;&gt;&lt;section data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;p data-recommend-title=&quot;t&quot; data-mid=&quot;&quot;&gt;推荐一个互联网企业级别的开源支付系统&lt;/p&gt;&lt;p data-recommend-date=&quot;t&quot; data-mid=&quot;&quot;&gt;2021-09-04&lt;/p&gt;&lt;/section&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.425&quot; data-type=&quot;jpeg&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7UG0pYPldneUCCVsPia3Rtr9j3hlFHakhItFlOXuwLicUqQvP1PhkTM28CUU9BpRCWfWPfHYredCBiaA/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-normal&quot; data-recomment-template-id=&quot;2&quot; data-recommend-article-id=&quot;2247501176_1&quot; data-recommend-article-time=&quot;1629509100&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7VQRwetNLhDOB2Ej0fDZK4eRXsYlRNicgmsWwmuvlhibooic3N3su1lbMQPqWD186JiaOC5yJ9iaaic8bzw/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;推荐一套开源通用后台管理系统（附源码）&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501176&amp;amp;idx=1&amp;amp;sn=68e3ae7a9dc33fbbd379906ddcefdf5b&amp;amp;chksm=c1ca3348f6bdba5e1774625745f5ef40081c9b8eb0189073734b6808efb872720781d25b8dc0#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501176&amp;amp;idx=1&amp;amp;sn=68e3ae7a9dc33fbbd379906ddcefdf5b&amp;amp;chksm=c1ca3348f6bdba5e1774625745f5ef40081c9b8eb0189073734b6808efb872720781d25b8dc0&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;1&quot; wah-hotarea=&quot;click&quot;&gt;&lt;section data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;p data-recommend-title=&quot;t&quot; data-mid=&quot;&quot;&gt;推荐一套开源通用后台管理系统（附源码）&lt;/p&gt;&lt;p data-recommend-date=&quot;t&quot; data-mid=&quot;&quot;&gt;2021-08-21&lt;/p&gt;&lt;/section&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4265625&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7VQRwetNLhDOB2Ej0fDZK4eRXsYlRNicgmsWwmuvlhibooic3N3su1lbMQPqWD186JiaOC5yJ9iaaic8bzw/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-normal&quot; data-recomment-template-id=&quot;2&quot; data-recommend-article-id=&quot;2247501153_1&quot; data-recommend-article-time=&quot;1627704022&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7UbyFoOMqOObokEYiahCar20LiaY8ZLGKzU7NYQQoGycgnhrmIzNJibPicGcNia3cbbXlYib6bcLJVV5aww/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;一款神仙接私活儿软件，吊到不行！&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501153&amp;amp;idx=1&amp;amp;sn=bb29cffa56431b72a92709c0ae993af7&amp;amp;chksm=c1ca3351f6bdba4729c671cdcd0ee8b6af75c6ce8a7003e6c032942b849aab5bfedecd0f9d3b#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501153&amp;amp;idx=1&amp;amp;sn=bb29cffa56431b72a92709c0ae993af7&amp;amp;chksm=c1ca3351f6bdba4729c671cdcd0ee8b6af75c6ce8a7003e6c032942b849aab5bfedecd0f9d3b&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;1&quot; wah-hotarea=&quot;click&quot;&gt;&lt;section data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;p data-recommend-title=&quot;t&quot; data-mid=&quot;&quot;&gt;一款神仙接私活儿软件，吊到不行！&lt;/p&gt;&lt;p data-recommend-date=&quot;t&quot; data-mid=&quot;&quot;&gt;2021-07-31&lt;/p&gt;&lt;/section&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4265625&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7UbyFoOMqOObokEYiahCar20LiaY8ZLGKzU7NYQQoGycgnhrmIzNJibPicGcNia3cbbXlYib6bcLJVV5aww/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-normal&quot; data-recomment-template-id=&quot;2&quot; data-recommend-article-id=&quot;2247501139_1&quot; data-recommend-article-time=&quot;1626571500&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7VGxZrbRFy96Sm9cXQzVEhiaLibUUYhYH1SJL4HUXenau3DCeq0KEOsguY4CWjaEd1BeAicJd24qFM2w/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;基于 SpringBoot 的仿豆瓣平台【源码分享】&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501139&amp;amp;idx=1&amp;amp;sn=f133e70bda8abae27459ccc4d3d6d8fd&amp;amp;chksm=c1ca3363f6bdba75b9a4145510d9b6108c56146a3146b2e2e6d660a08221618b01c815d55642#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501139&amp;amp;idx=1&amp;amp;sn=f133e70bda8abae27459ccc4d3d6d8fd&amp;amp;chksm=c1ca3363f6bdba75b9a4145510d9b6108c56146a3146b2e2e6d660a08221618b01c815d55642&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;1&quot; wah-hotarea=&quot;click&quot;&gt;&lt;section data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;p data-recommend-title=&quot;t&quot; data-mid=&quot;&quot;&gt;基于 SpringBoot 的仿豆瓣平台【源码分享】&lt;/p&gt;&lt;p data-recommend-date=&quot;t&quot; data-mid=&quot;&quot;&gt;2021-07-18&lt;/p&gt;&lt;/section&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.42427884615384615&quot; data-type=&quot;jpeg&quot; data-w=&quot;832&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7VGxZrbRFy96Sm9cXQzVEhiaLibUUYhYH1SJL4HUXenau3DCeq0KEOsguY4CWjaEd1BeAicJd24qFM2w/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-normal&quot; data-recomment-template-id=&quot;2&quot; data-recommend-article-id=&quot;2247501105_1&quot; data-recommend-article-time=&quot;1623979500&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7Xw68Ow8vZian4lanQFAu09f4JOZlXbC85jsByb8V6StkOpibAdgPamPWoPPY3G7S3nic50QvxxuGNrg/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;干掉 Wordpress！这个开源建站神器有点吊！&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501105&amp;amp;idx=1&amp;amp;sn=caf01186b6d2e4a38e940ce07d822238&amp;amp;chksm=c1ca3301f6bdba17ba7127da24e28963ae40f944e587f14b57405e2a9ee9d8cdbcb835c880c8#rd&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501105&amp;amp;idx=1&amp;amp;sn=caf01186b6d2e4a38e940ce07d822238&amp;amp;chksm=c1ca3301f6bdba17ba7127da24e28963ae40f944e587f14b57405e2a9ee9d8cdbcb835c880c8&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;1&quot; wah-hotarea=&quot;click&quot;&gt;&lt;section data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;p data-recommend-title=&quot;t&quot; data-mid=&quot;&quot;&gt;干掉 Wordpress！这个开源建站神器有点吊！&lt;/p&gt;&lt;p data-recommend-date=&quot;t&quot; data-mid=&quot;&quot;&gt;2021-06-18&lt;/p&gt;&lt;/section&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.42578125&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7Xw68Ow8vZian4lanQFAu09f4JOZlXbC85jsByb8V6StkOpibAdgPamPWoPPY3G7S3nic50QvxxuGNrg/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/a&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; data-recommend-article-type=&quot;list-normal&quot; data-recomment-template-id=&quot;2&quot; data-recommend-article-id=&quot;2247501098_2&quot; data-recommend-article-time=&quot;1623461160&quot; data-recommend-article-cover=&quot;http://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7VzIP6xibP6U8htKa7YEad1iaTE02ZbsOfvDX1D8LoTiaNsMVgdjFOdm5LahpnNXFe3ibSp8S4FJ39KkA/0?wx_fmt=jpeg&quot; data-recommend-article-title=&quot;从朋友那里搞了 20 个实战项目，速领！&quot; data-recommend-article-content-url=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501098&amp;amp;idx=2&amp;amp;sn=520b81839bb5b4f1c990278e03e1991d&amp;amp;chksm=c1ca331af6bdba0c0e3435da519fadda3be81744168e30c56a823180bd458a5ec8a6b499f2a4#rd&quot;&gt;&lt;section data-recommend-content=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;section data-mid=&quot;&quot;&gt;&lt;p data-recommend-title=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501098&amp;amp;idx=2&amp;amp;sn=520b81839bb5b4f1c990278e03e1991d&amp;amp;chksm=c1ca331af6bdba0c0e3435da519fadda3be81744168e30c56a823180bd458a5ec8a6b499f2a4&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot; wah-hotarea=&quot;click&quot;&gt;从朋友那里搞了 20 个实战项目，速领！&lt;/a&gt;&lt;/p&gt;&lt;p data-recommend-date=&quot;t&quot; data-mid=&quot;&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501098&amp;amp;idx=2&amp;amp;sn=520b81839bb5b4f1c990278e03e1991d&amp;amp;chksm=c1ca331af6bdba0c0e3435da519fadda3be81744168e30c56a823180bd458a5ec8a6b499f2a4&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot; wah-hotarea=&quot;click&quot;&gt;2021-06-12&lt;/a&gt;&lt;/p&gt;&lt;/section&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzkyNTI5NTQ1NQ==&amp;amp;mid=2247501098&amp;amp;idx=2&amp;amp;sn=520b81839bb5b4f1c990278e03e1991d&amp;amp;chksm=c1ca331af6bdba0c0e3435da519fadda3be81744168e30c56a823180bd458a5ec8a6b499f2a4&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;1&quot; wah-hotarea=&quot;click&quot;&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-type=&quot;jpeg&quot; data-w=&quot;200&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Baq5lYpIw7VzIP6xibP6U8htKa7YEad1iaTE02ZbsOfvDX1D8LoTiaNsMVgdjFOdm5LahpnNXFe3ibSp8S4FJ39KkA/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4703703703703704&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Baq5lYpIw7X6YPYGQITyP8Zdk96ab7CX0Ind5E05VokoepTP9Adic0xRwiaQrAvfTeC7iafngRibhBShpVqibqNcCCA/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;如有收获，点个在看，诚挚感谢&lt;/span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-fileid=&quot;100018364&quot; data-ratio=&quot;1&quot; data-type=&quot;png&quot; data-w=&quot;19&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54JM0xl7WLNGnqqwbcXQBWIOCMuOgPHRoOjMamXzrCqMS2xgOo5ibic9icPk7u3zsVgic3s1ZUYJ4xHXg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;
          &lt;/div&gt;

          

          



           
                                
                    
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>f3f40b796d0af43fe3a58971be2bf82d</guid>
<title>离线安装 Kubernetes 1.18.3 版本，万字教程，企业级部署！</title>
<link>https://toutiao.io/k/ey91eet</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;离线安装 Kubernetes 1.18.3 版本&lt;/h3&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;目录&lt;/h2&gt;&lt;h3/&gt;&lt;h3&gt;&lt;span&gt;&lt;strong&gt;一、Kubernetes 简介&lt;/strong&gt;&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;1.Kubernetes 架构设计图&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;2.Kubernetes 常见组件介绍&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;&lt;span&gt;&lt;strong&gt;二、Kubernetes 二进制方式安装&lt;/strong&gt;&lt;/span&gt;&lt;/h3&gt;&lt;h3&gt;&lt;strong/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;1.创建 CA 证书和密钥&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;2.安装 ETCD 组件&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;1、创建 ETCD 证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;2、生成证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;3、创建启动脚本&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4、启动 ETCD&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;3.安装 Flannel 网络插件&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;1、创建 Flannel 证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;2、生成证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;3、编写启动脚本&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4、启动并验证&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;4.安装 Docker 服务&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;5.安装 Kubectl 服务&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;1、创建 Admin 证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;3、生成证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4、创建 Kubeconfig 文件&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;5、创建 Kubectl 配置文件，并配置命令补全工具&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;三、安装 Kubenetes 相关组件&lt;/strong&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;1、安装 Kube-APIServer 组件&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;1、创建 Kubernetes 证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;2、生成证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;3、配置 Kube-APIServer 审计&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4、配置 Metrics-Server&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;5、创建启动脚本&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;6、启动 Kube-APIServer 并验证&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;2.安装 Controller Manager 组件&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;1、创建 Controller Manager 证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;2、生成证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;3、创建 Kubeconfig 文件&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4、创建启动脚本&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4、启动并验证&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;3.安装 Kube-Scheduler 组件&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;1、创建 Kube-Scheduler 证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;2、生成证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;3、创建 Kubeconfig 文件&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4、创建 Kube-Scheduler 配置文件&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;5、创建启动脚本&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;6、启动并验证&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;4.安装 Kubelet 组件&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;1、创建 Kubelet 启动脚本&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;2、启动并验证&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;3、Approve CSR 请求&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4、手动 Approve Server Cert Csr&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;5、Kubelet API 接口配置&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;5.安装 Kube-Proxy 组件&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;1、创建 Kube-Proxy 证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;2、生成证书和密钥&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;3、创建 Kubeconfig 文件&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4、创建 Kube-Proxy 配置文件&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4、创建启动脚本&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;5、启动并验证&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;6.安装 CoreDNS 插件&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;1、修改 Coredns 配置&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;2、创建 Coredns 并启动&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;3、验证&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;7.安装 Dashboard 仪表盘&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;1、创建证书&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;2、修改 Dashboard 配置&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;3、验证&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://mp.weixin.qq.com/s?__biz=MzI4NTM1NDgwNw==&amp;amp;mid=2247500365&amp;amp;idx=1&amp;amp;sn=7abfd8b30427d4ac15bb351c3dbb640c&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;注 意 文末有：7701页互联网大厂面试题 &quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;注 意&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;/a&gt;&lt;/section&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://mp.weixin.qq.com/s?__biz=MzI4NTM1NDgwNw==&amp;amp;mid=2247500365&amp;amp;idx=1&amp;amp;sn=7abfd8b30427d4ac15bb351c3dbb640c&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;注 意 文末有：7701页互联网大厂面试题 &quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;&lt;strong&gt; 文末有：7701页互联网大厂面试题 &lt;/strong&gt;&lt;/span&gt;&lt;/a&gt;&lt;/section&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;一、Kubernetes 简介&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Kubernetes，也称为 K8s，是由 Google 公司开源的容器集群管理系统，在 Docker 技术的基础上，为容器化的应用提供部署运行、资源调度、服务发现和动态伸缩等一系列完整功能，提高了大规模容器集群管理的便捷性。Kubernetes 官方&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;1.Kubernetes 架构设计图&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Kubernetes 是由一个 Master 和多个 Node 组成，Master 通过 API 提供服务，并接收 Kubectl 发送过来的请求来调度管理整个集群。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Kubectl 是 K8s 平台的管理命令。&lt;br/&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5254110612855007&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjCafjTHnCPZq0REHmHBc8on8C9K9VfeJMyxtltMbZWczroITAzLWExQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1338&quot;/&gt;&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.Kubernetes 常见组件介绍&lt;/h2&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;APIServer：&lt;/strong&gt; 所有服务的统一访问入口，并提供认证、授权、访问控制、API 注册和发现等机制；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;Controller Manager（控制器）：&lt;/strong&gt; 主要就是用来维持 Pod 的一个副本数，比如故障检测、自动扩展、滚动更新等；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;Scheduler（调度器）：&lt;/strong&gt; 主要就是用来分配任务到合适的节点上（资源调度）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;ETCD：&lt;/strong&gt; 键值对数据库，存放了 K8s 集群中所有的重要信息（持久化）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;Kubelet：&lt;/strong&gt; 直接和容器引擎交互，用来维护容器的一个生命周期；同时也负责 Volume（CVI）和网络（CNI）的管理；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;Kube-Porxy：&lt;/strong&gt; 用于将规则写入至 iptables 或 IPVS 来实现服务的映射访问；&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;其它组件：&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;CoreDNS：主要就是用来给 K8s 的 Service 提供一个域名和 IP 的对应解析关系。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Dashboard：主要就是用来给 K8s 提供一个 B/S 结构的访问体系（即，我们可以通过 Web 界面来对 K8s 进行管理）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Ingress Controller：主要就是用来实现 HTTP 代理（七层），官方的 Service 仅支持 TCP\UDP 代理（四层）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Prometheus：主要就是用来给 K8s 提供一个监控能力，使我们能够更加清晰的看到 K8s 相关组件及 Pod 的使用情况。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ELK：主要就是用来给 K8s 提供一个日志分析平台。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;Kubernetes 工作原理：&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;用户可以通过 Kubectl 命令来提交需要运行的 Docker Container 到 K8s 的 APIServer 组件中；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;接着 APIServer 接收到用户提交的请求后，会将请求存储到 ETCD 这个键值对存储中；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;然后由 Controller Manager 组件来创建出用户定义的控制器类型（Pod ReplicaSet Deployment DaemonSet 等）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;然后 Scheduler 组件会对 ETCD 进行扫描，并将用户需要运行的 Docker Container 分配到合适的主机上；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;最后由 Kubelet 组件来和 Docker 容器进行交互，创建、删除、停止容器等一系列操作。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;kube-proxy&lt;/code&gt; 主要就是为 Service 提供服务的，来实现内部从 Pod 到 Service 和外部 NodePort 到 Service 的访问。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;二、Kubernetes 二进制方式安装&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们下面的安装方式就是单纯的使用二进制方式安装，并没有对 Kube-APIServer 组件进行高可用配置，因为像我们安装 K8s 的话，其实主要还是为了学习 K8s，通过 K8s 来完成某些事情，所以并不需要关心高可用这块的东西。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;要是对Kubernetes 做高可用的话，其实并不难，像一些在云上的 K8s，一般都是通过 SLB 来代理到两台不同服务器上，来实现高可用；而像云下的 K8s，基本上也是如上，我们可以通过 Keepalived 加 Nginx 来实现高可用。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;准备工作：&lt;/p&gt;&lt;table data-tool=&quot;mdnice编辑器&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th align=&quot;left&quot;&gt;主机名&lt;/th&gt;&lt;th align=&quot;left&quot;&gt;操作系统&lt;/th&gt;&lt;th align=&quot;left&quot;&gt;IP 地址&lt;/th&gt;&lt;th align=&quot;left&quot;&gt;所需组件&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td align=&quot;left&quot;&gt;&lt;code&gt;k8s-master01&lt;/code&gt;&lt;/td&gt;&lt;td align=&quot;left&quot;&gt;CentOS 7.4&lt;/td&gt;&lt;td align=&quot;left&quot;&gt;192.168.1.1&lt;/td&gt;&lt;td align=&quot;left&quot;&gt;所有组件都安装 &lt;strong&gt;（合理利用资源）&lt;/strong&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align=&quot;left&quot;&gt;&lt;code&gt;k8s-master02&lt;/code&gt;&lt;/td&gt;&lt;td align=&quot;left&quot;&gt;CentOS 7.4&lt;/td&gt;&lt;td align=&quot;left&quot;&gt;192.168.1.2&lt;/td&gt;&lt;td align=&quot;left&quot;&gt;所有组件都安装&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align=&quot;left&quot;&gt;&lt;code&gt;k8s-node&lt;/code&gt;&lt;/td&gt;&lt;td align=&quot;left&quot;&gt;CentOS 7.4&lt;/td&gt;&lt;td align=&quot;left&quot;&gt;192.168.1.3&lt;/td&gt;&lt;td align=&quot;left&quot;&gt;&lt;code&gt;docker&lt;/code&gt; &lt;code&gt;kubelet&lt;/code&gt; &lt;code&gt;kube-proxy&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;1）在各个节点上配置主机名，并配置 Hosts 文件&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@ddkk&lt;/span&gt;.com ~]# hostnamectl set-hostname k8s-master01&lt;br/&gt;[root&lt;span&gt;@ddkk&lt;/span&gt;.com ~]# bash&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# cat &amp;lt;&amp;lt;END &amp;gt;&amp;gt; /etc/hosts&lt;br/&gt;&lt;span&gt;192.168.1.1&lt;/span&gt; k8s-master01&lt;br/&gt;&lt;span&gt;192.168.1.2&lt;/span&gt; k8s-master02&lt;br/&gt;&lt;span&gt;192.168.1.3&lt;/span&gt; k8s-node01&lt;br/&gt;END&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;2）在&lt;code&gt;k8s-master01&lt;/code&gt; 上配置 SSH 密钥对，并将公钥发送给其余主机&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# ssh-keygen -t rsa            # 三连回车&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# ssh-copy-id root@&lt;span&gt;192.168.1.1&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# ssh-copy-id root@&lt;span&gt;192.168.1.2&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# ssh-copy-id root@&lt;span&gt;192.168.1.3&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;3）编写 K8s 初始环境脚本&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# vim k8s-init.sh&lt;br/&gt;#!/bin/bash&lt;br/&gt;#****************************************************************#&lt;br/&gt;# ScriptName: k8s-init.sh&lt;br/&gt;# Initialize the machine. This needs to be executed on every machine.&lt;br/&gt;# Mkdir k8s directory&lt;br/&gt;yum -y install wget ntpdate &amp;amp;&amp;amp; ntpdate ntp1.aliyun.com&lt;br/&gt;wget -O /etc/yum.repos.d/CentOS-Base.repo https:&lt;span&gt;//mirrors.aliyun.com/repo/Centos-7.repo&lt;/span&gt;&lt;br/&gt;yum -y install epel-release&lt;br/&gt;mkdir -p /opt/k8s/bin/&lt;br/&gt;mkdir -p /data/k8s/docker&lt;br/&gt;mkdir -p /data/k8s/k8s&lt;br/&gt;# Disable the SELinux.&lt;br/&gt;swapoff -a&lt;br/&gt;sed -i &lt;span&gt;&#x27;/swap/s/^/#/&#x27;&lt;/span&gt; /etc/fstab&lt;br/&gt;# Turn off and disable the firewalld.&lt;br/&gt;systemctl stop firewalld&lt;br/&gt;systemctl disable firewalld&lt;br/&gt;# Modify related kernel parameters &amp;amp; Disable the swap.&lt;br/&gt;cat &amp;gt; /etc/sysctl.d/k8s.conf &amp;lt;&amp;lt; EOF&lt;br/&gt;net.ipv4.ip_forward = &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;net.bridge.bridge-nf-call-ip6tables = &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;net.bridge.bridge-nf-call-iptables = &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;net.ipv4.tcp_tw_recycle = &lt;span&gt;0&lt;/span&gt;&lt;br/&gt;vm.swappiness = &lt;span&gt;0&lt;/span&gt;&lt;br/&gt;vm.overcommit_memory = &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;vm.panic_on_oom = &lt;span&gt;0&lt;/span&gt;&lt;br/&gt;net.ipv6.conf.all.disable_ipv6 = &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;EOF&lt;br/&gt;sysctl -p /etc/sysctl.d/k8s.conf &amp;gt;&amp;amp; /dev/&lt;span&gt;null&lt;/span&gt;&lt;br/&gt;# Add ipvs modules&lt;br/&gt;cat &amp;gt; /etc/sysconfig/modules/ipvs.modules &amp;lt;&amp;lt; EOF&lt;br/&gt;#!/bin/bash&lt;br/&gt;modprobe -- ip_vs&lt;br/&gt;modprobe -- ip_vs_rr&lt;br/&gt;modprobe -- ip_vs_wrr&lt;br/&gt;modprobe -- ip_vs_sh&lt;br/&gt;modprobe -- br_netfilter&lt;br/&gt;modprobe -- nf_conntrack&lt;br/&gt;modprobe -- nf_conntrack_ipv4&lt;br/&gt;EOF&lt;br/&gt;chmod &lt;span&gt;755&lt;/span&gt; /etc/sysconfig/modules/ipvs.modules&lt;br/&gt;source /etc/sysconfig/modules/ipvs.modules&lt;br/&gt;# Install rpm&lt;br/&gt;yum install -y conntrack ntpdate ntp ipvsadm ipset jq iptables curl sysstat libseccomp wget gcc gcc-c++ make libnl libnl-devel libnfnetlink-devel openssl-devel vim openssl-devel bash-completion&lt;br/&gt;# ADD k8s bin to PATH&lt;br/&gt;echo &lt;span&gt;&#x27;export PATH=/opt/k8s/bin:$PATH&#x27;&lt;/span&gt; &amp;gt;&amp;gt; /root/.bashrc &amp;amp;&amp;amp; chmod +x /root/.bashrc &amp;amp;&amp;amp; source /root/.bashrc&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# bash k8s-init.sh&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;4）配置环境变量&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# vim environment.sh&lt;br/&gt;#!/bin/bash&lt;br/&gt;# 生成 EncryptionConfig 所需的加密 Key&lt;br/&gt;export ENCRYPTION_KEY=$(head -c &lt;span&gt;32&lt;/span&gt; /dev/urandom | base64)&lt;br/&gt;&lt;br/&gt;# 集群 Master 机器 IP 数组&lt;br/&gt;export MASTER_IPS=(&lt;span&gt;192.168.1.1&lt;/span&gt; &lt;span&gt;192.168.1.2&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;# 集群 Master IP 对应的主机名数组&lt;br/&gt;export MASTER_NAMES=(k8s-master01 k8s-master02)&lt;br/&gt;&lt;br/&gt;# 集群 Node 机器 IP 数组&lt;br/&gt;export NODE_IPS=(&lt;span&gt;192.168.1.3&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;# 集群 Node IP 对应的主机名数组&lt;br/&gt;export NODE_NAMES=(k8s-node01)&lt;br/&gt;&lt;br/&gt;# 集群所有机器 IP 数组&lt;br/&gt;export ALL_IPS=(&lt;span&gt;192.168.1.1&lt;/span&gt; &lt;span&gt;192.168.1.2&lt;/span&gt; &lt;span&gt;192.168.1.3&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;# 集群所有 IP 对应的主机名数组&lt;br/&gt;export ALL_NAMES=(k8s-master01 k8s-master02 k8s-node01)&lt;br/&gt;&lt;br/&gt;# Etcd 集群服务地址列表&lt;br/&gt;export ETCD_ENDPOINTS=&lt;span&gt;&quot;https://192.168.1.1:2379,https://192.168.1.2:2379&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# Etcd 集群间通信的 IP 和端口&lt;br/&gt;export ETCD_NODES=&lt;span&gt;&quot;k8s-master01=https://192.168.1.1:2380,k8s-master02=https://192.168.1.2:2380&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# Kube-apiserver 的 IP 和端口&lt;br/&gt;export KUBE_APISERVER=&lt;span&gt;&quot;https://192.168.1.1:6443&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# 节点间互联网络接口名称&lt;br/&gt;export IFACE=&lt;span&gt;&quot;ens32&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# Etcd 数据目录&lt;br/&gt;export ETCD_DATA_DIR=&lt;span&gt;&quot;/data/k8s/etcd/data&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# Etcd WAL 目录. 建议是 SSD 磁盘分区. 或者和 ETCD_DATA_DIR 不同的磁盘分区&lt;br/&gt;export ETCD_WAL_DIR=&lt;span&gt;&quot;/data/k8s/etcd/wal&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# K8s 各组件数据目录&lt;br/&gt;export K8S_DIR=&lt;span&gt;&quot;/data/k8s/k8s&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# Docker 数据目录&lt;br/&gt;export DOCKER_DIR=&lt;span&gt;&quot;/data/k8s/docker&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;## 以下参数一般不需要修改&lt;br/&gt;# TLS Bootstrapping 使用的 Token. 可以使用命令 head -c &lt;span&gt;16&lt;/span&gt; /dev/urandom | od -An -t x | tr -d &lt;span&gt;&#x27; &#x27;&lt;/span&gt; 生成&lt;br/&gt;BOOTSTRAP_TOKEN=&lt;span&gt;&quot;41f7e4ba8b7be874fcff18bf5cf41a7c&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# 最好使用当前未用的网段来定义服务网段和 Pod 网段&lt;br/&gt;# 服务网段. 部署前路由不可达. 部署后集群内路由可达(kube-proxy 保证)&lt;br/&gt;SERVICE_CIDR=&lt;span&gt;&quot;10.20.0.0/16&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# Pod 网段. 建议 /&lt;span&gt;16&lt;/span&gt; 段地址. 部署前路由不可达. 部署后集群内路由可达(flanneld 保证)&lt;br/&gt;CLUSTER_CIDR=&lt;span&gt;&quot;10.10.0.0/16&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# 服务端口范围 (NodePort Range)&lt;br/&gt;export NODE_PORT_RANGE=&lt;span&gt;&quot;1-65535&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# Flanneld 网络配置前缀&lt;br/&gt;export FLANNEL_ETCD_PREFIX=&lt;span&gt;&quot;/kubernetes/network&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# Kubernetes 服务 IP (一般是 SERVICE_CIDR 中第一个 IP)&lt;br/&gt;export CLUSTER_KUBERNETES_SVC_IP=&lt;span&gt;&quot;10.20.0.1&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# 集群 DNS 服务 IP (从 SERVICE_CIDR 中预分配)&lt;br/&gt;export CLUSTER_DNS_SVC_IP=&lt;span&gt;&quot;10.20.0.254&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# 集群 DNS 域名(末尾不带点号)&lt;br/&gt;export CLUSTER_DNS_DOMAIN=&lt;span&gt;&quot;cluster.local&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;# 将二进制目录 /opt/k8s/bin 加到 PATH 中&lt;br/&gt;export PATH=/opt/k8s/bin:$PATH&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;上面像那些 IP 地址和网卡啥的，你们要改成自身对应的信息。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# chmod +x environment.sh &amp;amp;&amp;amp; source environment.sh&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下面的这些操作，我们只需要在 &lt;code&gt;k8s-master01&lt;/code&gt; 主机上操作即可（因为下面我们会通过 &lt;code&gt;for&lt;/code&gt; 循环来发送到其余主机上）&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;1.创建 CA 证书和密钥&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;因为Kubernetes 系统的各个组件需要使用 TLS 证书对其通信加密以及授权认证，所以我们需要在安装前先生成相关的 TLS 证书；我们可以使用 &lt;code&gt;openssl&lt;/code&gt; &lt;code&gt;cfssl&lt;/code&gt; &lt;code&gt;easyrsa&lt;/code&gt; 来生成 Kubernetes 的相关证书，我们下面使用的是 &lt;code&gt;cfssl&lt;/code&gt; 方式。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;1）安装 &lt;code&gt;cfssl&lt;/code&gt; 工具集&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# mkdir -p /opt/k8s/cert&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# curl -L https:&lt;span&gt;//pkg.cfssl.org/R1.2/cfssl_linux-amd64 -o /opt/k8s/bin/cfssl&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# curl -L https:&lt;span&gt;//pkg.cfssl.org/R1.2/cfssljson_linux-amd64 -o /opt/k8s/bin/cfssljson&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# curl -L https:&lt;span&gt;//pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 -o /opt/k8s/bin/cfssl-certinfo&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# chmod +x /opt/k8s/bin&lt;span&gt;/*&lt;br/&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;2）创建根证书配置文件&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# mkdir -p /opt/k8s/work&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# cd /opt/k8s/work/&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; ca-config.json &amp;lt;&amp;lt; EOF&lt;br/&gt;{&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;    &lt;span&gt;&quot;signing&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;        &lt;span&gt;&quot;default&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;            &lt;span&gt;&quot;expiry&quot;&lt;/span&gt;: &lt;span&gt;&quot;876000h&quot;&lt;/span&gt;&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;&quot;profiles&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;            &lt;span&gt;&quot;kubernetes&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;                &lt;span&gt;&quot;expiry&quot;&lt;/span&gt;: &lt;span&gt;&quot;876000h&quot;&lt;/span&gt;,&lt;br/&gt;                &lt;span&gt;&quot;usages&quot;&lt;/span&gt;: [&lt;br/&gt;                    &lt;span&gt;&quot;signing&quot;&lt;/span&gt;,&lt;br/&gt;                    &lt;span&gt;&quot;key encipherment&quot;&lt;/span&gt;,&lt;br/&gt;                    &lt;span&gt;&quot;server auth&quot;&lt;/span&gt;,&lt;br/&gt;                    &lt;span&gt;&quot;client auth&quot;&lt;/span&gt;&lt;br/&gt;                ]&lt;br/&gt;            }&lt;br/&gt;        }&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;signing：表示当前证书可用于签名其它证书；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;server auth：表示 Client 可以用这个 CA 对 Server 提供的证书进行校验；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;client auth：表示 Server 可以用这个 CA 对 Client 提供的证书进行验证；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&quot;expiry&quot;: &quot;876000h&quot;：表示当前证书有效期为 100 年；&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;3）创建根证书签名请求文件&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; ca-csr.json &amp;lt;&amp;lt; EOF&lt;br/&gt;{&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;    &lt;span&gt;&quot;CN&quot;&lt;/span&gt;: &lt;span&gt;&quot;kubernetes&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;key&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;        &lt;span&gt;&quot;algo&quot;&lt;/span&gt;: &lt;span&gt;&quot;rsa&quot;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;&quot;size&quot;&lt;/span&gt;: &lt;span&gt;2048&lt;/span&gt;&lt;br/&gt;    },&lt;br/&gt;    &lt;span&gt;&quot;names&quot;&lt;/span&gt;: [&lt;br/&gt;        {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;            &lt;span&gt;&quot;C&quot;&lt;/span&gt;: &lt;span&gt;&quot;CN&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;ST&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;L&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;O&quot;&lt;/span&gt;: &lt;span&gt;&quot;k8s&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;OU&quot;&lt;/span&gt;: &lt;span&gt;&quot;System&quot;&lt;/span&gt;&lt;br/&gt;        }&lt;br/&gt;    ],&lt;br/&gt;    &lt;span&gt;&quot;ca&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;        &lt;span&gt;&quot;expiry&quot;&lt;/span&gt;: &lt;span&gt;&quot;876000h&quot;&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;CN：Kube-APIServer 将会把这个字段作为请求的用户名，来让浏览器验证网站是否合法。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;C：&lt;strong&gt;国家&lt;/strong&gt;；ST：&lt;strong&gt;州，省&lt;/strong&gt;；L：&lt;strong&gt;地区，城市&lt;/strong&gt;；O：&lt;strong&gt;组织名称，公司名称&lt;/strong&gt;；OU：&lt;strong&gt;组织单位名称，公司部门。&lt;/strong&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;4）生成 CA 密钥 &lt;code&gt;ca-key.pem&lt;/code&gt; 和证书 &lt;code&gt;ca.pem&lt;/code&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cfssl gencert -initca ca-csr.json | cfssljson -bare ca&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;生成证书后，因为 Kubernetes 集群需要 &lt;strong&gt;双向 TLS 认证&lt;/strong&gt;，所以我们可以将生成的文件传送到所有主机中。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;5）使用 &lt;code&gt;for&lt;/code&gt; 循环来遍历数组，将配置发送给所有主机&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_ip} &lt;span&gt;&quot;mkdir -p /etc/kubernetes/cert&quot;&lt;/span&gt;&lt;br/&gt;    scp ca*.pem ca-config.json root@${&lt;br/&gt;   &lt;br/&gt;     all_ip}:/etc/kubernetes/cert&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.安装 ETCD 组件&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;ETCD 是基于 Raft 的分布式 &lt;code&gt;key-value&lt;/code&gt; 存储系统，由 CoreOS 开发，常用于服务发现、共享配置以及并发控制（如 &lt;code&gt;leader&lt;/code&gt; 选举、分布式锁等）；Kubernetes 主要就是用 ETCD 来存储所有的运行数据。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下载ETCD&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# wget https:&lt;span&gt;//github.com/etcd-io/etcd/releases/download/v3.3.22/etcd-v3.3.22-linux-amd64.tar.gz&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# tar -zxf etcd-v3&lt;span&gt;.3.22&lt;/span&gt;-linux-amd64.tar.gz&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp etcd-v3&lt;span&gt;.3.22&lt;/span&gt;-linux-amd64/etcd* root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/opt/k8s/bin&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;chmod +x /opt/k8s/bin/*&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1）创建 ETCD 证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; etcd-csr.json &amp;lt;&amp;lt; EOF&lt;br/&gt;{&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;    &lt;span&gt;&quot;CN&quot;&lt;/span&gt;: &lt;span&gt;&quot;etcd&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;hosts&quot;&lt;/span&gt;: [&lt;br/&gt;        &lt;span&gt;&quot;127.0.0.1&quot;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;&quot;192.168.1.1&quot;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;&quot;192.168.1.2&quot;&lt;/span&gt;&lt;br/&gt;  ],&lt;br/&gt;    &lt;span&gt;&quot;key&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;        &lt;span&gt;&quot;algo&quot;&lt;/span&gt;: &lt;span&gt;&quot;rsa&quot;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;&quot;size&quot;&lt;/span&gt;: &lt;span&gt;2048&lt;/span&gt;&lt;br/&gt;    },&lt;br/&gt;    &lt;span&gt;&quot;names&quot;&lt;/span&gt;: [&lt;br/&gt;        {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;            &lt;span&gt;&quot;C&quot;&lt;/span&gt;: &lt;span&gt;&quot;CN&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;ST&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;L&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;O&quot;&lt;/span&gt;: &lt;span&gt;&quot;k8s&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;OU&quot;&lt;/span&gt;: &lt;span&gt;&quot;System&quot;&lt;/span&gt;&lt;br/&gt;        }&lt;br/&gt;    ]&lt;br/&gt;}&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;hosts：用来指定给 ETCD 授权的 IP 地址或域名列表。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;2）生成证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cfssl gencert -ca=/opt/k8s/work/ca.pem -ca-key=/opt/k8s/work/ca-key.pem -config=/opt/k8s/work/ca-config.json -profile=kubernetes etcd-csr.json | cfssljson -bare etcd&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;mkdir -p /etc/etcd/cert&quot;&lt;/span&gt;&lt;br/&gt;    scp etcd*.pem root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/etcd/cert/&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;3）创建启动脚本&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; etcd.service.template &amp;lt;&amp;lt; EOF&lt;br/&gt;[Unit]&lt;br/&gt;Description=Etcd Server&lt;br/&gt;After=network.target&lt;br/&gt;After=network-online.target&lt;br/&gt;Wants=network-online.target&lt;br/&gt;Documentation=https:&lt;span&gt;//github.com/coreos&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;[Service]&lt;br/&gt;Type=notify&lt;br/&gt;WorkingDirectory=${&lt;br/&gt;   &lt;br/&gt;     ETCD_DATA_DIR}&lt;br/&gt;ExecStart=/opt/k8s/bin/etcd \\&lt;br/&gt;  --enable-v2=&lt;span&gt;true&lt;/span&gt; \\&lt;br/&gt;  --data-dir=${&lt;br/&gt;   &lt;br/&gt;     ETCD_DATA_DIR} \\&lt;br/&gt;  --wal-dir=${&lt;br/&gt;   &lt;br/&gt;     ETCD_WAL_DIR} \\&lt;br/&gt;  --name=##MASTER_NAME## \\&lt;br/&gt;  --cert-file=/etc/etcd/cert/etcd.pem \\&lt;br/&gt;  --key-file=/etc/etcd/cert/etcd-key.pem \\&lt;br/&gt;  --trusted-ca-file=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --peer-cert-file=/etc/etcd/cert/etcd.pem \\&lt;br/&gt;  --peer-key-file=/etc/etcd/cert/etcd-key.pem \\&lt;br/&gt;  --peer-trusted-ca-file=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --peer-client-cert-auth \\&lt;br/&gt;  --client-cert-auth \\&lt;br/&gt;  --listen-peer-urls=https:&lt;span&gt;//##MASTER_IP##:2380 \\&lt;/span&gt;&lt;br/&gt;  --initial-advertise-peer-urls=https:&lt;span&gt;//##MASTER_IP##:2380 \\&lt;/span&gt;&lt;br/&gt;  --listen-client-urls=https:&lt;span&gt;//##MASTER_IP##:2379,http://127.0.0.1:2379 \\&lt;/span&gt;&lt;br/&gt;  --advertise-client-urls=https:&lt;span&gt;//##MASTER_IP##:2379 \\&lt;/span&gt;&lt;br/&gt;  --initial-cluster-token=etcd-cluster-&lt;span&gt;0&lt;/span&gt; \\&lt;br/&gt;  --initial-cluster=${&lt;br/&gt;   &lt;br/&gt;     ETCD_NODES} \\&lt;br/&gt;  --initial-cluster-state=&lt;span&gt;new&lt;/span&gt; \\&lt;br/&gt;  --auto-compaction-mode=periodic \\&lt;br/&gt;  --auto-compaction-retention=&lt;span&gt;1&lt;/span&gt; \\&lt;br/&gt;  --max-request-bytes=&lt;span&gt;33554432&lt;/span&gt; \\&lt;br/&gt;  --quota-backend-bytes=&lt;span&gt;6442450944&lt;/span&gt; \\&lt;br/&gt;  --heartbeat-interval=&lt;span&gt;250&lt;/span&gt; \\&lt;br/&gt;  --election-timeout=&lt;span&gt;2000&lt;/span&gt;&lt;br/&gt;Restart=on-failure&lt;br/&gt;RestartSec=&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;LimitNOFILE=&lt;span&gt;65536&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;[Install]&lt;br/&gt;WantedBy=multi-user.target&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; (( A=&lt;span&gt;0&lt;/span&gt;; A &amp;lt; &lt;span&gt;2&lt;/span&gt;; A++ ))&lt;br/&gt;&lt;span&gt;do&lt;/span&gt;&lt;br/&gt;sed -e &lt;span&gt;&quot;s/##MASTER_NAME##/${MASTER_NAMES[A]}/&quot;&lt;/span&gt; -e &lt;span&gt;&quot;s/##MASTER_IP##/${MASTER_IPS[A]}/&quot;&lt;/span&gt; etcd.service.template &amp;gt; etcd-${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[A]}.service&lt;br/&gt;done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;4）启动 ETCD&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp etcd-${&lt;br/&gt;   &lt;br/&gt;     master_ip}.service root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/systemd/system/etcd.service&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;mkdir -p ${ETCD_DATA_DIR} ${ETCD_WAL_DIR}&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;systemctl daemon-reload &amp;amp;&amp;amp; systemctl enable etcd &amp;amp;&amp;amp; systemctl restart etcd&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查看ETCD 当前的 Leader（领导）&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# ETCDCTL_API=&lt;span&gt;3&lt;/span&gt; /opt/k8s/bin/etcdctl \&lt;br/&gt;-w table --cacert=/etc/kubernetes/cert/ca.pem \&lt;br/&gt;--cert=/etc/etcd/cert/etcd.pem \&lt;br/&gt;--key=/etc/etcd/cert/etcd-key.pem \&lt;br/&gt;--endpoints=${&lt;br/&gt;   &lt;br/&gt;     ETCD_ENDPOINTS} endpoint status&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.2901155327342747&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjpq5FBsuQT8KKhc4muTOU5KnDaia8qrWLdjBACCPibHqgrvfd9B1qBk8Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1558&quot;/&gt;&lt;figcaption&gt; &lt;/figcaption&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;3.安装 Flannel 网络插件&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Flannel 是一种基于 &lt;code&gt;overlay&lt;/code&gt; 网络的跨主机容器网络解决方案，也就是将 TCP 数据封装在另一种网络包里面进行路由转发和通信。Flannel 是使用 Go 语言开发的，主要就是用来让不同主机内的容器实现互联。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下载Flannel&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# mkdir flannel&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# wget https:&lt;span&gt;//github.com/coreos/flannel/releases/download/v0.11.0/flannel-v0.11.0-linux-amd64.tar.gz&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# tar -zxf flannel-v0&lt;span&gt;.11.0&lt;/span&gt;-linux-amd64.tar.gz -C flannel&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp flannel/{&lt;br/&gt;   &lt;br/&gt;     flanneld,mk-docker-opts.sh} root@${&lt;br/&gt;   &lt;br/&gt;     all_ip}:/opt/k8s/bin/&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_ip} &lt;span&gt;&quot;chmod +x /opt/k8s/bin/*&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1）创建 Flannel 证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; flanneld-csr.json &amp;lt;&amp;lt; EOF&lt;br/&gt;{&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;    &lt;span&gt;&quot;CN&quot;&lt;/span&gt;: &lt;span&gt;&quot;flanneld&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;hosts&quot;&lt;/span&gt;: [],&lt;br/&gt;    &lt;span&gt;&quot;key&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;        &lt;span&gt;&quot;algo&quot;&lt;/span&gt;: &lt;span&gt;&quot;rsa&quot;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;&quot;size&quot;&lt;/span&gt;: &lt;span&gt;2048&lt;/span&gt;&lt;br/&gt;    },&lt;br/&gt;    &lt;span&gt;&quot;names&quot;&lt;/span&gt;: [&lt;br/&gt;        {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;            &lt;span&gt;&quot;C&quot;&lt;/span&gt;: &lt;span&gt;&quot;CN&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;ST&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;L&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;O&quot;&lt;/span&gt;: &lt;span&gt;&quot;k8s&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;OU&quot;&lt;/span&gt;: &lt;span&gt;&quot;System&quot;&lt;/span&gt;&lt;br/&gt;        }&lt;br/&gt;    ]&lt;br/&gt;}&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;2）生成证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cfssl gencert -ca=/opt/k8s/work/ca.pem -ca-key=/opt/k8s/work/ca-key.pem -config=/opt/k8s/work/ca-config.json -profile=kubernetes flanneld-csr.json | cfssljson -bare flanneld&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_ip} &lt;span&gt;&quot;mkdir -p /etc/flanneld/cert&quot;&lt;/span&gt;&lt;br/&gt;    scp flanneld*.pem root@${&lt;br/&gt;   &lt;br/&gt;     all_ip}:/etc/flanneld/cert&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;配置Pod 的网段信息&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# etcdctl \&lt;br/&gt;--endpoints=${&lt;br/&gt;   &lt;br/&gt;     ETCD_ENDPOINTS} \&lt;br/&gt;--ca-file=/opt/k8s/work/ca.pem \&lt;br/&gt;--cert-file=/opt/k8s/work/flanneld.pem \&lt;br/&gt;--key-file=/opt/k8s/work/flanneld-key.pem \&lt;br/&gt;mk ${&lt;br/&gt;   &lt;br/&gt;     FLANNEL_ETCD_PREFIX}/config &lt;span&gt;&#x27;{&quot;Network&quot;:&quot;&#x27;&lt;/span&gt;${&lt;br/&gt;   &lt;br/&gt;     CLUSTER_CIDR}&lt;span&gt;&#x27;&quot;, &quot;SubnetLen&quot;: 21, &quot;Backend&quot;: {&quot;Type&quot;: &quot;vxlan&quot;}}&#x27;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.27921279212792127&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjgSlWmXFYz7wZrTadCyRJjFxr5yWYaBR77puPiceue5IOxhO3SEzcibIA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1626&quot;/&gt;&lt;figcaption&gt; &lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;3）编写启动脚本&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; flanneld.service &amp;lt;&amp;lt; EOF&lt;br/&gt;[Unit]&lt;br/&gt;Description=Flanneld overlay address etcd agent&lt;br/&gt;After=network.target&lt;br/&gt;After=network-online.target&lt;br/&gt;Wants=network-online.target&lt;br/&gt;After=etcd.service&lt;br/&gt;Before=docker.service&lt;br/&gt;&lt;br/&gt;[Service]&lt;br/&gt;Type=notify&lt;br/&gt;ExecStart=/opt/k8s/bin/flanneld \\&lt;br/&gt;  -etcd-cafile=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  -etcd-certfile=/etc/flanneld/cert/flanneld.pem \\&lt;br/&gt;  -etcd-keyfile=/etc/flanneld/cert/flanneld-key.pem \\&lt;br/&gt;  -etcd-endpoints=${&lt;br/&gt;   &lt;br/&gt;     ETCD_ENDPOINTS} \\&lt;br/&gt;  -etcd-prefix=${&lt;br/&gt;   &lt;br/&gt;     FLANNEL_ETCD_PREFIX} \\&lt;br/&gt;  -iface=${&lt;br/&gt;   &lt;br/&gt;     IFACE} \\&lt;br/&gt;  -ip-masq&lt;br/&gt;ExecStartPost=/opt/k8s/bin/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/docker&lt;br/&gt;Restart=always&lt;br/&gt;RestartSec=&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;StartLimitInterval=&lt;span&gt;0&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;[Install]&lt;br/&gt;WantedBy=multi-user.target&lt;br/&gt;RequiredBy=docker.service&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;4）启动并验证&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp flanneld.service root@${&lt;br/&gt;   &lt;br/&gt;     all_ip}:/etc/systemd/system/&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_ip} &lt;span&gt;&quot;systemctl daemon-reload &amp;amp;&amp;amp; systemctl enable flanneld --now&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;1）查看 Pod 网段信息&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# etcdctl \&lt;br/&gt;--endpoints=${&lt;br/&gt;   &lt;br/&gt;     ETCD_ENDPOINTS} \&lt;br/&gt;--ca-file=/etc/kubernetes/cert/ca.pem \&lt;br/&gt;--cert-file=/etc/flanneld/cert/flanneld.pem \&lt;br/&gt;--key-file=/etc/flanneld/cert/flanneld-key.pem \&lt;br/&gt;get ${&lt;br/&gt;   &lt;br/&gt;     FLANNEL_ETCD_PREFIX}/config&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.33081570996978854&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjNO7b7dMzesWcYJzM9ib5dtVRkOV69pmjd1cNpQFxvN6zOyAAvuqrSrw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1324&quot;/&gt;&lt;br/&gt;2）查看已分配的 Pod 子网段列表&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# etcdctl \&lt;br/&gt;--endpoints=${&lt;br/&gt;   &lt;br/&gt;     ETCD_ENDPOINTS} \&lt;br/&gt;--ca-file=/etc/kubernetes/cert/ca.pem \&lt;br/&gt;--cert-file=/etc/flanneld/cert/flanneld.pem \&lt;br/&gt;--key-file=/etc/flanneld/cert/flanneld-key.pem \&lt;br/&gt;ls ${&lt;br/&gt;   &lt;br/&gt;     FLANNEL_ETCD_PREFIX}/subnets&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3300604229607251&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjXqUcyax1icQK1QntEGE1d4qBdwoHLo7geDYw00h8j2fpz3LOfCPJzqQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1324&quot;/&gt;&lt;br/&gt;3）查看某一 Pod 网段对应的节点 IP 和 Flannel 接口地址&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# etcdctl \&lt;br/&gt;--endpoints=${&lt;br/&gt;   &lt;br/&gt;     ETCD_ENDPOINTS} \&lt;br/&gt;--ca-file=/etc/kubernetes/cert/ca.pem \&lt;br/&gt;--cert-file=/etc/flanneld/cert/flanneld.pem \&lt;br/&gt;--key-file=/etc/flanneld/cert/flanneld-key.pem \&lt;br/&gt;get ${&lt;br/&gt;   &lt;br/&gt;     FLANNEL_ETCD_PREFIX}/subnets/&lt;span&gt;10.10.208.0&lt;/span&gt;-&lt;span&gt;21&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3273542600896861&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjucRwIcNl3NK8bf2oW1EAAfvpEJCriceQpNVnibbpADsezhXbXOqat0gA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1338&quot;/&gt;&lt;figcaption&gt; &lt;/figcaption&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;4.安装 Docker 服务&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Docker 运行和管理容器，Kubelet 通过 Container Runtime Interface (CRI) 与它进行交互。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下载Docker&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# wget https:&lt;span&gt;//download.docker.com/linux/static/stable/x86_64/docker-19.03.12.tgz&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# tar -zxf docker-&lt;span&gt;19.03.12&lt;/span&gt;.tgz&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;安装Docker&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp docker&lt;span&gt;/*  root@${&lt;br/&gt;   &lt;br/&gt;     all_ip}:/opt/k8s/bin/&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_ip} &quot;chmod +x /opt/k8s/bin/*&quot;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1）创建启动脚本&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; docker.service &amp;lt;&amp;lt; &lt;span&gt;&quot;EOF&quot;&lt;/span&gt;&lt;br/&gt;[Unit]&lt;br/&gt;Description=Docker Application Container Engine&lt;br/&gt;Documentation=http:&lt;span&gt;//docs.docker.io&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;[Service]&lt;br/&gt;WorkingDirectory=##DOCKER_DIR##&lt;br/&gt;Environment=&lt;span&gt;&quot;PATH=/opt/k8s/bin:/bin:/sbin:/usr/bin:/usr/sbin&quot;&lt;/span&gt;&lt;br/&gt;EnvironmentFile=-/run/flannel/docker&lt;br/&gt;ExecStart=/opt/k8s/bin/dockerd $DOCKER_NETWORK_OPTIONS&lt;br/&gt;ExecReload=/bin/kill -s HUP $MAINPID&lt;br/&gt;Restart=on-failure&lt;br/&gt;RestartSec=&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;LimitNOFILE=infinity&lt;br/&gt;LimitNPROC=infinity&lt;br/&gt;LimitCORE=infinity&lt;br/&gt;Delegate=yes&lt;br/&gt;KillMode=process&lt;br/&gt;&lt;br/&gt;[Install]&lt;br/&gt;WantedBy=multi-user.target&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# sed -i -e &lt;span&gt;&quot;s|##DOCKER_DIR##|${DOCKER_DIR}|&quot;&lt;/span&gt; docker.service&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp docker.service root@${&lt;br/&gt;   &lt;br/&gt;     all_ip}:/etc/systemd/system/&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;配置&lt;code&gt;daemon.json&lt;/code&gt; 文件&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; daemon.json &amp;lt;&amp;lt; EOF&lt;br/&gt;{&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;    &lt;span&gt;&quot;registry-mirrors&quot;&lt;/span&gt;: [&lt;span&gt;&quot;https://ipbtg5l0.mirror.aliyuncs.com&quot;&lt;/span&gt;],&lt;br/&gt;    &lt;span&gt;&quot;exec-opts&quot;&lt;/span&gt;: [&lt;span&gt;&quot;native.cgroupdriver=cgroupfs&quot;&lt;/span&gt;],&lt;br/&gt;    &lt;span&gt;&quot;data-root&quot;&lt;/span&gt;: &lt;span&gt;&quot;${DOCKER_DIR}/data&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;exec-root&quot;&lt;/span&gt;: &lt;span&gt;&quot;${DOCKER_DIR}/exec&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;log-driver&quot;&lt;/span&gt;: &lt;span&gt;&quot;json-file&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;log-opts&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;      &lt;span&gt;&quot;max-size&quot;&lt;/span&gt;: &lt;span&gt;&quot;100m&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;max-file&quot;&lt;/span&gt;: &lt;span&gt;&quot;5&quot;&lt;/span&gt;&lt;br/&gt;    },&lt;br/&gt;    &lt;span&gt;&quot;storage-driver&quot;&lt;/span&gt;: &lt;span&gt;&quot;overlay2&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;storage-opts&quot;&lt;/span&gt;: [&lt;br/&gt;      &lt;span&gt;&quot;overlay2.override_kernel_check=true&quot;&lt;/span&gt;&lt;br/&gt;  ]&lt;br/&gt;}&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_ip} &lt;span&gt;&quot;mkdir -p /etc/docker/ ${DOCKER_DIR}/{data,exec}&quot;&lt;/span&gt;&lt;br/&gt;    scp daemon.json root@${&lt;br/&gt;   &lt;br/&gt;     all_ip}:/etc/docker/daemon.json&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;2）启动 Docker&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_ip} &lt;span&gt;&quot;systemctl daemon-reload &amp;amp;&amp;amp; systemctl enable docker --now&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;5.安装 Kubectl 服务&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下载Kubectl&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# wget https:&lt;span&gt;//storage.googleapis.com/kubernetes-release/release/v1.18.3/kubernetes-client-linux-amd64.tar.gz&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# tar -zxf kubernetes-client-linux-amd64.tar.gz&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp kubernetes/client/bin/kubectl root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/opt/k8s/bin/&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;chmod +x /opt/k8s/bin/*&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1）创建 Admin 证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; admin-csr.json &amp;lt;&amp;lt; EOF&lt;br/&gt;{&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;    &lt;span&gt;&quot;CN&quot;&lt;/span&gt;: &lt;span&gt;&quot;admin&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;hosts&quot;&lt;/span&gt;: [],&lt;br/&gt;    &lt;span&gt;&quot;key&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;        &lt;span&gt;&quot;algo&quot;&lt;/span&gt;: &lt;span&gt;&quot;rsa&quot;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;&quot;size&quot;&lt;/span&gt;: &lt;span&gt;2048&lt;/span&gt;&lt;br/&gt;    },&lt;br/&gt;    &lt;span&gt;&quot;names&quot;&lt;/span&gt;: [&lt;br/&gt;        {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;            &lt;span&gt;&quot;C&quot;&lt;/span&gt;: &lt;span&gt;&quot;CN&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;ST&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;L&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;O&quot;&lt;/span&gt;: &lt;span&gt;&quot;system:masters&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;OU&quot;&lt;/span&gt;: &lt;span&gt;&quot;System&quot;&lt;/span&gt;&lt;br/&gt;        }&lt;br/&gt;    ]&lt;br/&gt;}&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;3）生成证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cfssl gencert -ca=/opt/k8s/work/ca.pem -ca-key=/opt/k8s/work/ca-key.pem -config=/opt/k8s/work/ca-config.json -profile=kubernetes admin-csr.json | cfssljson -bare admin&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;4）创建 Kubeconfig 文件&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;配置集群参数&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config set-cluster kubernetes \&lt;br/&gt;--certificate-authority=/opt/k8s/work/ca.pem \&lt;br/&gt;--embed-certs=&lt;span&gt;true&lt;/span&gt; \&lt;br/&gt;--server=${&lt;br/&gt;   &lt;br/&gt;     KUBE_APISERVER} \&lt;br/&gt;--kubeconfig=kubectl.kubeconfig&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;配置客户端认证参数&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config set-credentials admin \&lt;br/&gt;--client-certificate=/opt/k8s/work/admin.pem \&lt;br/&gt;--client-key=/opt/k8s/work/admin-key.pem \&lt;br/&gt;--embed-certs=&lt;span&gt;true&lt;/span&gt; \&lt;br/&gt;--kubeconfig=kubectl.kubeconfig&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;配置上下文参数&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config set-context kubernetes \&lt;br/&gt;--cluster=kubernetes \&lt;br/&gt;--user=admin \&lt;br/&gt;--kubeconfig=kubectl.kubeconfig&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;配置默认上下文&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config use-context kubernetes --kubeconfig=kubectl.kubeconfig&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;5）创建 Kubectl 配置文件，并配置命令补全工具&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;mkdir -p ~/.kube&quot;&lt;/span&gt;&lt;br/&gt;    scp kubectl.kubeconfig root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:~/.kube/config&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;echo &#x27;export KUBECONFIG=\$HOME/.kube/config&#x27; &amp;gt;&amp;gt; ~/.bashrc&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;echo &#x27;source &amp;lt;(kubectl completion bash)&#x27; &amp;gt;&amp;gt; ~/.bashrc&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下面命令需要在 &lt;code&gt;k8s-master01&lt;/code&gt; 和 &lt;code&gt;k8s-master02&lt;/code&gt; 上配置：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# source /usr/share/bash-completion/bash_completion&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# source &amp;lt;(kubectl completion bash)&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# bash ~/.bashrc&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;三、安装 Kubenetes 相关组件&lt;/h1&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;1.安装 Kube-APIServer 组件&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下载Kubernetes 二进制文件&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# wget https:&lt;span&gt;//storage.googleapis.com/kubernetes-release/release/v1.18.3/kubernetes-server-linux-amd64.tar.gz&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# tar -zxf kubernetes-server-linux-amd64.tar.gz&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cd kubernetes&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 kubernetes]# tar -zxf kubernetes-src.tar.gz&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 kubernetes]# cd ..&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp -rp kubernetes/server/bin/{&lt;br/&gt;   &lt;br/&gt;     apiextensions-apiserver,kube-apiserver,kube-controller-manager,kube-scheduler,kubeadm,kubectl,mounter} root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/opt/k8s/bin/&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;chmod +x /opt/k8s/bin/*&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1）创建 Kubernetes 证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; kubernetes-csr.json &amp;lt;&amp;lt; EOF&lt;br/&gt;{&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;  &lt;span&gt;&quot;CN&quot;&lt;/span&gt;: &lt;span&gt;&quot;kubernetes&quot;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;&quot;hosts&quot;&lt;/span&gt;: [&lt;br/&gt;    &lt;span&gt;&quot;127.0.0.1&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;192.168.1.1&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;192.168.1.2&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;${CLUSTER_KUBERNETES_SVC_IP}&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;kubernetes&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;kubernetes.default&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;kubernetes.default.svc&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;kubernetes.default.svc.cluster&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;kubernetes.default.svc.cluster.local.&quot;&lt;/span&gt;&lt;br/&gt;  ],&lt;br/&gt;  &lt;span&gt;&quot;key&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;    &lt;span&gt;&quot;algo&quot;&lt;/span&gt;: &lt;span&gt;&quot;rsa&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;size&quot;&lt;/span&gt;: &lt;span&gt;2048&lt;/span&gt;&lt;br/&gt;  },&lt;br/&gt;  &lt;span&gt;&quot;names&quot;&lt;/span&gt;: [&lt;br/&gt;    {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;      &lt;span&gt;&quot;C&quot;&lt;/span&gt;: &lt;span&gt;&quot;CN&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;ST&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;L&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;O&quot;&lt;/span&gt;: &lt;span&gt;&quot;k8s&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;OU&quot;&lt;/span&gt;: &lt;span&gt;&quot;System&quot;&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;  ]&lt;br/&gt;}&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;2）生成证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cfssl gencert -ca=/opt/k8s/work/ca.pem -ca-key=/opt/k8s/work/ca-key.pem -config=/opt/k8s/work/ca-config.json -profile=kubernetes kubernetes-csr.json | cfssljson -bare kubernetes&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;mkdir -p /etc/kubernetes/cert&quot;&lt;/span&gt;&lt;br/&gt;    scp kubernetes*.pem root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/kubernetes/cert/&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;3）配置 Kube-APIServer 审计&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;创建加密配置文件&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; encryption-config.yaml &amp;lt;&amp;lt; EOF&lt;br/&gt;kind: EncryptionConfig&lt;br/&gt;apiVersion: v1&lt;br/&gt;resources:&lt;br/&gt;  - resources:&lt;br/&gt;      - secrets&lt;br/&gt;    providers:&lt;br/&gt;      - aescbc:&lt;br/&gt;          keys:&lt;br/&gt;            - name: zhangsan&lt;br/&gt;              secret: ${&lt;br/&gt;   &lt;br/&gt;     ENCRYPTION_KEY}&lt;br/&gt;      - identity: {&lt;br/&gt;   &lt;br/&gt;     }&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp encryption-config.yaml root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/kubernetes/encryption-config.yaml&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;创建审计策略文件&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; audit-policy.yaml &amp;lt;&amp;lt; EOF&lt;br/&gt;apiVersion: audit.k8s.io/v1beta1&lt;br/&gt;kind: Policy&lt;br/&gt;rules:&lt;br/&gt;  # The following requests were manually identified as high-volume and low-risk, so drop them.&lt;br/&gt;  - level: None&lt;br/&gt;    resources:&lt;br/&gt;      - group: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;        resources:&lt;br/&gt;          - endpoints&lt;br/&gt;          - services&lt;br/&gt;          - services/status&lt;br/&gt;    users:&lt;br/&gt;      - &lt;span&gt;&#x27;system:kube-proxy&#x27;&lt;/span&gt;&lt;br/&gt;    verbs:&lt;br/&gt;      - watch&lt;br/&gt;&lt;br/&gt;  - level: None&lt;br/&gt;    resources:&lt;br/&gt;      - group: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;        resources:&lt;br/&gt;          - nodes&lt;br/&gt;          - nodes/status&lt;br/&gt;    userGroups:&lt;br/&gt;      - &lt;span&gt;&#x27;system:nodes&#x27;&lt;/span&gt;&lt;br/&gt;    verbs:&lt;br/&gt;      - get&lt;br/&gt;&lt;br/&gt;  - level: None&lt;br/&gt;    namespaces:&lt;br/&gt;      - kube-system&lt;br/&gt;    resources:&lt;br/&gt;      - group: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;        resources:&lt;br/&gt;          - endpoints&lt;br/&gt;    users:&lt;br/&gt;      - &lt;span&gt;&#x27;system:kube-controller-manager&#x27;&lt;/span&gt;&lt;br/&gt;      - &lt;span&gt;&#x27;system:kube-scheduler&#x27;&lt;/span&gt;&lt;br/&gt;      - &lt;span&gt;&#x27;system:serviceaccount:kube-system:endpoint-controller&#x27;&lt;/span&gt;&lt;br/&gt;    verbs:&lt;br/&gt;      - get&lt;br/&gt;      - update&lt;br/&gt;&lt;br/&gt;  - level: None&lt;br/&gt;    resources:&lt;br/&gt;      - group: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;        resources:&lt;br/&gt;          - namespaces&lt;br/&gt;          - namespaces/status&lt;br/&gt;          - namespaces/finalize&lt;br/&gt;    users:&lt;br/&gt;      - &lt;span&gt;&#x27;system:apiserver&#x27;&lt;/span&gt;&lt;br/&gt;    verbs:&lt;br/&gt;      - get&lt;br/&gt;&lt;br/&gt;  # Don&lt;span&gt;&#x27;t log HPA fetching metrics.&lt;br/&gt;  - level: None&lt;br/&gt;    resources:&lt;br/&gt;      - group: metrics.k8s.io&lt;br/&gt;    users:&lt;br/&gt;      - &#x27;&lt;/span&gt;system:kube-controller-manager&lt;span&gt;&#x27;&lt;br/&gt;    verbs:&lt;br/&gt;      - get&lt;br/&gt;      - list&lt;br/&gt;&lt;br/&gt;  # Don&#x27;&lt;/span&gt;t log these read-only URLs.&lt;br/&gt;  - level: None&lt;br/&gt;    nonResourceURLs:&lt;br/&gt;      - &lt;span&gt;&#x27;/healthz*&#x27;&lt;/span&gt;&lt;br/&gt;      - /version&lt;br/&gt;      - &lt;span&gt;&#x27;/swagger*&#x27;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  # Don&lt;span&gt;&#x27;t log events requests.&lt;br/&gt;  - level: None&lt;br/&gt;    resources:&lt;br/&gt;      - group: &quot;&quot;&lt;br/&gt;        resources:&lt;br/&gt;          - events&lt;br/&gt;&lt;br/&gt;  # node and pod status calls from nodes are high-volume and can be large, don&#x27;&lt;/span&gt;t log responses &lt;span&gt;for&lt;/span&gt; expected updates from nodes&lt;br/&gt;  - level: Request&lt;br/&gt;    omitStages:&lt;br/&gt;      - RequestReceived&lt;br/&gt;    resources:&lt;br/&gt;      - group: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;        resources:&lt;br/&gt;          - nodes/status&lt;br/&gt;          - pods/status&lt;br/&gt;    users:&lt;br/&gt;      - kubelet&lt;br/&gt;      - &lt;span&gt;&#x27;system:node-problem-detector&#x27;&lt;/span&gt;&lt;br/&gt;      - &lt;span&gt;&#x27;system:serviceaccount:kube-system:node-problem-detector&#x27;&lt;/span&gt;&lt;br/&gt;    verbs:&lt;br/&gt;      - update&lt;br/&gt;      - patch&lt;br/&gt;&lt;br/&gt;  - level: Request&lt;br/&gt;    omitStages:&lt;br/&gt;      - RequestReceived&lt;br/&gt;    resources:&lt;br/&gt;      - group: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;        resources:&lt;br/&gt;          - nodes/status&lt;br/&gt;          - pods/status&lt;br/&gt;    userGroups:&lt;br/&gt;      - &lt;span&gt;&#x27;system:nodes&#x27;&lt;/span&gt;&lt;br/&gt;    verbs:&lt;br/&gt;      - update&lt;br/&gt;      - patch&lt;br/&gt;&lt;br/&gt;  # deletecollection calls can be large, don&lt;span&gt;&#x27;t log responses for expected namespace deletions&lt;br/&gt;  - level: Request&lt;br/&gt;    omitStages:&lt;br/&gt;      - RequestReceived&lt;br/&gt;    users:&lt;br/&gt;      - &#x27;&lt;/span&gt;system:serviceaccount:kube-system:namespace-controller&lt;span&gt;&#x27;&lt;br/&gt;    verbs:&lt;br/&gt;      - deletecollection&lt;br/&gt;&lt;br/&gt;  # Secrets, ConfigMaps, and TokenReviews can contain sensitive &amp;amp; binary data,&lt;br/&gt;  # so only log at the Metadata level.&lt;br/&gt;  - level: Metadata&lt;br/&gt;    omitStages:&lt;br/&gt;      - RequestReceived&lt;br/&gt;    resources:&lt;br/&gt;      - group: &quot;&quot;&lt;br/&gt;        resources:&lt;br/&gt;          - secrets&lt;br/&gt;          - configmaps&lt;br/&gt;      - group: authentication.k8s.io&lt;br/&gt;        resources:&lt;br/&gt;          - tokenreviews&lt;br/&gt;  # Get repsonses can be large; skip them.&lt;br/&gt;  - level: Request&lt;br/&gt;    omitStages:&lt;br/&gt;      - RequestReceived&lt;br/&gt;    resources:&lt;br/&gt;      - group: &quot;&quot;&lt;br/&gt;      - group: admissionregistration.k8s.io&lt;br/&gt;      - group: apiextensions.k8s.io&lt;br/&gt;      - group: apiregistration.k8s.io&lt;br/&gt;      - group: apps&lt;br/&gt;      - group: authentication.k8s.io&lt;br/&gt;      - group: authorization.k8s.io&lt;br/&gt;      - group: autoscaling&lt;br/&gt;      - group: batch&lt;br/&gt;      - group: certificates.k8s.io&lt;br/&gt;      - group: extensions&lt;br/&gt;      - group: metrics.k8s.io&lt;br/&gt;      - group: networking.k8s.io&lt;br/&gt;      - group: policy&lt;br/&gt;      - group: rbac.authorization.k8s.io&lt;br/&gt;      - group: scheduling.k8s.io&lt;br/&gt;      - group: settings.k8s.io&lt;br/&gt;      - group: storage.k8s.io&lt;br/&gt;    verbs:&lt;br/&gt;      - get&lt;br/&gt;      - list&lt;br/&gt;      - watch&lt;br/&gt;&lt;br/&gt;  # Default level for known APIs&lt;br/&gt;  - level: RequestResponse&lt;br/&gt;    omitStages:&lt;br/&gt;      - RequestReceived&lt;br/&gt;    resources:&lt;br/&gt;      - group: &quot;&quot;&lt;br/&gt;      - group: admissionregistration.k8s.io&lt;br/&gt;      - group: apiextensions.k8s.io&lt;br/&gt;      - group: apiregistration.k8s.io&lt;br/&gt;      - group: apps&lt;br/&gt;      - group: authentication.k8s.io&lt;br/&gt;      - group: authorization.k8s.io&lt;br/&gt;      - group: autoscaling&lt;br/&gt;      - group: batch&lt;br/&gt;      - group: certificates.k8s.io&lt;br/&gt;      - group: extensions&lt;br/&gt;      - group: metrics.k8s.io&lt;br/&gt;      - group: networking.k8s.io&lt;br/&gt;      - group: policy&lt;br/&gt;      - group: rbac.authorization.k8s.io&lt;br/&gt;      - group: scheduling.k8s.io&lt;br/&gt;      - group: settings.k8s.io&lt;br/&gt;      - group: storage.k8s.io&lt;br/&gt;&lt;br/&gt;  # Default level for all other requests.&lt;br/&gt;  - level: Metadata&lt;br/&gt;    omitStages:&lt;br/&gt;      - RequestReceived&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp audit-policy.yaml root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/kubernetes/audit-policy.yaml&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;4）配置 Metrics-Server&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;创建&lt;code&gt;metrics-server&lt;/code&gt; 的 CA 证书请求文件&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; proxy-client-csr.json &amp;lt;&amp;lt; EOF&lt;br/&gt;{&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;  &lt;span&gt;&quot;CN&quot;&lt;/span&gt;: &lt;span&gt;&quot;system:metrics-server&quot;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;&quot;hosts&quot;&lt;/span&gt;: [],&lt;br/&gt;  &lt;span&gt;&quot;key&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;    &lt;span&gt;&quot;algo&quot;&lt;/span&gt;: &lt;span&gt;&quot;rsa&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;size&quot;&lt;/span&gt;: &lt;span&gt;2048&lt;/span&gt;&lt;br/&gt;  },&lt;br/&gt;  &lt;span&gt;&quot;names&quot;&lt;/span&gt;: [&lt;br/&gt;    {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;      &lt;span&gt;&quot;C&quot;&lt;/span&gt;: &lt;span&gt;&quot;CN&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;ST&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;L&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;O&quot;&lt;/span&gt;: &lt;span&gt;&quot;k8s&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;OU&quot;&lt;/span&gt;: &lt;span&gt;&quot;System&quot;&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;  ]&lt;br/&gt;}&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;生成证书和密钥&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cfssl gencert -ca=/opt/k8s/work/ca.pem -ca-key=/opt/k8s/work/ca-key.pem -config=/opt/k8s/work/ca-config.json -profile=kubernetes proxy-client-csr.json | cfssljson -bare proxy-client&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp proxy-client*.pem root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/kubernetes/cert/&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;5）创建启动脚本&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; kube-apiserver.service.template &amp;lt;&amp;lt; EOF&lt;br/&gt;[Unit]&lt;br/&gt;Description=Kubernetes API Server&lt;br/&gt;Documentation=https:&lt;span&gt;//github.com/GoogleCloudPlatform/kubernetes&lt;/span&gt;&lt;br/&gt;After=network.target&lt;br/&gt;&lt;br/&gt;[Service]&lt;br/&gt;WorkingDirectory=${&lt;br/&gt;   &lt;br/&gt;     K8S_DIR}/kube-apiserver&lt;br/&gt;ExecStart=/opt/k8s/bin/kube-apiserver \\&lt;br/&gt;  --insecure-port=&lt;span&gt;0&lt;/span&gt; \\&lt;br/&gt;  --secure-port=&lt;span&gt;6443&lt;/span&gt; \\&lt;br/&gt;  --bind-address=##MASTER_IP## \\&lt;br/&gt;  --advertise-address=##MASTER_IP## \\&lt;br/&gt;  --&lt;span&gt;default&lt;/span&gt;-not-ready-toleration-seconds=&lt;span&gt;360&lt;/span&gt; \\&lt;br/&gt;  --&lt;span&gt;default&lt;/span&gt;-unreachable-toleration-seconds=&lt;span&gt;360&lt;/span&gt; \\&lt;br/&gt;  --feature-gates=DynamicAuditing=&lt;span&gt;true&lt;/span&gt; \\&lt;br/&gt;  --max-mutating-requests-inflight=&lt;span&gt;2000&lt;/span&gt; \\&lt;br/&gt;  --max-requests-inflight=&lt;span&gt;4000&lt;/span&gt; \\&lt;br/&gt;  --&lt;span&gt;default&lt;/span&gt;-watch-cache-size=&lt;span&gt;200&lt;/span&gt; \\&lt;br/&gt;  --delete-collection-workers=&lt;span&gt;2&lt;/span&gt; \\&lt;br/&gt;  --encryption-provider-config=/etc/kubernetes/encryption-config.yaml \\&lt;br/&gt;  --etcd-cafile=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --etcd-certfile=/etc/kubernetes/cert/kubernetes.pem \\&lt;br/&gt;  --etcd-keyfile=/etc/kubernetes/cert/kubernetes-key.pem \\&lt;br/&gt;  --etcd-servers=${&lt;br/&gt;   &lt;br/&gt;     ETCD_ENDPOINTS} \\&lt;br/&gt;  --tls-cert-file=/etc/kubernetes/cert/kubernetes.pem \\&lt;br/&gt;  --tls-&lt;span&gt;private&lt;/span&gt;-key-file=/etc/kubernetes/cert/kubernetes-key.pem \\&lt;br/&gt;  --audit-dynamic-configuration \\&lt;br/&gt;  --audit-log-maxage=&lt;span&gt;30&lt;/span&gt; \\&lt;br/&gt;  --audit-log-maxbackup=&lt;span&gt;3&lt;/span&gt; \\&lt;br/&gt;  --audit-log-maxsize=&lt;span&gt;100&lt;/span&gt; \\&lt;br/&gt;  --audit-log-truncate-enabled=&lt;span&gt;true&lt;/span&gt; \\&lt;br/&gt;  --audit-log-path=${&lt;br/&gt;   &lt;br/&gt;     K8S_DIR}/kube-apiserver/audit.log \\&lt;br/&gt;  --audit-policy-file=/etc/kubernetes/audit-policy.yaml \\&lt;br/&gt;  --profiling \\&lt;br/&gt;  --anonymous-auth=&lt;span&gt;false&lt;/span&gt; \\&lt;br/&gt;  --client-ca-file=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --enable-bootstrap-token-auth=&lt;span&gt;true&lt;/span&gt; \\&lt;br/&gt;  --requestheader-allowed-names=&lt;span&gt;&quot;system:metrics-server&quot;&lt;/span&gt; \\&lt;br/&gt;  --requestheader-client-ca-file=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --requestheader-extra-headers-prefix=X-Remote-Extra- \\&lt;br/&gt;  --requestheader-group-headers=X-Remote-Group \\&lt;br/&gt;  --requestheader-username-headers=X-Remote-User \\&lt;br/&gt;  --service-account-key-file=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --authorization-mode=Node,RBAC \\&lt;br/&gt;  --runtime-config=api/all=&lt;span&gt;true&lt;/span&gt; \\&lt;br/&gt;  --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction \\&lt;br/&gt;  --allow-privileged=&lt;span&gt;true&lt;/span&gt; \\&lt;br/&gt;  --apiserver-count=&lt;span&gt;3&lt;/span&gt; \\&lt;br/&gt;  --event-ttl=&lt;span&gt;168&lt;/span&gt;h \\&lt;br/&gt;  --kubelet-certificate-authority=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --kubelet-client-certificate=/etc/kubernetes/cert/kubernetes.pem \\&lt;br/&gt;  --kubelet-client-key=/etc/kubernetes/cert/kubernetes-key.pem \\&lt;br/&gt;  --kubelet-https=&lt;span&gt;true&lt;/span&gt; \\&lt;br/&gt;  --kubelet-timeout=&lt;span&gt;10&lt;/span&gt;s \\&lt;br/&gt;  --proxy-client-cert-file=/etc/kubernetes/cert/proxy-client.pem \\&lt;br/&gt;  --proxy-client-key-file=/etc/kubernetes/cert/proxy-client-key.pem \\&lt;br/&gt;  --service-cluster-ip-range=${&lt;br/&gt;   &lt;br/&gt;     SERVICE_CIDR} \\&lt;br/&gt;  --service-node-port-range=${&lt;br/&gt;   &lt;br/&gt;     NODE_PORT_RANGE} \\&lt;br/&gt;  --logtostderr=&lt;span&gt;true&lt;/span&gt; \\&lt;br/&gt;  --v=&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;Restart=on-failure&lt;br/&gt;RestartSec=&lt;span&gt;10&lt;/span&gt;&lt;br/&gt;Type=notify&lt;br/&gt;LimitNOFILE=&lt;span&gt;65535&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;[Install]&lt;br/&gt;WantedBy=multi-user.target&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;6）启动 Kube-APIServer 并验证&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; (( A=&lt;span&gt;0&lt;/span&gt;; A &amp;lt; &lt;span&gt;2&lt;/span&gt;; A++ ))&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    sed -e &lt;span&gt;&quot;s/##MASTER_NAME##/${MASTER_NAMES[A]}/&quot;&lt;/span&gt; -e &lt;span&gt;&quot;s/##MASTER_IP##/${MASTER_IPS[A]}/&quot;&lt;/span&gt; kube-apiserver.service.template &amp;gt; kube-apiserver-${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[A]}.service&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp kube-apiserver-${&lt;br/&gt;   &lt;br/&gt;     master_ip}.service root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/systemd/system/kube-apiserver.service&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;mkdir -p ${K8S_DIR}/kube-apiserver&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;systemctl daemon-reload &amp;amp;&amp;amp; systemctl enable kube-apiserver --now&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查看Kube-APIServer 写入 ETCD 的数据&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# ETCDCTL_API=&lt;span&gt;3&lt;/span&gt; etcdctl \&lt;br/&gt;--endpoints=${&lt;br/&gt;   &lt;br/&gt;     ETCD_ENDPOINTS} \&lt;br/&gt;--cacert=/opt/k8s/work/ca.pem \&lt;br/&gt;--cert=/opt/k8s/work/etcd.pem \&lt;br/&gt;--key=/opt/k8s/work/etcd-key.pem \&lt;br/&gt;get /registry/ --prefix --keys-only&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查看集群信息&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl cluster-info&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl get all --all-namespaces&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl get componentstatuses&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# netstat -anpt | grep &lt;span&gt;6443&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.32405891980360063&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjIsmia0OD2UbFqMic53VwRXydTtFicKxBeaFdib3vc0ezRibpI8FoiadpC6Bg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1833&quot;/&gt;&lt;br/&gt;授予&lt;code&gt;kube-apiserver&lt;/code&gt; 访问 &lt;code&gt;kubelet&lt;/code&gt; API 的权限&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl create clusterrolebinding kube-apiserver:kubelet-apis --clusterrole=system:kubelet-api-admin --user kubernetes&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.安装 Controller Manager 组件&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1）创建 Controller Manager 证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; kube-controller-manager-csr.json &amp;lt;&amp;lt; EOF&lt;br/&gt;{&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;  &lt;span&gt;&quot;CN&quot;&lt;/span&gt;: &lt;span&gt;&quot;system:kube-controller-manager&quot;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;&quot;hosts&quot;&lt;/span&gt;: [&lt;br/&gt;    &lt;span&gt;&quot;127.0.0.1&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;192.168.1.1&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;192.168.1.2&quot;&lt;/span&gt;&lt;br/&gt;  ],&lt;br/&gt;  &lt;span&gt;&quot;key&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;    &lt;span&gt;&quot;algo&quot;&lt;/span&gt;: &lt;span&gt;&quot;rsa&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;size&quot;&lt;/span&gt;: &lt;span&gt;2048&lt;/span&gt;&lt;br/&gt;  },&lt;br/&gt;  &lt;span&gt;&quot;names&quot;&lt;/span&gt;: [&lt;br/&gt;    {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;      &lt;span&gt;&quot;C&quot;&lt;/span&gt;: &lt;span&gt;&quot;CN&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;ST&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;L&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;O&quot;&lt;/span&gt;: &lt;span&gt;&quot;system:kube-controller-manager&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;OU&quot;&lt;/span&gt;: &lt;span&gt;&quot;System&quot;&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;  ]&lt;br/&gt;}&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;2）生成证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cfssl gencert -ca=/opt/k8s/work/ca.pem -ca-key=/opt/k8s/work/ca-key.pem -config=/opt/k8s/work/ca-config.json -profile=kubernetes kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp kube-controller-manager*.pem root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/kubernetes/cert/&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;3）创建 Kubeconfig 文件&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config set-cluster kubernetes \&lt;br/&gt;--certificate-authority=/opt/k8s/work/ca.pem \&lt;br/&gt;--embed-certs=&lt;span&gt;true&lt;/span&gt; \&lt;br/&gt;--server=${&lt;br/&gt;   &lt;br/&gt;     KUBE_APISERVER} \&lt;br/&gt;--kubeconfig=kube-controller-manager.kubeconfig&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config set-credentials system:kube-controller-manager \&lt;br/&gt;--client-certificate=kube-controller-manager.pem \&lt;br/&gt;--client-key=kube-controller-manager-key.pem \&lt;br/&gt;--embed-certs=&lt;span&gt;true&lt;/span&gt; \&lt;br/&gt;--kubeconfig=kube-controller-manager.kubeconfig&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config set-context system:kube-controller-manager \&lt;br/&gt;--cluster=kubernetes \&lt;br/&gt;--user=system:kube-controller-manager \&lt;br/&gt;--kubeconfig=kube-controller-manager.kubeconfig&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config use-context system:kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp kube-controller-manager.kubeconfig root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/kubernetes/&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;4）创建启动脚本&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; kube-controller-manager.service.template &amp;lt;&amp;lt; EOF&lt;br/&gt;[Unit]&lt;br/&gt;Description=Kubernetes Controller Manager&lt;br/&gt;Documentation=https:&lt;span&gt;//github.com/GoogleCloudPlatform/kubernetes&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;[Service]&lt;br/&gt;WorkingDirectory=${&lt;br/&gt;   &lt;br/&gt;     K8S_DIR}/kube-controller-manager&lt;br/&gt;ExecStart=/opt/k8s/bin/kube-controller-manager \\&lt;br/&gt;  --secure-port=&lt;span&gt;10257&lt;/span&gt; \\&lt;br/&gt;  --bind-address=&lt;span&gt;127.0.0.1&lt;/span&gt; \\&lt;br/&gt;  --profiling \\&lt;br/&gt;  --cluster-name=kubernetes \\&lt;br/&gt;  --controllers=*,bootstrapsigner,tokencleaner \\&lt;br/&gt;  --kube-api-qps=&lt;span&gt;1000&lt;/span&gt; \\&lt;br/&gt;  --kube-api-burst=&lt;span&gt;2000&lt;/span&gt; \\&lt;br/&gt;  --leader-elect \\&lt;br/&gt;  --use-service-account-credentials\\&lt;br/&gt;  --concurrent-service-syncs=&lt;span&gt;2&lt;/span&gt; \\&lt;br/&gt;  --tls-cert-file=/etc/kubernetes/cert/kube-controller-manager.pem \\&lt;br/&gt;  --tls-&lt;span&gt;private&lt;/span&gt;-key-file=/etc/kubernetes/cert/kube-controller-manager-key.pem \\&lt;br/&gt;  --authentication-kubeconfig=/etc/kubernetes/kube-controller-manager.kubeconfig \\&lt;br/&gt;  --client-ca-file=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --requestheader-allowed-names=&lt;span&gt;&quot;system:metrics-server&quot;&lt;/span&gt; \\&lt;br/&gt;  --requestheader-client-ca-file=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --requestheader-extra-headers-prefix=&lt;span&gt;&quot;X-Remote-Extra-&quot;&lt;/span&gt; \\&lt;br/&gt;  --requestheader-group-headers=X-Remote-Group \\&lt;br/&gt;  --requestheader-username-headers=X-Remote-User \\&lt;br/&gt;  --cluster-signing-cert-file=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --cluster-signing-key-file=/etc/kubernetes/cert/ca-key.pem \\&lt;br/&gt;  --experimental-cluster-signing-duration=&lt;span&gt;87600&lt;/span&gt;h \\&lt;br/&gt;  --horizontal-pod-autoscaler-sync-period=&lt;span&gt;10&lt;/span&gt;s \\&lt;br/&gt;  --concurrent-deployment-syncs=&lt;span&gt;10&lt;/span&gt; \\&lt;br/&gt;  --concurrent-gc-syncs=&lt;span&gt;30&lt;/span&gt; \\&lt;br/&gt;  --node-cidr-mask-size=&lt;span&gt;24&lt;/span&gt; \\&lt;br/&gt;  --service-cluster-ip-range=${&lt;br/&gt;   &lt;br/&gt;     SERVICE_CIDR} \\&lt;br/&gt;  --cluster-cidr=${&lt;br/&gt;   &lt;br/&gt;     CLUSTER_CIDR} \\&lt;br/&gt;  --pod-eviction-timeout=&lt;span&gt;6&lt;/span&gt;m \\&lt;br/&gt;  --terminated-pod-gc-threshold=&lt;span&gt;10000&lt;/span&gt; \\&lt;br/&gt;  --root-ca-file=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --service-account-&lt;span&gt;private&lt;/span&gt;-key-file=/etc/kubernetes/cert/ca-key.pem \\&lt;br/&gt;  --kubeconfig=/etc/kubernetes/kube-controller-manager.kubeconfig \\&lt;br/&gt;  --logtostderr=&lt;span&gt;true&lt;/span&gt; \\&lt;br/&gt;  --v=&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;Restart=on-failure&lt;br/&gt;RestartSec=&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;[Install]&lt;br/&gt;WantedBy=multi-user.target&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;4）启动并验证&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp kube-controller-manager.service.template root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/systemd/system/kube-controller-manager.service&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;mkdir -p ${K8S_DIR}/kube-controller-manager&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;systemctl daemon-reload &amp;amp;&amp;amp; systemctl enable kube-controller-manager --now&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查看输出的 Metrics&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# curl -s --cacert /opt/k8s/work/ca.pem --cert /opt/k8s/work/admin.pem --key /opt/k8s/work/admin-key.pem https:&lt;span&gt;//127.0.0.1:10257/metrics | head&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查看权限&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl describe clusterrole system:kube-controller-manager&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl get clusterrole | grep controller&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl describe clusterrole system:controller:deployment-controller&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查看当前的 Leader&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl get endpoints kube-controller-manager --namespace=kube-system -o yaml&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;3.安装 Kube-Scheduler 组件&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1）创建 Kube-Scheduler 证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; kube-scheduler-csr.json &amp;lt;&amp;lt; EOF&lt;br/&gt;{&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;  &lt;span&gt;&quot;CN&quot;&lt;/span&gt;: &lt;span&gt;&quot;system:kube-scheduler&quot;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;&quot;hosts&quot;&lt;/span&gt;: [&lt;br/&gt;    &lt;span&gt;&quot;127.0.0.1&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;192.168.1.1&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;192.168.1.2&quot;&lt;/span&gt;&lt;br/&gt;  ],&lt;br/&gt;  &lt;span&gt;&quot;key&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;    &lt;span&gt;&quot;algo&quot;&lt;/span&gt;: &lt;span&gt;&quot;rsa&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;size&quot;&lt;/span&gt;: &lt;span&gt;2048&lt;/span&gt;&lt;br/&gt;  },&lt;br/&gt;  &lt;span&gt;&quot;names&quot;&lt;/span&gt;: [&lt;br/&gt;    {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;      &lt;span&gt;&quot;C&quot;&lt;/span&gt;: &lt;span&gt;&quot;CN&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;ST&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;L&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;O&quot;&lt;/span&gt;: &lt;span&gt;&quot;system:kube-scheduler&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;OU&quot;&lt;/span&gt;: &lt;span&gt;&quot;System&quot;&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;  ]&lt;br/&gt;}&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;2）生成证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cfssl gencert -ca=/opt/k8s/work/ca.pem -ca-key=/opt/k8s/work/ca-key.pem -config=/opt/k8s/work/ca-config.json -profile=kubernetes kube-scheduler-csr.json | cfssljson -bare kube-scheduler&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp kube-scheduler*.pem root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/kubernetes/cert/&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;3）创建 Kubeconfig 文件&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config set-cluster kubernetes \&lt;br/&gt;--certificate-authority=/opt/k8s/work/ca.pem \&lt;br/&gt;--embed-certs=&lt;span&gt;true&lt;/span&gt; \&lt;br/&gt;--server=${&lt;br/&gt;   &lt;br/&gt;     KUBE_APISERVER} \&lt;br/&gt;--kubeconfig=kube-scheduler.kubeconfig&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config set-credentials system:kube-scheduler \&lt;br/&gt;--client-certificate=kube-scheduler.pem \&lt;br/&gt;--client-key=kube-scheduler-key.pem \&lt;br/&gt;--embed-certs=&lt;span&gt;true&lt;/span&gt; \&lt;br/&gt;--kubeconfig=kube-scheduler.kubeconfig&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config set-context system:kube-scheduler \&lt;br/&gt;--cluster=kubernetes \&lt;br/&gt;--user=system:kube-scheduler \&lt;br/&gt;--kubeconfig=kube-scheduler.kubeconfig&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config use-context system:kube-scheduler --kubeconfig=kube-scheduler.kubeconfig&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp kube-scheduler.kubeconfig root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/kubernetes/&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;4）创建 Kube-Scheduler 配置文件&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; kube-scheduler.yaml.template &amp;lt;&amp;lt; EOF&lt;br/&gt;apiVersion: kubescheduler.config.k8s.io/v1alpha1&lt;br/&gt;kind: KubeSchedulerConfiguration&lt;br/&gt;bindTimeoutSeconds: &lt;span&gt;600&lt;/span&gt;&lt;br/&gt;clientConnection:&lt;br/&gt;  burst: &lt;span&gt;200&lt;/span&gt;&lt;br/&gt;  kubeconfig: &lt;span&gt;&quot;/etc/kubernetes/kube-scheduler.kubeconfig&quot;&lt;/span&gt;&lt;br/&gt;  qps: &lt;span&gt;100&lt;/span&gt;&lt;br/&gt;enableContentionProfiling: &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;enableProfiling: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;hardPodAffinitySymmetricWeight: &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;healthzBindAddress: &lt;span&gt;127.0.0.1&lt;/span&gt;:&lt;span&gt;10251&lt;/span&gt;&lt;br/&gt;leaderElection:&lt;br/&gt;  leaderElect: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;metricsBindAddress: &lt;span&gt;127.0.0.1&lt;/span&gt;:&lt;span&gt;10251&lt;/span&gt;&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp kube-scheduler.yaml.template root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/kubernetes/kube-scheduler.yaml&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;5）创建启动脚本&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; kube-scheduler.service.template &amp;lt;&amp;lt; EOF&lt;br/&gt;[Unit]&lt;br/&gt;Description=Kubernetes Scheduler&lt;br/&gt;Documentation=https:&lt;span&gt;//github.com/GoogleCloudPlatform/kubernetes&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;[Service]&lt;br/&gt;WorkingDirectory=${&lt;br/&gt;   &lt;br/&gt;     K8S_DIR}/kube-scheduler&lt;br/&gt;ExecStart=/opt/k8s/bin/kube-scheduler \\&lt;br/&gt;  --port=&lt;span&gt;0&lt;/span&gt; \\&lt;br/&gt;  --secure-port=&lt;span&gt;10259&lt;/span&gt; \\&lt;br/&gt;  --bind-address=&lt;span&gt;127.0.0.1&lt;/span&gt; \\&lt;br/&gt;  --config=/etc/kubernetes/kube-scheduler.yaml \\&lt;br/&gt;  --tls-cert-file=/etc/kubernetes/cert/kube-scheduler.pem \\&lt;br/&gt;  --tls-&lt;span&gt;private&lt;/span&gt;-key-file=/etc/kubernetes/cert/kube-scheduler-key.pem \\&lt;br/&gt;  --authentication-kubeconfig=/etc/kubernetes/kube-scheduler.kubeconfig \\&lt;br/&gt;  --client-ca-file=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --requestheader-allowed-names=&lt;span&gt;&quot;system:metrics-server&quot;&lt;/span&gt; \\&lt;br/&gt;  --requestheader-client-ca-file=/etc/kubernetes/cert/ca.pem \\&lt;br/&gt;  --requestheader-extra-headers-prefix=&lt;span&gt;&quot;X-Remote-Extra-&quot;&lt;/span&gt; \\&lt;br/&gt;  --requestheader-group-headers=X-Remote-Group \\&lt;br/&gt;  --requestheader-username-headers=X-Remote-User \\&lt;br/&gt;  --authorization-kubeconfig=/etc/kubernetes/kube-scheduler.kubeconfig \\&lt;br/&gt;  --logtostderr=&lt;span&gt;true&lt;/span&gt; \\&lt;br/&gt;  --v=&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;Restart=always&lt;br/&gt;RestartSec=&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;StartLimitInterval=&lt;span&gt;0&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;[Install]&lt;br/&gt;WantedBy=multi-user.target&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;6）启动并验证&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp kube-scheduler.service.template root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/etc/systemd/system/kube-scheduler.service&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;mkdir -p ${K8S_DIR}/kube-scheduler&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;systemctl daemon-reload &amp;amp;&amp;amp; systemctl enable kube-scheduler --now&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# netstat -nlpt | grep kube-schedule&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;10251：接收 http 请求，非安全端口，不需要认证授权；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;10259：接收 https 请求，安全端口，需要认认证授权（两个接口都对外提供 /metrics 和 /healthz 的访问）&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查看输出的 Metrics&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# curl -s --cacert /opt/k8s/work/ca.pem --cert /opt/k8s/work/admin.pem --key /opt/k8s/work/admin-key.pem https:&lt;span&gt;//127.0.0.1:10257/metrics | head&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查看权限&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl describe clusterrole system:kube-controller-manager&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl get clusterrole | grep controller&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl describe clusterrole system:controller:deployment-controller&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查看当前的 Leader&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl get endpoints kube-controller-manager --namespace=kube-system -o yaml&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;4.安装 Kubelet 组件&lt;/h2&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp kubernetes/server/bin/kubelet root@${&lt;br/&gt;   &lt;br/&gt;     all_ip}:/opt/k8s/bin/&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_ip} &lt;span&gt;&quot;chmod +x /opt/k8s/bin/*&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_name in ${&lt;br/&gt;   &lt;br/&gt;     ALL_NAMES[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_name}&quot;&lt;/span&gt;&lt;br/&gt;    export BOOTSTRAP_TOKEN=$(kubeadm token create \&lt;br/&gt;      --description kubelet-bootstrap-token \&lt;br/&gt;      --groups system:bootstrappers:${&lt;br/&gt;   &lt;br/&gt;     all_name} \&lt;br/&gt;      --kubeconfig ~/.kube/config)&lt;br/&gt;    kubectl config set-cluster kubernetes \&lt;br/&gt;      --certificate-authority=/etc/kubernetes/cert/ca.pem \&lt;br/&gt;      --embed-certs=&lt;span&gt;true&lt;/span&gt; \&lt;br/&gt;      --server=${&lt;br/&gt;   &lt;br/&gt;     KUBE_APISERVER} \&lt;br/&gt;      --kubeconfig=kubelet-bootstrap-${&lt;br/&gt;   &lt;br/&gt;     all_name}.kubeconfig&lt;br/&gt;    kubectl config set-credentials kubelet-bootstrap \&lt;br/&gt;      --token=${&lt;br/&gt;   &lt;br/&gt;     BOOTSTRAP_TOKEN} \&lt;br/&gt;      --kubeconfig=kubelet-bootstrap-${&lt;br/&gt;   &lt;br/&gt;     all_name}.kubeconfig&lt;br/&gt;    kubectl config set-context &lt;span&gt;default&lt;/span&gt; \&lt;br/&gt;      --cluster=kubernetes \&lt;br/&gt;      --user=kubelet-bootstrap \&lt;br/&gt;      --kubeconfig=kubelet-bootstrap-${&lt;br/&gt;   &lt;br/&gt;     all_name}.kubeconfig&lt;br/&gt;    kubectl config use-context &lt;span&gt;default&lt;/span&gt; --kubeconfig=kubelet-bootstrap-${&lt;br/&gt;   &lt;br/&gt;     all_name}.kubeconfig&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubeadm token list --kubeconfig ~/.kube/config     # 查看 Kubeadm 为各节点创建的 Token&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl get secrets -n kube-system | grep bootstrap-token   # 查看各 Token 关联的 Secret&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.36592865928659285&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjB9Vw3Gxy2HjSeiaibicTx1l2v1nVassr3xElpAqmTlpnB2Ma6jlR23Frw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1626&quot;/&gt;&lt;figcaption&gt; &lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_name in ${&lt;br/&gt;   &lt;br/&gt;     ALL_NAMES[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_name}&quot;&lt;/span&gt;&lt;br/&gt;    scp kubelet-bootstrap-${&lt;br/&gt;   &lt;br/&gt;     all_name}.kubeconfig root@${&lt;br/&gt;   &lt;br/&gt;     all_name}:/etc/kubernetes/kubelet-bootstrap.kubeconfig&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;创建Kubelet 参数配置文件&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; kubelet-config.yaml.template &amp;lt;&amp;lt; EOF&lt;br/&gt;kind: KubeletConfiguration&lt;br/&gt;apiVersion: kubelet.config.k8s.io/v1beta1&lt;br/&gt;address: &lt;span&gt;&quot;##ALL_IP##&quot;&lt;/span&gt;&lt;br/&gt;staticPodPath: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;syncFrequency: &lt;span&gt;1&lt;/span&gt;m&lt;br/&gt;fileCheckFrequency: &lt;span&gt;20&lt;/span&gt;s&lt;br/&gt;httpCheckFrequency: &lt;span&gt;20&lt;/span&gt;s&lt;br/&gt;staticPodURL: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;port: &lt;span&gt;10250&lt;/span&gt;&lt;br/&gt;readOnlyPort: &lt;span&gt;0&lt;/span&gt;&lt;br/&gt;rotateCertificates: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;serverTLSBootstrap: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;authentication:&lt;br/&gt;  anonymous:&lt;br/&gt;    enabled: &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;  webhook:&lt;br/&gt;    enabled: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;  x509:&lt;br/&gt;    clientCAFile: &lt;span&gt;&quot;/etc/kubernetes/cert/ca.pem&quot;&lt;/span&gt;&lt;br/&gt;authorization:&lt;br/&gt;  mode: Webhook&lt;br/&gt;registryPullQPS: &lt;span&gt;0&lt;/span&gt;&lt;br/&gt;registryBurst: &lt;span&gt;20&lt;/span&gt;&lt;br/&gt;eventRecordQPS: &lt;span&gt;0&lt;/span&gt;&lt;br/&gt;eventBurst: &lt;span&gt;20&lt;/span&gt;&lt;br/&gt;enableDebuggingHandlers: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;enableContentionProfiling: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;healthzPort: &lt;span&gt;10248&lt;/span&gt;&lt;br/&gt;healthzBindAddress: &lt;span&gt;&quot;##ALL_IP##&quot;&lt;/span&gt;&lt;br/&gt;clusterDomain: &lt;span&gt;&quot;${CLUSTER_DNS_DOMAIN}&quot;&lt;/span&gt;&lt;br/&gt;clusterDNS:&lt;br/&gt;  - &lt;span&gt;&quot;${CLUSTER_DNS_SVC_IP}&quot;&lt;/span&gt;&lt;br/&gt;nodeStatusUpdateFrequency: &lt;span&gt;10&lt;/span&gt;s&lt;br/&gt;nodeStatusReportFrequency: &lt;span&gt;1&lt;/span&gt;m&lt;br/&gt;imageMinimumGCAge: &lt;span&gt;2&lt;/span&gt;m&lt;br/&gt;imageGCHighThresholdPercent: &lt;span&gt;85&lt;/span&gt;&lt;br/&gt;imageGCLowThresholdPercent: &lt;span&gt;80&lt;/span&gt;&lt;br/&gt;volumeStatsAggPeriod: &lt;span&gt;1&lt;/span&gt;m&lt;br/&gt;kubeletCgroups: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;systemCgroups: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;cgroupRoot: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;cgroupsPerQOS: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;cgroupDriver: cgroupfs&lt;br/&gt;runtimeRequestTimeout: &lt;span&gt;10&lt;/span&gt;m&lt;br/&gt;hairpinMode: promiscuous-bridge&lt;br/&gt;maxPods: &lt;span&gt;220&lt;/span&gt;&lt;br/&gt;podCIDR: &lt;span&gt;&quot;${CLUSTER_CIDR}&quot;&lt;/span&gt;&lt;br/&gt;podPidsLimit: -&lt;span&gt;1&lt;/span&gt;&lt;br/&gt;resolvConf: /etc/resolv.conf&lt;br/&gt;maxOpenFiles: &lt;span&gt;1000000&lt;/span&gt;&lt;br/&gt;kubeAPIQPS: &lt;span&gt;1000&lt;/span&gt;&lt;br/&gt;kubeAPIBurst: &lt;span&gt;2000&lt;/span&gt;&lt;br/&gt;serializeImagePulls: &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;evictionHard:&lt;br/&gt;  memory.available:  &lt;span&gt;&quot;100Mi&quot;&lt;/span&gt;&lt;br/&gt;nodefs.available:  &lt;span&gt;&quot;10%&quot;&lt;/span&gt;&lt;br/&gt;nodefs.inodesFree: &lt;span&gt;&quot;5%&quot;&lt;/span&gt;&lt;br/&gt;imagefs.available: &lt;span&gt;&quot;15%&quot;&lt;/span&gt;&lt;br/&gt;evictionSoft: {&lt;br/&gt;   &lt;br/&gt;     }&lt;br/&gt;enableControllerAttachDetach: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;failSwapOn: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;containerLogMaxSize: &lt;span&gt;20&lt;/span&gt;Mi&lt;br/&gt;containerLogMaxFiles: &lt;span&gt;10&lt;/span&gt;&lt;br/&gt;systemReserved: {&lt;br/&gt;   &lt;br/&gt;     }&lt;br/&gt;kubeReserved: {&lt;br/&gt;   &lt;br/&gt;     }&lt;br/&gt;systemReservedCgroup: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;kubeReservedCgroup: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;enforceNodeAllocatable: [&lt;span&gt;&quot;pods&quot;&lt;/span&gt;]&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    sed -e &lt;span&gt;&quot;s/##ALL_IP##/${all_ip}/&quot;&lt;/span&gt; kubelet-config.yaml.template &amp;gt; kubelet-config-${&lt;br/&gt;   &lt;br/&gt;     all_ip}.yaml.template&lt;br/&gt;    scp kubelet-config-${&lt;br/&gt;   &lt;br/&gt;     all_ip}.yaml.template root@${&lt;br/&gt;   &lt;br/&gt;     all_ip}:/etc/kubernetes/kubelet-config.yaml&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1）创建 Kubelet 启动脚本&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; kubelet.service.template &amp;lt;&amp;lt; EOF&lt;br/&gt;[Unit]&lt;br/&gt;Description=Kubernetes Kubelet&lt;br/&gt;Documentation=https:&lt;span&gt;//github.com/GoogleCloudPlatform/kubernetes&lt;/span&gt;&lt;br/&gt;After=docker.service&lt;br/&gt;Requires=docker.service&lt;br/&gt;&lt;br/&gt;[Service]&lt;br/&gt;WorkingDirectory=${&lt;br/&gt;   &lt;br/&gt;     K8S_DIR}/kubelet&lt;br/&gt;ExecStart=/opt/k8s/bin/kubelet \\&lt;br/&gt;  --bootstrap-kubeconfig=/etc/kubernetes/kubelet-bootstrap.kubeconfig \\&lt;br/&gt;  --cert-dir=/etc/kubernetes/cert \\&lt;br/&gt;  --cgroup-driver=cgroupfs \\&lt;br/&gt;  --cni-conf-dir=/etc/cni/net.d \\&lt;br/&gt;  --container-runtime=docker \\&lt;br/&gt;  --container-runtime-endpoint=unix:&lt;span&gt;///var/run/dockershim.sock \\&lt;/span&gt;&lt;br/&gt;  --root-dir=${&lt;br/&gt;   &lt;br/&gt;     K8S_DIR}/kubelet \\&lt;br/&gt;  --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \\&lt;br/&gt;  --config=/etc/kubernetes/kubelet-config.yaml \\&lt;br/&gt;  --hostname-override=##ALL_NAME## \\&lt;br/&gt;  --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause-amd64:&lt;span&gt;3.2&lt;/span&gt; \\&lt;br/&gt;  --image-pull-progress-deadline=&lt;span&gt;15&lt;/span&gt;m \\&lt;br/&gt;  --volume-plugin-dir=${&lt;br/&gt;   &lt;br/&gt;     K8S_DIR}/kubelet/kubelet-plugins/volume/exec/ \\&lt;br/&gt;  --logtostderr=&lt;span&gt;true&lt;/span&gt; \\&lt;br/&gt;  --v=&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;Restart=always&lt;br/&gt;RestartSec=&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;StartLimitInterval=&lt;span&gt;0&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;[Install]&lt;br/&gt;WantedBy=multi-user.target&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_name in ${&lt;br/&gt;   &lt;br/&gt;     ALL_NAMES[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_name}&quot;&lt;/span&gt;&lt;br/&gt;    sed -e &lt;span&gt;&quot;s/##ALL_NAME##/${all_name}/&quot;&lt;/span&gt; kubelet.service.template &amp;gt; kubelet-${&lt;br/&gt;   &lt;br/&gt;     all_name}.service&lt;br/&gt;    scp kubelet-${&lt;br/&gt;   &lt;br/&gt;     all_name}.service root@${&lt;br/&gt;   &lt;br/&gt;     all_name}:/etc/systemd/system/kubelet.service&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;2）启动并验证&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;授权&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --group=system:bootstrappers&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;启动Kubelet&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_name in ${&lt;br/&gt;   &lt;br/&gt;     ALL_NAMES[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_name}&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_name} &lt;span&gt;&quot;mkdir -p ${K8S_DIR}/kubelet/kubelet-plugins/volume/exec/&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_name} &lt;span&gt;&quot;systemctl daemon-reload &amp;amp;&amp;amp; systemctl enable kubelet --now&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查看Kubelet 服务&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_name in ${&lt;br/&gt;   &lt;br/&gt;     ALL_NAMES[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_name}&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_name} &lt;span&gt;&quot;systemctl status kubelet | grep active&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl get csr         # 因为我们还没做认证. 所以显示 Pengding 状态&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3759148369926813&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjsR548wIJVEPW7iaoMneHibkrpI3Uhbc3sZDvNX9a8WUUUCN3yno6PQUg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1503&quot;/&gt;&lt;figcaption&gt; &lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;3）Approve CSR 请求&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;自动Approve CSR 请求（创建三个 ClusterRoleBinding，分别用于自动 &lt;code&gt;approve client&lt;/code&gt; &lt;code&gt;renew client&lt;/code&gt; &lt;code&gt;renew server&lt;/code&gt; 证书）&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; csr-crb.yaml &amp;lt;&amp;lt; EOF&lt;br/&gt; # Approve all CSRs &lt;span&gt;for&lt;/span&gt; the group &lt;span&gt;&quot;system:bootstrappers&quot;&lt;/span&gt;&lt;br/&gt; kind: ClusterRoleBinding&lt;br/&gt; apiVersion: rbac.authorization.k8s.io/v1&lt;br/&gt; metadata:&lt;br/&gt;   name: auto-approve-csrs-&lt;span&gt;for&lt;/span&gt;-group&lt;br/&gt; subjects:&lt;br/&gt; - kind: Group&lt;br/&gt;   name: system:bootstrappers&lt;br/&gt;   apiGroup: rbac.authorization.k8s.io&lt;br/&gt; roleRef:&lt;br/&gt;   kind: ClusterRole&lt;br/&gt;   name: system:certificates.k8s.io:certificatesigningrequests:nodeclient&lt;br/&gt;   apiGroup: rbac.authorization.k8s.io&lt;br/&gt;---&lt;br/&gt; # To let a node of the group &lt;span&gt;&quot;system:nodes&quot;&lt;/span&gt; renew its own credentials&lt;br/&gt; kind: ClusterRoleBinding&lt;br/&gt; apiVersion: rbac.authorization.k8s.io/v1&lt;br/&gt; metadata:&lt;br/&gt;   name: node-client-cert-renewal&lt;br/&gt; subjects:&lt;br/&gt; - kind: Group&lt;br/&gt;   name: system:nodes&lt;br/&gt;   apiGroup: rbac.authorization.k8s.io&lt;br/&gt; roleRef:&lt;br/&gt;   kind: ClusterRole&lt;br/&gt;   name: system:certificates.k8s.io:certificatesigningrequests:selfnodeclient&lt;br/&gt;   apiGroup: rbac.authorization.k8s.io&lt;br/&gt;---&lt;br/&gt;# A ClusterRole which instructs the CSR approver to approve a node requesting a&lt;br/&gt;# serving cert matching its client cert.&lt;br/&gt;kind: ClusterRole&lt;br/&gt;apiVersion: rbac.authorization.k8s.io/v1&lt;br/&gt;metadata:&lt;br/&gt;  name: approve-node-server-renewal-csr&lt;br/&gt;rules:&lt;br/&gt;- apiGroups: [&lt;span&gt;&quot;certificates.k8s.io&quot;&lt;/span&gt;]&lt;br/&gt;  resources: [&lt;span&gt;&quot;certificatesigningrequests/selfnodeserver&quot;&lt;/span&gt;]&lt;br/&gt;  verbs: [&lt;span&gt;&quot;create&quot;&lt;/span&gt;]&lt;br/&gt;---&lt;br/&gt; # To let a node of the group &lt;span&gt;&quot;system:nodes&quot;&lt;/span&gt; renew its own server credentials&lt;br/&gt; kind: ClusterRoleBinding&lt;br/&gt; apiVersion: rbac.authorization.k8s.io/v1&lt;br/&gt; metadata:&lt;br/&gt;   name: node-server-cert-renewal&lt;br/&gt; subjects:&lt;br/&gt; - kind: Group&lt;br/&gt;   name: system:nodes&lt;br/&gt;   apiGroup: rbac.authorization.k8s.io&lt;br/&gt; roleRef:&lt;br/&gt;   kind: ClusterRole&lt;br/&gt;   name: approve-node-server-renewal-csr&lt;br/&gt;   apiGroup: rbac.authorization.k8s.io&lt;br/&gt;EOF&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl apply -f csr-crb.yaml&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;验证（等待一段时间 &lt;code&gt;1 ~ 5&lt;/code&gt; 分钟)，三个节点的 CSR 都自动 &lt;code&gt;approved&lt;/code&gt;）&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl get csr | grep boot    # 等待一段时间 (&lt;span&gt;1&lt;/span&gt;-&lt;span&gt;10&lt;/span&gt; 分钟)，三个节点的 CSR 都自动 approved&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl get nodes       # 所有节点均 Ready&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.2741184298070526&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjc4jicK7Y0iaKSXaqA5mWl6dibaKGfHibkNFibKicN3w9vv79f1q57KI7R9qA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1503&quot;/&gt;&lt;figcaption&gt; &lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# ls -l /etc/kubernetes/kubelet.kubeconfig&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# ls -l /etc/kubernetes/cert/ | grep kubelet&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.23401950162513543&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjmV6xHNrRsLkFJMQ9YODhOltEUQXkM4cwFJTEUmMtuDehJpibs6lwFkw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1846&quot;/&gt;&lt;figcaption&gt; &lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;4）手动 Approve Server Cert Csr&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;基于安全性考虑，CSR &lt;code&gt;approving controllers&lt;/code&gt; 不会自动 &lt;code&gt;approve kubelet server&lt;/code&gt; 证书签名请求，需要手动 &lt;code&gt;approve&lt;/code&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# kubectl get csr | grep node&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3169912693082606&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjWA5Wb0dwCSoctOROAv29jrHVcLHU9RH984ke3VZCvNRIKFAXVbib2zQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1489&quot;/&gt;&lt;figcaption&gt; &lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# kubectl get csr | grep Pending | awk &lt;span&gt;&#x27;{print $1}&#x27;&lt;/span&gt; | xargs kubectl certificate approve&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# ls -l /etc/kubernetes/cert/kubelet-*&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.2502708559046587&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjpGrQdTHz1GT4G1iblDeLBodU9Db0ibNM9VoIO91PgDlZYX3henicib0fCA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1846&quot;/&gt;&lt;figcaption&gt; &lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;5）Kubelet API 接口配置&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Kubelet API 认证和授权&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# curl -s --cacert /etc/kubernetes/cert/ca.pem https:&lt;span&gt;//192.168.1.1:10250/metrics&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# curl -s --cacert /etc/kubernetes/cert/ca.pem -H &lt;span&gt;&quot;Authorization: Bearer 123456&quot;&lt;/span&gt; https:&lt;span&gt;//192.168.1.1:10250/metrics&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.27824267782426776&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFj5yanN3ZIMwTF9H9lp2oicQ5RsXgW1cU6UcFcdzfmxjzNial2tmj7tibbw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1434&quot;/&gt;&lt;br/&gt;证书认证和授权&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;// 默认权限不足&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# curl -s --cacert /etc/kubernetes/cert/ca.pem --cert /etc/kubernetes/cert/kube-controller-manager.pem --key /etc/kubernetes/cert/kube-controller-manager-key.pem https:&lt;span&gt;//192.168.1.1:10250/metrics&lt;/span&gt;&lt;br/&gt;&lt;span&gt;// 使用最高权限的 admin&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# curl -s --cacert /etc/kubernetes/cert/ca.pem --cert /opt/k8s/work/admin.pem --key /opt/k8s/work/admin-key.pem https:&lt;span&gt;//192.168.1.1:10250/metrics | head&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;创建Bear Token 认证和授权&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# kubectl create serviceaccount kubelet-api-test&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# kubectl create clusterrolebinding kubelet-api-test --clusterrole=system:kubelet-api-admin --serviceaccount=&lt;span&gt;default&lt;/span&gt;:kubelet-api-test&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# SECRET=$(kubectl get secrets | grep kubelet-api-test | awk &lt;span&gt;&#x27;{print $1}&#x27;&lt;/span&gt;)&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# TOKEN=$(kubectl describe secret ${&lt;br/&gt;   &lt;br/&gt;     SECRET} | grep -E &lt;span&gt;&#x27;^token&#x27;&lt;/span&gt; | awk &lt;span&gt;&#x27;{print $2}&#x27;&lt;/span&gt;)&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# echo ${&lt;br/&gt;   &lt;br/&gt;     TOKEN}&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# curl -s --cacert /etc/kubernetes/cert/ca.pem -H &lt;span&gt;&quot;Authorization: Bearer ${TOKEN}&quot;&lt;/span&gt; https:&lt;span&gt;//192.168.1.1:10250/metrics | head&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;5.安装 Kube-Proxy 组件&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Kube-Proxy 运行在所有主机上，用来监听 APIServer 中的 Service 和 Endpoint 的变化情况，并创建路由规则来提供服务 IP 和负载均衡功能。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp kubernetes/server/bin/kube-proxy root@${&lt;br/&gt;   &lt;br/&gt;     all_ip}:/opt/k8s/bin/&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_ip} &lt;span&gt;&quot;chmod +x /opt/k8s/bin/*&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1）创建 Kube-Proxy 证书和密钥&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;创建Kube-Proxy 的 CA 证书请求文件&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; kube-proxy-csr.json &amp;lt;&amp;lt; EOF&lt;br/&gt;{&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;  &lt;span&gt;&quot;CN&quot;&lt;/span&gt;: &lt;span&gt;&quot;system:kube-proxy&quot;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;&quot;key&quot;&lt;/span&gt;: {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;    &lt;span&gt;&quot;algo&quot;&lt;/span&gt;: &lt;span&gt;&quot;rsa&quot;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;&quot;size&quot;&lt;/span&gt;: &lt;span&gt;2048&lt;/span&gt;&lt;br/&gt;  },&lt;br/&gt;  &lt;span&gt;&quot;names&quot;&lt;/span&gt;: [&lt;br/&gt;    {&lt;br/&gt;   &lt;br/&gt;     &lt;br/&gt;      &lt;span&gt;&quot;C&quot;&lt;/span&gt;: &lt;span&gt;&quot;CN&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;ST&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;L&quot;&lt;/span&gt;: &lt;span&gt;&quot;Shanghai&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;O&quot;&lt;/span&gt;: &lt;span&gt;&quot;k8s&quot;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;&quot;OU&quot;&lt;/span&gt;: &lt;span&gt;&quot;System&quot;&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;  ]&lt;br/&gt;}&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;2）生成证书和密钥&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cfssl gencert -ca=/opt/k8s/work/ca.pem -ca-key=/opt/k8s/work/ca-key.pem -config=/opt/k8s/work/ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;3）创建 Kubeconfig 文件&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config set-cluster kubernetes \&lt;br/&gt;  --certificate-authority=/opt/k8s/work/ca.pem \&lt;br/&gt;  --embed-certs=&lt;span&gt;true&lt;/span&gt; \&lt;br/&gt;  --server=${&lt;br/&gt;   &lt;br/&gt;     KUBE_APISERVER} \&lt;br/&gt;  --kubeconfig=kube-proxy.kubeconfig&lt;br/&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config set-credentials kube-proxy \&lt;br/&gt;  --client-certificate=kube-proxy.pem \&lt;br/&gt;  --client-key=kube-proxy-key.pem \&lt;br/&gt;  --embed-certs=&lt;span&gt;true&lt;/span&gt; \&lt;br/&gt;  --kubeconfig=kube-proxy.kubeconfig&lt;br/&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config set-context &lt;span&gt;default&lt;/span&gt; \&lt;br/&gt;  --cluster=kubernetes \&lt;br/&gt;  --user=kube-proxy \&lt;br/&gt;  --kubeconfig=kube-proxy.kubeconfig&lt;br/&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# kubectl config use-context &lt;span&gt;default&lt;/span&gt; --kubeconfig=kube-proxy.kubeconfig&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    scp kube-proxy.kubeconfig root@${&lt;br/&gt;   &lt;br/&gt;     all_ip}:/etc/kubernetes/&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;4）创建 Kube-Proxy 配置文件&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; kube-proxy-config.yaml.template &amp;lt;&amp;lt; EOF&lt;br/&gt;kind: KubeProxyConfiguration&lt;br/&gt;apiVersion: kubeproxy.config.k8s.io/v1alpha1&lt;br/&gt;clientConnection:&lt;br/&gt;  burst: &lt;span&gt;200&lt;/span&gt;&lt;br/&gt;  kubeconfig: &lt;span&gt;&quot;/etc/kubernetes/kube-proxy.kubeconfig&quot;&lt;/span&gt;&lt;br/&gt;  qps: &lt;span&gt;100&lt;/span&gt;&lt;br/&gt;bindAddress: ##ALL_IP##&lt;br/&gt;healthzBindAddress: ##ALL_IP##:&lt;span&gt;10256&lt;/span&gt;&lt;br/&gt;metricsBindAddress: ##ALL_IP##:&lt;span&gt;10249&lt;/span&gt;&lt;br/&gt;enableProfiling: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;clusterCIDR: ${&lt;br/&gt;   &lt;br/&gt;     CLUSTER_CIDR}&lt;br/&gt;hostnameOverride: ##ALL_NAME##&lt;br/&gt;mode: &lt;span&gt;&quot;ipvs&quot;&lt;/span&gt;&lt;br/&gt;portRange: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;kubeProxyIPTablesConfiguration:&lt;br/&gt;  masqueradeAll: &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;kubeProxyIPVSConfiguration:&lt;br/&gt;  scheduler: rr&lt;br/&gt;  excludeCIDRs: []&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; (( i=&lt;span&gt;0&lt;/span&gt;; i &amp;lt; &lt;span&gt;3&lt;/span&gt;; i++ ))&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${ALL_NAMES[i]}&quot;&lt;/span&gt;&lt;br/&gt;    sed -e &lt;span&gt;&quot;s/##ALL_NAME##/${ALL_NAMES[i]}/&quot;&lt;/span&gt; -e &lt;span&gt;&quot;s/##ALL_IP##/${ALL_IPS[i]}/&quot;&lt;/span&gt; kube-proxy-config.yaml.template &amp;gt; kube-proxy-config-${&lt;br/&gt;   &lt;br/&gt;     ALL_NAMES[i]}.yaml.template&lt;br/&gt;    scp kube-proxy-config-${&lt;br/&gt;   &lt;br/&gt;     ALL_NAMES[i]}.yaml.template root@${&lt;br/&gt;   &lt;br/&gt;     ALL_NAMES[i]}:/etc/kubernetes/kube-proxy-config.yaml&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;4）创建启动脚本&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cat &amp;gt; kube-proxy.service &amp;lt;&amp;lt; EOF&lt;br/&gt;[Unit]&lt;br/&gt;Description=Kubernetes Kube-Proxy Server&lt;br/&gt;Documentation=https:&lt;span&gt;//github.com/GoogleCloudPlatform/kubernetes&lt;/span&gt;&lt;br/&gt;After=network.target&lt;br/&gt;&lt;br/&gt;[Service]&lt;br/&gt;WorkingDirectory=${&lt;br/&gt;   &lt;br/&gt;     K8S_DIR}/kube-proxy&lt;br/&gt;ExecStart=/opt/k8s/bin/kube-proxy \\&lt;br/&gt;  --config=/etc/kubernetes/kube-proxy-config.yaml \\&lt;br/&gt;  --logtostderr=&lt;span&gt;true&lt;/span&gt; \\&lt;br/&gt;  --v=&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;Restart=on-failure&lt;br/&gt;RestartSec=&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;LimitNOFILE=&lt;span&gt;65536&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;[Install]&lt;br/&gt;WantedBy=multi-user.target&lt;br/&gt;EOF&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_name in ${&lt;br/&gt;   &lt;br/&gt;     ALL_NAMES[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_name}&quot;&lt;/span&gt;&lt;br/&gt;    scp kube-proxy.service root@${&lt;br/&gt;   &lt;br/&gt;     all_name}:/etc/systemd/system/&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;5）启动并验证&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; all_ip in ${&lt;br/&gt;   &lt;br/&gt;     ALL_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_ip}&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_ip} &lt;span&gt;&quot;mkdir -p ${K8S_DIR}/kube-proxy&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_ip} &lt;span&gt;&quot;modprobe ip_vs_rr&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_ip} &lt;span&gt;&quot;systemctl daemon-reload &amp;amp;&amp;amp; systemctl enable kube-proxy --now&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查看&lt;code&gt;ipvs&lt;/code&gt; 路由规则&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# ipvsadm -ln&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.33987915407854985&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjG7AgZtVk1h0M13PY5PCBToFibso96WL9KzUZcbfnUnRoPw4SXN1xeYw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1324&quot;/&gt;&lt;br/&gt;&lt;strong&gt;问题：&lt;/strong&gt; 当我们在启动 &lt;code&gt;kube-proxy&lt;/code&gt; 组件后，通过 &lt;code&gt;systemctl&lt;/code&gt; 查看该组件状态时，出现如下错误&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;Not using --random-fully in the MASQUERADE rule &lt;span&gt;for&lt;/span&gt; iptables because the local version of iptables does not support it&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上面报错是因为我们的 &lt;code&gt;iptables&lt;/code&gt; 版本不支持 &lt;code&gt;--random-fully&lt;/code&gt; 配置（1.6.2 版本上支持），所以我们需要对 &lt;code&gt;iptables&lt;/code&gt; 进行升级操作。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@master&lt;/span&gt;01 work]# wget https:&lt;span&gt;//www.netfilter.org/projects/iptables/files/iptables-1.6.2.tar.bz2 --no-check-certificate&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@master&lt;/span&gt;01 work]# &lt;span&gt;for&lt;/span&gt; all_name in ${&lt;br/&gt;   &lt;br/&gt;     ALL_NAMES[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${all_name}&quot;&lt;/span&gt;&lt;br/&gt;    scp iptables-&lt;span&gt;1.6.2&lt;/span&gt;.tar.bz2 root@${&lt;br/&gt;   &lt;br/&gt;     all_name}:/root/&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_name} &lt;span&gt;&quot;yum -y install gcc make libnftnl-devel libmnl-devel autoconf automake libtool bison flex libnetfilter_conntrack-devel libnetfilter_queue-devel libpcap-devel bzip2&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_name} &lt;span&gt;&quot;export LC_ALL=C &amp;amp;&amp;amp; tar -xf iptables-1.6.2.tar.bz2 &amp;amp;&amp;amp; cd iptables-1.6.2 &amp;amp;&amp;amp; ./autogen.sh &amp;amp;&amp;amp; ./configure &amp;amp;&amp;amp; make &amp;amp;&amp;amp; make install&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     all_name} &lt;span&gt;&quot;systemctl daemon-reload &amp;amp;&amp;amp; systemctl restart kubelet &amp;amp;&amp;amp; systemctl restart kube-proxy&quot;&lt;/span&gt;&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;6.安装 CoreDNS 插件&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1）修改 Coredns 配置&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 ~]# cd /opt/k8s/work/kubernetes/cluster/addons/dns/coredns&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 coredns]# cp coredns.yaml.base coredns.yaml&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 coredns]# sed -i -e &lt;span&gt;&quot;s/__PILLAR__DNS__DOMAIN__/${CLUSTER_DNS_DOMAIN}/&quot;&lt;/span&gt; -e &lt;span&gt;&quot;s/__PILLAR__DNS__SERVER__/${CLUSTER_DNS_SVC_IP}/&quot;&lt;/span&gt; -e &lt;span&gt;&quot;s/__PILLAR__DNS__MEMORY__LIMIT__/200Mi/&quot;&lt;/span&gt; coredns.yaml&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;2）创建 Coredns 并启动&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;配置调度策略&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 coredns]# kubectl label nodes k8s-master01 node-role.kubernetes.io/master=&lt;span&gt;true&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 coredns]# kubectl label nodes k8s-master02 node-role.kubernetes.io/master=&lt;span&gt;true&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 coredns]# vim coredns.yaml&lt;br/&gt;......&lt;br/&gt;apiVersion: apps/v1&lt;br/&gt;kind: Deployment&lt;br/&gt;......&lt;br/&gt;spec:&lt;br/&gt;  replicas: &lt;span&gt;2&lt;/span&gt;               # 配置成两个副本&lt;br/&gt;......&lt;br/&gt;      tolerations:&lt;br/&gt;        - key: &lt;span&gt;&quot;node-role.kubernetes.io/master&quot;&lt;/span&gt;&lt;br/&gt;          operator: &lt;span&gt;&quot;Equal&quot;&lt;/span&gt;&lt;br/&gt;          value: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;          effect: NoSchedule&lt;br/&gt;      nodeSelector:&lt;br/&gt;        node-role.kubernetes.io/master: &lt;span&gt;&quot;true&quot;&lt;/span&gt;&lt;br/&gt;......&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 coredns]# kubectl create -f coredns.yaml&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3721498371335505&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjQXSJ15Evr3fvibxJyzavJliatO8W2HKA6iafFiaVsVCQYQUZxuzfT9yqxg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1228&quot;/&gt;&lt;figcaption&gt; &lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;kubectl describe pod Pod-Name -n kube-system           # Pod-Name 你们需要换成自己的&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;因为上面镜像使用的是 K8s 官方的镜像（国外），所以可能会出现：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;Normal   BackOff    &lt;span&gt;72&lt;/span&gt;s (x6 over &lt;span&gt;3&lt;/span&gt;m47s)   kubelet, k8s-master01  Back-off pulling image &lt;span&gt;&quot;k8s.gcr.io/coredns:1.6.5&quot;&lt;/span&gt;&lt;br/&gt;Warning  Failed     &lt;span&gt;57&lt;/span&gt;s (x7 over &lt;span&gt;3&lt;/span&gt;m47s)   kubelet, k8s-master01  Error: ImagePullBackOff&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;出现如上问题后，我们可以通过拉取其它仓库中的镜像，拉取完后重新打个标签即可。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;如：docker pull k8s.gcr.io/coredns:&lt;span&gt;1.6.5&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;我们可以：&lt;br/&gt;docker pull registry.aliyuncs.com/google_containers/coredns:&lt;span&gt;1.6.5&lt;/span&gt;&lt;br/&gt;docker tag registry.aliyuncs.com/google_containers/coredns:&lt;span&gt;1.6.5&lt;/span&gt; k8s.gcr.io/coredns:&lt;span&gt;1.6.5&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;3）验证&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 coredns]# kubectl run -it --rm test-dns --image=busybox:&lt;span&gt;1.28.4&lt;/span&gt; sh&lt;br/&gt;If you don&lt;span&gt;&#x27;t see a command prompt, try pressing enter.&lt;br/&gt;/ # &lt;br/&gt;/ # nslookup kubernetes&lt;br/&gt;Server:    10.20.0.254&lt;br/&gt;Address 1: 10.20.0.254 kube-dns.kube-system.svc.cluster.local&lt;br/&gt;&lt;br/&gt;Name:      kubernetes&lt;br/&gt;Address 1: 10.20.0.1 kubernetes.default.svc.cluster.local&lt;br/&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;7.安装 Dashboard 仪表盘&lt;/h2&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 coredns]# cd /opt/k8s/work/&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# mkdir metrics&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cd metrics/&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 metrics]# wget https:&lt;span&gt;//github.com/kubernetes-sigs/metrics-server/releases/download/v0.3.6/components.yaml&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 metrics]# vim components.yaml&lt;br/&gt;......&lt;br/&gt;apiVersion: apps/v1&lt;br/&gt;kind: Deployment&lt;br/&gt;metadata:&lt;br/&gt;  name: metrics-server&lt;br/&gt;  namespace: kube-system&lt;br/&gt;  labels:&lt;br/&gt;    k8s-app: metrics-server&lt;br/&gt;spec:&lt;br/&gt;  replicas: &lt;span&gt;2&lt;/span&gt;            # 修改副本数&lt;br/&gt;  selector:&lt;br/&gt;    matchLabels:&lt;br/&gt;      k8s-app: metrics-server&lt;br/&gt;  template:&lt;br/&gt;    metadata:&lt;br/&gt;      name: metrics-server&lt;br/&gt;      labels:&lt;br/&gt;        k8s-app: metrics-server&lt;br/&gt;    spec:&lt;br/&gt;      hostNetwork: &lt;span&gt;true&lt;/span&gt;          # 配置主机网络&lt;br/&gt;      serviceAccountName: metrics-server&lt;br/&gt;      volumes:&lt;br/&gt;      # mount in tmp so we can safely use from-scratch images and/or read-only containers&lt;br/&gt;      - name: tmp-dir&lt;br/&gt;        emptyDir: {&lt;br/&gt;   &lt;br/&gt;     }&lt;br/&gt;      containers:&lt;br/&gt;      - name: metrics-server&lt;br/&gt;        image: registry.aliyuncs.com/google_containers/metrics-server-amd64:v0&lt;span&gt;.3.6&lt;/span&gt;  # 修改镜像名&lt;br/&gt;        imagePullPolicy: IfNotPresent&lt;br/&gt;        args:&lt;br/&gt;          - --cert-dir=/tmp&lt;br/&gt;          - --secure-port=&lt;span&gt;4443&lt;/span&gt;&lt;br/&gt;          - --kubelet-insecure-tls       # 新加的&lt;br/&gt;          - --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP # 新加的&lt;br/&gt;......&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 metrics]# kubectl create -f components.yaml &lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;验证：&lt;img data-ratio=&quot;0.39086294416243655&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjqa7zr5c7Z8Oh7HPOD2I1AwOUQlnDx1zwpO0KXHReFKKThBC6B0IPUg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1379&quot;/&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1）创建证书&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 metrics]# cd /opt/k8s/work/&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# mkdir -p /opt/k8s/work/dashboard/certs&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# openssl req -x509 -nodes -days &lt;span&gt;365&lt;/span&gt; -newkey rsa:&lt;span&gt;2048&lt;/span&gt; -keyout tls.key -out tls.crt -subj &lt;span&gt;&quot;/C=CN/ST=ZheJiang/L=HangZhou/O=Xianghy/OU=Xianghy/CN=k8s.odocker.com&quot;&lt;/span&gt;&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# &lt;span&gt;for&lt;/span&gt; master_ip in ${&lt;br/&gt;   &lt;br/&gt;     MASTER_IPS[@]}&lt;br/&gt;  &lt;span&gt;do&lt;/span&gt;&lt;br/&gt;    echo &lt;span&gt;&quot;&amp;gt;&amp;gt;&amp;gt; ${master_ip}&quot;&lt;/span&gt;&lt;br/&gt;    ssh root@${&lt;br/&gt;   &lt;br/&gt;     master_ip} &lt;span&gt;&quot;mkdir -p /opt/k8s/work/dashboard/certs&quot;&lt;/span&gt; &lt;br/&gt;    scp tls.* root@${&lt;br/&gt;   &lt;br/&gt;     master_ip}:/opt/k8s/work/dashboard/certs/&lt;br/&gt;  done&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;2）修改 Dashboard 配置&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;手动创建 Secret&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@master&lt;/span&gt;01 ~]# kubectl create namespace kubernetes-dashboard&lt;br/&gt;[root&lt;span&gt;@master&lt;/span&gt;01 ~]# kubectl create secret generic kubernetes-dashboard-certs --from-file=/opt/k8s/work/dashboard/certs -n kubernetes-dashboard&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;修改Dashboard 配置（你们可以通过这个地址来看 Dashboard 的 &lt;code&gt;yaml&lt;/code&gt; 文件：传送门）&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 work]# cd dashboard/&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 dashboard]# vim dashboard.yaml&lt;br/&gt;apiVersion: v1&lt;br/&gt;kind: ServiceAccount&lt;br/&gt;metadata:&lt;br/&gt;  labels:&lt;br/&gt;    k8s-app: kubernetes-dashboard&lt;br/&gt;  name: kubernetes-dashboard&lt;br/&gt;  namespace: kubernetes-dashboard&lt;br/&gt;---&lt;br/&gt;kind: Service&lt;br/&gt;apiVersion: v1&lt;br/&gt;metadata:&lt;br/&gt;  labels:&lt;br/&gt;    k8s-app: kubernetes-dashboard&lt;br/&gt;  name: kubernetes-dashboard&lt;br/&gt;  namespace: kubernetes-dashboard&lt;br/&gt;spec:&lt;br/&gt;  type: NodePort&lt;br/&gt;  ports:&lt;br/&gt;    - port: &lt;span&gt;443&lt;/span&gt;&lt;br/&gt;      targetPort: &lt;span&gt;8443&lt;/span&gt;&lt;br/&gt;      nodePort: &lt;span&gt;30080&lt;/span&gt;&lt;br/&gt;  selector:&lt;br/&gt;    k8s-app: kubernetes-dashboard&lt;br/&gt;---&lt;br/&gt;apiVersion: v1&lt;br/&gt;kind: Secret&lt;br/&gt;metadata:&lt;br/&gt;  labels:&lt;br/&gt;    k8s-app: kubernetes-dashboard&lt;br/&gt;  name: kubernetes-dashboard-csrf&lt;br/&gt;  namespace: kubernetes-dashboard&lt;br/&gt;type: Opaque&lt;br/&gt;data:&lt;br/&gt;  csrf: &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;---&lt;br/&gt;apiVersion: v1&lt;br/&gt;kind: Secret&lt;br/&gt;metadata:&lt;br/&gt;  labels:&lt;br/&gt;    k8s-app: kubernetes-dashboard&lt;br/&gt;  name: kubernetes-dashboard-key-holder&lt;br/&gt;  namespace: kubernetes-dashboard&lt;br/&gt;type: Opaque&lt;br/&gt;---&lt;br/&gt;kind: ConfigMap&lt;br/&gt;apiVersion: v1&lt;br/&gt;metadata:&lt;br/&gt;  labels:&lt;br/&gt;    k8s-app: kubernetes-dashboard&lt;br/&gt;  name: kubernetes-dashboard-settings&lt;br/&gt;  namespace: kubernetes-dashboard&lt;br/&gt;---&lt;br/&gt;kind: Role&lt;br/&gt;apiVersion: rbac.authorization.k8s.io/v1&lt;br/&gt;metadata:&lt;br/&gt;  labels:&lt;br/&gt;    k8s-app: kubernetes-dashboard&lt;br/&gt;  name: kubernetes-dashboard&lt;br/&gt;  namespace: kubernetes-dashboard&lt;br/&gt;rules:&lt;br/&gt;  - apiGroups: [&lt;span&gt;&quot;&quot;&lt;/span&gt;]&lt;br/&gt;    resources: [&lt;span&gt;&quot;secrets&quot;&lt;/span&gt;]&lt;br/&gt;    resourceNames: [&lt;span&gt;&quot;kubernetes-dashboard-key-holder&quot;&lt;/span&gt;, &lt;span&gt;&quot;kubernetes-dashboard-certs&quot;&lt;/span&gt;, &lt;span&gt;&quot;kubernetes-dashboard-csrf&quot;&lt;/span&gt;]&lt;br/&gt;    verbs: [&lt;span&gt;&quot;get&quot;&lt;/span&gt;, &lt;span&gt;&quot;update&quot;&lt;/span&gt;, &lt;span&gt;&quot;delete&quot;&lt;/span&gt;]&lt;br/&gt;  - apiGroups: [&lt;span&gt;&quot;&quot;&lt;/span&gt;]&lt;br/&gt;    resources: [&lt;span&gt;&quot;configmaps&quot;&lt;/span&gt;]&lt;br/&gt;    resourceNames: [&lt;span&gt;&quot;kubernetes-dashboard-settings&quot;&lt;/span&gt;]&lt;br/&gt;    verbs: [&lt;span&gt;&quot;get&quot;&lt;/span&gt;, &lt;span&gt;&quot;update&quot;&lt;/span&gt;]&lt;br/&gt;  - apiGroups: [&lt;span&gt;&quot;&quot;&lt;/span&gt;]&lt;br/&gt;    resources: [&lt;span&gt;&quot;services&quot;&lt;/span&gt;]&lt;br/&gt;    resourceNames: [&lt;span&gt;&quot;heapster&quot;&lt;/span&gt;, &lt;span&gt;&quot;dashboard-metrics-scraper&quot;&lt;/span&gt;]&lt;br/&gt;    verbs: [&lt;span&gt;&quot;proxy&quot;&lt;/span&gt;]&lt;br/&gt;  - apiGroups: [&lt;span&gt;&quot;&quot;&lt;/span&gt;]&lt;br/&gt;    resources: [&lt;span&gt;&quot;services/proxy&quot;&lt;/span&gt;]&lt;br/&gt;    resourceNames: [&lt;span&gt;&quot;heapster&quot;&lt;/span&gt;, &lt;span&gt;&quot;http:heapster:&quot;&lt;/span&gt;, &lt;span&gt;&quot;https:heapster:&quot;&lt;/span&gt;, &lt;span&gt;&quot;dashboard-metrics-scraper&quot;&lt;/span&gt;, &lt;span&gt;&quot;http:dashboard-metrics-scraper&quot;&lt;/span&gt;]&lt;br/&gt;    verbs: [&lt;span&gt;&quot;get&quot;&lt;/span&gt;]&lt;br/&gt;---&lt;br/&gt;kind: ClusterRole&lt;br/&gt;apiVersion: rbac.authorization.k8s.io/v1&lt;br/&gt;metadata:&lt;br/&gt;  labels:&lt;br/&gt;    k8s-app: kubernetes-dashboard&lt;br/&gt;  name: kubernetes-dashboard&lt;br/&gt;rules:&lt;br/&gt;  # Allow Metrics Scraper to get metrics from the Metrics server&lt;br/&gt;  - apiGroups: [&lt;span&gt;&quot;metrics.k8s.io&quot;&lt;/span&gt;]&lt;br/&gt;    resources: [&lt;span&gt;&quot;pods&quot;&lt;/span&gt;, &lt;span&gt;&quot;nodes&quot;&lt;/span&gt;]&lt;br/&gt;    verbs: [&lt;span&gt;&quot;get&quot;&lt;/span&gt;, &lt;span&gt;&quot;list&quot;&lt;/span&gt;, &lt;span&gt;&quot;watch&quot;&lt;/span&gt;]&lt;br/&gt;---&lt;br/&gt;apiVersion: rbac.authorization.k8s.io/v1&lt;br/&gt;kind: RoleBinding&lt;br/&gt;metadata:&lt;br/&gt;  labels:&lt;br/&gt;    k8s-app: kubernetes-dashboard&lt;br/&gt;  name: kubernetes-dashboard&lt;br/&gt;  namespace: kubernetes-dashboard&lt;br/&gt;roleRef:&lt;br/&gt;  apiGroup: rbac.authorization.k8s.io&lt;br/&gt;  kind: Role&lt;br/&gt;  name: kubernetes-dashboard&lt;br/&gt;subjects:&lt;br/&gt;  - kind: ServiceAccount&lt;br/&gt;    name: kubernetes-dashboard&lt;br/&gt;    namespace: kubernetes-dashboard&lt;br/&gt;---&lt;br/&gt;apiVersion: rbac.authorization.k8s.io/v1&lt;br/&gt;kind: ClusterRoleBinding&lt;br/&gt;metadata:&lt;br/&gt;  name: kubernetes-dashboard&lt;br/&gt;roleRef:&lt;br/&gt;  apiGroup: rbac.authorization.k8s.io&lt;br/&gt;  kind: ClusterRole&lt;br/&gt;  name: kubernetes-dashboard&lt;br/&gt;subjects:&lt;br/&gt;  - kind: ServiceAccount&lt;br/&gt;    name: kubernetes-dashboard&lt;br/&gt;    namespace: kubernetes-dashboard&lt;br/&gt;---&lt;br/&gt;kind: Deployment&lt;br/&gt;apiVersion: apps/v1&lt;br/&gt;metadata:&lt;br/&gt;  labels:&lt;br/&gt;    k8s-app: kubernetes-dashboard&lt;br/&gt;  name: kubernetes-dashboard&lt;br/&gt;  namespace: kubernetes-dashboard&lt;br/&gt;spec:&lt;br/&gt;  replicas: &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;  revisionHistoryLimit: &lt;span&gt;10&lt;/span&gt;&lt;br/&gt;  selector:&lt;br/&gt;    matchLabels:&lt;br/&gt;      k8s-app: kubernetes-dashboard&lt;br/&gt;  template:&lt;br/&gt;    metadata:&lt;br/&gt;      labels:&lt;br/&gt;        k8s-app: kubernetes-dashboard&lt;br/&gt;    spec:&lt;br/&gt;      containers:&lt;br/&gt;        - name: kubernetes-dashboard&lt;br/&gt;          image: kubernetesui/dashboard:v2&lt;span&gt;.0.0&lt;/span&gt;-beta8&lt;br/&gt;          imagePullPolicy: IfNotPresent&lt;br/&gt;          ports:&lt;br/&gt;            - containerPort: &lt;span&gt;8443&lt;/span&gt;&lt;br/&gt;              protocol: TCP&lt;br/&gt;          args:&lt;br/&gt;            - --auto-generate-certificates&lt;br/&gt;            - --namespace=kubernetes-dashboard&lt;br/&gt;            - --tls-key-file=tls.key&lt;br/&gt;            - --tls-cert-file=tls.crt&lt;br/&gt;            - --token-ttl=&lt;span&gt;3600&lt;/span&gt;&lt;br/&gt;          volumeMounts:&lt;br/&gt;            - name: kubernetes-dashboard-certs&lt;br/&gt;              mountPath: /certs&lt;br/&gt;            - mountPath: /tmp&lt;br/&gt;              name: tmp-volume&lt;br/&gt;          livenessProbe:&lt;br/&gt;            httpGet:&lt;br/&gt;              scheme: HTTPS&lt;br/&gt;              path: /&lt;br/&gt;              port: &lt;span&gt;8443&lt;/span&gt;&lt;br/&gt;            initialDelaySeconds: &lt;span&gt;30&lt;/span&gt;&lt;br/&gt;            timeoutSeconds: &lt;span&gt;30&lt;/span&gt;&lt;br/&gt;          securityContext:&lt;br/&gt;            allowPrivilegeEscalation: &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;            readOnlyRootFilesystem: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;            runAsUser: &lt;span&gt;1001&lt;/span&gt;&lt;br/&gt;            runAsGroup: &lt;span&gt;2001&lt;/span&gt;&lt;br/&gt;      volumes:&lt;br/&gt;        - name: kubernetes-dashboard-certs&lt;br/&gt;          secret:&lt;br/&gt;            secretName: kubernetes-dashboard-certs&lt;br/&gt;        - name: tmp-volume&lt;br/&gt;          emptyDir: {&lt;br/&gt;   &lt;br/&gt;     }&lt;br/&gt;      serviceAccountName: kubernetes-dashboard&lt;br/&gt;      nodeSelector:&lt;br/&gt;        &lt;span&gt;&quot;beta.kubernetes.io/os&quot;&lt;/span&gt;: linux&lt;br/&gt;      tolerations:&lt;br/&gt;        - key: node-role.kubernetes.io/master&lt;br/&gt;          effect: NoSchedule&lt;br/&gt;---&lt;br/&gt;kind: Service&lt;br/&gt;apiVersion: v1&lt;br/&gt;metadata:&lt;br/&gt;  labels:&lt;br/&gt;    k8s-app: dashboard-metrics-scraper&lt;br/&gt;  name: dashboard-metrics-scraper&lt;br/&gt;  namespace: kubernetes-dashboard&lt;br/&gt;spec:&lt;br/&gt;  ports:&lt;br/&gt;    - port: &lt;span&gt;8000&lt;/span&gt;&lt;br/&gt;      targetPort: &lt;span&gt;8000&lt;/span&gt;&lt;br/&gt;  selector:&lt;br/&gt;    k8s-app: dashboard-metrics-scraper&lt;br/&gt;---&lt;br/&gt;kind: Deployment&lt;br/&gt;apiVersion: apps/v1&lt;br/&gt;metadata:&lt;br/&gt;  labels:&lt;br/&gt;    k8s-app: dashboard-metrics-scraper&lt;br/&gt;  name: dashboard-metrics-scraper&lt;br/&gt;  namespace: kubernetes-dashboard&lt;br/&gt;spec:&lt;br/&gt;  replicas: &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;  revisionHistoryLimit: &lt;span&gt;10&lt;/span&gt;&lt;br/&gt;  selector:&lt;br/&gt;    matchLabels:&lt;br/&gt;      k8s-app: dashboard-metrics-scraper&lt;br/&gt;  template:&lt;br/&gt;    metadata:&lt;br/&gt;      labels:&lt;br/&gt;        k8s-app: dashboard-metrics-scraper&lt;br/&gt;      annotations:&lt;br/&gt;        seccomp.security.alpha.kubernetes.io/pod: &lt;span&gt;&#x27;runtime/default&#x27;&lt;/span&gt;&lt;br/&gt;    spec:&lt;br/&gt;      containers:&lt;br/&gt;        - name: dashboard-metrics-scraper&lt;br/&gt;          image: kubernetesui/metrics-scraper:v1&lt;span&gt;.0.1&lt;/span&gt;&lt;br/&gt;          imagePullPolicy: IfNotPresent&lt;br/&gt;          ports:&lt;br/&gt;            - containerPort: &lt;span&gt;8000&lt;/span&gt;&lt;br/&gt;              protocol: TCP&lt;br/&gt;          livenessProbe:&lt;br/&gt;            httpGet:&lt;br/&gt;              scheme: HTTP&lt;br/&gt;              path: /&lt;br/&gt;              port: &lt;span&gt;8000&lt;/span&gt;&lt;br/&gt;            initialDelaySeconds: &lt;span&gt;30&lt;/span&gt;&lt;br/&gt;            timeoutSeconds: &lt;span&gt;30&lt;/span&gt;&lt;br/&gt;          volumeMounts:&lt;br/&gt;          - mountPath: /tmp&lt;br/&gt;            name: tmp-volume&lt;br/&gt;          securityContext:&lt;br/&gt;            allowPrivilegeEscalation: &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;            readOnlyRootFilesystem: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;            runAsUser: &lt;span&gt;1001&lt;/span&gt;&lt;br/&gt;            runAsGroup: &lt;span&gt;2001&lt;/span&gt;&lt;br/&gt;      serviceAccountName: kubernetes-dashboard&lt;br/&gt;      nodeSelector:&lt;br/&gt;        &lt;span&gt;&quot;beta.kubernetes.io/os&quot;&lt;/span&gt;: linux&lt;br/&gt;      tolerations:&lt;br/&gt;        - key: node-role.kubernetes.io/master&lt;br/&gt;          effect: NoSchedule&lt;br/&gt;      volumes:&lt;br/&gt;        - name: tmp-volume&lt;br/&gt;          emptyDir: {&lt;br/&gt;   &lt;br/&gt;     }&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 dashboard]# kubectl create -f dashboard.yaml          &lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;创建管理员账户&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 dashboard]# kubectl create serviceaccount admin-user -n kubernetes-dashboard&lt;br/&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 dashboard]# kubectl create clusterrolebinding admin-user --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:admin-user&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;3）验证&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;获取登录令牌&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;[root&lt;span&gt;@k&lt;/span&gt;8s-master01 dashboard]# kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk &lt;span&gt;&#x27;{print $1}&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.34816941852117733&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjd7xna7LNnkXjhCtUickcfnbOgOnAibRiaica1mGlFobNptTAbhEiaWnZNpw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1393&quot;/&gt;&lt;br/&gt;访问：&lt;code&gt;https://192.168.1.1:30080&lt;/code&gt;&lt;br/&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.46749024707412223&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFjRgv8aG1HI87QCkKoJicn75IXPFrVl8zxvaZuVu2L9YibNeey7AZJUVicA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1538&quot;/&gt;&lt;br/&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5359375&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/GpcH5Yqqj0n9Cliag8kbwng634qNfmqFj7kwBMxjjPuomuTbIe30CS9JhWTsMzsjyKiacQiacAIW57xpjaMmWek7g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1920&quot;/&gt;&lt;br/&gt;到此，我们的 Kubernetes 便搭建完成了，如果你们在安装中出现问题，可以通过下面的推广信息来联系博主共同探讨。&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>ef0c69802de9573be1abd0d036d44d0d</guid>
<title>应用实践 | 蜀海供应链基于 Apache Doris 的数据中台建设</title>
<link>https://toutiao.io/k/acnbqim</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content                                       &quot; id=&quot;js_content&quot;&gt;
            &lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;span&gt;关注&lt;/span&gt;&lt;span&gt;「SelectDB」&lt;/span&gt;&lt;span&gt;第一时间获取更多资讯！&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;custom_select_card mp_profile_iframe js_uneditable&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;Mzg3Njc2NDAwOA==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSaYO6RicI4f7wJp8iamVJ655osRGXKPTyYACfNLfwp3uqv0exQg73CPVXiajkOsyuLycE1iaKN9pET87w/0?wx_fmt=png&quot; data-nickname=&quot;SelectDB&quot; data-alias=&quot;SelectDB&quot; data-signature=&quot;The enterprise-grade cloud-native distribution for Apache Doris(incubating)&quot; data-from=&quot;2&quot;/&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section data-mpa-template-id=&quot;1159112&quot; data-mpa-category=&quot;fav&quot;&gt;&lt;section&gt;&lt;section data-tools-id=&quot;21516&quot;&gt;&lt;section powered-by=&quot;KolEditor.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;KolEditor.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;导读：&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;蜀海供应链是集销售、研发、采购、生产、品保、仓储、运输、信息、金融为一体的餐饮供应链服务企业，因其业务比较复杂，2020 年底完成了以 Apache Doris 为核心的架构升级，并在 2021 年开始建设以 Apache Doris 为核心的数据中台。&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;本文将从数据接入，数据服务编排，数据安全，Doris 应用等方面进行介绍。&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span/&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;作者&lt;/span&gt;&lt;strong&gt;&lt;span&gt;｜&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;蜀海供应链大数据团队负责人 &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;韦永绪&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;业务背景&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;蜀海供应链是集销售、研发、采购、生产、品保、仓储、运输、信息、金融为一体的餐饮供应链服务企业，为广大餐饮连锁企业及零售客户提供整体食材供应链解决方案服务。&lt;/span&gt;&lt;span&gt;因&lt;/span&gt;&lt;span&gt;其业务比较复杂，&lt;/span&gt;&lt;span&gt;&lt;strong&gt;2020 年底完成了以 Apache Doris 为核心的架构升级，并在 2021 年开始建设以 Apache Doris 为核心的数据中台。&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;在使用 Doris 之前，我们采用了 CDH 这套数据平台，用了很多组件，但其链路过长，&lt;span&gt;并且开发和维护成本比较大，最后&lt;/span&gt;没有引入一个很好的 OLAP 系统。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;因为我们的数据历史包袱比较轻，经过对 Apache Doris 的调研和测试，决定&lt;/span&gt;&lt;strong&gt;&lt;span&gt;使用以 Apache Doris 为核心建设数据平台，它有以下优势：&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;架构图如下：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.42896935933147634&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFiaxa0NB7NliabWibibL5xQEX0GNichl7baD5YBMgDOsBibATKX5ianuSOxThw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1077&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;由于之前已经对&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzI4ODMyNTcwMw==&amp;amp;mid=2247484100&amp;amp;idx=1&amp;amp;sn=77b2edceabc45df1874e6d71f56574f2&amp;amp;chksm=ebc16becdcb6e2fac27083bdc7871f811015583d95f63858bea1631c465c90e5caec8f7911f4&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;元数据，数据服务，接入数据质量，血缘关系的建设&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;元数据，数据服务，接入数据质量，血缘关系的建设&lt;/a&gt;做过介绍，&lt;/span&gt;&lt;span&gt;本文将从数据接入，数据服务编排，数据安全，Doris 应用等方面进行介绍。&lt;/span&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;数据接入&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;数据接入功能是数据开发的重要一环，我们开发了一套数据接入系统，在 Web 端操作，&lt;/span&gt;&lt;span&gt;&lt;strong&gt;实现零代码数据接入到 Doris，以下为主要功能介绍：&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;订阅 &lt;span&gt;MySQ&lt;/span&gt;&lt;span&gt;L&lt;/span&gt; Binlog，入仓到 Doris 表。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;订阅 Kafka Topic，入仓到 Doris 表。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;数据动态清洗，在页面编写代码即可完成数据入仓之前的转换。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;接入任务合并，为节省资源，支持分库分表在一个任务接入，支持多个 TOPIC 在一个任务接入。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;动态数据质量校验，配置字段质量规则，进行接入数据质量校验。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;入仓加密，再接入过程中，可以对敏感数据进行加密后再入到 Doris 表。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;错误数据管理，因为网络或者数据错误等原因，在页面可完成数据的重新入仓。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;数据接入链路监控，比如错误数据监控，数据生产链路异常监控，数据消费链路异常监控，任务数据接入趋势图，集群数据接入趋势图等。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;数据接入任务列表：&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.26796875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFXDGJMnB87afTwIUx1mdarZPf6xNtf2BgzTeBhFwPq2y2Lu6vqMZmZw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;数据接入任务配置：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.5234375&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFtCodKYIN8H9BVOwj5SdHGeQ1SmBiasfbmTQsaEEwLfVGhRx0kWryIUQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;&lt;span/&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;数据接入动态代码处理：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.37890625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFwT0VQjlBlNZh2yfbH17yPOJ2ibVFIoV7uyAoYkHm7JScHnueVibWXArw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;&lt;span/&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;数据服务编排&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;数据服务是供业务系统调用 API 获取数据的一个系统。可以在页面进行 API 新建、编辑、在线开发调试、设置限流、上下线等操作。由于 API 之间可能存在业务逻辑关系，并且不能在配置同一个 API，我们开发了数据服务编排功能，通过拖拉拽的方式，让 API 之间能够进行编排并进行数据传递，对外提供 API 时，仍然暴露的是一个 API。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;举例：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;用户和用户所属的城市保存在一个 &lt;span&gt;MySQL&lt;/span&gt; 数据源，每个城市的销售额保存在 Doris 数据源。要开发的 API 的功能是用户只能查看他所属城市的销售额。那么可以通过服务编排功能来实现，Node1 节点通过用户 ID 获取到城市，Node2 节点获取上游节点的输出(城市)作为输入，获取城市销售额作为 API 的输出。&lt;/span&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.39375&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFDEFFIDyCqxITdZah6wdibRzJoJBvBlPw71Gx9hDkE6oqUcFhDo4nesw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;每个节点的输入和输出都可以自定义配置，输入可以来自 API 请求参数，也可以来自上游某个节点的输出，可以来自全局参数，比如用户 ID，分页参数等；&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFcLmjpYdfL4iaBvv0zQfbwWaYEWNux1ZdLZIvhgvnsicRgXnZGuicQ5piag/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.80390625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFIgofgG7kzyqc2rNCj3h0UfBR2BNq9RmiajW4PCib4sgNXIlwLvSVO2icA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;数据安全建设&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;数据安全是一个很大的话题，涉及到方方面面，&lt;/span&gt;&lt;span&gt;&lt;strong&gt;这里从数据加密，数据权限和数仓数据备份几个方面进行简单介绍。&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;strong&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;span mp-original-font-size=&quot;18&quot; mp-original-line-height=&quot;28.799999237060547&quot;&gt;&lt;strong mp-original-font-size=&quot;18&quot; mp-original-line-height=&quot;28.799999237060547&quot;&gt;&amp;gt;&lt;/strong&gt;&lt;/span&gt;&lt;span mp-original-font-size=&quot;18&quot; mp-original-line-height=&quot;28.799999237060547&quot;&gt;&lt;strong mp-original-font-size=&quot;18&quot; mp-original-line-height=&quot;28.799999237060547&quot;&gt;&amp;gt;&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;&lt;strong mp-original-font-size=&quot;18&quot; mp-original-line-height=&quot;28.799999237060547&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;span&gt;数据入仓加密&lt;/span&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;在数据接入过程中，可以选择对字段进行加密，当接入到 Doris 表后，就已经是加密的数据，后续的数据分析，可以利用密钥进行解密。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;数据接入加密配置：&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.18515625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFgQUtkDQ99IMZDrTmW7rOiasWYN4bWgdwUGCQVwEHFg2LEwGddcIpS2g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section data-mpa-template=&quot;t&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;strong&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;span mp-original-font-size=&quot;18&quot; mp-original-line-height=&quot;28.799999237060547&quot;&gt;&lt;strong mp-original-font-size=&quot;18&quot; mp-original-line-height=&quot;28.799999237060547&quot;&gt;&amp;gt;&lt;/strong&gt;&lt;/span&gt;&lt;span mp-original-font-size=&quot;18&quot; mp-original-line-height=&quot;28.799999237060547&quot;&gt;&lt;strong mp-original-font-size=&quot;18&quot; mp-original-line-height=&quot;28.799999237060547&quot;&gt;&amp;gt;&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;&lt;strong mp-original-font-size=&quot;18&quot; mp-original-line-height=&quot;28.799999237060547&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;span&gt;数据权限&lt;/span&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;由于公司查看报表的人员分布很广，对于同一个数据模型，每个城市每个区域的销售，运营，工厂人员，管理人员等人员查看到的数据是不一样的，需要精确控制到行权限和列权限，所以&lt;/span&gt;&lt;span&gt;&lt;strong&gt;我们在 Doris 上层开发了一套数据权限系统，通过配置化的方式，完成数据权限配置，可以精确到行权限和列权限&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span&gt;。&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;BI 报表系统作为一个接入方，引入数据权限客户端并实现相应抽象方法即可。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;举例1：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;对一个报表模型，张三只能查看区域为华北区域或者西北区域的数据；李四，王明只能查看城市为西安或者北京，并且销售额大于 10000 的数据；张四，张五不受限制，其他人无任何权限。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;模型行级权限规则列表：&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.46953125&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFUP60jX6gf5rtB6m5trOg4SiaVGJ3RbfHJzoEeYLbGGia9Sspa7UFnv2w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;行级别赋权规则编辑：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.44140625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFicBC9gTkUJdXRhwWPLuBFWAMu4vyIqzhPDzwWvsdIMG7sz5tBBQ5D4g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.4625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFm6O0c6lJVBbBpbwBvQouWvSmuDgwqQf150LnsfGOc9h8XlnNwupicrg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;举例2: &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;所有人都能查看报表数据，但是每个人只能查看自己所在城市，并且金额大于200或者金额小于100的数据。&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;自由组合规则条件和规则关系：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.4140625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkF1B8DmOr3uWibwkVAw0WQHcic8yBd0oewODBDWj4rySfMcNp1HveqjYcA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;人员标签管理：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.26875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFpj1ibtcY9cf1HTBXeRZ8W6bsmop7lxaibn3NIaZ2KcjprBM8WickicZZDA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.19296875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFbwVfUFjjcvCCcBgOhAcGedzKXAJBPRwIfYI3KjVwMHwtmYRIXIrBCA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;举例3：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;列权限规则，可以针对用户设置禁止查看，数据脱敏等规则&lt;br/&gt;&lt;strong&gt;列级别权限配置：&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.41171875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFlg1y6ticDSwXicjSrYRyLG9AEaBwupmLsF5rOyBXjQK6F5tmjZ0frdTQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.43046875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFr2GtjicXiaib1hg5tuPoqB8asiboFQI3qQC1GaDbicLSUXibesDGzxAWKWTg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;数仓数据备份&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;我们以 Dori 作为存储和计算的核心，Doris 本身数据已经是多副本存储，但是考虑到容灾，我们还是会对核心接入数据进行备份到 HDFS，为此开发了一套数仓数据备份系统，把 Doris 表按照全量或者分区，定时备份到 HDFS。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;备份计划配置：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.3609375&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFSv5ygBWqy5dgv1oUYp0ZuUmpUJzE2GskIPgibR3nb1OjPiabQePibDalw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;备份计划任务列表&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.171875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFM0ZWvQJMmP9AbI4sgbA3tHiaD2E8IuAvOsAljh4xib8qwIKX2gVRNJog/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;Doris 的应用&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;我们用 Doris 承载了数据分析的计算和存储。此外，还存在一个这样的场景：业务的 &lt;span&gt;MySQL&lt;/span&gt; 数据库数据一直在增长，大量的历史数据影响业务线上性能，而且不能直接删除，因为还有低频的历史数据查询，为此，&lt;/span&gt;&lt;span&gt;&lt;strong&gt;我们基于 Doris 开发了一套业务历史数据归档系统，可以定时把不再变更的历史数据进行增量归档&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;，通过数据服务系统提供数据查询，把归档的数据推送给业务方，业务方进行校验，并删除历史数据。&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;归档计划列表：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.29765625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkF6aviaA431hnydk4bfrdJabAWkZTMYQV8JsYxW4h06NaO7oa0ZgU6OPA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;归档计划配置：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.44453125&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFwmJRPvAY7g3rprwbKbRt7SHd6lWJaaswa4cGsy3gOvP6EEpH6f8XpA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;数据推送计划配置：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.5453125&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSZwzUE9iakzbUfPPiaiaqAQjkFYEOXW7ZKQy9X5ZvCSicnEghXpXbhPhG44WGzGrpeYwVazibRnFQaa5SA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;收益&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;目前以 Doris 为核心的数据平台，已经支撑了公司几十个业务系统的数据查询和数据分析需求&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;。为BI智能分析，各业务系统提供了优异的查询性能，并且极大减少了数据平台维护，数据开发，数据中台建设的成本。&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span/&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;数据实时接入稳定可靠，通过 Stream Load，实时接入了数千张表，每天接入数据总条数在亿级别，非常稳定可靠；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span/&gt;&lt;span&gt;支持高并发高性能的数据在线分析查询，每天对 Doris 的在线分析查询次数在百万级别，大部分 SQL 在毫秒级别，慢 SQL 也有很大优化空间，并且 Doris 会自动做一些场景下的查询优化；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span/&gt;&lt;span&gt;通过直接查询原始接入表，建立物化试图，建立索引，支撑了多个低延时高并发的实时查询需求。&lt;/span&gt;&lt;span&gt;并且多表 Join 性能优异；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;其他：&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;Doris 的整体架构简单，运维成本很低，可在线滚动升级，可节省人力专注于数据中台的建设以及业务开发；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;Doris 高度兼容 &lt;span&gt;MySQ&lt;/span&gt;&lt;span&gt;L&lt;/span&gt; 协议，交互式查询分析，提供高效的数据开发体验；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;高可用，数据分区多副本存储，&lt;/span&gt;&lt;span&gt;不会因为部分节点的异常导致整体服务不可用；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;广泛生态兼容，社区提供了和 Flink，Datax 等大数据交互的 Doris 插件，通过 Broker 导入导出数据简单快捷；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;社区活跃，Doris 功能和性能在不断的扩充和提升，遇到问题能够得到社区的密切帮助。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.0027322&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSYap6EMzpzneBwO7zZ5Ub2EX6IBBXldWaI0L3XmHO9kvcJwdWHJBI8LX7Ndr0OfOxMT61bjpVlD3Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;732&quot;/&gt;&lt;/p&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;加入社区&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;欢迎更多热爱开源的&lt;/span&gt;&lt;span&gt;小伙伴加入&lt;/span&gt;&lt;span&gt; Apache Doris 社区，参与社区建设，除了可以在 GitHub 上提 PR 或 Issue 之外，也欢迎大家积极参与到社区日常建设中来，比如：&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;参加社区&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg3Njc2NDAwOA==&amp;amp;mid=2247489095&amp;amp;idx=1&amp;amp;sn=6fb07303527038f9ed0aa89a377c2ad2&amp;amp;chksm=cf2c1840f85b915608986b71625598934fc324831b646fc69218bb2339ef0ff954ac22dbc12f&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;征文活动&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;征文活动&lt;/a&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span&gt;，&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;进行技术解析、应用实践等文章产出；作为讲师参与 Doris 社区的线上线下活动；积极参与 Doris 社区用户群的提问与解答等。&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;最后，欢迎更多的开源技术爱好者加入 Apache Doris 社区，携手成长，共建社区生态。&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;578&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;321&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.3333333333333333&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/Uecg6b8kbSaJGsyqV41aMic1nnPFCquWicS5g2w6jnpwrH3kEFNEkTIQicMwPGGKcNcANfUOfzIt8UG1HicfgH6EVA/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;900&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.0027322&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSYap6EMzpzneBwO7zZ5Ub2EX6IBBXldWaI0L3XmHO9kvcJwdWHJBI8LX7Ndr0OfOxMT61bjpVlD3Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;732&quot;/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.16666666666666666&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSYAsL4vHMicGdVmylG5uibxhN3XOBT5xjTQVpyojBwHjhJgsRgD318FicEzjw0t3rK6F6HAZkDnDuq2A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1200&quot;/&gt;&lt;/p&gt;&lt;section data-mpa-template-id=&quot;1159112&quot; data-mpa-category=&quot;fav&quot;&gt;&lt;section&gt;&lt;section data-tools-id=&quot;21516&quot;&gt;&lt;section powered-by=&quot;KolEditor.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;KolEditor.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;span&gt;SelectDB 是一家开源技术公司，致力于为 Apache Doris 社区提供一个由全职工程师、产品经理和支持工程师组成的团队，繁荣开源社区生态，打造实时分析型数据库领域的国际工业界标准。基于 Apache Doris 研发的新一代云原生实时数仓 SelectDB，运行于多家云上，为用户和客户提供开箱即用的能力。&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;span&gt;&lt;span&gt;关注&lt;/span&gt;&lt;span&gt;「SelectDB」&lt;/span&gt;&lt;span&gt;获取更多技术干货 &lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;custom_select_card mp_profile_iframe js_uneditable&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;Mzg3Njc2NDAwOA==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSaYO6RicI4f7wJp8iamVJ655osRGXKPTyYACfNLfwp3uqv0exQg73CPVXiajkOsyuLycE1iaKN9pET87w/0?wx_fmt=png&quot; data-nickname=&quot;SelectDB&quot; data-alias=&quot;SelectDB&quot; data-signature=&quot;The enterprise-grade cloud-native distribution for Apache Doris&quot; data-from=&quot;2&quot;/&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;相关链接：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;SelectDB 官方网站：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;https://selectdb.com (We Are Coming Soon)&lt;/p&gt;&lt;p&gt;&lt;span&gt;Apache Doris 官方网站：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;http://doris.apache.org&lt;/p&gt;&lt;p&gt;&lt;span&gt;Apache Doris Github：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;https://github.com/apache/doris&lt;/p&gt;&lt;p&gt;&lt;span&gt;Apache Doris 开发者邮件组：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;dev@doris.apache.org &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.18518518518518517&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Uecg6b8kbSacCFPQEC1t42qBYRLyRAmR5GqkhSnCGEljWGfJwuQQBgPqpynV6UBt636zMtRHhlwa3nFM2UrI2A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg3Njc2NDAwOA==&amp;amp;mid=2247489095&amp;amp;idx=1&amp;amp;sn=6fb07303527038f9ed0aa89a377c2ad2&amp;amp;chksm=cf2c1840f85b915608986b71625598934fc324831b646fc69218bb2339ef0ff954ac22dbc12f&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;你已选中了添加链接的内容&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;1&quot;&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;558&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;93&quot; data-ratio=&quot;0.1658711217183771&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Uecg6b8kbSY0SYhPdYX7mf9wg7f57iaytRdtXs9RMmkPKLADTib4QLdlUZBzajESjJcsd0rQ55lqV2ggqTYQwLdA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;838&quot;/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg3Njc2NDAwOA==&amp;amp;mid=2247493182&amp;amp;idx=1&amp;amp;sn=32414441c64fac47f11c3f11a4bbb20f&amp;amp;chksm=cf2fe839f858612f73681198138c87dc3e50937b99a04f6bf52b3fb7a33d4cd047c15af7b4a4&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;‍‍&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;1&quot;&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;558&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;93&quot; data-ratio=&quot;0.1658711217183771&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Uecg6b8kbSaiaFbY9aVQbRe6JuRNf8surRWUWCuIcxQp9ooiccRLc5btXPp56dqc8vD4HSmw0zia8TosjgckIEtjg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;838&quot;/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg3Njc2NDAwOA==&amp;amp;mid=2247493995&amp;amp;idx=1&amp;amp;sn=b785f0b2cec033af94491c9d9f676dff&amp;amp;chksm=cf2fe76cf8586e7a6f8017c69d3411f6ad79fe62a296082929a036f57f0bee6f7004a8fd65eb&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;‍‍&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;1&quot;&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;93&quot; data-backw=&quot;558&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;558&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;93&quot; data-ratio=&quot;0.1658711217183771&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Uecg6b8kbSaiaFbY9aVQbRe6JuRNf8surdsDHB2gPH22yEJIsJSMSRqOCibGtsKG8aDMxuWUaG3lzkJw3ImibeBIA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;838&quot;/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.08375&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/6aVaON9Kibf5ibKRPQgZ9XgbVNsIeQUnfKksOWF7nvlQJYqymJI2xlsp6Hr8RJf7BSgfJlBmiaWSNOiaK7culuXnEA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;800&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;
          &lt;/div&gt;

          

          



           
                                
                    
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>