<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>268dc10ea4505bb77639827f53c03e04</guid>
<title>Go 新语法挺丑？最新的泛型类型约束介绍</title>
<link>https://toutiao.io/k/xz28ueh</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;大家好，我是煎鱼。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;近期我们在分享《&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzUxMDI4MDc1NA==&amp;amp;mid=2247493037&amp;amp;idx=1&amp;amp;sn=cef41f8c00120a04033a1eb02c6d75f3&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;3 件与 Go 开发者有关的大小事&lt;/a&gt;》时，里面有一部分有提到 Go 泛型的约束类型语法又又又变了。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在评论区里看到不少的读者朋友大呼泛型的新类型约束语法挺丑，不如原本的好...&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如下：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6298076923076923&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/KVl0giak5ib4hWeLZXIiaPY2ibdm19IxaOsgyoausft4hQPciasnHvkL0zAum84ZVRh5pGiaqFrzdGe2iaD4GfAaib53Vg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1248&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为此，今天煎鱼就带大家来看看，为什么会发生泛型的新语法会这种改变？&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;问题背景&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;原本 @Ian Lance Taylor 设计的的泛型类型关键字如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt; T &lt;span&gt;interface&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;type&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;, &lt;span&gt;int8&lt;/span&gt;, &lt;span&gt;int16&lt;/span&gt;, &lt;span&gt;int32&lt;/span&gt;, &lt;span&gt;int64&lt;/span&gt;, &lt;span&gt;uint&lt;/span&gt;, &lt;span&gt;uint8&lt;/span&gt;, &lt;span&gt;uint16&lt;/span&gt;, &lt;span&gt;uint32&lt;/span&gt;, &lt;span&gt;uint64&lt;/span&gt;, &lt;span&gt;uintptr&lt;/span&gt;, &lt;span&gt;float32&lt;/span&gt;, &lt;span&gt;float64&lt;/span&gt;, &lt;span&gt;complex64&lt;/span&gt;, &lt;span&gt;complex128&lt;/span&gt;, &lt;span&gt;string&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;看起来好像非常 “顺眼”。但在《&lt;span&gt;proposal: Go 2: sum types using interface type lists&lt;/span&gt;&lt;sup&gt;[1]&lt;/sup&gt;》中社区进行了热烈的讨论。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;认为该类型约束的关键字，过于 “模棱两可”。像是 @Damien Neil 所提出的以下两个例子。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结构体的例子：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; p&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; mustIncludeDefaultCase &lt;span&gt;struct&lt;/span&gt;{}&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; MySum &lt;span&gt;interface&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;type&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;, &lt;span&gt;float64&lt;/span&gt;, mustIncludeDefaultCase&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;不明确的点之一，如果类型列表包含一个未导出的类型，那又应该是如何处理呢？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;接口的例子：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt; T &lt;span&gt;interface&lt;/span&gt; { &lt;span&gt;type&lt;/span&gt; &lt;span&gt;int16&lt;/span&gt;, &lt;span&gt;int32&lt;/span&gt; }&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;main&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;var&lt;/span&gt; x T&lt;br/&gt;  &lt;span&gt;switch&lt;/span&gt; x.(&lt;span&gt;type&lt;/span&gt;) {&lt;br/&gt;  &lt;span&gt;case&lt;/span&gt; &lt;span&gt;int16&lt;/span&gt;:&lt;br/&gt;  &lt;span&gt;case&lt;/span&gt; &lt;span&gt;int32&lt;/span&gt;:&lt;br/&gt;  } &lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;你认为程序会跑进哪个 switch-case 的代码块里呢，是 int16，还是 int32？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;不，都不会，变量 x 是 nil，如此迷惑。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在社区讨论中，发现设计与真实场景一结合，发现这个类型规则在普通的接口类型、在约束中使用也太微妙了。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用类型列表嵌入接口时的行为也很奇怪。认为可以做的更好，那就是 “更显式”。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;新提案&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为此，Go 泛型的设计者 @Ian Lance Taylor 提出了一个新的提案《&lt;span&gt;spec: generics: use type sets to remove type keyword in constraints&lt;/span&gt;&lt;sup&gt;[2]&lt;/sup&gt;》。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其包含三个新的、更简单的想法来取代泛型提案中定义的类型列表。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;关键名词&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;新语法在泛型处增加一个新概念：接口元素（interface elements），用作约束条件的接口类型，或者被嵌入约束条件的接口类型，允许嵌入一些额外的构造。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;被嵌入的可以是：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;任何类型，而不仅仅是一个接口类型。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;一个新的句法结构，称为近似元素。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;一个新的句法结构，称为联合元素。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;重点名词，我们继续展开讲解，分别是：&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;联合元素&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;原先的语法中，类型约束会用逗号分隔的方式来展示。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;, &lt;span&gt;int8&lt;/span&gt;, &lt;span&gt;int16&lt;/span&gt;, &lt;span&gt;int32&lt;/span&gt;, &lt;span&gt;int64&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在新语法中，结合定义为 union element（联合元素），写成一系列由竖线 ”|“ 分隔的类型或近似元素。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt; PredeclaredSignedInteger &lt;span&gt;interface&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;int&lt;/span&gt; | &lt;span&gt;int8&lt;/span&gt; | &lt;span&gt;int16&lt;/span&gt; | &lt;span&gt;int32&lt;/span&gt; | &lt;span&gt;int64&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;常常会和下面讲到的近似元素一起使用。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;近似元素&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;新语法，他的标识符是 “~”，完整用法是 &lt;code&gt;~T&lt;/code&gt;。&lt;code&gt;~T&lt;/code&gt; 是指底层类型为 T 的所有类型的集合。例如：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt; AnyInt &lt;span&gt;interface&lt;/span&gt;{ ~&lt;span&gt;int&lt;/span&gt; }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;他的类型集是 &lt;code&gt;~int&lt;/code&gt;，也就是所有类型为 int 的类型（如：int、int8、int16、int32、int64）都能够满足这个类型约束的条件。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;再结合以上的分隔来使用，用法为：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt; SignedInteger &lt;span&gt;interface&lt;/span&gt; {&lt;br/&gt; ~&lt;span&gt;int&lt;/span&gt; | ~&lt;span&gt;int8&lt;/span&gt; | ~&lt;span&gt;int16&lt;/span&gt; | ~&lt;span&gt;int32&lt;/span&gt; | ~&lt;span&gt;int64&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;相当于泛型提案中使用的以下类型：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;interface&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;type&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;, &lt;span&gt;int8&lt;/span&gt;, &lt;span&gt;int16&lt;/span&gt;, &lt;span&gt;int32&lt;/span&gt;, &lt;span&gt;int64&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;新语法只需借助近似标识符 &lt;code&gt;~int&lt;/code&gt; 来表达就可以了，更明确的表示了近似匹配，而不是存在隐式理解。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;嵌入约束&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一个类型约束可以嵌入另一个约束，联合元素可以包括约束。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;例如：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;// Signed is a constraint whose type set is any signed integer type.&lt;/span&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; Signed &lt;span&gt;interface&lt;/span&gt; {&lt;br/&gt; ~&lt;span&gt;int&lt;/span&gt; | ~&lt;span&gt;int8&lt;/span&gt; | ~&lt;span&gt;int16&lt;/span&gt; | ~&lt;span&gt;int32&lt;/span&gt; | ~&lt;span&gt;int64&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;// Unsigned is a constraint whose type set is any unsigned integer type.&lt;/span&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; Unsigned &lt;span&gt;interface&lt;/span&gt; {&lt;br/&gt; ~&lt;span&gt;uint&lt;/span&gt; | ~&lt;span&gt;uint8&lt;/span&gt; | ~&lt;span&gt;uint16&lt;/span&gt; | ~&lt;span&gt;uint32&lt;/span&gt; | ~&lt;span&gt;uint64&lt;/span&gt; | ~&lt;span&gt;uintptr&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;// Float is a constraint whose type set is any floating point type.&lt;/span&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; Float &lt;span&gt;interface&lt;/span&gt; {&lt;br/&gt; ~&lt;span&gt;float32&lt;/span&gt; | ~&lt;span&gt;float64&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;// Ordered is a constraint whose type set is any ordered type.&lt;/span&gt;&lt;br/&gt;&lt;span&gt;// That is, any type that supports the &amp;lt; operator.&lt;/span&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; Ordered &lt;span&gt;interface&lt;/span&gt; {&lt;br/&gt; Signed | Unsigned | Float | ~&lt;span&gt;string&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个很好理解，就是正式支持嵌入约束了。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;接口类型（联合约束元素）&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在联合元素中，使用接口类型的话。将会把该类型集添加到联合中。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;例如：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt; Stringish &lt;span&gt;interface&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;string&lt;/span&gt; | fmt.Stringer&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Stringish 的类型集将是字符串类型和所有实现 &lt;code&gt;fmt.Stringer&lt;/code&gt; 的类型，任何这些类型（包括 &lt;code&gt;fmt.Stringer&lt;/code&gt; 本身）将被允许作为这个约束的类型参数。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;也就是针对接口类型做了特殊的处理。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;总结&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;今天这篇文章，主要讲解了 Go 泛型的新语法，其实本质上还是为了解决引入 A 后，出现了 BCD 新问题，又继续引入新的语法和模式来解决。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;整体就是三个观点：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;显式匹配：使用&lt;strong&gt;明确的 &quot;~&quot; 近似元素，澄清了何时在底层类型上进行匹配&lt;/strong&gt;。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;明确含义：&lt;strong&gt;使用 “|” 而不是 “,” 强调这是一个元素的联合&lt;/strong&gt;。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;嵌套优化：通过允许约束嵌入非界面元素，类型关键字可以被省略。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这就是用这两个新语法符号的原因，被嫌丑的新语法标识符 “|” 和 “~” ，其实也是在 issues 的大范围讨论中，由社区贡献出来的。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;算是有利有弊？&lt;strong&gt;你的看法如何，欢迎在评论区留言&lt;/strong&gt;：）&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;参考资料&lt;/span&gt;&lt;/h3&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;span&gt;[1]&lt;/span&gt;&lt;p&gt;proposal: Go 2: sum types using interface type lists: &lt;em&gt;https://github.com/golang/go/issues/41716&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[2]&lt;/span&gt;&lt;p&gt;spec: generics: use type sets to remove type keyword in constraints: &lt;em&gt;https://github.com/golang/go/issues/45346&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>f6c8f5a3980a82f3090e582c611c6933</guid>
<title>Element UI Tree 树形控件根据层级全选控制</title>
<link>https://toutiao.io/k/c8fd8aa</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;entryContent&quot;&gt;&amp;#13;
        &lt;p&gt;&lt;strong&gt;Tree 树形控件&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;使用场景：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;多级分类&lt;/li&gt;
&lt;li&gt;组织架构多级管理&lt;/li&gt;
&lt;li&gt;知识或者文件夹层级组织方式&lt;/li&gt;
&lt;li&gt;事物的归属关系&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;最近就遇到关于公司组织架构的应用场景，既要显示公司职员的树形组织架构，而且还可以勾选某个人进行资料的查询，并且支持多选&lt;/p&gt;
&lt;p&gt;通过设置 &lt;code&gt;el-tree&lt;/code&gt; 组件的 &lt;code&gt;show-checkbox&lt;/code&gt; 属性为 &lt;code&gt;true&lt;/code&gt;，将节点置为可被选择状态。&lt;/p&gt;

&lt;p&gt;这里的问题是怎么支持多选的问题，该组件 &lt;code&gt;check-strictly&lt;/code&gt; 属性设置为 &lt;code&gt;false&lt;/code&gt; 的时候，可选中父节点来选中所有下面的子节点。没有层级限制，一直到最终的叶子节点。而我们的需求是只想选中某一层级的节点。对于管理人员来说，他只关心下面最直接的下属，进行相关的操作。&lt;/p&gt;
&lt;p&gt;我们拿到的树形数据结构如下：&lt;/p&gt;
&lt;p&gt;&lt;img class=&quot;alignnone size-full wp-image-307&quot; src=&quot;https://gitee.com/argus-timfan/file-source/raw/master/2021/12/03/1638460822503-620c40a4-444d-4c7b-b636-d43f76698605.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;我的做法是添加了 &lt;code&gt;el-checkbox&lt;/code&gt; 组件，首先算出树形结构数据的最大深度值，然后循环输出所有的层级选择框&lt;/p&gt;
&lt;div class=&quot;_2Uzcx_&quot;&gt;
&lt;pre&gt;&lt;code class=&quot; language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 获取树形数据的最大深度值&lt;/span&gt;&amp;#13;
&lt;span class=&quot;token function&quot;&gt;getMaxFloor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;treeData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
  let deep &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&amp;#13;
  let deepEach &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; floor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
    data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
      item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;floor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; floor&amp;#13;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;floor &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; deep&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
        deep &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; floor&amp;#13;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&amp;#13;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subOrdinate &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subOrdinate&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
        &lt;span class=&quot;token function&quot;&gt;deepEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subOrdinate&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; floor &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&amp;#13;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&amp;#13;
  &lt;span class=&quot;token function&quot;&gt;deepEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;treeData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; deep&amp;#13;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&amp;#13;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;接下来就是通过选中层级，找出该深度下的所有员工，以数组的形式进行存储&lt;/p&gt;
&lt;div class=&quot;_2Uzcx_&quot;&gt;
&lt;pre&gt;&lt;code class=&quot; language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 根据深度值查找该深度下的所有节点&lt;/span&gt;&amp;#13;
&lt;span class=&quot;token function&quot;&gt;getChildByIndex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;treeData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; deep&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
  let max &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&amp;#13;
  let arr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&amp;#13;
  let deepEach &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; floor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
    data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
      item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;floor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; floor&amp;#13;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;floor &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; deep&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
        arr&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&amp;#13;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;floor &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; max&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
        max &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; floor&amp;#13;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&amp;#13;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;children &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
        &lt;span class=&quot;token function&quot;&gt;deepEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; floor &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&amp;#13;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&amp;#13;
  &lt;span class=&quot;token function&quot;&gt;deepEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;treeData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; arr&amp;#13;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&amp;#13;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;el-tree&lt;/code&gt; 控件的 &lt;code&gt;default-checked-keys&lt;/code&gt; 属性可以设置默认选中的节点，我们通过改变这个值来间接达到选中的目的。&lt;code&gt;default-expanded-keys&lt;/code&gt; 属性为展开节点的控制值，当我们选中某个节点的时候，为了能直接看到该节点，还需要展开与它相关的上级所有的节点。&lt;/p&gt;
&lt;p&gt;最后我们监听 &lt;code&gt;checkbox&lt;/code&gt; 的值（所有选中值组成的数组），循环层级数组，通过获取某个层级的节点，拼接成最终所有的节点，然后通过该组件内部方法 &lt;code&gt;setCheckedKeys&lt;/code&gt; 来设置选中状态。&lt;/p&gt;
&lt;div class=&quot;_2Uzcx_&quot;&gt;
&lt;pre&gt;&lt;code class=&quot; language-kotlin&quot;&gt;&lt;span class=&quot;token function&quot;&gt;selectMulti&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; treeData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;employeeOptions&amp;#13;
  let selectedEmployee &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&amp;#13;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;el&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&amp;#13;
    let level &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getChildByIndex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;treeData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; el&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
    selectedEmployee &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectedEmployee&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;concat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;level&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;defaultExpandKeys &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getChildByIndex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;treeData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
&amp;#13;
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;$refs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;employeeTree&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setCheckedKeys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectedEmployee&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;employeeAccounts &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;new &lt;span class=&quot;token function&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectedEmployee&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getEmployeeDocuments&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&amp;#13;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这里需要注意的是控制展开的数组值，当我们选中二级时，所有的一级应该展开，选中三级，二级所有的节点应该展开，依次类推。&lt;/p&gt;
&lt;p&gt;我们拿到选中层级数组，算出里面的最大层级，然后通过最大层级的值减去1算出该层级下的所有节点，就可以展开所有选中节点。（这里有个规则就是展开深度大的节点时外层节点一定是展开的）&lt;/p&gt;

    &lt;/div&gt;&amp;#13;
&amp;#13;
    &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>0c1ab05c23716d9d2e3ad26cceb48ba7</guid>
<title>预训练技术在美团到店搜索广告中的应用</title>
<link>https://toutiao.io/k/kiyd9hq</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;578&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;48&quot; data-ratio=&quot;0.10078125&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsUrXicw2VXTQTVVN5yxXWEacdY1ZdxTH195Pgibtib8EENJRMia3tzEnyVfgyfAgRibMssKqwlE186TLSw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;总第479&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;&lt;span&gt;篇&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;2021年 第049篇&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section data-role=&quot;outer&quot; label=&quot;Powered by 135editor.com&quot;&gt;&lt;section data-role=&quot;outer&quot; label=&quot;Powered by 135editor.com&quot;&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;127&quot;&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;127&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;img border=&quot;0&quot; class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;93&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;93&quot; data-ratio=&quot;0.9966329966329966&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsVLR21NicmyQxcmiaqQ2KOJJj2JLwgJL4KSbo7CcuMF1hLf4xFjGQiaDRhSPyERxWGChWYP47Oc4sKGA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;594&quot; data-width=&quot;100%&quot; opacity=&quot;&quot; title=&quot;undefined&quot;/&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-brushtype=&quot;text&quot; data-style=&quot;text-align: left; font-size: 14px; color: inherit;&quot;&gt;&lt;section&gt;&lt;span&gt;搜索广告在优化流量变现效率等商业指标之外，也需要重点优化用户体验，降低不相关广告对用户体验的损害，这样才能保证平台生态的健康发展。本文对预训练技术在广告相关性的落地方案进行了介绍，既包括训练样本上的数据增强、预训练及微调阶段的BERT模型优化等算法探索层面的工作，也包括知识蒸馏、相关性服务链路优化等实践经验。&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;引言&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span&gt;美团到店搜索广告负责美团、大众点评双平台站内搜索流量的商业变现，服务于到店餐饮、休娱亲子、丽人医美、酒店旅游等众多本地生活服务商家。在美团搜索场景中广告的展示样式非常原生，用户使用美团服务不会明显区分广告和自然结果，而广告用户体验损失则会显著影响搜索流量。因此，搜索广告除了优化流量变现效率等商业指标外，也需要重点优化用户体验，不断降低不相关广告对用户体验的损害，这样才能保证整个平台生态长期健康地发展。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;在优化用户体验的目标下，如何正确的衡量用户体验，定义不相关广告是首要解决的问题。在搜索广告中，受结果列表页广告位置偏差、素材创意等因素影响，我们无法单一使用点击率（&lt;/span&gt;&lt;span&gt;CTR&lt;/span&gt;&lt;span&gt;）等客观性指标来衡量用户体验，尤其首位、首屏等排序靠前广告的相关性问题被认为是影响用户体验的主要因素。因此，我们首先建立了美团场景下的搜索广告相关性标准和评估体系，主要通过例行采样和人工评估的方式对搜索广告结果进行相关、一般和不相关的分档标注，进而驱动我们的广告相关性模型和策略迭代。然后，使用广告排序前五位的Badcase率（&lt;/span&gt;&lt;span&gt;即Badcase@5&lt;/span&gt;&lt;span&gt;）作为搜索广告的相关性评估指标。&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;问题与挑战&lt;/span&gt;&lt;/h3&gt;&lt;section&gt;&lt;span&gt;在定义出广告相关性问题和评估指标后，使用相关性模型进行搜索关键词（&lt;/span&gt;&lt;span&gt;Query&lt;/span&gt;&lt;span&gt;）和候选广告（&lt;/span&gt;&lt;span&gt;Doc&lt;/span&gt;&lt;span&gt;）的相关性打分，类似于NLP文本匹配任务，但实际建模中也发现若干困难。美团搜索结果以商户门店（&lt;/span&gt;&lt;span&gt;POI&lt;/span&gt;&lt;span&gt;）粒度展示，即Doc除了POI文本外，还包含一系列的团单或商品描述，内容非常丰富但也带来较多冗余或歧义，且不同业务的文本表达差异较大，比如结婚类商品“朱颜【出门出阁红色秀禾】，南国【中式婚礼嫁衣红色秀禾】”，给广告内容编码带来挑战。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;其次，美团广告商户大多没有选择竞价关键词，且POI和团单标题并未面向搜索优化，Doc内容与Query可能存在文本表达偏差。比如“满月酒”和“嗨派星球宝宝宴·游轮派对，生日宴个性气球拱门”，需要处理这类信息缺失的问题。我们最初采用ESIM[1]交互式模型，但实践中发现该模型对我们复杂广告内容的表征能力有限，正负样本区分能力不足，在过滤不相关广告的同时对相关广告的误伤率较高。自2018年底以来，以BERT[2]为代表的预训练模型在多项NLP任务上都取得了突破，我们也开始探索预训练技术在搜索广告相关性上的应用。&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;业界及美团的解决方案&lt;/span&gt;&lt;/h3&gt;&lt;section&gt;&lt;span&gt;针对搜索语义匹配任务，Google[3]和Bing[4]的搜索团队已经基于BERT来编码Query和候选Doc，进而改善相关性的效果。预训练模型在美团内部的NLP场景中也有不少落地实践，美团搜索已经验证了预训练模型在文本相关性任务上的有效性[5]。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;而针对预训练在语义匹配任务中的应用，业界也提出不少的解决方案。中科院计算所郭嘉丰等人提出PROP[6]和B-PROP[7]等针对搜索任务的预训练方法，主要思想是引入文档中代表词预测ROP（&lt;/span&gt;&lt;span&gt;Representative wOrds Prediction&lt;/span&gt;&lt;span&gt;）任务。纽约大学石溪分校曹庆庆等人提出DeFormer[8]分解预训练语言模型来做问答等语义匹配任务，在BERT的低层分别对问题和文档各自编码，再在高层部分拼接问题和文档的表征进行交互编码，让文档和问题在编码阶段尽可能地独立，从而提升模型的整体效率。百度刘璟等人提出RocketQA[9]和RocketQAv2[10]等面向端到端问答的检索模型训练方法，通过跨批次负采样、去噪的强负例采样以及数据增强技术大幅提升了双塔模型的效果。陈丹琦等人提出SimCSE[11]，采用自监督来提升模型的句子表示能力，从而提升语义匹配的效果。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;另一方面，2020年至今，预训练从“大炼模型”迈向了“炼大模型”的阶段，通过设计先进的算法，整合尽可能多的数据，汇聚大量算力，集约化地训练超大模型，持续提升模型效果。不论是公开论文结果还是美团内部实践，均已证明：更大规模的预训练模型能带来更好的下游任务效果。因此，美团广告平台与美团搜索与NLP部进行了合作，尝试利用预训练模型来优化搜索关键词和广告结果的相关性，进一步降低首屏广告Badcase，提升用户体验。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;本文分为算法探索、应用实践和总结规划三个部分，对预训练技术在搜索广告相关性的落地方案进行介绍。在算法探索部分介绍了我们在训练样本上的数据增强、预训练（&lt;/span&gt;&lt;span&gt;Pre-training&lt;/span&gt;&lt;span&gt;）和微调（&lt;/span&gt;&lt;span&gt;Fine-tuning&lt;/span&gt;&lt;span&gt;）阶段的模型结构优化；在应用实践部分，本文介绍了以知识蒸馏为主的模型压缩方法、相关性服务链路优化方案，以及所取得的业务效果；最后，我们总结了相关性方面的优化方法，并对未来技术探索进行了展望。希望这些经验和思考能够给从事相关研究的同学带来一些帮助或启发。&lt;/span&gt;&lt;/section&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;算法探索&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span&gt;在美团搜索广告场景中，相关性计算可以看做用户搜索意图（&lt;/span&gt;&lt;span&gt;Query&lt;/span&gt;&lt;span&gt;）和广告商户（&lt;/span&gt;&lt;span&gt;POI/Doc&lt;/span&gt;&lt;span&gt;）之间的匹配问题，实践中我们采用了能够从多角度衡量匹配程度的集成方法，具体方案为分别基于Query和POI的结构化信息匹配、文本匹配和语义匹配等方法进行打分并且进行分数融合。其中，结构化信息匹配主要是对Query分析结果与POI进行类目、属性等信息的匹配；文本匹配方面借鉴了搜索引擎中的传统相关性方法，包括Query和POI的term共现数、Query term覆盖率、TF-IDF、BM25打分等；语义匹配包括传统的隐语义匹配（&lt;/span&gt;&lt;span&gt;如基于LDA或者Word2Vec计算相似度&lt;/span&gt;&lt;span&gt;）和深度语义匹配方法。在广告相关性服务中，我们采用学习能力更强的深度语义匹配模型。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;深度语义匹配通常分为表示型和交互型两类：表示型模型一般基于双塔结构分别得到两段输入文本的向量表示，最后计算两段文本表示的相似度；该方法的优点是Doc向量可提前离线计算缓存，且匹配阶段计算速度很快，适合线上应用；缺点是只在模型最后阶段进行交互，对文本之间匹配关系学习不足。而交互型模型在初期即对两段输入文本进行交互，匹配阶段可以采用更复杂的网络结构，以学习文本间细粒度匹配关系；这种方法往往可以达到更高的精度，主要挑战在于线上应用的性能瓶颈。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;美团搜索广告相关性服务的基线模型采用Transformer+ESIM的交互式模型结构，在满足性能的前提下有效解决了部分相关性问题，但是实际应用中仍然存在一些不足，主要包括：&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;训练数据中存在标签错误、正负样本分布不一致等问题；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;Doc除了基础门店信息外还关联了大量商品和团单内容，如果直接将这些信息拼接成长文本作为Doc输入，由于模型结构限制往往需要对Doc文本进行截断，因而导致信息丢失；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;基线模型对于长文本的表征能力有限，相关性判别能力不足，很难在控制变现效率影响的同时解决更多的Badcase。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section&gt;&lt;span&gt;为了解决这些问题，我们基于BERT在训练数据、特征构造和模型方面进行若干探索和实践。下文将逐一展开介绍。&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;数据增强&lt;/span&gt;&lt;/h3&gt;&lt;section&gt;&lt;span&gt;由于BERT模型微调阶段所需数据量相比ESIM模型更少，并且对数据覆盖全面度、标签准确度、数据分布合理性等因素更为敏感，在进行模型结构探索前，我们先按照如下思路产出一份可用性较高的数据。搜索广告涉及的业务众多且差异性大，包含的团单和商品种类多元，我们希望BERT的微调数据尽可能覆盖各个场景和主要服务。如果全部人工标注人力和时间成本较高，而用户点击转化行为能一定程度反映出广告是否相关，所以训练数据主要基于曝光点击日志构造，对于部分困难样本加以规则及人工校验。我们根据业务特性对训练数据的主要优化包括以下几点。&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;正样本置信加权&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;正样本主要通过点击数据得到，我们对4个月内的Query-POI点击数据进行统计，并且基于曝光频次和CTR进行数据清洗以减少噪声。实际采样流程中，假设对于某个Query需要取N个POI构造N条正样本，采样过程中令POI被采样的概率与其点击数成正比，这样做主要是基于点击越多相关性越高的认知，既可以进一步保证标签置信，又有利于模型学习到POI之间不同的相关程度。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;在实验中我们也尝试了另外两个正样本采样方法：1) 对某个Query随机取N个POI，2) 对某个Query取点击最多的N个POI。实践发现方法1会采样到较多的弱相关样本，而方法2得到的大多为强相关样本，这两种方式均不利于模型拟合真实场景的数据分布。&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;负采样分层&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;我们按照模型学习的困难程度，从低到高设计了三种负样本采样方式：&lt;/span&gt;&lt;/section&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;全局随机负样本&lt;/strong&gt;：大多为跨业务的负样本（&lt;/span&gt;&lt;span&gt;比如烧烤和密室逃脱&lt;/span&gt;&lt;span&gt;），模型学习最容易，可以有效识别跨类目的恶劣Badcase；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;一级类目内负样本&lt;/strong&gt;：Query和POI属于相同一级类目（&lt;/span&gt;&lt;span&gt;比如美食、丽人等&lt;/span&gt;&lt;span&gt;），但是属于不同细化类目（&lt;/span&gt;&lt;span&gt;比如祛痘和医学美容&lt;/span&gt;&lt;span&gt;），这部分样本可以为模型学习增加一定难度，提高模型判别能力；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;三级类目内负样本&lt;/strong&gt;：Query和POI属于相同的细化类目，但是POI并不提供Query相关的服务（&lt;/span&gt;&lt;span&gt;比如光子嫩肤和水光针商户&lt;/span&gt;&lt;span&gt;），这部分属于困难负样本，可以提升模型对语义相近但服务不相关的Badcase的判别能力，更大程度保障用户体验；但是在三级类目下采样可能取到较多相关样本，所以这部分样本还需要经过基于服务核心词的规则过滤以及人工校验。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;采样平滑及分布一致性&lt;/span&gt;&lt;/h4&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;采样平滑&lt;/strong&gt;：在正样本构建过程中对Query采样频次做了平滑，避免高频Query采样过多，导致模型忽略对中长尾Query样本的学习。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;样本分布一致性&lt;/strong&gt;：在负样本构建中，对于每种负样本均需要保证各Query出现概率与其在正样本中概率相等，避免样本分布不一致性导致模型学习有偏。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;文本关键词提取&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;美团搜索广告场景下，Query中可能包含地址词、品牌词、服务核心词等多种成分，Query文本一般较短，90%以上的Query长度小于10；POI的主要文本特征包括门店名称和商品信息，而广告主的商品数量普遍较多，直接拼接商品标题会导致POI文本过长，有26%的POI文本长度超过240。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;由于相关性模型的主要目标是学习Query和POI之间的服务相关性，大量冗余文本信息会影响模型性能和学习效果，我们对Query和POI文本进行如下处理以提取关键文本信息：&lt;/span&gt;&lt;/section&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;对于Query文本&lt;/strong&gt;：基于命名实体识别（&lt;/span&gt;&lt;span&gt;NER&lt;/span&gt;&lt;span&gt;）和词权重结果过滤掉地址词、分店名等成分，保留服务核心词；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;对于POI文本&lt;/strong&gt;：对所有商品标题进行关键词抽取，得到一组能反映商户核心服务的关键词，将其拼接作为POI文本。相比直接拼接原始商品文本，长度大幅下降，仅有5%的POI长度超过240，并且POI文本质量更高，模型学习效果更好。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;最终，我们的微调样本包括约50万条数据，涵盖餐饮、休娱、亲子和丽人等20个主要类目，其中正负样本比例为1:5，三种负样本比例为2:2:1。&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;模型优化&lt;/span&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;基于多任务学习的多业务模型&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;由于美团搜索广告涉及餐饮、休娱亲子、丽人医美等大量业务场景，并且不同场景之间差异较大。从过去的实践经验可知，对于某个业务场景下的相关性优化，利用该业务数据训练的子模型相比利用全业务数据训练的通用模型往往效果更佳，但这种方法存在几个问题：1) 多个子模型的维护和迭代成本更高；2) 某些小场景由于训练数据稀疏难以正确学习到文本表示。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;受到多业务子模型优缺点的启发，我们尝试了区分业务场景的多任务学习，利用BERT作为共享层学习各个业务的通用特征表达，采用对应不同业务的多个分类器处理BERT输出的中间结果，实际应用中根据多个小场景的业务相似程度划分成N类，亦对应N个分类器，每个样本只经过其对应的分类器。多业务模型的主要优势在于，能够利用所有数据进行全场景联合训练，同时一定程度上保留每个场景的特性，从而解决多业务场景下的相关性问题，模型结构如下图1所示：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.7648148148148148&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXJTzDOUpBAANkPiagLqkiaaKZM61N5jsUqHYcLu9QxA69Xk2nSiafJ4raV14P3bia9MtiaKxeg3MqouQQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;图1 多业务模型结构&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;引入品类信息的预训练&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;由于美团商户POI和商品标题可能缺乏有效信息表达，有时仅根据Query和POI商品文本很难准确判断两者之间的语义相关性。例如【租车公司，&amp;lt;上水超跑俱乐部；宝马，奥迪&amp;gt;】，Query和POI文本的相关性不高，而该商户的三级品类是“养车-用车租车-租车”，我们认为引入品类信息有助于提高模型效果。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;为了更合理的引入品类信息，我们对BERT模型的输入编码部分进行改造，除了与原始BERT一致的Query、Doc两个片段外，还引入了品类文本作为第三个片段，将品类文本作为额外片段的作用是防止品类信息对Query、Doc产生交叉干扰，使模型对于POI文本和品类文本区别学习。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;下图2为模型输入示意图，其中红色框内为品类片段的编码情况，Ec为品类片段的片段编码（&lt;/span&gt;&lt;span&gt;Segment Embedding&lt;/span&gt;&lt;span&gt;）。由于我们改变了BERT输入部分的结构，无法直接基于标准BERT进行相关性微调任务。我们对BERT重新进行预训练，并对预训练方式做了改进，将BERT预训练中用到的NSP（&lt;/span&gt;&lt;span&gt;Next Sentence Prediction&lt;/span&gt;&lt;span&gt;）任务替换为更适合搜索广告场景的点击预测任务，具体为“给定用户的搜索关键词、商户文本和商户品类信息，判断用户是否点击”。预训练数据采用自然及广告搜索曝光点击数据，大约6千万样本。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;figcaption&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.17037037037037037&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXJTzDOUpBAANkPiagLqkiaaKEOFVHy2B1eNov38N5BAgXD8bZPdeAgv1zSK1QOSJRFCBibVjVP4ADTQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;/figcaption&gt;&lt;figcaption&gt;&lt;span&gt;图2 BERT输入部分引入POI品类信息&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;模型优化离线效果&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;为了清晰准确地反映模型迭代的离线效果，我们通过人工标注的方法构建了一份广告相关性任务Benchmark。基线ESIM模型、BERT模型以及本文提到的优化后BERT模型在Benchmark上的评估指标如下表1所示：&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4707379134860051&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXJTzDOUpBAANkPiagLqkiaaKJTGpgr2XE6F7ibTVYT6W10udWtwdbHZmIsD8OkQDTAchBkyh0gd67Sw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;786&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;表1 广告相关性任务模型优化迭代指标&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;我们首先利用上文介绍的数据增强后的训练样本训练了MT-BERT-Base模型（&lt;/span&gt;&lt;span&gt;12层768维&lt;/span&gt;&lt;span&gt;），与ESIM模型相比，各项指标均显著提升，其中AUC提升6.6PP。在BERT模型优化方面，多任务学习和引入品类信息这两种方式均能进一步提升模型效果，其中引入品类信息的MT-BERT-Base模型效果更佳，相比标准的MT-BERT-Base模型AUC提升1.2PP。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;在BERT模型规模方面，实验发现随着其规模增长，模型效果持续提升，但是预训练和部署成本也相应增长，最终我们选取了大约3亿参数量的MT-BERT-Large模型（&lt;/span&gt;&lt;span&gt;24层1024维&lt;/span&gt;&lt;span&gt;），在同样引入品类信息的条件下，相比MT-BERT-Base模型AUC增长1.21PP，相比ESIM模型AUC增长8.12PP。&lt;/span&gt;&lt;/section&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;应用实践&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span&gt;在模型的实践落地过程中，我们也遇到若干挑战，并且针对性的设计了优化方案。第一个挑战是BERT模型的前向耗时无法满足线上性能要求，我们通过知识蒸馏和低精度量化方法对模型进行压缩，并且采用离线缓存与实时预测结合的方式进一步提升了服务性能。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;另一个挑战是，在广告业务场景下，需要综合考虑平台变现效率、用户体验、商户供给及转化等因素，如何使相关性分数在广告整体链路中发挥出更好的作用。我们目前采用了低质量广告过滤、重排阶段考虑相关性因子以及TOP位次广告门槛控制等策略。下文对应用实践方面的具体方案进行介绍。&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;模型压缩&lt;/span&gt;&lt;/h3&gt;&lt;section&gt;&lt;span&gt;由于BERT模型的庞大参数量和前向预测耗时，直接部署上线会面临很大的性能挑战，通常需要将训练好的模型压缩为符合一定要求的小模型，业内常用模型压缩方案包括模型裁剪、低精度量化和知识蒸馏等。知识蒸馏[12]旨在有效地从大模型（&lt;/span&gt;&lt;span&gt;教师模型&lt;/span&gt;&lt;span&gt;）中迁移知识到小模型（&lt;/span&gt;&lt;span&gt;学生模型&lt;/span&gt;&lt;span&gt;）中，在业内得到了广泛的研究和应用，如HuggingFace提出的DistillBERT[13]和华为提出的TinyBERT[14]等蒸馏方法，均在保证效果的前提下大幅提升了模型性能。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;经过在搜索等业务上的探索和迭代，美团NLP团队沉淀了一套基于两阶段知识蒸馏的模型压缩方案，包括通用型知识蒸馏和任务型知识蒸馏，具体过程如下图3所示。在通用型知识蒸馏阶段，使用规模更大的预训练BERT模型作为教师模型，对学生模型在无监督预训练语料上进行通用知识蒸馏，得到通用轻量模型，该模型可用于初始化任务型知识蒸馏里的学生模型或直接对下游任务进行微调。在任务型知识蒸馏阶段，使用在有监督业务语料上微调的BERT模型作为教师模型，对学生模型在业务语料上进行领域知识蒸馏，得到最终的任务轻量模型，用于下游任务。实验证明，这两个阶段对于模型最终效果的提升都至关重要。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.23796296296296296&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXJTzDOUpBAANkPiagLqkiaaKMWnY3PzwlWgJ2H5zsehbkKVwcyXgBk8VRGKUbtib2uNzxjnk9fOQibkw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;span&gt;图3 两阶段知识蒸馏&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;在美团搜索广告场景下，首先我们基于MT-BERT-Large（&lt;/span&gt;&lt;span&gt;24层1024维&lt;/span&gt;&lt;span&gt;）在大规模无监督广告语料上进行第一阶段通用型知识蒸馏，得到MT-BERT-Medium（&lt;/span&gt;&lt;span&gt;6层384维&lt;/span&gt;&lt;span&gt;）通用轻量模型，在下游的广告相关性任务上进行微调。MT-BERT-Medium属于单塔交互结构，如图4(a)所示。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;目前，每个Query请求会召回上百个POI候选，交互模型需要分别对上百个Query-POI对进行实时推理，复杂度较高，很难满足上线条件。常见解决方案是将交互模型改造成如图4(b)所示的双塔结构，即分别对Query和POI编码后计算相似度。由于大量候选POI编码可以离线完成，线上只需对Query短文本实时编码，使用双塔结构后模型效率大幅提升。我们使用通用型蒸馏得到的MT-BERT-Medium模型对双塔模型中Query和POI的编码网络进行初始化，并且在双塔在微调阶段始终共享参数，因此本文将双塔模型记为Siamese-MT-BERT-Medium（&lt;/span&gt;&lt;span&gt;每个塔为6层384维&lt;/span&gt;&lt;span&gt;）。双塔结构虽然带来效率的提升，但由于Query和POI的编码完全独立，缺少上下文交互，模型效果会有很大损失，如表2所示，Siamese-MT-BERT-Medium双塔模型相比MT-BERT-Medium交互模型在相关性Benchmark上各项指标都明显下降。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.27314814814814814&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXJTzDOUpBAANkPiagLqkiaaKpRGTSLW7tpDxrziapTFQOZUIR33puBaUm4HptibVfArka2t6QF0nEX3Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;图4 相关性模型结构对比&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;为了充分结合交互结构效果好和双塔结构效率高的优势，Facebook Poly-encoder[15]、斯坦福大学ColBERT[16]等工作在双塔结构的基础上引入不同复杂程度的后交互层（&lt;/span&gt;&lt;span&gt;Late Interaction Layer&lt;/span&gt;&lt;span&gt;）以提升模型效果，如图4(c)所示。后交互网络能提升双塔模型效果，但也引入了更多的计算量，在高QPS场景仍然很难满足上线要求。针对上述问题，在第二阶段任务型知识蒸馏过程中，我们提出了虚拟交互机制（&lt;/span&gt;&lt;span&gt;Virtual InteRacTion mechanism, VIRT&lt;/span&gt;&lt;span&gt;），如图4(d)所示，通过在双塔结构中引入虚拟交互信息，将交互模型中的知识迁移到双塔模型中，从而在保持双塔模型性能的同时提升模型效果。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4111111111111111&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXJTzDOUpBAANkPiagLqkiaaKp3xnlzDAtcr7ib4l97FzQjBRSenuBOktQlHFTgdkJ84HyoOPPhL9EnA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;span&gt;图5 任务型知识蒸馏&amp;amp;虚拟交互&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;任务型知识蒸馏及虚拟交互的具体过程如上图5所示。在任务型知识蒸馏阶段，我们首先基于MT-BERT-Large交互模型在业务语料上进行微调得到教师模型。由于学生模型Siamese-MT-BERT-Medium缺乏上下文交互，如图5(b)所示，注意力矩阵中的灰色部分代表了2块缺失的交互信息，我们通过虚拟交互机制对缺失部分进行模拟，计算公式如下为：&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;\widetilde{\mathbf{M}}_{\mathbf{x}\rightarrow\mathbf{y}} = \operatorname{softmax}\left( \mathrm{Attention}( \widetilde{\mathbf{H}}_{\mathbf{x}}\widetilde{\mathbf{W}}_q,  \widetilde{\mathbf{H}}_{\mathbf{y}} \widetilde{\mathbf{V}}_k)\right)&amp;#10;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;embed src=&quot;https://mmbiz.qlogo.cn/mmbiz_svg/3a3QxMHZ8Yy3emRZDscpQOH4f0Jy7qle9oNwFc7l2P26IzYiaNgJeo0ibZ3GXNrHqiaKguOywicHCx21KGrrMVrrBU0UkSrsZYns/0?wx_fmt=svg&quot; data-type=&quot;svg+xml&quot;/&gt;&lt;/section&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;\widetilde{\mathbf{M}}_{\mathbf{y}\rightarrow\mathbf{x}} = \operatorname{softmax}\left( \mathrm{Attention}( \widetilde{\mathbf{H}}_{\mathbf{y}}\widetilde{\mathbf{V}}_q,  \widetilde{\mathbf{H}}_{\mathbf{x}} \widetilde{\mathbf{W}}_k)\right)&amp;#10;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;embed src=&quot;https://mmbiz.qlogo.cn/mmbiz_svg/3a3QxMHZ8Yy3emRZDscpQOH4f0Jy7qlelBwlGVfDfmqnaDMOxxEuBlEzaltznTATXxIANp5MD08kN1O6YhwItAWvopxCMUyu/0?wx_fmt=svg&quot; data-type=&quot;svg+xml&quot;/&gt;&lt;/section&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;其中，&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -985 1479.2 1135&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot; transform=&quot;translate(50, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;48&quot; d=&quot;M400 0Q376 3 226 3Q75 3 51 0H39V62H147V624H39V686H51Q75 683 226 683Q376 683 400 686H412V624H304V388H595V624H487V686H499Q523 683 673 683Q824 683 848 686H860V624H752V62H860V0H848Q824 3 674 3Q523 3 499 0H487V62H595V326H304V62H412V0H400Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(0, 135)&quot;&gt;&lt;path data-c=&quot;2DC&quot; d=&quot;M296 691Q258 691 216 683T140 663T79 639T34 619T16 611Q13 619 8 628L0 644L36 662Q206 749 321 749Q410 749 517 710T703 670Q741 670 783 678T859 698T920 722T965 742T983 750Q986 742 991 733L999 717L963 699Q787 611 664 611Q594 611 484 651T296 691Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(1000, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M227 0Q212 3 121 3Q40 3 28 0H21V62H117L245 213L109 382H26V444H34Q49 441 143 441Q247 441 265 444H274V382H246L281 339Q315 297 316 297Q320 297 354 341L389 382H352V444H360Q375 441 466 441Q547 441 559 444H566V382H471L355 246L504 63L545 62H586V0H578Q563 3 469 3Q365 3 347 0H338V62H366Q366 63 326 112T285 163L198 63L217 62H235V0H227Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;和&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -985 1479.2 1276.4&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot; transform=&quot;translate(50, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;48&quot; d=&quot;M400 0Q376 3 226 3Q75 3 51 0H39V62H147V624H39V686H51Q75 683 226 683Q376 683 400 686H412V624H304V388H595V624H487V686H499Q523 683 673 683Q824 683 848 686H860V624H752V62H860V0H848Q824 3 674 3Q523 3 499 0H487V62H595V326H304V62H412V0H400Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(0, 135)&quot;&gt;&lt;path data-c=&quot;2DC&quot; d=&quot;M296 691Q258 691 216 683T140 663T79 639T34 619T16 611Q13 619 8 628L0 644L36 662Q206 749 321 749Q410 749 517 710T703 670Q741 670 783 678T859 698T920 722T965 742T983 750Q986 742 991 733L999 717L963 699Q787 611 664 611Q594 611 484 651T296 691Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(1000, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;79&quot; d=&quot;M84 -102Q84 -110 87 -119T102 -138T133 -149Q148 -148 162 -143T186 -131T206 -114T222 -95T234 -76T243 -59T249 -45T252 -37L269 0L96 382H26V444H34Q49 441 146 441Q252 441 270 444H279V382H255Q232 382 232 380L337 151L442 382H394V444H401Q413 441 495 441Q568 441 574 444H580V382H510L406 152Q298 -84 297 -87Q269 -139 225 -169T131 -200Q85 -200 54 -172T23 -100Q23 -64 44 -50T87 -35Q111 -35 130 -50T152 -92V-100H84V-102Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;分别代表双塔模型中Query和POI表示，&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -985 1189 992&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;57&quot; d=&quot;M915 686L1052 683Q1142 683 1157 686H1164V624H1073L957 320Q930 249 900 170T855 52T839 10Q834 0 826 -5Q821 -7 799 -7H792Q777 -7 772 -5T759 10Q759 11 748 39T716 122T676 228L594 442L512 228Q486 159 455 78Q433 19 428 9T416 -5Q411 -7 389 -7H379Q356 -7 349 10Q349 12 334 51T288 170T231 320L116 624H24V686H35Q44 683 183 683Q331 683 355 686H368V624H323Q278 624 278 623L437 207L499 369L561 531L526 624H434V686H445Q454 683 593 683Q741 683 765 686H778V624H733Q688 624 688 623L847 207Q848 207 927 415T1006 624H905V686H915Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(94.5, 135)&quot;&gt;&lt;path data-c=&quot;2DC&quot; d=&quot;M296 691Q258 691 216 683T140 663T79 639T34 619T16 611Q13 619 8 628L0 644L36 662Q206 749 321 749Q410 749 517 710T703 670Q741 670 783 678T859 698T920 722T965 742T983 750Q986 742 991 733L999 717L963 699Q787 611 664 611Q594 611 484 651T296 691Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;和&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -971 869 978&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;56&quot; d=&quot;M592 686H604Q615 685 631 685T666 684T700 684T724 683Q829 683 835 686H843V624H744L611 315Q584 254 546 165Q492 40 482 19T461 -6L460 -7H409Q398 -4 391 9Q385 20 257 315L124 624H25V686H36Q57 683 190 683Q340 683 364 686H377V624H289L384 403L480 185L492 212Q504 240 529 298T575 405L670 624H582V686H592Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(156.5, 149)&quot;&gt;&lt;path data-c=&quot;2DC&quot; d=&quot;M374 597Q337 597 269 627T160 658Q101 658 34 606L24 597L12 611Q1 624 1 626Q1 627 27 648T55 671Q120 722 182 722Q219 722 286 692T395 661Q454 661 521 713L531 722L543 708Q554 695 554 693Q554 692 528 671T500 648Q434 597 374 597Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;分别是Query和POI进行编码时的模型参数，&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -985 2707.5 1276.4&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;4D&quot; d=&quot;M314 0Q296 3 181 3T48 0H39V62H147V624H39V686H305Q316 679 323 667Q330 653 434 414L546 157L658 414Q766 662 773 674Q778 681 788 686H1052V624H944V62H1052V0H1040Q1016 3 874 3T708 0H696V62H804V341L803 618L786 580Q770 543 735 462T671 315Q540 13 536 9Q528 1 507 1Q485 1 477 9Q472 14 408 162T281 457T217 603Q215 603 215 334V62H323V0H314Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(46, 135)&quot;&gt;&lt;path data-c=&quot;2DC&quot; d=&quot;M296 691Q258 691 216 683T140 663T79 639T34 619T16 611Q13 619 8 628L0 644L36 662Q206 749 321 749Q410 749 517 710T703 670Q741 670 783 678T859 698T920 722T965 742T983 750Q986 742 991 733L999 717L963 699Q787 611 664 611Q594 611 484 651T296 691Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(1092, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M227 0Q212 3 121 3Q40 3 28 0H21V62H117L245 213L109 382H26V444H34Q49 441 143 441Q247 441 265 444H274V382H246L281 339Q315 297 316 297Q320 297 354 341L389 382H352V444H360Q375 441 466 441Q547 441 559 444H566V382H471L355 246L504 63L545 62H586V0H578Q563 3 469 3Q365 3 347 0H338V62H366Q366 63 326 112T285 163L198 63L217 62H235V0H227Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(607, 0)&quot;&gt;&lt;path data-c=&quot;2192&quot; d=&quot;M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot; transform=&quot;translate(1607, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;79&quot; d=&quot;M84 -102Q84 -110 87 -119T102 -138T133 -149Q148 -148 162 -143T186 -131T206 -114T222 -95T234 -76T243 -59T249 -45T252 -37L269 0L96 382H26V444H34Q49 441 146 441Q252 441 270 444H279V382H255Q232 382 232 380L337 151L442 382H394V444H401Q413 441 495 441Q568 441 574 444H580V382H510L406 152Q298 -84 297 -87Q269 -139 225 -169T131 -200Q85 -200 54 -172T23 -100Q23 -64 44 -50T87 -35Q111 -35 130 -50T152 -92V-100H84V-102Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt; 代表了&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -985 1479.2 1135&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot; transform=&quot;translate(50, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;48&quot; d=&quot;M400 0Q376 3 226 3Q75 3 51 0H39V62H147V624H39V686H51Q75 683 226 683Q376 683 400 686H412V624H304V388H595V624H487V686H499Q523 683 673 683Q824 683 848 686H860V624H752V62H860V0H848Q824 3 674 3Q523 3 499 0H487V62H595V326H304V62H412V0H400Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(0, 135)&quot;&gt;&lt;path data-c=&quot;2DC&quot; d=&quot;M296 691Q258 691 216 683T140 663T79 639T34 619T16 611Q13 619 8 628L0 644L36 662Q206 749 321 749Q410 749 517 710T703 670Q741 670 783 678T859 698T920 722T965 742T983 750Q986 742 991 733L999 717L963 699Q787 611 664 611Q594 611 484 651T296 691Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(1000, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M227 0Q212 3 121 3Q40 3 28 0H21V62H117L245 213L109 382H26V444H34Q49 441 143 441Q247 441 265 444H274V382H246L281 339Q315 297 316 297Q320 297 354 341L389 382H352V444H360Q375 441 466 441Q547 441 559 444H566V382H471L355 246L504 63L545 62H586V0H578Q563 3 469 3Q365 3 347 0H338V62H366Q366 63 326 112T285 163L198 63L217 62H235V0H227Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;到&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -985 1479.2 1276.4&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot; transform=&quot;translate(50, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;48&quot; d=&quot;M400 0Q376 3 226 3Q75 3 51 0H39V62H147V624H39V686H51Q75 683 226 683Q376 683 400 686H412V624H304V388H595V624H487V686H499Q523 683 673 683Q824 683 848 686H860V624H752V62H860V0H848Q824 3 674 3Q523 3 499 0H487V62H595V326H304V62H412V0H400Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(0, 135)&quot;&gt;&lt;path data-c=&quot;2DC&quot; d=&quot;M296 691Q258 691 216 683T140 663T79 639T34 619T16 611Q13 619 8 628L0 644L36 662Q206 749 321 749Q410 749 517 710T703 670Q741 670 783 678T859 698T920 722T965 742T983 750Q986 742 991 733L999 717L963 699Q787 611 664 611Q594 611 484 651T296 691Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(1000, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;79&quot; d=&quot;M84 -102Q84 -110 87 -119T102 -138T133 -149Q148 -148 162 -143T186 -131T206 -114T222 -95T234 -76T243 -59T249 -45T252 -37L269 0L96 382H26V444H34Q49 441 146 441Q252 441 270 444H279V382H255Q232 382 232 380L337 151L442 382H394V444H401Q413 441 495 441Q568 441 574 444H580V382H510L406 152Q298 -84 297 -87Q269 -139 225 -169T131 -200Q85 -200 54 -172T23 -100Q23 -64 44 -50T87 -35Q111 -35 130 -50T152 -92V-100H84V-102Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;的注意力（即图5(b)右上角缺失部分），&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -985 2707.5 1276.4&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;4D&quot; d=&quot;M314 0Q296 3 181 3T48 0H39V62H147V624H39V686H305Q316 679 323 667Q330 653 434 414L546 157L658 414Q766 662 773 674Q778 681 788 686H1052V624H944V62H1052V0H1040Q1016 3 874 3T708 0H696V62H804V341L803 618L786 580Q770 543 735 462T671 315Q540 13 536 9Q528 1 507 1Q485 1 477 9Q472 14 408 162T281 457T217 603Q215 603 215 334V62H323V0H314Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(46, 135)&quot;&gt;&lt;path data-c=&quot;2DC&quot; d=&quot;M296 691Q258 691 216 683T140 663T79 639T34 619T16 611Q13 619 8 628L0 644L36 662Q206 749 321 749Q410 749 517 710T703 670Q741 670 783 678T859 698T920 722T965 742T983 750Q986 742 991 733L999 717L963 699Q787 611 664 611Q594 611 484 651T296 691Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(1092, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;79&quot; d=&quot;M84 -102Q84 -110 87 -119T102 -138T133 -149Q148 -148 162 -143T186 -131T206 -114T222 -95T234 -76T243 -59T249 -45T252 -37L269 0L96 382H26V444H34Q49 441 146 441Q252 441 270 444H279V382H255Q232 382 232 380L337 151L442 382H394V444H401Q413 441 495 441Q568 441 574 444H580V382H510L406 152Q298 -84 297 -87Q269 -139 225 -169T131 -200Q85 -200 54 -172T23 -100Q23 -64 44 -50T87 -35Q111 -35 130 -50T152 -92V-100H84V-102Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(607, 0)&quot;&gt;&lt;path data-c=&quot;2192&quot; d=&quot;M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot; transform=&quot;translate(1607, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M227 0Q212 3 121 3Q40 3 28 0H21V62H117L245 213L109 382H26V444H34Q49 441 143 441Q247 441 265 444H274V382H246L281 339Q315 297 316 297Q320 297 354 341L389 382H352V444H360Q375 441 466 441Q547 441 559 444H566V382H471L355 246L504 63L545 62H586V0H578Q563 3 469 3Q365 3 347 0H338V62H366Q366 63 326 112T285 163L198 63L217 62H235V0H227Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt; 代表了&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -985 1479.2 1276.4&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot; transform=&quot;translate(50, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;48&quot; d=&quot;M400 0Q376 3 226 3Q75 3 51 0H39V62H147V624H39V686H51Q75 683 226 683Q376 683 400 686H412V624H304V388H595V624H487V686H499Q523 683 673 683Q824 683 848 686H860V624H752V62H860V0H848Q824 3 674 3Q523 3 499 0H487V62H595V326H304V62H412V0H400Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(0, 135)&quot;&gt;&lt;path data-c=&quot;2DC&quot; d=&quot;M296 691Q258 691 216 683T140 663T79 639T34 619T16 611Q13 619 8 628L0 644L36 662Q206 749 321 749Q410 749 517 710T703 670Q741 670 783 678T859 698T920 722T965 742T983 750Q986 742 991 733L999 717L963 699Q787 611 664 611Q594 611 484 651T296 691Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(1000, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;79&quot; d=&quot;M84 -102Q84 -110 87 -119T102 -138T133 -149Q148 -148 162 -143T186 -131T206 -114T222 -95T234 -76T243 -59T249 -45T252 -37L269 0L96 382H26V444H34Q49 441 146 441Q252 441 270 444H279V382H255Q232 382 232 380L337 151L442 382H394V444H401Q413 441 495 441Q568 441 574 444H580V382H510L406 152Q298 -84 297 -87Q269 -139 225 -169T131 -200Q85 -200 54 -172T23 -100Q23 -64 44 -50T87 -35Q111 -35 130 -50T152 -92V-100H84V-102Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;到&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -985 1479.2 1135&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot; transform=&quot;translate(50, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;48&quot; d=&quot;M400 0Q376 3 226 3Q75 3 51 0H39V62H147V624H39V686H51Q75 683 226 683Q376 683 400 686H412V624H304V388H595V624H487V686H499Q523 683 673 683Q824 683 848 686H860V624H752V62H860V0H848Q824 3 674 3Q523 3 499 0H487V62H595V326H304V62H412V0H400Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(0, 135)&quot;&gt;&lt;path data-c=&quot;2DC&quot; d=&quot;M296 691Q258 691 216 683T140 663T79 639T34 619T16 611Q13 619 8 628L0 644L36 662Q206 749 321 749Q410 749 517 710T703 670Q741 670 783 678T859 698T920 722T965 742T983 750Q986 742 991 733L999 717L963 699Q787 611 664 611Q594 611 484 651T296 691Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(1000, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M227 0Q212 3 121 3Q40 3 28 0H21V62H117L245 213L109 382H26V444H34Q49 441 143 441Q247 441 265 444H274V382H246L281 339Q315 297 316 297Q320 297 354 341L389 382H352V444H360Q375 441 466 441Q547 441 559 444H566V382H471L355 246L504 63L545 62H586V0H578Q563 3 469 3Q365 3 347 0H338V62H366Q366 63 326 112T285 163L198 63L217 62H235V0H227Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;的注意力（&lt;/span&gt;&lt;span&gt;即图5(b)左下角缺失部分&lt;/span&gt;&lt;span&gt;）。而交互模型包含了Query和POI的全交互，计算公式为：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;\begin{align*}&amp;#10;\mathbf{S}  &amp;amp; =\mathrm {Attention}\left( \mathbf{H}_{}\mathbf{W}_q,\ \mathbf{H}_{} \mathbf{W}_k\right)  \\&amp;#10;&amp;amp; = \mathrm {Attention}\left( (\mathbf{H}_{\mathbf{x}},\mathbf{H}_{\mathbf{y}})_{}\mathbf{W}_q, \ (\mathbf{H}_{\mathbf{x}},\mathbf{H}_{\mathbf{y}})_{} \mathbf{W}_k\right) \\&amp;#10;&amp;amp; = \left[\begin{array}{l} \mathbf{S}_{\mathbf{x}\rightarrow\mathbf{x}} &amp;amp; \mathbf{S}_{\mathbf{x}\rightarrow\mathbf{y}}\\ \mathbf{S}_{\mathbf{y}\rightarrow\mathbf{x}} &amp;amp; \mathbf{S}_{\mathbf{y}\rightarrow\mathbf{y}} \end{array} \right]&amp;#10;\end{align*}&amp;#10;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;embed src=&quot;https://mmbiz.qlogo.cn/mmbiz_svg/3a3QxMHZ8Yy3emRZDscpQOH4f0Jy7qlePRySoe5tZJNyicbTRob26eF6c6ZRpUQHof3GozgDFMcLZjfBg9tDkvN1p0nERbKeO/0?wx_fmt=svg&quot; data-type=&quot;svg+xml&quot;/&gt;&lt;/section&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;其中，&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -686 900 686&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;48&quot; d=&quot;M400 0Q376 3 226 3Q75 3 51 0H39V62H147V624H39V686H51Q75 683 226 683Q376 683 400 686H412V624H304V388H595V624H487V686H499Q523 683 673 683Q824 683 848 686H860V624H752V62H860V0H848Q824 3 674 3Q523 3 499 0H487V62H595V326H304V62H412V0H400Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;是交互模型中Query和POI的融合表示，可以分解为&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -686 1379.2 836&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;48&quot; d=&quot;M400 0Q376 3 226 3Q75 3 51 0H39V62H147V624H39V686H51Q75 683 226 683Q376 683 400 686H412V624H304V388H595V624H487V686H499Q523 683 673 683Q824 683 848 686H860V624H752V62H860V0H848Q824 3 674 3Q523 3 499 0H487V62H595V326H304V62H412V0H400Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(900, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M227 0Q212 3 121 3Q40 3 28 0H21V62H117L245 213L109 382H26V444H34Q49 441 143 441Q247 441 265 444H274V382H246L281 339Q315 297 316 297Q320 297 354 341L389 382H352V444H360Q375 441 466 441Q547 441 559 444H566V382H471L355 246L504 63L545 62H586V0H578Q563 3 469 3Q365 3 347 0H338V62H366Q366 63 326 112T285 163L198 63L217 62H235V0H227Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;和&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -686 1379.2 977.4&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;48&quot; d=&quot;M400 0Q376 3 226 3Q75 3 51 0H39V62H147V624H39V686H51Q75 683 226 683Q376 683 400 686H412V624H304V388H595V624H487V686H499Q523 683 673 683Q824 683 848 686H860V624H752V62H860V0H848Q824 3 674 3Q523 3 499 0H487V62H595V326H304V62H412V0H400Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(900, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;79&quot; d=&quot;M84 -102Q84 -110 87 -119T102 -138T133 -149Q148 -148 162 -143T186 -131T206 -114T222 -95T234 -76T243 -59T249 -45T252 -37L269 0L96 382H26V444H34Q49 441 146 441Q252 441 270 444H279V382H255Q232 382 232 380L337 151L442 382H394V444H401Q413 441 495 441Q568 441 574 444H580V382H510L406 152Q298 -84 297 -87Q269 -139 225 -169T131 -200Q85 -200 54 -172T23 -100Q23 -64 44 -50T87 -35Q111 -35 130 -50T152 -92V-100H84V-102Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;，分别代表Query和POI，&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -686 1189 693&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;57&quot; d=&quot;M915 686L1052 683Q1142 683 1157 686H1164V624H1073L957 320Q930 249 900 170T855 52T839 10Q834 0 826 -5Q821 -7 799 -7H792Q777 -7 772 -5T759 10Q759 11 748 39T716 122T676 228L594 442L512 228Q486 159 455 78Q433 19 428 9T416 -5Q411 -7 389 -7H379Q356 -7 349 10Q349 12 334 51T288 170T231 320L116 624H24V686H35Q44 683 183 683Q331 683 355 686H368V624H323Q278 624 278 623L437 207L499 369L561 531L526 624H434V686H445Q454 683 593 683Q741 683 765 686H778V624H733Q688 624 688 623L847 207Q848 207 927 415T1006 624H905V686H915Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;是模型参数。交互模型的自注意力矩阵可以分解为4个部分，其中&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -697 2254.5 988.4&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;53&quot; d=&quot;M64 493Q64 582 120 636T264 696H272Q280 697 285 697Q380 697 454 645L480 669Q484 672 488 676T495 683T500 688T504 691T508 693T511 695T514 696T517 697T522 697Q536 697 539 691T542 652V577Q542 557 542 532T543 500Q543 472 540 465T524 458H511H505Q489 458 485 461T479 478Q472 529 449 564T393 614T336 634T287 639Q228 639 203 610T177 544Q177 517 195 493T247 457Q253 454 343 436T475 391Q574 326 574 207V200Q574 163 559 120Q517 12 389 -9Q380 -10 346 -10Q308 -10 275 -5T221 7T184 22T160 35T151 40L126 17Q122 14 118 10T111 3T106 -2T102 -5T98 -7T95 -9T92 -10T89 -11T84 -11Q70 -11 67 -4T64 35V108Q64 128 64 153T63 185Q63 203 63 211T69 223T77 227T94 228H100Q118 228 122 225T126 205Q130 125 193 88T345 51Q408 51 434 82T460 157Q460 196 439 221T388 257Q384 259 305 276T221 295Q155 313 110 366T64 493Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(639, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M227 0Q212 3 121 3Q40 3 28 0H21V62H117L245 213L109 382H26V444H34Q49 441 143 441Q247 441 265 444H274V382H246L281 339Q315 297 316 297Q320 297 354 341L389 382H352V444H360Q375 441 466 441Q547 441 559 444H566V382H471L355 246L504 63L545 62H586V0H578Q563 3 469 3Q365 3 347 0H338V62H366Q366 63 326 112T285 163L198 63L217 62H235V0H227Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(607, 0)&quot;&gt;&lt;path data-c=&quot;2192&quot; d=&quot;M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot; transform=&quot;translate(1607, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;79&quot; d=&quot;M84 -102Q84 -110 87 -119T102 -138T133 -149Q148 -148 162 -143T186 -131T206 -114T222 -95T234 -76T243 -59T249 -45T252 -37L269 0L96 382H26V444H34Q49 441 146 441Q252 441 270 444H279V382H255Q232 382 232 380L337 151L442 382H394V444H401Q413 441 495 441Q568 441 574 444H580V382H510L406 152Q298 -84 297 -87Q269 -139 225 -169T131 -200Q85 -200 54 -172T23 -100Q23 -64 44 -50T87 -35Q111 -35 130 -50T152 -92V-100H84V-102Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;和&lt;span&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -697 2254.5 988.4&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;53&quot; d=&quot;M64 493Q64 582 120 636T264 696H272Q280 697 285 697Q380 697 454 645L480 669Q484 672 488 676T495 683T500 688T504 691T508 693T511 695T514 696T517 697T522 697Q536 697 539 691T542 652V577Q542 557 542 532T543 500Q543 472 540 465T524 458H511H505Q489 458 485 461T479 478Q472 529 449 564T393 614T336 634T287 639Q228 639 203 610T177 544Q177 517 195 493T247 457Q253 454 343 436T475 391Q574 326 574 207V200Q574 163 559 120Q517 12 389 -9Q380 -10 346 -10Q308 -10 275 -5T221 7T184 22T160 35T151 40L126 17Q122 14 118 10T111 3T106 -2T102 -5T98 -7T95 -9T92 -10T89 -11T84 -11Q70 -11 67 -4T64 35V108Q64 128 64 153T63 185Q63 203 63 211T69 223T77 227T94 228H100Q118 228 122 225T126 205Q130 125 193 88T345 51Q408 51 434 82T460 157Q460 196 439 221T388 257Q384 259 305 276T221 295Q155 313 110 366T64 493Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(639, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;79&quot; d=&quot;M84 -102Q84 -110 87 -119T102 -138T133 -149Q148 -148 162 -143T186 -131T206 -114T222 -95T234 -76T243 -59T249 -45T252 -37L269 0L96 382H26V444H34Q49 441 146 441Q252 441 270 444H279V382H255Q232 382 232 380L337 151L442 382H394V444H401Q413 441 495 441Q568 441 574 444H580V382H510L406 152Q298 -84 297 -87Q269 -139 225 -169T131 -200Q85 -200 54 -172T23 -100Q23 -64 44 -50T87 -35Q111 -35 130 -50T152 -92V-100H84V-102Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(607, 0)&quot;&gt;&lt;path data-c=&quot;2192&quot; d=&quot;M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot; transform=&quot;translate(1607, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M227 0Q212 3 121 3Q40 3 28 0H21V62H117L245 213L109 382H26V444H34Q49 441 143 441Q247 441 265 444H274V382H246L281 339Q315 297 316 297Q320 297 354 341L389 382H352V444H360Q375 441 466 441Q547 441 559 444H566V382H471L355 246L504 63L545 62H586V0H578Q563 3 469 3Q365 3 347 0H338V62H366Q366 63 326 112T285 163L198 63L217 62H235V0H227Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;则是Query和POI之间的交互，也即双塔模型的缺失部分。我们对交互模型的交互矩阵和双塔模型的虚拟交互矩阵之间的L2距离进行最小化，从而将交互模型中的核心交互知识迁移到双塔模型中，计算过程为：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot; \mathbf{M}_{\mathbf{x}\rightarrow\mathbf{y}} = \operatorname{softmax} \left( \mathbf{S}_{\mathbf{x}\rightarrow\mathbf{y}} \right) \\&amp;#10;\mathbf{M}_{\mathbf{y}\rightarrow\mathbf{x}} = \operatorname{softmax} \left( \mathbf{S}_{\mathbf{y}\rightarrow\mathbf{x}} \right)&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;embed src=&quot;https://mmbiz.qlogo.cn/mmbiz_svg/3a3QxMHZ8Yy3emRZDscpQOH4f0Jy7qlecz50V2l6pHbQ5eVeJaRaV4z2IK1oN9MRyRib4OkBYtvnvuWjX9MsJ4sOQRAiaPnNmH/0?wx_fmt=svg&quot; data-type=&quot;svg+xml&quot;/&gt;&lt;/section&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot; \mathcal{L}_{\text {virt }} =\left\|\widetilde{\mathbf{M}}_{\mathbf{x}\rightarrow\mathbf{y}} - \mathbf{M}_{\mathbf{x}\rightarrow\mathbf{y}} \right\|_2 &amp;#10;+ \left\|\widetilde{\mathbf{M}}_{\mathbf{y}\rightarrow\mathbf{x}} - \mathbf{M}_{\mathbf{y}\rightarrow\mathbf{x}} \right\|_2 &quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;embed src=&quot;https://mmbiz.qlogo.cn/mmbiz_svg/3a3QxMHZ8Yy3emRZDscpQOH4f0Jy7qled4ticN37QMPzG77XgLdXV3rDoQlpTscSibXe7aTqZ58NuBBbfibpaeRx9BNKDfsNuIu/0?wx_fmt=svg&quot; data-type=&quot;svg+xml&quot;/&gt;&lt;/section&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;我们对蒸馏阶段各个模型进行了Benchmark上的效果评估以及线上QPS=50时的性能测试，结果如表2所示。通过虚拟交互进行任务型知识蒸馏得到的任务轻量模型Siamese-MT-BERT-Medium相较于直接对通用轻量模型进行微调得到的同结构的Siamese-MT-BERT-Medium（&lt;/span&gt;&lt;span&gt;W/O任务型知识蒸馏&lt;/span&gt;&lt;span&gt;）模型，各项效果指标明显提升，其中Accuracy提升1.18PP，AUC提升1.66PP，F1-Score提升1.54PP。最终我们对任务轻量模型Siamese-MT-BERT-Medium进行上线，相较于最初的MT-BERT-Large模型，线上推理速度提升56倍，完全满足线上服务的性能要求。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.34948604992657856&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXJTzDOUpBAANkPiagLqkiaaKrcxKFnfsIfia9AEUpgt5OHLBxSvYH29yPdicyYYIS1ze2xSrQqlgDYxg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1362&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;表2 模型效果对比&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;相关性服务链路优化&lt;/span&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;相关性计算&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;为了更好地衡量广告召回结果的相关程度，除了基于模型得出的语义相关性之外，我们还计算了文本相关性、类目相关性等分数，并对所有分数进行融合得到最终的相关性分数。其中，文本相关性的计算借鉴了搜索引擎场景的检索相关性方法，例如Query和POI的字符串包含关系、短语匹配数和匹配率、以及BM25分等。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;另外，文本匹配同时考虑了原串匹配、核心词匹配及同义词匹配等多维度指标；类目相关性主要基于Query意图分类和商户类目信息进行匹配。分数融合模型可以选择LR或者GBDT等复杂度比较低的模型，并基于高质量标注数据集训练得到。&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;相关性应用&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;通过模型结构和分数融合策略的迭代优化可以得到更加准确合理的相关性分数，但是在实际的相关性应用中，还需要紧密结合广告业务场景，综合考虑平台变现效率、用户体验、广告主供给及转化等多方面因素。基于“减少低质量的不相关广告”和“相关广告排序应该尽量靠前”两个基本要求，我们设计了几种相关性分数的具体应用方式：&lt;/span&gt;&lt;/section&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;过滤低质量广告&lt;/strong&gt;：完全不相关的广告无疑会严重影响用户体验，需要进行过滤。考虑到不同召回策略和不同业务流量在变现效率及Badcase严重程度等方面存在差异，过滤阈值被设计成召回策略×类目的二维超参矩阵；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;重排序参考相关性&lt;/strong&gt;：在广告系统的竞价排序模块，在考虑点击率、转化率、交易额和出价等因素的同时，也需要考虑相关性分数；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;TOP位次相关性门槛&lt;/strong&gt;：首位、首屏等排序靠前的广告结果对于用户体验影响更大，因此针对TOP位次设置了相关性门槛，进一步改善用户体验。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;figcaption&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4888888888888889&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXJTzDOUpBAANkPiagLqkiaaKwtLMSzePr7Ab9icOtKQ4icib0fOWjPSBgJichgbVc9eLpIIm4zsnQVOe8Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;/figcaption&gt;&lt;figcaption&gt;&lt;span&gt;图6 相关性服务链路示意图&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;模型部署&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;为了进一步提升服务性能并且能有效利用计算资源，模型部署阶段我们采用高频流量缓存、长尾流量实时计算的方案。对高频Query-POI对进行离线相关性计算并写入缓存，每日对新增或商品信息变化的Query-POI对进行增量计算并更新缓存，线上相关性服务优先取缓存数据，如果失效则基于蒸馏后的任务轻量模型进行实时计算。对于输入相关性服务的Query-POI对，缓存数据的覆盖率达到90%以上，有效缓解了在线计算的性能压力。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5435185185185185&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXJTzDOUpBAANkPiagLqkiaaKLV8kJgzZ2cN0a6mNfTatNXYAPxTicuoKzTqdSOeZgXlPvyoiaibUTUS5Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;span&gt;图7 相关性分数离线/在线计算流程图&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;线上实时计算的任务轻量模型使用TF-Serving进行部署，TF-Serving预测引擎支持使用美团机器学习平台的模型优化工具—ART框架（&lt;/span&gt;&lt;span&gt;基于Faster-Transformer改进&lt;/span&gt;&lt;span&gt;）进行加速，在将模型转为FP16精度后，最终加速比可达到5.5，数值平均误差仅为5e-4，在保证精度的同时极大地提高了模型预测的效率。&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;线上效果&lt;/span&gt;&lt;/h3&gt;&lt;section&gt;&lt;span&gt;为了更加直接客观地反映线上广告相关性情况，我们建立了美团场景下的搜索广告相关性标准和评估体系，对搜索关键词和广告结果进行相关、一般和不相关的分档标注，采用排序前五位广告的Badcase率（&lt;/span&gt;&lt;span&gt;即Badcase@5&lt;/span&gt;&lt;span&gt;）作为搜索广告的相关性评估核心指标。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;除此之外，由于CTR能够通过用户行为间接反映广告的相关程度，并且便于在线上进行AB实验评估，而NDCG可以反映相关性分数用于广告列表排序的准确性，所以我们选取CTR和NDCG作为间接指标来辅助验证相关性模型迭代的有效性。我们对本文的优化进行了线上小流量实验，结果显示，实验组CTR提升1.0%，覆盖率降低1.0%，变现效率基本没有损失。并且经过人工评测，Badcase@5降低2.2PP，NDCG提升2.0PP，说明优化后的相关性模型能够对召回广告列表进行更加准确的校验，有效提升了广告相关性，从而给用户带来更好的搜索体验。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;下面列举了两个Badcase解决示例，图8(a)和8(b)分别包含了搜索“登记照”和“头皮SPA”时的基线返回结果（&lt;/span&gt;&lt;span&gt;左侧截图&lt;/span&gt;&lt;span&gt;）和实验组返回结果（&lt;/span&gt;&lt;span&gt;右侧截图&lt;/span&gt;&lt;span&gt;），截图第一位是广告结果。在这两个示例中，实验组相关性模型将不相关结果“麻朵新生儿摄影”和“莲琪科技美肤抗衰中心”检测出来并过滤掉，让相关广告得以首位展示曝光。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5481481481481482&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXJTzDOUpBAANkPiagLqkiaaKgTZ6cnZOI469P3SyAGNh7c3S0uEEwjGdRPticA27Ucb6Z0HgTyAp6sA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;span&gt;图8 Badcase解决示例&lt;/span&gt;&lt;/section&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;总结与展望&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span&gt;本文介绍了预训练技术在美团到店搜索广告相关性上的应用，主要包括样本数据增强、模型结构优化、模型轻量化及线上部署等优化方案。在数据增强方面，为了基于曝光点击数据构造出适合美团广告场景下相关性任务的训练数据，我们构造了多种类型负样本，在采样时考虑正样本置信度、关键词频率平滑、正负样本均衡等因素，另外也对POI和团单商品文本进行关键词抽取得到更加简短有效的文本特征。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;在模型结构优化方面，我们尝试了对不同业务场景做多任务学习，以及在BERT输入中引入品类文本片段这两种方案使模型更好地拟合美团搜索广告业务数据，并利用规模更大的预训练模型进一步提升了模型的表达能力。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;在实践应用中，为了同时满足模型效果和线上性能要求，我们对中高频流量进行离线打分和缓存，并且利用MT-BERT-Large蒸馏得到的双塔模型进行线上实时预测以覆盖长尾流量。最终，在保证广告平台收入的前提下，有效降低了搜索广告Badcase率，提升了用户在平台的搜索体验。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;目前，广告相关性打分主要应用于阈值门槛，目的是端到端的过滤掉不相关广告，从而快速降低广告Badcase。在此基础上，我们期望相关性模型继续提升区分相关和一般相关广告的能力，从而在重排序中作为排序因子更好的平衡变现效率和用户体验指标，更准确的度量用户体验损失和变现效率提升的兑换关系。此外，在本地搜索类场景下，局部供给经常比较匮乏，实际召回效果对比全局供给的情况更依赖相关性打分的能力，所以我们依然需要在相关性模型上持续深入迭代，并支撑广告召回模型和策略的进一步优化。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;在具体技术方向上，相关性门槛阈值设置、广告长文本表达和业务知识融合等方面依然存在优化和提升空间：&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;阈值搜索&lt;/strong&gt;：目前的阈值策略需要对每个类目分别调参，缺乏整体性且难以达到全局优化效果。我们正在实验将阈值搜索看作可变现流量上的最优化问题，在限定消耗损失及其他业务约束的条件下，找到一组门槛阈值使得整体Badcase解决最大化，并已经取得初步的效果。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;特征表达&lt;/strong&gt;：目前广告Doc特征主要采用团单商品标题的关键词抽取结果，但是Doc文本仍然较长并且存在一些冗余信息，有必要对Doc信息抽取方法继续探索，比如融合外部知识进行信息抽取，或者通过优化Transformer注意力机制使模型在相关性打分时更加关注某些重要词项或者行业相关的关键词。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;联合优化&lt;/strong&gt;：Query和POI文本中的蕴含的类目信息、实体成分等对于判断相关性很有帮助，我们计划将相关性任务与搜索广告场景下其他任务联合优化，比如命名实体识别、Query类目识别等，期望通过引入辅助任务增强模型的学习能力，更全面准确的学习语义相关性。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;参考资料&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span&gt;[1] Chen, Qian, et al. &quot;Enhanced lstm for natural language inference.&quot; arXiv preprint arXiv:1609.06038 (2016).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[2] Devlin, Jacob, et al. &quot;BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding.&quot; arXiv preprint arXiv: 1810.04805 (2018).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[3] Pandu Nayak, &quot;Understanding searches better than ever before.&quot; Google blog (2019).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[4] Wenhao Lu, et al. &quot;TwinBERT: Distilling Knowledge to Twin-Structured BERT Models for Efficient Retrieval.&quot; arXiv preprint arXiv: 2002.06275 (2020).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[5] 李勇, 佳昊, 杨扬等. BERT在美团搜索核心排序的探索和实践.&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[6] Ma, Xinyu, et al. &quot;PROP: Pre-training with Representative Words Prediction for Ad-hoc Retrieval.&quot; Proceedings of the 14th ACM International Conference on Web Search and Data Mining (2021).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[7] Ma, Xinyu, et al. &quot;B-PROP: Bootstrapped Pre-training with Representative Words Prediction for Ad-hoc Retrieval.&quot; arXiv preprint arXiv: 2104.09791 (2021).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[8] Cao, Qingqing, et al. &quot;DeFormer: Decomposing Pre-trained Transformers for Faster Question Answering.&quot; arXiv preprint arXiv:2005.00697 (2020).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[9] Qu, Yingqi, et al. &quot;RocketQA: An Optimized Training Approach to Dense Passage Retrieval for Open-Domain Question Answering.&quot; arXiv preprint arXiv: 2010.08191 (2021).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[10] Ren, Ruiyang, et al. &quot;RocketQAv2: A Joint Training Method for Dense Passage Retrieval and Passage Re-ranking.&quot; arXiv preprint arXiv: 2110.07367 (2021).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[11] Gao, Tianyu, et al. &quot;SimCSE: Simple Contrastive Learning of Sentence Embeddings.&quot; arXiv preprint arXiv: 2104.08821 (2021).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[12] Hinton, Geoffrey, Oriol Vinyals, and Jeff Dean. &quot;Distilling the knowledge in a neural network.&quot; arXiv preprint arXiv:1503.02531 (2015).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[13] Sanh, Victor, et al. &quot;DistilBERT, a distilled version of BERT: smaller, faster, cheaper and lighter.&quot; arXiv preprint arXiv:1910.01108 (2019).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[14] Jiao, Xiaoqi, et al. &quot;Tinybert: Distilling bert for natural language understanding.&quot; arXiv preprint arXiv:1909.10351 (2019).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[15] Humeau, Samuel, et al. &quot;Poly-encoders: Transformer architectures and pre-training strategies for fast and accurate multi-sentence scoring.&quot; arXiv preprint arXiv:1905.01969 (2019).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;[16] Khattab, Omar, and Matei Zaharia. &quot;Colbert: Efficient and effective passage search via contextualized late interaction over bert.&quot; Proceedings of the 43rd International ACM SIGIR conference on research and development in Information Retrieval. (2020).&lt;/span&gt;&lt;/section&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;作者简介&lt;/span&gt;&lt;/h2&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;邵雯、春喜、晓俊、程佳、雷军等，来自美团广告平台技术部。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;杨扬、任磊、金刚、武威等，来自美团平台/搜索与NLP部。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;----------  END  ----------&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;招聘信息&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section data-source=&quot;bj.96weixin.com&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;span&gt;美团到店广告平台广告算法团队立足广告场景，探索深度学习、强化学习、人工智能、大数据、知识图谱、NLP和计算机视觉前沿的技术发展，探索本地生活服务电商的价值。主要工作方向包括：&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;| 触发策略：用户意图识别、广告商家数据理解，Query改写，深度匹配，相关性建模。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;| 质量预估：广告质量度建模。点击率、转化率、客单价、交易额预估。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;| 机制设计：广告排序机制、竞价机制、出价建议、流量预估、预算分配。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;| 创意优化：智能创意设计。广告图片、文字、团单、优惠信息等展示创意的优化。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;岗位要求&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;| 有三年以上相关工作经验，对CTR/CVR预估、NLP、图像理解，机制设计至少一方面有应用经验。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;| 熟悉常用的机器学习、深度学习、强化学习模型。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;| 具有优秀的逻辑思维能力，对解决挑战性问题充满热情，对数据敏感，善于分析/解决问题。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;| 计算机、数学相关专业硕士及以上学历。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;具备以下条件优先：&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;| 有广告/搜索/推荐等相关业务经验。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;| 有大规模机器学习相关经验。&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;感兴趣的同学可投递简历至：&lt;/span&gt;&lt;span&gt;chengxiuying@meituan.com&lt;/span&gt;&lt;span&gt;（&lt;/span&gt;&lt;span&gt;邮件标题请注明：美团广平算法团队&lt;/span&gt;&lt;span&gt;）。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;美团科研合作&lt;/span&gt;&lt;/strong&gt;&lt;strong/&gt;&lt;/p&gt;&lt;section data-source=&quot;bj.96weixin.com&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;span&gt;美团科研合作致力于搭建美团各部门与高校、科研机构、智库的合作桥梁和平台，依托美团丰富的业务场景、数据资源和真实的产业问题，开放创新，汇聚向上的力量，围绕人工智能、大数据、物联网、无人驾驶、运筹优化、数字经济、公共事务等领域，共同探索前沿科技和产业焦点宏观问题，促进产学研合作交流和成果转化，推动优秀人才培养。面向未来，我们期待能与更多高校和科研院所的老师和同学们进行合作。欢迎老师和同学们发送邮件至：&lt;span&gt;meituan.oi@meituan.com &lt;/span&gt;。&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;也许你还想看&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;  | &lt;/strong&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651750945&amp;amp;idx=1&amp;amp;sn=713f16c46065db1f831a495ffb1d9a78&amp;amp;chksm=bd125b6c8a65d27adb13bb234f027d619950a979259ae1c035427c4c025c95e26d7485194232&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;美团BERT的探索和实践&lt;/a&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;  |&lt;/strong&gt;&lt;/span&gt; &lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651751586&amp;amp;idx=1&amp;amp;sn=a61c9da125e9b7e68473b32e0278b0ea&amp;amp;chksm=bd125def8a65d4f9d20b682345365d5001e9c863d5046acf683da6116b265d168c0340754fc9&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;Transformer 在美团搜索排序中的实践&lt;/a&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;  |&lt;/strong&gt; &lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651763427&amp;amp;idx=1&amp;amp;sn=b06da2382ffb70bfab0a9ecabe36c540&amp;amp;chksm=bd126bae8a65e2b845a615f5d192d97d027321a9f350caca607ccd696962fb655fbbc73e4b3b&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;常识性概念图谱建设以及在美团场景中的应用&lt;/a&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;阅读更多&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;---&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://t.1yb.co/jo7r&quot; textvalue=&quot;前端&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;前端&lt;/a&gt;&lt;strong&gt;&lt;span&gt; |&lt;/span&gt;&lt;/strong&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://t.1yb.co/jo7v&quot; textvalue=&quot; 安全&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;strong&gt; &lt;/strong&gt; &lt;/a&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://t.1yb.co/jsdG&quot; textvalue=&quot;算法&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;算法&lt;/a&gt;&lt;strong&gt; |&lt;/strong&gt;&lt;span&gt; &lt;a target=&quot;_blank&quot; href=&quot;https://t.1yb.co/jsWK&quot; textvalue=&quot;后端&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;后端&lt;/a&gt;&lt;/span&gt;&lt;strong&gt;&lt;span&gt; | &lt;/span&gt;&lt;/strong&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://t.1yb.co/jqRZ&quot; textvalue=&quot;数据&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;数据&lt;/a&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://t.1yb.co/jo7v&quot; textvalue=&quot; 安全&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;安全&lt;/a&gt;&lt;strong&gt; | &lt;/strong&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://t.1yb.co/jui4&quot; textvalue=&quot;Android&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;Android&lt;/a&gt;&lt;strong&gt; |&lt;/strong&gt; &lt;a target=&quot;_blank&quot; href=&quot;https://t.1yb.co/jtXE&quot; textvalue=&quot;iOS&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;iOS&lt;/a&gt; &lt;strong&gt; |&lt;/strong&gt; &lt;a target=&quot;_blank&quot; href=&quot;https://t.1yb.co/jo7K&quot; textvalue=&quot;运维&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;运维&lt;/a&gt;&lt;strong&gt; | &lt;/strong&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://t.1yb.co/jtsX&quot; textvalue=&quot;测试&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;测试&lt;/a&gt;&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MjM5NjQ5MTI5OA==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsVGibnsaEib3aNlqF0tOrA2RGEmNSbia2nnohE4Tpf95UyTiaSjDVbHRfY8WNBeTuLLTaVdSckkNyEx1Q/0?wx_fmt=png&quot; data-nickname=&quot;美团技术团队&quot; data-alias=&quot;meituantech&quot; data-signature=&quot;10000+工程师，如何支撑中国领先的生活服务电子商务平台？数亿消费者、数百万商户、2000多个行业、几千亿交易额背后是哪些技术在支撑？这里是美团、大众点评、美团外卖、美团配送、美团优选等技术团队的对外窗口。&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>7b02a8467a78085b6f3a13763bafefc8</guid>
<title>听老外吐槽框架设计，Why I Hate Frameworks?</title>
<link>https://toutiao.io/k/5y0ifzh</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Hello，小伙伴们，今天不聊技术，分享点有意思的东西。前段时间，表弟给我发过来一篇老外写的文章，以略带讽刺的对话方式调侃了自己对框架的看法，我在读了一下以后也感觉比较有趣，这里分享给大家。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;作者Benji Smith，可惜目前在这位老哥的个人网站上已经找不到这篇文章的原文了，只剩下了一段自我介绍。这里最后在国内的技术论坛里找到了英文原文和其他的大佬的翻译，这里我参考了一些版本的译文，配合自己的理解重新进行了一波翻译，并添加了一些插图，方便大家更容易地理解原文。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;好了，下面就来看一下正文吧。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;正文&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前，我正处于构建一个Java web应用的计划阶段（是的，必须要使用Java，而其中各式各样的原因我现在并不想去讨论）。在这个过程中，我评估了一系列基于角色的CMS服务应用容器框架，并且它们基本使用了J2EE门户设计、遵循JSR规范的MVC架构。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;I&#x27;m currently in the planning stages of building a hosted Java web application (yes, it has to be Java, for a variety of reasons that I don&#x27;t feel like going into right now). In the process, I&#x27;m evaluating a bunch of J2EE portlet-enabled JSR-compliant MVC role-based CMS web service application container frameworks.&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但是在花了几十个小时阅读功能列表和文档后，我真想抠出我的眼珠子。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;And after spending dozens of hours reading through feature lists and documentation, I&#x27;m ready to gouge out my eyes.&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;让我们假设我决定做一个放香料的架子。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Let&#x27;s pretend I&#x27;ve decided to build a spice rack.&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5793742757821553&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33G9pibPtjgicIsNbmkLvIM4HBv6qYIFDDdEW0Db7ZIOZZaxm2ExuVpXSUA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;863&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在以前，我做过一些零碎的木匠活，因此我很清楚我到底需要什么：一些木头以及基础的工具，例如卷尺、锯子、水平仪和锤子。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;I&#x27;ve done small woodworking projects before, and I think I have a pretty good idea of what I need: some wood and a few basic tools: a tape measure, a saw, a level, and a hammer.&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5164835164835165&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33G6lwgkUWiaDymicg2rj7UMLfibRp6qIVnicEXxUfodyRLba0nKkqmyTrS6Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;910&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果我要建造一整栋房屋，而不仅是一个香料架的话，那么我需要的还是卷尺、锯子、水平仪、锤子以及其他的一些东西。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;If I were going to build a whole house, rather than just a spice rack, I&#x27;d still need a tape measure, a saw, a level, and a hammer (among other things).&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;所以我去了一家五金店，然后询问店员我在哪里能买到一把锤子。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;So I go to the hardware store to buy the tools, and I ask the sales clerk where I can find a hammer.&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6338582677165354&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33GTm4leQtJRSVbv6D5e235Qw6GU9nDYYmghicav8YSolrO0ZugFq1fCaw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;762&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“一把锤子？”他问道，“现在已经没有人再买锤子了，它们已经过时了。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;A hammer?&quot; he asks. &quot;Nobody really buys hammers anymore. They&#x27;re kind of old fashioned.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我被这一发展趋势震惊了，并问他原因。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Surprised at this development, I ask him why.&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“嗯，锤子的问题就在于它有太多的种类了，就像大锤、羊角锤、球头锤等等。如果你买了一把后突然意识到你还需要另一种类的锤子怎么办呢，你还需要为你下一个任务再单独买一把。事实证明，大多数人需要一把能够解决生活中可能遇到的所有敲打任务的锤子。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Well, the problem with hammers is that there are so many different kinds. Sledge hammers, claw hammers, ball-peen hammers. What if you bought one kind of hammer and then realized that you needed a different kind of hammer later? You&#x27;d have to buy a separate hammer for your next task. As it turns out, most people really want a single hammer that can handle all of the different kinds of hammering tasks you might encounter in your life.&quot;&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5754824063564131&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33GzPQTez1iaDHcgKwxj7ibS6rGa90wGbSqiciaMLsCb4rVoUyJQpcTic673Zw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;881&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“呃，嗯，我认为这听起来确实不错。那么你能告诉我哪里能找到这么一把万能的锤子吗？”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Hmmmmmm. Well, I suppose that sounds all right. Can you show me where to find a Universal Hammer.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“不，我们已经不卖它了，它已经被淘汰了。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;No, we don&#x27;t sell those anymore. They&#x27;re pretty obsolete.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“是真的吗？但是你刚才还在说万能锤子是未来的潮流不是吗？”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Really? I thought you just said that the Universal Hammer was the wave of the future.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“事实证明，如果你仅仅制造出一种能够完成所有任务的锤子，它们反而不能很有效的处理其中的任何一件任务，就像用一把大锤去钉钉子就会很费力。并且，如果你想杀了你前任女友的话，真没有什么能够代替一把球头锤。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;As it turns out, if you make only one kind of hammer, capable of performing all the same tasks as all those different kinds of hammers, then it isn&#x27;t very good at any of them. Driving a nail with a sledgehammer isn&#x27;t very effective. And, if you want to kill your ex-girlfriend, there&#x27;s really no substitute for a ball-peen hammer.&quot;&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.44504310344827586&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33G4ib65lwqnbqADdYeUKrj0W2alpma08gqlgU1NDs2tuWM7J6zRQ6WBew/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;928&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“这倒是真的。那么，如果没有人买这种万能锤子的话，而你们也不再卖那些老款式的锤子的话，你们到底卖什么锤子呢？”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;That&#x27;s true. So, if nobody buys Universal Hammers anymore, and if you&#x27;re no longer selling all those old-fashioned kinds of hammers, what kinds of hammers do you sell?&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“实际上，我们根本不卖锤子”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Actually, we don&#x27;t sell hammers at all.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“那么……”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;So...&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“根据我们的研究，人们真正需要的根本就不是万能锤子，最好还是能有一把合适类型的锤子来适用于不同的工作。因此，我们开始出售锤子工厂，它能够生产你可能感兴趣的各式各样的锤子。而你需要做的就是，为锤子工厂招聘工人、启动机器、购买原材料、支付水电费等等……很快你就能得到你所需要的那种特定的锤子。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;According to our research, what people really needed wasn&#x27;t a Universal Hammer after all. It&#x27;s always better to have the right kind of hammer for the job. So, we started selling hammer factories, capable of producing whatever kind of hammers you might be interested in using. All you need to do is staff the hammer factory with workers, activate the machinery, buy the raw materials, pay the utility bills, and PRESTO...you&#x27;ll have &lt;em&gt;exactly&lt;/em&gt; the kind of hammer you need in no time flat.&quot;&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6041426927502876&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33Gf8aTiceoOV28gpOA6P3wtKnJCVxfkbgmpbHFXe52QfJf42NDZmbh9YQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;869&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“但是我真的不想买一个锤子工厂…”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;But I don&#x27;t really want to buy a hammer factory...&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“那就对了，因为我们早就不卖锤子工厂了。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;That&#x27;s good. Because we don&#x27;t sell them anymore.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“但我听见你刚才还在说……”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;But I thought you just said...&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“我们发现，其实大多数人实际上并不需要一个完整的锤子工厂，例如有一些人可能永远用不到球头锤（或者是因为他们根本就没有前女友，或者他们可以用冰镐来代替锤子来杀死她们）。因此对人们来说，买一个能生产各种锤子的锤子工厂是没有意义的。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;We discovered that most people don&#x27;t actually need an entire hammer factory. Some people, for example, will never need a ball-peen hammer. (Maybe they&#x27;ve never had ex-girlfriends. Or maybe they killed them with icepicks instead.) So there&#x27;s no point in someone buying a hammer factory that can produce every kind of hammer under the sun.&quot;&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7163029525032092&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33GPosewA98c9Zzb7Ysnhu4Y0NCbpjwGdgMtjibkye9kHH1MwdBKIKZd3A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;779&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“嗯，这么听上去确实挺合理。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Yeah, that makes a lot of sense.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“因此作为代替，我们开始出售锤子工厂的设计图，以便我们的客户能够搭建自己的锤子工厂，通过定制设计，只生产他们实际需要的那些种类的锤子。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;So, instead, we started selling schematic diagrams for hammer factories, enabling our clients to build their own hammer factories, custom engineered to manufacture only the kinds of hammers that they would actually need.&quot;&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.36140724946695096&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33Giag9uTRqvmIe8sZFvJqxa3OyezNcmXcdkcPO5ztvuRVN9t6sibNCDEmw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;938&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“让我猜一下，你们肯定也不再出售这些设计图了”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Let me guess. You don&#x27;t sell those anymore.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“没错，当然不了。事实证明，人们不会仅仅为了制造几把锤子就去建造一整个工厂。把工厂的建造留给工厂建造专家，这才是我常常说到的。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Nope. Sure don&#x27;t. As it turns out, people don&#x27;t want to build an entire factory just to manufacture a couple of hammers. Leave the factory-building up to the factory-building experts, that&#x27;s what I always say!!&quot;&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6403712296983759&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33GCrFDHzm1Vqico6wFZJjgrEzYP06mYpLKyAEGNSeYNaia9aAt4SSo1p8w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;862&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“我很同意你的观点。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;And I would agree with you there.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“是的，所以我们停止出售那些设计图，转而去出售建造锤子工厂的工厂。每个建造锤子工厂的工厂都是由这一领域的顶级业务专家为你建造的，因此你不需要担心建造工厂的任何细节。你仍然可以享受自定义锤子工厂的所有优点，根据你自己特殊锤子的设计，生产你自己的定制锤子。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Yup. So we stopped selling those schematics and started selling hammer-factory-building factories. Each hammer factory factory is built for you by the top experts in the hammer factory factory business, so you don&#x27;t need to worry about all the details that go into building a factory. Yet you still get all the benefits of having your own customized hammer factory, churning out your own customized hammers, according to your own specific hammer designs.&quot;&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4125714285714286&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33GwDicW0ENvhvxqWvBwrtmfgEBZPP5NeQ3T9bfkxtNNtEO2PH6na16XXQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;875&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“嗯，那实际上并不……”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Well, that doesn&#x27;t really...&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“我知道你要说什么！！…我们早就不出售这些东西了。出于某些原因，并没有多少人去购买建造锤子工厂的工厂，因此我们想出了新的解决方案来处理这个问题。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;I know what you&#x27;re going to say!! ...and we don&#x27;t sell those anymore either. For some reason, not many people were buying the hammer factory factories, so we came up with a new solution to address the problem.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“呃，嗯。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Uh huh.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“当我们回过头来，再审视这个统一工具的底层时，发现人们苦恼于管理这个建造锤子工厂的工厂、以及它生产出来的锤子工厂。如果你同时需要运营卷尺工厂的工厂、锯子工厂的工厂、水平仪工厂的工厂的话，那么开销会变的非常庞大，更不用说运营一家木材制造集团控股公司了。当我们真正考虑到这种情况的时候，我们认为这对于一个只想做一个香料架子的人来说，实在是过于复杂了。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;When we stepped back and looked at the global tool infrastructure, we determined that people were frustrated with having to manage and operate a hammer factory factory, as well as the hammer factory that it produced. That kind of overhead can get pretty cumbersome when you deal with the likely scenario of also operating a tape measure factory factory, a saw factory factory, and a level factory factory, not to mention a lumber manufacturing conglomerate holding company. When we really looked at the situation, we determined that that&#x27;s just too complex for someone who really just wants to build a spice rack.&quot;&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5901132852729145&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33G8RtzibJgKgCIRViclMOoXicbfLp172SaCuMBqhLTrVTVuOibiaUA0jYSV5A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;971&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“是的，这可不是闹着玩的。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Yeah, no kidding.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“所以这个星期，我们正在推广一种通用型的工厂，用来建造生产工具工厂的工厂，这样一来，所有用来建造不同种类工具的工厂的工厂，就可以由一个单一和统一的工厂来建造了。这种通用工厂只生产你实际需要的工具工厂的建造工厂，而这些建造工厂将生成一个仅生产你自定义的工具的工厂。在这个过程中最后产生的工具，就是你特定工程需要的理想工具。最后只需要按下一个按钮，你就能够得到你需要的锤子和卷尺（尽管有可能你还需要部署一些配置文件，来使它按照你的期望工作）。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;So this week, we&#x27;re introducing a general-purpose tool-building factory factory factory, so that all of your different tool factory factories can be produced by a single, unified factory. The factory factory factory will produce only the tool factory factories that you actually need, and each of those factory factories will produce a single factory based on your custom tool specifications. The final set of tools that emerge from this process will be the ideal tools for your particular project. You&#x27;ll have &lt;em&gt;exactly&lt;/em&gt; the hammer you need, and exactly the right tape measure for your task, all at the press of a button (though you may also have to deploy a few &lt;em&gt;configuration files&lt;/em&gt; to make it all work according to your expectations).&quot;&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6305525460455038&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33GxJBdphtbwddxTZnElaRLMH7VeX4vN4X6RKVRXkGTgriaksJSpfyQ7MQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;923&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“所以说你们根本就没有锤子，对吗？”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;So you don&#x27;t have any hammers? None at all?&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“是的，如果你真的需要一个高质量的、符合工业设计的香料架，你绝对需要这些更先进的东西，而不是一把能随便从破旧五金店买到的普通锤子。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;No. If you really want a high-quality, industrially engineered spice rack, you desperately need something more advanced than a simple hammer from a rinky-dink hardware store.&quot;&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6067961165048543&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33G6krboeQPibDvc2Y5WPH1QhbqFv3iaicYEpyniadX4bfR9V863Ln1zNQJnw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;824&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“现在每个人都是这样做的吗？当需要一把锤子的时候，他们都在使用一个通用的能够生产工具工厂的建造工厂的工厂吗？”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;And this is the way everyone is doing it now? Everyone is using a general-purpose tool-building factory factory factory now, whenever they need a hammer?&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“是的。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Yes.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“那么…好吧。我想这就是我必须要做的了。如果这就是处理事情的解决方案的话，我想我最好学学怎么使用它吧。”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Well…All right. I guess that&#x27;s what I&#x27;ll have to do. If this is the way things are done now, I guess I&#x27;d better learn how to do it.&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“祝你好运！”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;Good for you!!&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;“这玩意儿一定是有文档的，对吧？”&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&quot;This thing comes with documentation, right?&quot;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;现在，我已经自豪的拥有了自己的通用的工具工厂的建造工厂的建造工厂，我很欣慰地知道它与GPTBFFF 0.97 RC2草案相兼容，这一草案正是用来规范“通用的工具工厂的建造工厂的建造工厂”标准。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Now that I&#x27;m the proud owner of my own general-purpose tool-building factory factory factory, I&#x27;m satisfied to know that it complies with the GPTBFFF 0.97 RC2 draft specification for tool-building factory factory factories.&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.41624365482233505&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33GJR6Cr3RUZXr6EOjwsCo4H0tWh0IqEe6krEJBUMPnh6T01uxXibmMEMA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;788&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;幸运的是，在面向工具的元工厂联盟中，70%的工人通过了这一版本规范的认证。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Luckily, 70% of the workers in the Tool-Oriented Metafactory Union are certified against this version of the spec.&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然而标准之争已初露端倪，一项名为UXCTBFFF（通用跨大陆工具制造FFF）的元工厂技术非常具有竞争力，它承诺将要统一通用工厂的建造工厂的建造工厂标准，来满足那些同时使用通用工厂方法和标准原始工具作为方案的的场景。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;On the horizon is a competing standard, though: a very compelling metafactory technolgy called the UXCTBFFF (Universal Trans-Continental Tool Building FFF), which promises to unify the factory factory factory industry to comply with guidelines of countries that use both metric and standard tools.&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我的理解是，只要在用户界面上创建一个抽象层，肯定会有一个补丁包能使我的GPTBFFF 0.97 RC2与UXCTBFFF标准达到95%左右的兼容。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;My understanding is that there will be a service pack to my GPTBFFF 0.97 RC2 to bring it into nearly 95% compliance with the UXCTBFFF standard, just by creating an abstraction layer through its user interface.&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;太棒了！！&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Sweet!!&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;毫无疑问，这种新的发展一定能提高我的香料架子的质量（总有一天，当我搭建好我的通用工具工厂的建造工厂的建造工厂并使它开始运转、培训好我的劳动力、从柬埔寨进口好原材料后，我就要开始着手做我的香料架子了）。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Surely this new development will improve the quality of my spicerack (which I&#x27;ll get around to building one of these days, as soon as I&#x27;ve got my factory factory factory all up and running, my labor force trained, my raw materials imported from Cambodia, etc).&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6817226890756303&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zpom4BeZSicaC5SlAAu0XQhP6EXM9U33GD4A9OibdibFPsPmTQ2y7Gcwf1TbI0QK5dUQO4SWiadMvoz3aYxljBU8iaQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;952&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;-- End --&lt;/strong&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;Benji Smith个人网站：&lt;/p&gt;&lt;p&gt;http://www.benjismith.net/&lt;/p&gt;&lt;p&gt;原文及译文参考：&lt;/p&gt;&lt;p&gt;https://www.cnblogs.com/kkjmyazi/archive/2006/11/29/576573.html&lt;/p&gt;&lt;p&gt;PS：&lt;/p&gt;&lt;p&gt;因为文中有很多我也不确定翻译是否正确的地方，所以贴出了英文原文。例如对于文中“which promises to unify the factory factory factory industry to comply with guidelines of countries that use both metric and standard tools.”这一句，如果从字面上进行翻译的话后半句大致意思是“使它符合一些同时使用公制和标准工具的国家的标准”，而我决定将它引申为“同时使用通用工厂方法和标准原始工具”。&lt;/p&gt;&lt;p&gt;诸如此类的地方，如果您有更好的建议，可以在公众号后台直接发送建议给我，万分感谢！&lt;/p&gt;&lt;/blockquote&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>3847a25c9a8dd3e28f176a6cb51ff0cc</guid>
<title>手把手教你用 Python 直观查看贵州茅台股票交易数据</title>
<link>https://toutiao.io/k/ht1yt54</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;markdown-body detail-content&quot;&gt;&amp;#13;
                &amp;#13;
                &lt;p&gt;&lt;img src=&quot;http://download.broadview.com.cn/Original/21118990e1285908c6ca&quot; alt=&quot;&quot;/&gt;&amp;#13;
&lt;/p&gt;&lt;p&gt;&lt;strong&gt;【本文原创：关东升】&lt;/strong&gt;&lt;/p&gt;&amp;#13;
&lt;p&gt;如图1所示是网易财经展示的贵州茅台股票的历史交易数据。&lt;/p&gt;&amp;#13;
&lt;p&gt;&lt;img src=&quot;http://download.broadview.com.cn/Original/211105f64322d64ef11a&quot; alt=&quot;&quot;/&gt;&lt;br/&gt;图1&amp;#13;
&lt;/p&gt;&lt;p&gt;单击“下载数据”超链接，会弹出如图2所示的对话框，选择完成后单击“下载”按钮就可以下载数据了，所下载的数据是CSV格式。&lt;br/&gt;&lt;img src=&quot;http://download.broadview.com.cn/Original/21114afeab8af8bc69fc&quot; alt=&quot;&quot;/&gt;&lt;br/&gt;图2&amp;#13;
&lt;/p&gt;&lt;p&gt;CSV（Comma-Separated Values）是以逗号分隔数据项（也被称为字段）的数据交换格式，主要应用于电子表格和数据库之间的数据交换。&lt;/p&gt;&amp;#13;
&lt;p&gt;&lt;strong&gt;提示：&lt;/strong&gt;CSV 是文本文件，可以使用记事本等文本编辑器打开，如图2-5所示，还可以使用Excel打开，如图2-6所示。另外，可以将Excel中的电子表格另存为CSV文件，但这可能会导致数据格式丢失，例如CSV文件中的”0001”数据使用Excel打开会变为1。在Windows平台上，默认的字符集是GBK，要想使用Excel打开CSV文件且不乱码，就需要将CSV文件保存为GBK字符集。&lt;/p&gt;&amp;#13;
&lt;p&gt;&lt;img src=&quot;http://download.broadview.com.cn/Original/2111788defa8eed32048&quot; alt=&quot;&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;http://download.broadview.com.cn/Original/2111f51eed498b596d17&quot; alt=&quot;&quot;/&gt;&lt;br/&gt;图3&amp;#13;
&lt;/p&gt;&lt;p&gt;该折线图的实现代码如下：&lt;br/&gt;&lt;img src=&quot;http://download.broadview.com.cn/Original/21113192eb95787eb24c&quot; alt=&quot;&quot;/&gt;&lt;br/&gt;代码解释如下。&amp;#13;
&lt;/p&gt;&lt;p&gt;&lt;strong&gt;第①行通过指定时间段来查询数据，并按照’Date’字段排序。&lt;/strong&gt;&lt;/p&gt;&amp;#13;
&lt;p&gt;&lt;strong&gt;第②行通过plt.plot函数绘制折线，其中df2[‘Date’]是x轴数据，df2[‘Volume’]是y轴数据。&lt;/strong&gt;&lt;/p&gt;&amp;#13;
&lt;p&gt;&lt;img src=&quot;http://download.broadview.com.cn/Original/211113da39f6f9e05f96&quot; alt=&quot;&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;http://download.broadview.com.cn/Original/211133b7f290c0ab92a9&quot; alt=&quot;&quot;/&gt;&lt;br/&gt;图 4&amp;#13;
&lt;/p&gt;&lt;p&gt;该折线图的实现代码如下：&lt;br/&gt;&lt;img src=&quot;http://download.broadview.com.cn/Original/2111892e4bfeb3161c5e&quot; alt=&quot;&quot;/&gt;&lt;br/&gt;代码解释如下。&amp;#13;
&lt;/p&gt;&lt;p&gt;第①行和第②行绘制了4个折线图，label参数用于设置在图例中显示的折线标签。&lt;/p&gt;&amp;#13;
&lt;p&gt;至此，我们便可以直观地看到茅台一个月内的历史股票交易数据啦！&lt;/p&gt;&amp;#13;
&lt;p&gt;本文摘自&lt;strong&gt;《趣玩Python：自动化办公真简单（双色+视频版）》&lt;/strong&gt;一书，欢迎阅读此书了解更多关于Python自动化办公的内容。&lt;/p&gt;&amp;#13;
&lt;hr/&gt;&amp;#13;
&lt;p&gt;&lt;img src=&quot;http://download.broadview.com.cn/Original/2111a26c4983fc2ca289&quot; alt=&quot;&quot;/&gt;&lt;br/&gt;&lt;strong&gt;《趣玩Python：自动化办公真简单（双色+视频版）》&lt;/strong&gt;&lt;br/&gt;关东升 著&amp;#13;
&lt;/p&gt;&lt;p&gt;&lt;strong&gt;有趣、有料、好玩、好用的Python自动化办公书！自动化办公真简单！&lt;/strong&gt;&lt;/p&gt;&amp;#13;
&lt;p&gt;&lt;strong&gt;精美双色印刷，好看、养眼，可读性更好！&lt;/strong&gt;&lt;/p&gt;&amp;#13;
&lt;p&gt;&lt;strong&gt;内页植入配套视频二维码，看不懂的地方随手扫一扫，轻松看视频&lt;/strong&gt;&lt;/p&gt;&amp;#13;
&lt;p&gt;&lt;strong&gt;贴心配套随书源码、视频、课件，根据封底读者服务即可轻松获取&lt;/strong&gt;&lt;/p&gt;&amp;#13;
&lt;p&gt;本书以数据收集→数据清洗→数据分析→数据可视化→根据数据可视化结果（即图表）做决策为脉络，介绍Python在实际工作场景中的应用，侧重于用Python解决工作中的数据处理问题，并通过实战形式讲解如何用Python实现数据收集、数据清洗、数据分析及可视化等工作。本书还详细讲解了Python自动化办公方面的内容，包括：Excel自动化、Word自动化、PPT自动化、PDF文件处理、图形图像处理和RPA（机器人流程自动化），并介绍了GUI技术和应用程序打包相关知识。&lt;/p&gt;&amp;#13;
&lt;p&gt;本书秉承有趣、有料、好玩、好用的理念，特意设计了两个人物角色，通过这两个人物角色的轻松对话、搞笑形象及夸张动作，把复杂的技术问题讲解得深入浅出，非常适合广大读者阅读。&lt;br/&gt;&lt;img src=&quot;http://download.broadview.com.cn/Original/2111a1c31328c342606d&quot; alt=&quot;&quot;/&gt;&lt;br/&gt;&lt;strong&gt;（京东满100减50，快快扫码抢购吧！）&lt;/strong&gt;&lt;/p&gt;&amp;#13;
&amp;#13;
            &lt;/div&gt;&amp;#13;
&amp;#13;
            &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>