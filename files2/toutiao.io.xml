<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>04464901717dcce2c4ac51c773630c90</guid>
<title>性能提高 15 倍！只是把 MySQL 换成了 ClickHouse</title>
<link>https://toutiao.io/k/221a7sh</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;简介&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们需要存储结构化时序数据，时间间隔为5分钟或1分钟，计算&lt;code&gt;95峰值&lt;/code&gt;、&lt;code&gt;995峰值&lt;/code&gt;、&lt;code&gt;最值&lt;/code&gt;等指标，并且在网页中展示。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;MySQL&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;项目开发初期，为了快速开发原型，验证产品，我们使用MySQL作为整个项目的存储。带来的问题是时序数据库范围分析查询耗时很长，计算30天的数据需要30s+，到了无法容忍的地步，即便是创建索引、使用BitInt存储时间戳，几乎没有性能提升。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;后来我们组其他同事说换ClickHouse来存储时序数据，于是我们就开始了替换之旅。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;ClickHouse&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;ClickHouse是面向OLAP（在线分析处理）、兼容SQL标准的列式数据库，主要的不足是&lt;code&gt;不支持事务&lt;/code&gt;。因此我们目前没有把整个存储都迁移到ClickHouse上，而是只把时序数据存过来。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;本以为替换过程会很麻烦，可能修改大量的代码和逻辑，实际上很快，因为之前接口的逻辑设计很合理，所以只替换了数据库ORM库，从gorm换成了sqlx，花了1天时间(&lt;code&gt;前期重构逻辑花了1个星期我会乱说&lt;/code&gt;)。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;更重要的是，ClickHouse提供了很多聚合函数，之前计算95值需要2次查询，而现在只需要一次查询就够了，对应的SQL如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;select&lt;/span&gt; d.en_name, &lt;span&gt;max&lt;/span&gt;(d.in_value) &lt;span&gt;as&lt;/span&gt; peak_in,&lt;br/&gt;    &lt;span&gt;max&lt;/span&gt;(d.out_value) &lt;span&gt;as&lt;/span&gt; peak_out, &lt;span&gt;max&lt;/span&gt;(d.max_value) &lt;span&gt;as&lt;/span&gt; peak_max,&lt;br/&gt;    quantileExact(&lt;span&gt;0.95&lt;/span&gt;)(d.out_value) &lt;span&gt;as&lt;/span&gt; peak_95,&lt;br/&gt;    quantileExact(&lt;span&gt;0.995&lt;/span&gt;)(d.out_value) &lt;span&gt;as&lt;/span&gt; peak_995,&lt;br/&gt;    quantileExact(&lt;span&gt;0.999&lt;/span&gt;)(d.out_value) &lt;span&gt;as&lt;/span&gt; peak_999&lt;br/&gt;&lt;span&gt;from&lt;/span&gt; table_value d &lt;span&gt;where&lt;/span&gt; d.record_time &amp;gt;= &lt;span&gt;&#x27;2020-01-01 00:00:00&#x27;&lt;/span&gt; &lt;span&gt;and&lt;/span&gt; d.record_time &amp;lt;= &lt;span&gt;&#x27;2020-01-31 23:59:59&#x27;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;group&lt;/span&gt; &lt;span&gt;by&lt;/span&gt; d.en_name&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;经验证，ClickHouse是真的牛逼，&lt;strong&gt;30天内的查询耗时从30s降到2s内，提升了15倍！！！&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下图是ClickHouse的测试结果，x轴表示查询的时间范围，最大12个月，最小1个月，共测试12次。&lt;strong&gt;可以看到大部分耗时在3s内&lt;/strong&gt;。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.75&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ib3G4kbB3s93Zic7yYTPq5Zz2tLx7LkVBnyUh4QKWhog2eV0hpvpE1UnZ4ekY8xAA7ZaAQQaeEkALc6v3S826CuQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;640&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下图是MySQL存储中的测试结果（忽略标题），分别计算1、2、3个月范围的数据，共查询1次，耗时都在100s以上。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.75&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ib3G4kbB3s93Zic7yYTPq5Zz2tLx7LkVBnIrl5mVc5zZrIgWh86vkQMH6oLhwHOBj8d2ibQWpddI7QZt0H6yYASGg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;640&quot;/&gt;&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;总结&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;ClickHouse之所以快主要是采用&lt;strong&gt;列式存储&lt;/strong&gt;和&lt;strong&gt;数据压缩&lt;/strong&gt;，减少了&lt;strong&gt;数据扫描范围&lt;/strong&gt;和&lt;strong&gt;数据传输大小&lt;/strong&gt;；其次，利用CPU的SIMD(Single Instruction Multiple Data)技术实现向量化执行引擎，可以通过一条CPU指令对一组数据执行相同的操作，实现空间上的并行。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;需要说明的是，MySQL和ClickHouse各有优劣，要针对自己的业务需求、场景选择合适的数据库。本文涉及的业务比较适用于ClickHouse的强项，才会比MySQL快15倍。&lt;/p&gt;&lt;section&gt;&lt;mpcps frameborder=&quot;0&quot; class=&quot;js_editor_cps&quot; data-datakey=&quot;1607824839573_0.7663749515124103&quot; data-uid=&quot;1607824839571&quot; data-type=&quot;1&quot; data-product=&quot;&quot; data-templateid=&quot;list&quot; data-pid=&quot;12886370&quot; data-categoryid=&quot;3&quot; data-appuin=&quot;3208869061&quot;/&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot;&gt;
                                &lt;p class=&quot;tips_global&quot;&gt;Long-press QR code to transfer me a reward&lt;/p&gt;
                                                                &lt;p class=&quot;reward_tips&quot;&gt;Stay foolish Stay hungry&lt;/p&gt;
                                &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;/&gt;&lt;/span&gt;
                                &lt;p class=&quot;tips_global&quot;&gt;As required by Apple&#x27;s new policy, the Reward feature has been disabled on Weixin for iOS. You can still reward an Official Account by transferring money via QR code.&lt;/p&gt;
                            &lt;/div&gt;
                                                                            
                              
            &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>b8e96d3171001842c154e1f265b6c1b9</guid>
<title>架构设计：服务自动化部署和管理流程</title>
<link>https://toutiao.io/k/vggjh71</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;h1&gt;&lt;span&gt;一、分布式服务&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;从常规分布式架构系统来说，划分出十来个独立的微服务模块是很常见的，然后不同的开发人员分工几个服务块，负责日常开发和维护，微服务之间会出现版本差异也是自然的。例如用户服务需要开发版本为7.0，其他服务可能高于这个版本或者低于这个版本，所以对服务发布这块做持续集成就很有必要。&lt;/p&gt;&lt;p&gt;现在比较通用的服务自动发布和管理的技术栈：Jenkins持续集成工具、Docker容器、K8S容器管理。&lt;/p&gt;&lt;h1&gt;&lt;span&gt;二、Jenkins集成&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;Jenkins可以很方便的整合常用的代码仓库，例如：GitHub、SVN等，提供持续集成能力，可以把整个代码构建打包，部署做成自动管理流程，代码一经提交就会自动发布到指定环境下，极大减少非必要的工作量。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.5674676524953789&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvDYVrLL1CpSefDF5HpkA6nNGuZ5lpggjR6U6XIca5KUrhvibicPMWUne5sxCGDMhAOXAroibZPwOialEA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1082&quot;/&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;开发人员提交本地代码；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;代码仓库通过Hook机制通知Jenkins；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;Jenkins获取最新代码编译打包；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;生成Docker镜像文件上传到中心仓库；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;最终触发滚动或者灰度等发布机制；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;在整个代码发布过程如果出现问题，可以快速的回滚到上个版本，需要手动处理的流程极少，作为程序员这个职业，越是工作时间长，越要善用自动化的流程。系统架构越复杂，则服务部署、数据和环境隔离、容灾、灰度、动态扩容就更是需要自动管理，上述技术体系可以很轻松的解决这些问题。&lt;/p&gt;&lt;h1&gt;&lt;span&gt;三、Docker容器&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;Docker是作为开源的应用容器引擎，有三个核心概念，Image-镜像，Container-容器、Repository-仓库；开发人员可以通过打包应用和依赖包到一个可移植的容器中，容器是完全使用沙箱机制，相互之间不会有任何接口，然后发布到任何流行的服务器上，也可以实现虚拟化。&lt;/p&gt;&lt;p&gt;上述微服务模块变多，需要持续集成工具管理；同理当Docker容器变多和复杂，管理和调度也是一个问题。&lt;/p&gt;&lt;h1&gt;&lt;span&gt;四、K8S容器管理&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;Kubernetes简称K8S，用做灵活和便捷管理和调度Docker容器，提供应用部署、规划、更新、维护的一种机制，让部署容器化的应用简单并且高效，支持自动化部署、大规模可伸缩、应用容器化管理。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.4820415879017013&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvDYVrLL1CpSefDF5HpkA6nNUFeMkI7txaGgqJSVLeRMzl4uRq7AUSUJ9NIc109seuYp5kHiacBdVWw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1058&quot;/&gt;&lt;/p&gt;&lt;p&gt;在上面的部署环境架构下，Docker可以理解为Kubernetes上的一个组件，通过K8S去统一管理。&lt;/p&gt;&lt;p&gt;这样一套服务发布和环境管理的技术体系现在非常常用，从开发的角度看，熟悉基本使用流程最好，原理逻辑不负责，但是实际操作复杂，通常由专业的运维管理，能说清楚环境的搭建思路也是面试中常见的问题。&lt;/p&gt;&lt;h1&gt;&lt;span&gt;五、源代码地址&lt;/span&gt;&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;GitHub地址：知了一笑&lt;br/&gt;https:&lt;span&gt;//github.com/cicadasmile/spring-cloud-base&lt;/span&gt;&lt;br/&gt;GitEE地址：知了一笑&lt;br/&gt;https:&lt;span&gt;//gitee.com/cicadasmile/spring-cloud-base&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.3783359497645212&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvCjMheLZtcM2iaVMBOpIUKR4CDRCG9FLT5K6NmGXvG7exrW0TSuDjnTKJQ5PDq8j8Y7PHDd17Z3gicA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1274&quot;/&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>432fb394efe494eda9d42136e04c4e42</guid>
<title>Math.random() 还能这样玩？</title>
<link>https://toutiao.io/k/ukwznum</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;相信大家对 Math.random 函数都不会陌生，调用该函数后会返回一个伪随机数，对应的取值范围是 &lt;code&gt;[0, 1)&lt;/code&gt;。在日常工作中，应用的比较多的场景是生成 UUID，比如：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;function&lt;/span&gt; &lt;span&gt;uuidv4&lt;/span&gt;(&lt;span/&gt;) &lt;/span&gt;{&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; &lt;span&gt;&#x27;xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx&#x27;&lt;/span&gt;.replace(&lt;span&gt;/[xy]/g&lt;/span&gt;, &lt;span&gt;&lt;span&gt;function&lt;/span&gt;(&lt;span&gt;c&lt;/span&gt;) &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;var&lt;/span&gt; r = &lt;span&gt;Math&lt;/span&gt;.random() * &lt;span&gt;16&lt;/span&gt; | &lt;span&gt;0&lt;/span&gt;, v = c == &lt;span&gt;&#x27;x&#x27;&lt;/span&gt; ? r : (r &amp;amp; &lt;span&gt;0x3&lt;/span&gt; | &lt;span&gt;0x8&lt;/span&gt;);&lt;br/&gt;    &lt;span&gt;return&lt;/span&gt; v.toString(&lt;span&gt;16&lt;/span&gt;);&lt;br/&gt;  });&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当然除了上述方法外，还有其他的方法可以用来生成 UUID，感兴趣的小伙伴可以参考一下 Stack Overflow 上 “how-to-create-a-guid-uuid” 这一篇问答。Math.random 除了上述的应用场景之外，还可以应用在游戏、动画、随机数据、生成音乐或艺术图片等场景。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;好的，废话不多说，接下来我们马上来一起感受一下 Math.random 的魅力。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;霓虹灯六角形粒子动画&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/jQmwTIFl1V2X1qrzRu204SoH2zzibRmPflzrYeicwn5Q3o0xy5ibxdwwDEbZRicAaDMoFFFPb94fCvCsHld04QNl1A/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-ratio=&quot;0.5083333333333333&quot; data-w=&quot;720&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;（图片来源：https://codepen.io/towc/pen/mJzOWJ）&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;生成音乐&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/jQmwTIFl1V2X1qrzRu204SoH2zzibRmPfIn2O45eiaGVs0FXv6PqtMkOGP91stRtOr9ricwDQy5wibAYrAAb17RxQw/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-ratio=&quot;0.4322250639386189&quot; data-w=&quot;782&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;（图片来源：https://codepen.io/jakealbaugh/pen/zxoOjG）&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;文字打乱效果&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/jQmwTIFl1V2X1qrzRu204SoH2zzibRmPfYepcjeiaibd7GXiaTG1u4b4zpCnCtLEWsdVVFCw8lMFg3hJI3XKxouSOg/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-ratio=&quot;0.37650602409638556&quot; data-w=&quot;664&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;（图片来源：https://codepen.io/soulwire/pen/mErPAK）&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;手头剪刀布游戏&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/jQmwTIFl1V2X1qrzRu204SoH2zzibRmPfWlLiaiaF5TXeHcic9mN0IT5Jht0wXhSe7wmGbudArnQ6dJUNJRZ1eT2kw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-ratio=&quot;0.5212962962962963&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;（图片来源：https://codepen.io/studiojvla/pen/ONjyMo）&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;随机密码生成器&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/jQmwTIFl1V2X1qrzRu204SoH2zzibRmPfibG8ibmdI8addQgJbgr9CCnRribvnoNRlNGzGXMAJPq2frw3SgKAX4sOw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-ratio=&quot;0.7176684881602914&quot; data-w=&quot;549&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;（图片来源：https://codepen.io/nourabusoud/pen/YeMOVv）&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;随机背景颜色&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/jQmwTIFl1V2X1qrzRu204SoH2zzibRmPfF0bflPpvt5jnprqm4dPHKicYjsloMDQd7DibViayuFiawPh4HRftP9k8ZQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-ratio=&quot;0.5509259259259259&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;（图片来源：https://codepen.io/meodai/pen/RerqjG）&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;生成艺术图案&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/jQmwTIFl1V2X1qrzRu204SoH2zzibRmPfrQ5RMNeuVoNv5icyCThzavtwlQDcwRibLBUQoicKiaUicSmhNwR1iaeds4cw/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-ratio=&quot;0.44776119402985076&quot; data-w=&quot;804&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;（图片来源：https://codepen.io/tjoen/pen/iCgfj）&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;看完以上的示例，你是不是觉得挺好玩的。其实这些示例是阿宝哥从 &lt;strong&gt;“lots-of-ways-to-use-math-random-in-javascript”&lt;/strong&gt; 这篇文章中介绍的例子里挑选出来的，感谢作者 Jwahir Sundai 为我们提供了那么👍  的使用示例。如果你对其他的示例感兴趣的话，可以自行阅读一下该文章哟。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;虽然 Math.random 函数能帮助我们实现很酷炫的动画或很好玩的功能，但该函数并不是真的随机，对应的算法被称为 &lt;strong&gt;伪随机数生成器（Pseudo Random Number Generator）&lt;/strong&gt;。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;因为 Math.random 不能提供像密码一样安全的随机数字，所以不要使用它来处理有关安全的事情。针对信息安全的场景，你可以使用 Web Crypto API 来代替，并使用更精确的 &lt;code&gt;window.crypto.getRandomValues()&lt;/code&gt; 方法。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;参考资源&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;MDN - Math.random&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Stackoverflow - how-to-create-a-guid-uuid&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;lots-of-ways-to-use-math-random-in-javascript&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;聚焦全栈，专注分享 TypeScript、Web API、前端架构等技术干货。&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-cropselx1=&quot;1&quot; data-cropselx2=&quot;517&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;287&quot; data-ratio=&quot;0.55390625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/jQmwTIFl1V05hkPsHIMuu0u4t7PXe8Rr8AYsibjj4I8JiaAA9pIOib3bX4WN78BcjbtSuMgoxOH5tTOzPk6qmrFEg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;/section&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>43b900457d921576e07a7ccd4083be25</guid>
<title>那些有趣/实用的 Chrome 扩展神器系列</title>
<link>https://toutiao.io/k/37mphn9</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;苏生不惑第&lt;code&gt;201&lt;/code&gt; 篇原创文章，将本公众号设为&lt;code&gt;星标&lt;/code&gt;，第一时间看最新文章。&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;之前分享过 &lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247487291&amp;amp;idx=1&amp;amp;sn=e61de6b32892423b297e5c300916c1c0&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;那些有趣/实用的 Chrome 扩展神器&lt;/a&gt; ,准备做成一个系列，这是第2篇，关于谷歌浏览器安装Chrome扩展参考我之前的文章 &lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247485797&amp;amp;idx=1&amp;amp;sn=8c38c77fa9926f0ea4e32a930e55a753&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;那些你可能不知道的谷歌浏览器实用技巧&lt;/a&gt; ， &lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247484489&amp;amp;idx=1&amp;amp;sn=50909c0f512152e507e7a4ad86a32d75&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;上不了谷歌如何安装 Chrome 扩展？&lt;/a&gt; 。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;正则搜索&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;平常网页上最常用&lt;code&gt;ctrl+f&lt;/code&gt;搜索关键词，不过功能单一，如果想更丰富的查找功能可以使用这个插件 https://chrome.google.com/webstore/detail/chrome-regex-search/bpelaihoicobbkgmhcbikncnpacdbknn&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;比如使用正则&lt;code&gt;[\u4e00-\u9fa5]&lt;/code&gt;可以高亮显示页面的中文，还可以直接复制下来。&lt;img data-ratio=&quot;0.30806451612903224&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKITTP1mNuMEeNJtWmBmKbDicQjb1rRYABBZTUHciaU2tyXWhxVqb2czSw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1240&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果对正则不熟悉可以在网站 https://regexr.com/ ， https://regex101.com/ 在线练习使用方法，很快就能学会 。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;录屏标记&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;之前分享过录制GIF工具 &lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247484635&amp;amp;idx=1&amp;amp;sn=9d4a44f34bc14bd444273abb2a61efa5&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;那些好用的 GIF 录制工具&lt;/a&gt; ，如果不想安装客户端软件可以试试这个插件screenity  https://chrome.google.com/webstore/detail/screenity-screen-recorder/kbbdabhdfibnancpjfhlkhafgdilcnji，支持在屏幕上任意位置进行录制和标注信息，并可将录制内容导出 MP4、gif、webm 等文件格式。&lt;img data-ratio=&quot;1.6881028938906752&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VK9rXicmcXesxkw8C6gUulTAIwopMicTfOUfq5AdW4bicQKIhCNoIkn3cCQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;311&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.2240566037735849&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKn3Bfc5iczlqDeriatZOice5FtKxUfKIdfY8pOnWzPdb4op8NTeAQLv8rg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;424&quot;/&gt;这里导出GIF格式，不过导出的GIF文件有点大，可以使用 https://ezgif.com/ 压缩下。&lt;img data-ratio=&quot;0.4443548387096774&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKllc6F7Ycrc5zMOln251icG571kuttCntIxOCAiak3qykU1WIHHyITZKw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1240&quot;/&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;视频下载&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;之前分享过好几个下载视频神器 &lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247487784&amp;amp;idx=1&amp;amp;sn=f41890470c54c150bfa02144f21899a5&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;视频下载神器：支持腾讯/优酷/爱奇艺/b站/微博等全网视频&lt;/a&gt;，这里再补上一个插件CoCoCut https://chrome.google.com/webstore/detail/video-downloader-cococut/gddbgllpilhpnjpkdbopahnpealaklle ，可以在线下载视频（支持HLS和视频直播下载，难以下载的视频还可以通过录制的方式下载）和音乐。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;比如微博视频就可以直接下载。&lt;img data-ratio=&quot;0.3621013133208255&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKiaAiaICicnH0GGTIt269D1xXCjico9uLWP85bocsUicOY2URaeeIFeY6y6g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;533&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;腾讯视频因为使用的m3u8格式，点击强力下载跳转 https://cococut.net/zh_cn/hls.html&lt;img data-ratio=&quot;0.4174397031539889&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKBxkNauT9ImEaPrrnyZr4ibYx6ict7oe0EYarEjyv7IlI0OicQEuDQEG5Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;539&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;很快就下载好了，文件是mp4格式。&lt;img data-ratio=&quot;1.089922480620155&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKZPMIicRChr5FD3P6xOwfEILce7ibGfCrT4UQPpIVDDZt2sygbR1hM2EQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;645&quot;/&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;中国传统色&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;每次打开新标签页看到中国的传统颜色搭配一句经典诗词歌赋，非常赏心悦目，这就是几枝扩展 https://chrome.google.com/webstore/detail/%E5%87%A0%E6%9E%9D/hfohpokminpknagcgncibpacohagppjn/?hl=zh-CN&lt;img data-ratio=&quot;0.6346774193548387&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKgpkEicBMI5rkrzHtDiacibiadV9zicudGXCu0gutcVX9RNhqTgXPrfv8hzQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1240&quot;/&gt;诗词来自网站 https://www.jinrishici.com/&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;股票基金盯盘&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个扩展支持自选A股、港股、美股、基金等产品、实时显示股票信息，小窗口看盘非常适用于上班族
https://chrome.google.com/webstore/detail/%E8%82%A1%E7%A5%A8%E5%9F%BA%E9%87%91%E5%8A%A9%E6%89%8B-%E7%9B%AF%E7%9B%98%E5%8A%A9%E6%89%8Bpro/folafkamgdbhdeejjhohajojeogpoknm?hl=zh-CN  ，添加贵州茅台股票代号。&lt;img data-ratio=&quot;0.2965779467680608&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKWWMic36czo3coc89uKBzVZafcrpmqicIEz0iaRIM4wSSicmiaic8ic6sXtlMw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;526&quot;/&gt;查看股票行情。&lt;img data-ratio=&quot;1.184&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKglVApOxfGQyppjy22IUnQxo2GoALClV6xAMFrkWsYY2cL3ict6QVIDQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;500&quot;/&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;GitHub 文件树&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;平常看代码找文件很麻烦，推荐Gitako 扩展https://chrome.google.com/webstore/detail/gitako-github-file-tree/giljefjcheohhamkjphiebfjnlphnokk ，左侧会显示文件目录，非常直观。&lt;img data-ratio=&quot;1.4914463452566096&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKeefMfeJ9D9ly1n24GcN6dZibhiaxIhPAnljiaTsqqDibcbwGdJia42MsLxQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;643&quot;/&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;可视化浏览历史记录&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;想知道自己每天都喜欢上哪些网站，使用这个扩展一看便知
https://chrome.google.com/webstore/detail/history-master/mkfgjjeggnmkbobjmelbjhdchcoadnin  ，直观展示访问时间 ，网页标题，访问次数。&lt;img data-ratio=&quot;0.22580645161290322&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKwkr7LudH88ZRK1ia4SvmibdMJJvnYYkBWwDx813NmjWmxUIjzf1vyycw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1240&quot;/&gt;还有可视化功能，看看你访问的top10网站是哪些。&lt;img data-ratio=&quot;0.45806451612903226&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKMP9S29Lvn7MSagUSVZfKWwJb0ty5ZqtNVbFIICz9ocPJicasricI2TzQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1240&quot;/&gt;还可以导出txt文件，文件内容是逗号分隔，用Excel看会方便点，不过由于中文乱码的原因需要转换下，我这里用Python处理下。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;history=pd.read_table(&lt;span&gt;&#x27;2020-12-03_2020-12-10.txt&#x27;&lt;/span&gt;,&lt;span&gt;&#x27;,&#x27;&lt;/span&gt;)&lt;br/&gt;history.to_csv(&lt;span&gt;&#x27;history.csv&#x27;&lt;/span&gt;,encoding=&lt;span&gt;&quot;utf_8_sig&quot;&lt;/span&gt;)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.38480392156862747&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKPsvuib9icMI9NwWVHpJc8AwvFMYGhVNJwsZty6eH67e7tJVy9RHL1KEQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;408&quot;/&gt;&lt;figcaption&gt; &lt;/figcaption&gt;&lt;/figure&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;如果文章对你有帮助还请 &lt;code&gt;点赞/在看/分享&lt;/code&gt; 三连支持下， 感谢各位！&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最近原创文章：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247488041&amp;amp;idx=1&amp;amp;sn=0801dea6540e8be3ef9a1a30d0e4131e&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;百度网盘分享链接秒挂？试试这个神器&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247487936&amp;amp;idx=1&amp;amp;sn=43c4cf2364fce0a306c25e81ee05f350&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;一键下载百度文库/豆丁/道客巴巴文档，支持导出PDF，Word，txt 文件&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247487906&amp;amp;idx=1&amp;amp;sn=38a7429316d494d2f221804675cc0fc0&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;解除网页查看限制，自由查看和跳转网站&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247487818&amp;amp;idx=1&amp;amp;sn=05c12cc952249bbde7ed6ec0e6569b5c&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;不用写代码，Chrome 扩展神器 web scraper 抓取知乎热榜/话题/回答/专栏，豆瓣电影&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247488120&amp;amp;idx=1&amp;amp;sn=027cf732a9fbc459929ac8c32b4bd49d&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;不为人知的几个微信实用技巧&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247486819&amp;amp;idx=1&amp;amp;sn=79437e027e21f0b3b12e8a72592c82ec&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;2020 最全电子书搜索网站，找电子书不再愁&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247487672&amp;amp;idx=1&amp;amp;sn=669e6c9aa9f522cabb21a48d85308aab&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;b 站账号快速升级到 Lv6：每天自动签到，观看，分享，投币视频&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzIyMjg2ODExMA==&amp;amp;mid=2247487229&amp;amp;idx=1&amp;amp;sn=63265f859e9043d2af03ce290577f044&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;集赞生成器：朋友圈集赞不求人&lt;/a&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;公众号 苏生不惑&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/sZeVtjGD4lGXb7Hl8vzr9BGgqJxoJ8VKvsII4mAwxDwmibiavr1QHEhpe1kt4taWVJrNdZmrXf1ibmg7yOA3HqBEw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;344&quot;/&gt;&lt;figcaption&gt;扫描二维码关注或搜索微信susheng_buhuo&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot;&gt;
                                &lt;p class=&quot;tips_global&quot;&gt;Long-press QR code to transfer me a reward&lt;/p&gt;
                                                                &lt;p class=&quot;reward_tips&quot;&gt;坚持原创不易，点在看支持一下&lt;/p&gt;
                                &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;/&gt;&lt;/span&gt;
                                &lt;p class=&quot;tips_global&quot;&gt;As required by Apple&#x27;s new policy, the Reward feature has been disabled on Weixin for iOS. You can still reward an Official Account by transferring money via QR code.&lt;/p&gt;
                            &lt;/div&gt;
                                                                            
                              
            &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>e46bd46d138c9b7ee1ac692e1bd7640f</guid>
<title>关于 Elasticsearch 集群核心配置，腾讯大佬的灵魂 9 问，你能接住几个？</title>
<link>https://toutiao.io/k/i41dalm</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;题记&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这是一位腾讯大佬 2020年4月份在死磕 Elasticsearch技术交流微信群里发起讨论的问题，之前初步讨论了答案，但是不够细或者说讲解不透，所以一直没有成文。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这一次，加上了实践验证，说透。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;1、上问题&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;还是没太搞懂 seed_hosts 和 cluster.initial_master_nodes 的区别。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;1、 seed_hosts里面一定是配置 master eligible节点吗?&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;2、还是说data节点也可以配置到 master eligible&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;3、是如何发现潜在机器的呢?&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;4、initial_master一定是master eligible节点吧?&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;5、集群初始启动时, 这几个节点一定都要在是吗?&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;6 、初始的时候是不是可以配置一个, 然后集群初始化后, 再加master eligible节点也可以的是吗?&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;7 、多加几个以后, 把initial_master里的几个去掉是不是也可以了?&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;8、如果一个集群当前master为7，那他的quorum是4。es 是支持慢慢去掉节点，quorum慢慢降低的吗？&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;9、 那假如慢慢去掉了3个节点，原集群正常工作，那这三个节点重启后网络分区在一起了，那会不会自己形成集群啊？&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;希望大佬们点拨一下... ...&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;2、拆解一把&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;问题的核心是：seed_host 和 cluster.initial_master_nodes 的区别？&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.0 认知前提&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为避免认知偏差，将常用英文词汇做基础释义：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Discovery ：发现是节点间在形成集群之前发现其他节点的过程。当你启动Elasticsearch节点时，或者当节点认为主节点发生故障时，此过程将运行，并持续到找到主节点或选择新的主节点为止。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;master-eligible nodes：候选主节点&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;master-ineligible nodes：非候选主节点&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;coordinating-only nodes：仅协调节点&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;data-only nodes：仅数据节点&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;seed hosts providers：种子主机列表&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;voting configuration：投票配置&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;split brain：脑裂&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;initial quorum：初始仲裁——仅在整个集群首次启动时才需要初始仲裁&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.1 主节点职责&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;主节点负责集群范围内的轻量级操作，例如：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;创建或删除索引&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;跟踪哪些节点是集群的一部分&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;确定将哪些分片分配给哪些节点。&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;拥有稳定的主节点对于集群健康非常重要。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;候选主节点通过主选举过程成为主节点。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一个集群中：选举后只有一个主节点。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.2 脑裂&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;以下脑裂是我的通俗解释：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;假设在 2.1 选举主节点过程中，一个集群中出现了 2个或者2个以上的主节点，也就是说一个集群形式上划分为两个或两个以上的孤立集群，这就被称为脑裂。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.3 候选主节点两大基本任务&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;候选主节点必须合力完成的两个基本任务：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;即时某些节点故障，也要保住以上两活动正常运行。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.4 投票配置&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;每个 Elasticsearch 集群都有一组投票配置，这是一组候选主节点的集合。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;什么时候使用呢？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;什么时候做决策？——仅在投票配置中超过一半节点做出响应后才做决策。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;通常：投票配置和集群中所有候选主节点集合相同。但，某些情况下可以不同。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;以下是要强调的也是被问最多的问题之一：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;为确保集群仍然可用，请勿同时停止投票配置中的一半或更多节点。&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;只要有一半以上的投票节点可用，集群就可以正常工作。&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;例如：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;如果有三个或四个候选主机节点，则集群可以容忍一个候选主节点不可用。&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;如果有两个或更少的候选主节点，则它们必须全部保持可用。&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;后面的实战验证举例，你会进一步看到结论。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.5 集群规划时设置奇数个候选主节点&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;集群中通常应有奇数个候选主节点。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果有偶数个，Elasticsearch将其中一个排除在投票配置之外，以确保其大小为奇数。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;换种通俗说法：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;4个候选主节点和3个候选主节点本质一样，只容许一个候选主节点失效。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.6 discovery.seed_hosts  和 initial_master_nodes 作用&lt;/h2&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;7.x&lt;/th&gt;&lt;th&gt;7.X 之前&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;span&gt;discovery.seed_hosts&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;discovery.zen.ping.unicast.hosts&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;span&gt;cluster.initial_master_nodes&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;minimum_master_nodes  min_master_count&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;discovery.seed_hosts 的来龙去脉&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;6.X 5.X对应名字：discovery.zen.ping.unicast.hosts。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;看如下截图，对比：除了名称不同，释义部分一模一样。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.08339124391938846&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ493MjcpKQIyntPTnu2cicsMz23K1QmicnSkIO6IX13vUiaXIVrclwvrzMIA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1439&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果多节点集群，discovery.seed_hosts 应该配置为候选主节点。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;cluster.initial_master_nodes&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这也是7.X的特性，区别于之前设置min_master_count候选主节点的个数。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;白话文：设置候选主机节点的主机名称列表。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在7.x节点上，discovery.zen.minimum_master_nodes设置是允许的，但被忽略。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;集群首次启动的时候，cluster.initial_master_nodes 必须设置为执行集群引导。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在集群初始化阶段，cluster.initial_master_nodes 应该包含候选主节点的名称，并在集群中每个候选主节点上进行定义。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;本质区别：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;cluster.initial_master_nodes：仅在集群首次启动会使用。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;discovery.seed_hosts：每次启动都需要。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.7 Discovery 过程解读&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Discovery 过程从一个或多个种子主机列表以及集群中已知的任何一个候选主节点地址开始。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该过程分两个阶段进行：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;每个节点通过连接到每个地址并尝试识别其连接的节点是否是候选主节点来探测种子地址。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;其次，如果成功，它将与远程节点共享其所有已知的候选主机节点列表，并且远程节点将依次与其做对等回应。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然后，该节点将探测刚刚发现的所有新节点，请求其对等节点，依此类推。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果该节点不是候选主节点，则它将继续此 Discovery 过程，直到发现了选举的主节点为止。如果未发现选择的主节点，则该节点将在默认值为 1s 之后重试。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果该节点是候选主节点，则它将继续此 Discovery 过程，直到它找到了选举的主节点，或者它找到了足够的候选主节点来完成选举。同样的，如果这两种方法都没有很快的进行，则该节点将在 1s 后重试。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里有点绕，需要结合英文文档多读几遍，加深 Discovery 理解。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.8 elasticsearch.yml 配置注意&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;现在，7.X Elasticsearch 的生产部署需要至少在 elasticsearch.yml 配置文件中指定以下设置之一：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;discovery.seed_hosts&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;discovery.seed_providers&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;cluster.initial_master_nodes&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;discovery.zen.ping.unicast.hosts&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;discovery.zen.hosts_provider&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.9  非候选主节点在 discovery  阶段被忽略&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在 7.X 之前早期版本中，有可能在 discovery 过程中使用非候选主节点作为种子节点或在符合条件的主机之间间接传输信息。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;像这样的依赖非候选主节点的集群非常脆弱，无法自动从某些故障中恢复。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;7.X 版本之后，discovery 仅涉及集群中候选主节点，不会像早期版本一样依赖于非候选主节点。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如何在7.X 中配置呢？应该在配置中将  discovery.seed_hosts 或者  discovery.seed_providers 设置为所有候选主节点的地址。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.10 关于故障检测超时时间&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;7.X 默认情况下，如果集群节点未能响应 3 个连续的 ping（每个 ping 在 10 秒后超时），则集群故障检测子系统现在将其视为故障节点。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;因此，响应时间超过 &lt;strong&gt;30&lt;/strong&gt; 秒 的节点可能会从集群中删除。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;7.X 以前，每个ping的默认超时为 30 秒，因此，无响应的节点可能会在集群中保留 90 秒以上。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;2.11  删除候选主节点有时需要做排除投票&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果你希望从集群中删除一半或更多的候选主节点，则必须首先使用投票配置排除API从投票配置中排除受影响的节点。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;排除 API 如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;POST _cluster/voting_config_exclusions?node_names=&amp;lt;node_names&amp;gt;&lt;br/&gt;POST _cluster/voting_config_exclusions?node_ids=&amp;lt;node_ids&amp;gt;&lt;br/&gt;DELETE _cluster/voting_config_exclusions&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果你同时删除少于一半的候选主节点，则不需要做投票排除。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果仅删除非候选主节点（例如仅数据节点或仅协调节点），则不需要做投票排除。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;同样，如果将节点添加到集群，也不需要投票排除。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;3、实践一把&lt;/h1&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;3.1 场景1：一主节点、一仅数据节点&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;数据节点配置：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.18867924528301888&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ49XaPBJaETMiblM3Jrsqu21rz908HsChcdJq8taYMkoWwC6KRF2Ftnzyw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;583&quot;/&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;seed host 和  initial_master_nodes 只设置主节点配置。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果如下：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.5475409836065573&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ49oFVwhhJj7vK2pKy8DmciawOhpXqqUnbwBWPLiaZSGPwHMQV86EhgRvlg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;305&quot;/&gt;&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;3.2 场景二：一主节点、二仅数据节点&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;两个数据节点配置：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.18932874354561102&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ49UasIT75eZxKRjzvkgibZCMYsF46EicUHNRfUDpRY3MafzqN7HZAsSZYA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;581&quot;/&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;seed host 和  initial_master_nodes 只设置主节点配置。&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.7010309278350515&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ491SsJFhzSicXV7XLK63icc6icMhH7gS7kfPLkxEpPyEe9Pa4P9hXsZGicicw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;291&quot;/&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;3.3 场景三：三个节点都是主节点同时也是数据节点&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;三节点相同配置如下：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.19270833333333334&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ4985qs9hRDBTESzPzLibib0reBkhb7sPKRF4bicZPPyNibW8IAK6fNM6G7ZA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;576&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.8175438596491228&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ49QbYtv9hjiaib5M8xL1244V7OVarTOEVhkJTmx3WO2KHBQMibvzleI6yJA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;285&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;注意，这时候，我把node-1 强制杀掉？大家猜会发生什么？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果说宕机，你错了！集群进行了重新选主：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.09097633136094675&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ49Pg2ZconoIYPCVn3DXDyumJdfHkNmnwNeaNQtEG7xHVuAkbpJu2MyoQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1352&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果如下：节点2 成为主节点。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.5906040268456376&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ49kYTNCA1DHnNJcHNibVmmYaCcOnicXE92ywYKJkgDX2NIfF0bBPTDcAKg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;298&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;实际业务场景不建议这么做，&lt;span&gt;数据节点在没有设置主节点角色：node.master: true 的前提下，成为了主节点&lt;/span&gt;。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;3.4 场景四：三个节点都是主节点同时也是数据节点&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;三节点相同配置如下：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.1396551724137931&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ49Ewmk30P0Nx2OsSBia17CicWdeUrYJOIpZJXuZj48hBxmNBp7a3Q1YS9Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;580&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.7551724137931034&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ4989ZYVCpjWyMhNuickZrrrsZmbG8WBjZzyGcT4yohmfVjDTCrquicff0A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;290&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;逐个kill 掉 节点2、节点 1 看看结果？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;先干掉节点2：节点1成为了主节点。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.7689655172413793&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ49VxMZLndhDOiavg0yc3R8guZR03XG55BCtXaiceicf5MWBmMHtdXrVV5ew/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;290&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;再干掉节点1：集群已无法访问和使用。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.07332854061826025&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ49ib9IrNcZ40S6p82frAPSRrCe3g6Uk03EaAEHA9DJB7S9unkr4qdhmOg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1391&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个时候，错误日志如下：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;核心错误说明：候选主节点要求至少 2个节点。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;an election requires at least 2 nodes  .....  which is not a quorum.&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;详细报错如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt; [node-3] master not discovered or elected yet, an election requires at least 2 nodes with ids from [0bozQB4VRZWB4TuzjRahAw, Z7PxWN_bQEeeI6KOlQT8pw, AWDZHrxaTd2qmOB1e8kadQ], have discovered [] &lt;span&gt;which&lt;/span&gt; is not a quorum; discovery will &lt;span&gt;continue&lt;/span&gt; using [172.21.0.14:9300, 172.21.0.14:9302] from hosts providers and [{node-3}{Z7PxWN_bQEeeI6KOlQT8pw}{ejRvW9egTrum3G5DrwmrIA}{172.21.0.14}{172.21.0.14:9303}{ml.machine_memory=8200851456, xpack.installed=&lt;span&gt;true&lt;/span&gt;, ml.max_open_jobs=20}, {node-1}{AWDZHrxaTd2qmOB1e8kadQ}{FFIDQcynQMGHqPwCW9lFfw}{172.21.0.14}{172.21.0.14:9300}{ml.machine_memory=8200851456, ml.max_open_jobs=20, xpack.installed=&lt;span&gt;true&lt;/span&gt;}] from last-known cluster state; node term 8, last-accepted version 92 &lt;span&gt;in&lt;/span&gt; term 8&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;正如官方文档所示：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为确保集群仍然可用，你不得同时停止投票配置中的&lt;span&gt;一半或更多&lt;/span&gt;节点。只要有一半以上的投票节点可用，集群可以正常工作。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如前所述：投票配置中配置的就是候选主节点！&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;3.5 场景五：三个节点都是主节点同时也是数据节点&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在老配置基础上修改，注释掉：initial_master_nodes 的配置。配置如下：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.14166666666666666&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ49JFyD7gCtsGWK0ka9ncrDEfLzgibwM3wb7cXNGDetfZajtsTsAOgXsfQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;600&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;集群结果如下：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.8245614035087719&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/mjl8GCpsL9YAgjy4V7ByPpzvzcs9IQ49MJPFFz3oxDLXPQxVricclxTkib1OwvibMsI478bNnXWR7O1sy1R4eNarg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;285&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;集群也能正常启动。结合 2.6 小节看能更好理解一些。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;4、再回答腾讯大佬的问题&lt;/h1&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;1、 seed_hosts里面一定是配置 master eligible节点吗?&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;是的，必须候选主节点。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;2、还是说data节点也可以配置到 master eligible&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;理论可以，实际不推荐。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Discovery 过程就是发现过程。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;4、initial_master一定是master eligible节点吧?&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;是的。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;大规模集群要注意：集群规划阶段要考虑设置：奇数个候选主节点。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;集群初始启动阶段之前候选主节点配置要设置合理。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;6 、初始的时候是不是可以配置一个, 然后集群初始化后, 再加master eligible节点也可以的是吗?&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可以，但不推荐。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果多节点集群，建议一步到位。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;7 、多加几个以后, 把initial_master里的几个去掉是不是也可以了?&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;仅在集群首次启动会使用，其他阶段可以去掉。详见案例五。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;不过，规范管理起见，配置上不用动就可以了。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;8、如果一个集群当前master为7，那他的quorum是4。es 是支持慢慢去掉节点，quorum慢慢降低的吗？&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;换个思维理解，这里如果有 7 个候选主节点，意味着至少要一半以上有效集群才能存活。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;也就是干掉3个候选主节点，集群依然是存活状态的。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;9、 那假如慢慢去掉了3个节点，原集群正常工作，那这三个节点重启后网络分区在一起了，那会不会自己形成集群啊？&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;不会，去掉的3个节点，还会继续加入原来的集群啊！&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;5、小结&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;类似概念的确单纯看文档不好理解，甚至你看完本文还是有点糊涂。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;不要为了区分概念而区分概念，实践一把，把理论概念转成实践、再结合理论，就好理解了。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;欢迎留言写下你的思考！&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;参考：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/breaking-changes-7.0.html&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery-voting.html8&lt;/span&gt;&lt;/p&gt;&lt;hr/&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;加微信：&lt;strong&gt;elastic6&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;（仅有少量坑位了），和 BAT 大佬一起精进 Elastic 技术！&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>