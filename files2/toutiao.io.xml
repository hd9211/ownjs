<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>d9adfbc1c81702fd7dfbdad1e614d523</guid>
<title>CURD 系统怎么做出技术含量：怎样引导面试</title>
<link>https://toutiao.io/k/73a6wxc</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;引子&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;很多朋友可能会因为自己做的工作不是特别核心或者业务简单而引起面试中没有自信。但是很多公司面试的时候是可以接受面试者之前岗位的并发量、交易量低一些的。比如我们要招聘和我们交易量同等级或者以上的出来的人才，业界本来就没有多少，但我们还是要招人的。所以很多时候更偏向于考察面试者的设计底蕴、思考和解决问题的能力。&lt;/p&gt;&lt;p&gt;我建议面试时，面试者要争取主动权，主动引导面试。一般作为面试官也很乐意被面试者引导。因为面试官的职责是发现面试者的技术特长，为此我们绞尽脑汁的从简历中、自我介绍中去发掘。如果面试者可以自己有完整清晰的思路，是面试官求之不得的事情。&lt;/p&gt;&lt;p&gt;假设我是一个面试者，近几年做的都是XX后台管理系统。后台管理系统嘛，没有高并发、没有高可用需求、没有复杂架构，属于三无系统。要是我的话，会把自己的以下知识技能放到项目介绍里展示给面试官：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-fileid=&quot;100002274&quot; data-ratio=&quot;0.8759259259259259&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/2tk5ianItRl8Vl88XukjGrhjia3xufC7HwX03eEB1O64xrdiahT8bNAAHDiadL662RKdP2eecbyAqQRlLDsedRalVg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;可测试性设计&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;谦卑对象模式&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;作为一个后台管理系统，一般场景下微服务化的价值不大。DDD领域驱动设计这种专门用于复杂问题的解决办法在这里多半也是杀鸡用牛刀。后面会讲到一些DDD技巧还是可以用的。实际中大多是采用前后端分离的架构，这种架构实践一方面是动静分离，便于缓存优化等性能考虑，另一方面也是一个出于可测试性的考虑。分离出可自动化测试的接口层和测试难度高的展现层。&lt;/p&gt;&lt;p&gt;展现层对象等测试难度高的对象在整洁架构中被称为谦卑对象。通过拆分不同的类或者模块，来区分容易测试的行为和不容易测试的行为，这种设计上的隔离模式被称为谦卑对象模型。&lt;/p&gt;&lt;p&gt;现在的很多设计对程序的可测试性提供了友好的改进和支持。比如：程序调用数据库执行操作，mybatis等持久层框架将把sql以接口的形式对外提供服务，接口有成熟的工具来做mock打桩，这是比较典型的谦卑对象模式。&lt;/p&gt;&lt;p&gt;另外一个比较典型的比较典型的谦卑对象模式是feign。netflix的feign把原本需要手写的httpClient(或者OKHttp)代码使用接口调用的的形式，实现了命令式到声明式的转换。同时，谦卑对象和非谦卑对象之间有很好的隔离层，也对测试更友好。对feign想做进一步了解的可参考我之前的文章&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzUzNjAxODg4MQ==&amp;amp;mid=2247485195&amp;amp;idx=1&amp;amp;sn=9aa72718cdcc24d872f0a89cf63ea34f&amp;amp;chksm=fafdeda5cd8a64b3a55f4de3fdc48d2ee396074d851f686b70a7e679dbcf26862348a79182eb&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;《Java&amp;amp;Spring过时的经典语录》&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;《Java&amp;amp;Spring过时的经典语录》&lt;/a&gt;，这里简单举个例子：&lt;/p&gt;&lt;p&gt;&lt;span&gt;public interface &lt;/span&gt;&lt;span&gt;TestHttpService {&lt;/span&gt;&lt;/p&gt;&lt;pre&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;    &lt;span&gt;@RequestLine&lt;/span&gt;(&lt;span&gt;&quot;GET /xxxx?appkey={appkey}&amp;amp;ips={ip}&amp;amp;username={username}&amp;amp;operator={operator}&quot;&lt;/span&gt;)&lt;br/&gt;    Response getTest(&lt;span&gt;@Param&lt;/span&gt;(value = &lt;span&gt;&quot;appkey&quot;&lt;/span&gt;) String appkey,&lt;br/&gt;                                       &lt;span&gt;@Param&lt;/span&gt;(value = &lt;span&gt;&quot;ip&quot;&lt;/span&gt;) String ip,&lt;br/&gt;                                       &lt;span&gt;@Param&lt;/span&gt;(value = &lt;span&gt;&quot;username&quot;&lt;/span&gt;) String username,&lt;br/&gt;                                       &lt;span&gt;@Param&lt;/span&gt;(value = &lt;span&gt;&quot;operator&quot;&lt;/span&gt;) String operator);&lt;br/&gt;&lt;p&gt;}&lt;/p&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;pre/&gt;&lt;p&gt;&lt;strong&gt;RESTful&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;说起后台管理系统的接口层，RESTful风格的接口是比较流行的最佳实践。虽然这个被提了很多年了，实际严格按照这种风格设计的接口并不多。大多数系统的接口风格像是跟着江南七怪学武的郭靖一般，武功路数驳杂不成体系。&lt;/p&gt;&lt;p&gt;来做个判断题：&lt;/p&gt;&lt;p&gt;下面的代码，类上用了RestController的注解，这是RESTful风格的代码吗？&lt;/p&gt;&lt;pre&gt;&lt;span&gt;@RestController&lt;br/&gt;&lt;/span&gt;&lt;span&gt;public class &lt;/span&gt;JacksonController {&lt;br/&gt;    &lt;span&gt;@Resource&lt;br/&gt;    &lt;/span&gt;&lt;span&gt;private &lt;/span&gt;User &lt;span&gt;user&lt;/span&gt;&lt;span&gt;;&lt;br/&gt;    &lt;/span&gt;&lt;span&gt;@GetMapping&lt;/span&gt;(&lt;span&gt;&quot;/writeStringAsString&quot;&lt;/span&gt;)&lt;br/&gt;    &lt;span&gt;public &lt;/span&gt;String &lt;span&gt;writeStringAsString&lt;/span&gt;(String toWrite) &lt;span&gt;throws &lt;/span&gt;Exception {&lt;br/&gt;        System.&lt;span&gt;out&lt;/span&gt;.println(&lt;span&gt;user&lt;/span&gt;.getAge())&lt;span&gt;;&lt;br/&gt;        &lt;/span&gt;ObjectMapper objectMapper = &lt;span&gt;new &lt;/span&gt;ObjectMapper()&lt;span&gt;;&lt;br/&gt;        return &lt;/span&gt;objectMapper.writeValueAsString(toWrite)&lt;span&gt;;&lt;br/&gt;&lt;/span&gt;&lt;p&gt;}&lt;/p&gt;&lt;p&gt;}&lt;/p&gt;&lt;/pre&gt;&lt;p&gt;REST（英文：Representational State Transfer，简称REST） 指的是一组架构约束条件和原则。满足这些约束条件和原则的应用程序或设计就是 RESTful。&lt;/p&gt;&lt;p&gt;理论上REST架构风格并不是绑定在HTTP上，但是REST本身受Web技术的影响很深， 目前HTTP是唯一与REST相关的实例。&lt;br/&gt;咱们来看看需要满足哪些约束条件和原则。&lt;/p&gt;&lt;p&gt;&lt;strong&gt;资源设计规则：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1&amp;gt;不用大写；&lt;/span&gt;&lt;br/&gt;&lt;span&gt;2&amp;gt;用中杠-不用下杠_；&lt;/span&gt;&lt;br/&gt;&lt;span&gt;3&amp;gt;用名词不用动词；&lt;/span&gt;&lt;br/&gt;&lt;span&gt;4&amp;gt;URI中的名词表示资源集合，使用复数形式。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;动作设计规则：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;1&amp;gt;GET（SELECT）：从服务器取出资源（一项或多项）。&lt;/p&gt;&lt;p&gt;2&amp;gt;POST（CREATE）：在服务器新建一个资源。&lt;/p&gt;&lt;p&gt;3&amp;gt;PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。&lt;/p&gt;&lt;p&gt;4&amp;gt;PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。&lt;/p&gt;&lt;p&gt;5&amp;gt;DELETE（DELETE）：从服务器删除资源。&lt;/p&gt;&lt;p&gt;&lt;strong&gt;返回结果规则：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;与HTTP协议标准基本没有新的约束。要注意content-type的accept，包含accept-encoding。之前出个我在测试环境出个一个问题，我们自动化测试回归平台不支持gzip，但是请求时带了gzip，其实平台并不支持导致乱码。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-fileid=&quot;100002279&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.3926174496644295&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRlic2J7cNVQWgTFniam7jzO9uvBFc2jzdMD6PMFX62OIvwmZjiarr4N7wS0K7m8IykvbKjYeOst3fEunw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;894&quot;/&gt;&lt;/p&gt;&lt;p&gt;通过上面的约束条件和原则咱们来总结一下为什么叫REST：&quot;资源&quot;是一种信息实体，它可以有多种外在表现形式。我们把&quot;资源&quot;具体呈现出来的形式，叫做它的&quot;表现层&quot;（Representation）。&lt;/p&gt;&lt;p&gt;互联网通信协议HTTP协议，是一个无状态协议。这意味着，所有的状态都保存在服务器端。因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生&quot;状态转化&quot;（State Transfer）。而这种转化是建立在表现层之上的，所以就是&quot;表现层状态转化&quot;。&lt;/p&gt;&lt;p&gt;如果大家都理解，那上面判断题的答案也呼之欲出了：因为不满足相应的约束条件和原则，所以不是RESTful风格。@RestController 只是让资源返回结果是RESTful风格的。但不管是不是RESTful风格，都是URI。统一资源标识符（Uniform Resource Identifier，URI)是一个用于标识某一互联网资源名称的字符串。 只要定位到资源了，都是URI。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;领域驱动设计DDD&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;充血模型&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;贫血模型是指实体对象或者说是POJO只包含简单的set、get方法，充血模型认为一个对象是拥有状态和行为的。什么叫状态和行为呢？举个例子：&lt;/p&gt;&lt;pre&gt;&lt;span&gt;@Setter&lt;br/&gt;@Getter&lt;br/&gt;@ToString&lt;br/&gt;@EqualsAndHashCode&lt;br/&gt;&lt;/span&gt;&lt;span&gt;public class &lt;/span&gt;Pojo {&lt;br/&gt;    &lt;span&gt;private &lt;/span&gt;String &lt;span&gt;name &lt;/span&gt;&lt;span&gt;;&lt;br/&gt;    private &lt;/span&gt;String &lt;span&gt;status&lt;/span&gt;&lt;span&gt;;&lt;br/&gt;    public int &lt;/span&gt;&lt;span&gt;getStatus&lt;/span&gt;() {&lt;br/&gt;        &lt;span&gt;return &lt;/span&gt;NumberUtils.&lt;span&gt;toInt&lt;/span&gt;(&lt;span&gt;status&lt;/span&gt;)&lt;span&gt;;&lt;br/&gt;    &lt;/span&gt;}&lt;br/&gt;}&lt;/pre&gt;&lt;p&gt;上面类代码上用了lombok的@Setter、@Getter注解之外，还用了@ToString、@EqualsAndHashCode，这两个虽然是Object对象的基本方法，实际上也是做了状态和行为的事情，而不只是@Setter、@Getter的数据存取。与之类似的还有上面的int getStatus，实际上进行了类型转换这个行为。&lt;/p&gt;&lt;p&gt;现在针对到底使用贫血模型还是充血模型更好说法不一。我个人更倾向于使用充血模型，因为这种方法从领域上更内聚。但是很多人不建议使用，主要是因为充血模型对个人能力有更高的要求。充血模型开发者需要自己去识别哪些是实体领域中的。对于一般的spring开发者来说，个人经验上有个简单的办法：凡是要引用@Service、@Component的都不要放到里面，之前本来要放到XXUtils的建议看看更符合哪个实体领域，不要一股脑放到util包下面，看看是否可以划分到实体领域中。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;CQRS&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;CQRS — Command Query Responsibility Segregation，&lt;/span&gt;&lt;span&gt;顾名思义&lt;/span&gt;&lt;span&gt;&lt;span&gt;是将 command 与 query 分离的一种模式。&lt;/span&gt;&lt;span&gt;CQRS 将系统中的操作分为两类，即「命令」(Command) 与「查询」(Query)。命令则是对会引起数据发生变化操作的总称，即我们常说的新增，更新，删除这些操作，都是命令。而查询则和字面意思一样，即不会对数据产生变化的操作，只是按照某些条件查找数据。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在后台系统中，某些查询操作可能会过于频繁，比如页面定时刷新获取数据。这些查询操作不需要保证每次都成功。而命令操作如果失败则涉及到事务回滚等操作，需要保证操作的成功率。这时候可以使用CQRS隔离，比如将检查流量和命令流量使用&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzUzNjAxODg4MQ==&amp;amp;mid=2247485474&amp;amp;idx=1&amp;amp;sn=df22866d7a0b096e7169a5bef81a3058&amp;amp;chksm=fafde28ccd8a6b9a0157fb4e2600a71c8a5db6db7eea37dfdbd6f25e6d3b38b6ab92c4d1f9e3&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;hystrix隔离&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;hystrix隔离&lt;/a&gt;，架构清晰了，还可以画出下面这样清晰的架构图：&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;568&quot; data-backw=&quot;578&quot; data-fileid=&quot;100002278&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.9831697054698457&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRl8Vl88XukjGrhjia3xufC7HwFdtG13RnV4JB9zF4xdNMmSRPAUW2yYzWEZCkOiaHWtaRsvCKVmqBSnA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;713&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;总结&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;上面都是后台管理系统中常用的一些技术，其实还有ACL（防腐层），批量操作的隔离、熔断、分片，数据异步转同步等限于篇幅这里就不介绍了。只要面试中能够引导面试官提问这方面的技术并且可以讲的明明白白，已经可以超过大部分的面试者。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;219&quot; data-backw=&quot;292&quot; data-fileid=&quot;100002277&quot; data-ratio=&quot;0.75&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/2tk5ianItRl8Vl88XukjGrhjia3xufC7Hwa7IGSwtibHsxsZKGHFVibQfUHZCzAbibiauOthcQEnGsfXTUCeCzluyzqw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;292&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;推荐阅读&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzUzNjAxODg4MQ==&amp;amp;mid=2247485029&amp;amp;idx=1&amp;amp;sn=81b593816669318ee3203449177f90c9&amp;amp;chksm=fafdeccbcd8a65dd8a1116dd4eee9e9de9c4c8833e64854422d0a8bc57d28d83d8d57e1e936d&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;分布式存储系统的一致性-可见性差异&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; wah-hotarea=&quot;click&quot; hasload=&quot;1&quot;&gt;分布式存储系统的一致性-可见性差异&lt;/a&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>9da12a92c4186e35fc07fdb30bf543cb</guid>
<title>1 万行代码，单机 50 万 QPS，今年最值得学习的开源 RPC 框架</title>
<link>https://toutiao.io/k/5fkacdj</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;section data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;span&gt;又发现一个不错的，工业级的，高性能RPC框架srpc，分享给大家。&lt;/span&gt;&lt;span/&gt;&lt;/section&gt;&lt;blockquote class=&quot;js_blockquote_wrap&quot; data-type=&quot;2&quot; data-url=&quot;&quot; data-author-name=&quot;&quot; data-content-utf8-length=&quot;79&quot; data-source-title=&quot;&quot;&gt;&lt;section class=&quot;js_blockquote_digest&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;（1）RPC简介；&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;（2）行业常见RPC框架；&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;（3）srpc特点；&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;（4）srpc上手指南，demo示例；&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;（5）srpc架构设计；&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;（6）srpc相关资料与资源；&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;span&gt;文章较长，建议提前收藏。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;什么是RPC？&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Remote Procedure Call&lt;/span&gt;&lt;span&gt;，&lt;/span&gt;&lt;span&gt;远程过程调用&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;什么是“远程”，为什么“远”？&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;先来看下什么是“近”，即“&lt;/span&gt;&lt;span&gt;本地函数调用&lt;/span&gt;&lt;span&gt;”。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;当我们写下：&lt;/span&gt;&lt;/section&gt;&lt;blockquote class=&quot;js_blockquote_wrap&quot; data-type=&quot;2&quot; data-url=&quot;&quot; data-author-name=&quot;&quot; data-content-utf8-length=&quot;23&quot; data-source-title=&quot;&quot;&gt;&lt;section class=&quot;js_blockquote_digest&quot;&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;int result = Add(1, 2);&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;span&gt;这行代码的&lt;/span&gt;&lt;span&gt;时候，到底发生了什么？&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.8288288288288288&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/YrezxckhYOy134MrU6QE59LGHkfibRxxDbV6HtfwUpRvs8nlccF1fSIic7fSCy92AOvtJOrOUm6MaAfcPtAWAJ4A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;333&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span/&gt;&lt;span&gt;（1）&lt;span&gt;传&lt;/span&gt;递两个入参；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（2）调用了本地&lt;/span&gt;&lt;span&gt;代码段&lt;/span&gt;&lt;span&gt;中的函数，执行运算逻辑；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（3）返回一个出参；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;这三个动作，都发生在同&lt;/span&gt;&lt;span&gt;一个进程空间里&lt;/span&gt;&lt;span&gt;，这是本地函数调用。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;那有没有办法，调用一个&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;跨进程&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span&gt;的函数呢？&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;典型的，这个进程部署在另一台服务器上。&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.4166666666666667&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/YrezxckhYOy134MrU6QE59LGHkfibRxxD1h4GAVsn6M7rdCjm2ibMsGYadsp0I7fVr0cUicNgibIXTplJcicucMibTMQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;516&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;最容易想到的，两个进程约定一个协议格式，使用&lt;/span&gt;&lt;span&gt;Socket&lt;/span&gt;&lt;span&gt;通信，来传输：&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（1）入参；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（2）调用哪个函数；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（3）出参；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;如果能够实现，那这就是“远程”过程调用。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;为什么需要RPC框架呢？&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;如果没有统一的RPC框架，各个团队的服务提供方就需要各自实现一套&lt;/span&gt;&lt;span&gt;序列化、反序列化、网络框架、连接池、收发线程、超时处理、状态机&lt;/span&gt;&lt;span&gt;等“业务之外”的重复技术劳动，造成整体的低效。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;RPC框架的职责&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;，就是要屏蔽各种复杂性：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（1）调用方&lt;/span&gt;&lt;span&gt;client感觉就像调用本地函数&lt;/span&gt;&lt;span&gt;一样，来调用服务；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（2）提供方&lt;/span&gt;&lt;span&gt;server感觉就像实现一个本地函数&lt;/span&gt;&lt;span&gt;一样，来实现服务；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;有哪些常见的，出圈的RPC框架呢？&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（1）gRPC，Google出品，支持多语言；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（2）Thrift，Facebook出品，支持多语言；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（3）Dubbo，阿里开源的，支持Java；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（4）bRPC，百度开源的，支持C++，Java；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（5）tRPC，腾讯RPC框架，支持多语言；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（6）...&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;画外音：还有哪些？&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;今天和大家分享的srpc，作者是搜狗的媛架构师liyingxin，基于WF，&lt;/span&gt;&lt;span&gt;代码量1W左右&lt;/span&gt;&lt;span&gt;：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（1）非常&lt;/span&gt;&lt;span&gt;适合用来学习&lt;/span&gt;&lt;span&gt;RPC的架构设计；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（2）又是一个&lt;/span&gt;&lt;span&gt;工业级的产品&lt;/span&gt;&lt;span&gt;，QPS可以到50W，应该是行业能目前性能最好的RPC框架了吧，有不少超高并发的线上应用都使用它。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;画外音：不服？来战！&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;什么是srpc？&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;基于WF的轻量级，超高性能，工业级RPC框架，兼容多协议，例如百度bRPC，腾讯tRPC，Google的gRPC，以及FB的thrift协议。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;srpc有些什么特点？&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（1）&lt;/span&gt;&lt;span&gt;支持多种IDL格式&lt;/span&gt;&lt;span&gt;，包括Protobuf，Thrift等，对于这类项目，可以一键迁移；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（2）&lt;/span&gt;&lt;span&gt;支持多种序列化方式&lt;/span&gt;&lt;span&gt;，包括Protobuf，Thrift，json等；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（3）&lt;/span&gt;&lt;span&gt;支持多压缩方法&lt;/span&gt;&lt;span&gt;，对应用透明，包括gzip，zlib，lz4，snappy等；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（4）&lt;/span&gt;&lt;span&gt;支持多协议&lt;/span&gt;&lt;span&gt;，对应用透明，包括http，https，ssl，tcp等；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（5）&lt;/span&gt;&lt;span&gt;高性能&lt;/span&gt;&lt;span&gt;；&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.52890625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/YrezxckhYOy134MrU6QE59LGHkfibRxxDlVTxGdJ4t3Lh9b01MtOr2HByfqQHUrpzRM1XPrPDb34enZZFRtBKXg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;不同客户端线程压力下的性能表现非常稳定，QPS在50W左右，优于同等压测配置的bRPC与thrift。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（6）&lt;/span&gt;&lt;span&gt;轻量级，低门槛&lt;/span&gt;&lt;span&gt;，1W行左右代码，只需引入一个静态库；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;如何快速上手，体验这个帅气的RPC框架呢？&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;简单来说，只需要三个步骤。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;第一步：定义IDL描述文件。&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;blockquote class=&quot;js_blockquote_wrap&quot; data-type=&quot;2&quot; data-url=&quot;&quot; data-author-name=&quot;&quot; data-content-utf8-length=&quot;179&quot; data-source-title=&quot;&quot;&gt;&lt;section class=&quot;js_blockquote_digest&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;syntax = &quot;proto3&quot;;// proto2 or proto3&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;message EchoRequest {&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;   string message = 1;&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;   string name = 2;&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;};&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;message EchoResponse {&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;   string message = 1;&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;};&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;service Example {&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;   rpc Echo(EchoRequest) returns (EchoResponse);&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;};&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;第二步：&lt;/span&gt;&lt;span&gt;生成代码，并实现&lt;/span&gt;&lt;span&gt;ServiceIMPL&lt;/span&gt;&lt;span&gt;，&lt;/span&gt;&lt;span&gt;server&lt;/span&gt;&lt;span&gt;端就搞定了。&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;blockquote class=&quot;js_blockquote_wrap&quot; data-type=&quot;2&quot; data-url=&quot;&quot; data-author-name=&quot;&quot; data-content-utf8-length=&quot;177&quot; data-source-title=&quot;&quot;&gt;&lt;section class=&quot;js_blockquote_digest&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;class ExampleServiceImpl : public Example::Service&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;{&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;public:&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;   void Echo(EchoRequest *request,&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;         EchoResponse *response,&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;         RPCContext *ctx) override&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;    {&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;       response-&amp;gt;set_message(&quot;Hi, &quot; + request-&amp;gt;name());&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;    }&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;};&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;span&gt;make&lt;/span&gt;&lt;span&gt;一把，一气呵成。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;第三步：自己定义一个请求客户端，向服务端发送echo请求。&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;blockquote class=&quot;js_blockquote_wrap&quot; data-type=&quot;2&quot; data-url=&quot;&quot; data-author-name=&quot;&quot; data-content-utf8-length=&quot;195&quot; data-source-title=&quot;&quot;&gt;&lt;section class=&quot;js_blockquote_digest&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;int main()&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;{&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;   Example::SRPCClient client(&quot;127.0.0.1&quot;, 1412);&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;   EchoRequest req;&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;   req.set_message(&quot;Hello, srpc!&quot;);&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;   req.set_name(&quot;zhangsan&quot;);&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;   client.Echo(&amp;amp;req, &lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;        [](EchoResponse *response, RPCContext *ctx){});&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span/&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;   return 0;&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;&lt;span&gt;}&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;span&gt;文末的资料集里，有非常详细的手册链接，一步步照着来就行。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;srpc的架构设计思路是怎样的？&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;作为一个RPC框架，srpc的架构是异常清晰的，用户需要关注这&lt;/span&gt;&lt;span&gt;3个层次&lt;/span&gt;&lt;span&gt;：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（1）&lt;strong&gt;IDL接口描述文件层&lt;/strong&gt;；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（2）&lt;strong&gt;RPC序列化协议层&lt;/strong&gt;；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（3）&lt;strong&gt;网络通讯层&lt;/strong&gt;；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;同时，&lt;/span&gt;&lt;span&gt;每一层次又提供了多种选择&lt;/span&gt;&lt;span&gt;，用户可以任意的组合：&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.4077669902912621&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/YrezxckhYOy134MrU6QE59LGHkfibRxxDNsKIyicpEkyeHgTQ3icPuC40ztPQnHYT7myggXI1Oesjp27oK59ibRBew/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1030&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;如上图所示：&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（1）&lt;strong&gt;IDL层&lt;/strong&gt;，用户可以选择Protobuf或者Thrift；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（2）&lt;strong&gt;协议层&lt;/strong&gt;，可以选择Th&lt;span&gt;r&lt;/span&gt;ift，bRPC，tRPC等；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;画外音：因此，才能和其他RPC框架无缝互通。&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（3）&lt;strong&gt;通信层&lt;/strong&gt;，可以选择tcp或者http；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;在此分层架构之下，RPC的客户端要做什么工作，RPC的服务端要做什么工作，srpc框架又做了什么工作呢？&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;首先必须在IDL中要定义好：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（1）逻辑请求包request；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（2）逻辑响应包response；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（3）服务接口函数method；&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.5600461893764435&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/YrezxckhYOy134MrU6QE59LGHkfibRxxDY5qlQ1yqWj8JePVLtjtuJCGssyv0RUVgcGPiaZicU8Jw25hallQvKraw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;RPC-client的工作&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;就异常简单了：&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（1）调用method；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（2）绑定回调函数，处理回调；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;对应上图中顶部方框的&lt;/span&gt;&lt;span&gt;绿色部分&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;RPC-server的工作&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;也非常简单，像实现一个本地函数一样，提供远程的服务：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（1）实现method；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（2）接受request，逻辑处理，返回response；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;对应上图中底部方框的&lt;/span&gt;&lt;span&gt;黄色部分&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;srpc框架&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;完成了绝大部分的工作：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（1）对request序列化，压缩，处理生成二进制报文；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（2）连接池，超时，任务队列，异步等处理；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;（3）对request二进制报文处理，解压缩，反序列化；&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;...&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;对应上图中中间的方框的&lt;/span&gt;&lt;span&gt;红色部分&lt;/span&gt;&lt;span&gt;，以及大部分流程。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;在这个过程中，srpc采用&lt;/span&gt;&lt;span&gt;插件化设计&lt;/span&gt;&lt;span&gt;，各种复杂性细节，对接口调用方与服务提供方，都是透明的，并且具备良好的&lt;strong&gt;扩展性&lt;/strong&gt;。&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.3075020610057708&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/YrezxckhYOy134MrU6QE59LGHkfibRxxD15lwjuDpBzVkGGkIqRKzO76b3amiaLNBdhWOhgrHESPVQTASZiaQibBHA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1213&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;如上图所示，用户只需要关注IDL，即逻辑请求，响应，接口的调用与实现。框架层面，将各种能力以插件的方式集成进来，向用户提供不同能力的组合选择。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;另外，定义好IDL之后，服务端的代码可以利用框架提供的工具&lt;/span&gt;&lt;span&gt;自动生成代码&lt;/span&gt;&lt;span&gt;，业务服务提供方，只需要专注于业务接口的实现即可，你说帅气不帅气？&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;画外音：具体的生成工具，与生成方法，请参看git上的文档。&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;最后，我觉得这个srpc最帅气的地方之一，就是：&lt;/span&gt;&lt;span&gt;开源版本即线上工程版本&lt;/span&gt;&lt;span&gt;，更新快，&lt;/span&gt;&lt;span&gt;issue响应快&lt;/span&gt;&lt;span&gt;，并且&lt;/span&gt;&lt;span&gt;文档真的很全&lt;/span&gt;&lt;span&gt;！&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;画外音：不少大公司，公司内部的版本和开源的版本是两套代码，开源版本没有文档，KPI完成之后，开源就没人维护了，结果坑了一大票人。&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;文章的结尾，分享一些学习资源吧。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;项目地址：&lt;/span&gt;&lt;/strong&gt;&lt;em&gt;&lt;span&gt;https://github.com/sogou/srpc&lt;/span&gt;&lt;/em&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;项目demo：&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.9008464328899637&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/YrezxckhYOy134MrU6QE59LGHkfibRxxD3PeJR5K92YSwlqXNhI7U4P3NDicNJBibX2kttvadYeibrlAUmgE6Rm9PA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;827&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;em&gt;&lt;span&gt;README_cn.md&lt;/span&gt;&lt;/em&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;项目架构设计：&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;1.063030303030303&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/YrezxckhYOy134MrU6QE59LGHkfibRxxDwqOvWwUV4YQfUQAfKq2icGBXHicNpWpY6yQ0qJILVKwnY2MYTdSib0Kog/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;825&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;em&gt;&lt;span&gt;docs/wiki.md&lt;/span&gt;&lt;/em&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;作者知乎：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.5118110236220472&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/YrezxckhYOy134MrU6QE59LGHkfibRxxDKMXdHZD3SNA7s4mrXW0xANPZn0VANAMBF2Zs9Ly4Vj5oO3icuKCMOpg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1143&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;em&gt;&lt;span&gt;https://www.zhihu.com/people/liyingxin1412/posts&lt;/span&gt;&lt;/em&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;作者联系方式：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.3&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/YrezxckhYOy134MrU6QE59LGHkfibRxxDo1FWlk67rQzq2u3c9sxDRMTPe9PatmOzlL5AxOWKoibKm5PSxgVArDw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;740&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;发现bug可以随时提交给她，响应绝对快速。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;项目地址&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：&lt;/span&gt;&lt;span&gt;&lt;em&gt;https://github.com/sogou/srpc&lt;/em&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;Star&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：800+&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;em&gt;&lt;span&gt;画外音：srpc还有很多优秀的设计，等待大家去挖掘。&lt;/span&gt;&lt;/em&gt;&lt;/span&gt;&lt;span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;末了，希望这个1W行代码的RPC框架，能够帮助大家更透彻的了解RPC的底层原理。&lt;/span&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;阅读原文&lt;/span&gt;&lt;span&gt;，&lt;strong&gt;直达代码&lt;/strong&gt;，欢迎标星。&lt;/span&gt;&lt;/section&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>d29e3f27123ac18817a2e68e348a1656</guid>
<title>复习 Redis 持久化：AOF</title>
<link>https://toutiao.io/k/mjs1zxm</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;post-body&quot; itemprop=&quot;articleBody&quot;&gt;

      
      

      
        &lt;h2 id=&quot;引言&quot;&gt;&lt;a href=&quot;#引言&quot; class=&quot;headerlink&quot; title=&quot;引言&quot;/&gt;引言&lt;/h2&gt;&lt;p&gt;为了使得线上的数据更加的安全可靠，我们都知道Redis的数据是保存在内存中的，一旦Redis的服务器挂掉，会导致数据的丢失，所以我们在使用Redis的时候，一般会开启持久化功能，来保证数据不丢失，下边分享一下RDB和AOF两个持久化方式的知识点，本文承接上文聊AOF。&lt;/p&gt;
&lt;h2 id=&quot;AOF持久化及配置&quot;&gt;&lt;a href=&quot;#AOF持久化及配置&quot; class=&quot;headerlink&quot; title=&quot;AOF持久化及配置&quot;/&gt;AOF持久化及配置&lt;/h2&gt;&lt;p&gt;与RDB持久化方式不同的是，AOF持久化是通过保存Redis服务器的写和选择db的命令实现。&lt;/p&gt;
&lt;h3 id=&quot;首先简单聊一下操作系统的文件写入和同步&quot;&gt;&lt;a href=&quot;#首先简单聊一下操作系统的文件写入和同步&quot; class=&quot;headerlink&quot; title=&quot;首先简单聊一下操作系统的文件写入和同步&quot;/&gt;首先简单聊一下操作系统的文件写入和同步&lt;/h3&gt;&lt;p&gt;操作系统为了提高文件写入效率，当我们在往一个文件写入内容的时候，实际是先把内容放到了写入缓冲区，当达到缓存区大小限定或者时间条件后，操作系统才将内容同步到磁盘中。这种做法有效的提高了写入速度，但是从我们写文件到文件真正的落地到磁盘是有时间间隔的，这样就带了了安全问题，如果服务器在将数据从缓冲区同步到文件之前异常关机，那就会导致写入缓冲区内的数据丢失。&lt;/p&gt;
&lt;h3 id=&quot;Redis-AOF同步&quot;&gt;&lt;a href=&quot;#Redis-AOF同步&quot; class=&quot;headerlink&quot; title=&quot;Redis AOF同步&quot;/&gt;Redis AOF同步&lt;/h3&gt;&lt;p&gt;在Redis配置文件中，有一个配置项为appendfsync，其可选值为always、everysec、no&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;AOF的持久化过程，先执行追加、再是文件写入、最后是文件的同步。&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;追加，是将Redis服务器的写命令追加到服务器的aof_buf缓冲区末尾。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;文件写入，是将上边aof_buf中的指令，按顺序写入到AOF文件中，及appendonly.aof文件中，这个在配置文件可以找到。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;最后是文件同步，由每个事件循环控制，在serverCron函数内，这个就取决于上边appendfsync的配置&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;always：只要aof_buf内容，就将内容写入并同步到文件中，效率最低，频繁磁盘io，但是数据最安全，最多丢失一个事件内的数据。&lt;/li&gt;
&lt;li&gt;everysec：虽然将aof_buf的内容写入到了文件，但不是立即同步，看当前时间和上次间隔是不是达到了1秒，达到了在做同步。折中，不是频繁的io操作，数据相对安全，会丢失1秒的数据。&lt;/li&gt;
&lt;li&gt;no：只对aof_buf中的内容做写入操作，并不做同步工作，同步工作交由系统执行。效率最高，数据最不安全，一旦丢失，丢失的最多。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;AOF文件的载入就很简单，就是起一个伪客户端，依次执行AOF文件里的命令即可。&lt;/p&gt;
&lt;h2 id=&quot;AOF文件的重写&quot;&gt;&lt;a href=&quot;#AOF文件的重写&quot; class=&quot;headerlink&quot; title=&quot;AOF文件的重写&quot;/&gt;AOF文件的重写&lt;/h2&gt;&lt;p&gt;AOF持久化的方式，很容易让aof文件变得很大，同一个key，比如来来回回被设置删除，更改内容，AOF持久化的方式都要将每一条写命令保存下来，这就容易造成文件的快速膨胀，因此需要对AOF重写，来压缩文件大小。&lt;/p&gt;
&lt;p&gt;AOF文件的重写并不是真的对旧文件重写，而是直接分析当前内存数据，得到AOF文件。可以使用命令是服务器立即完成AOF文件的重写，或者后台运行。&lt;/p&gt;
&lt;h3 id=&quot;基本过程&quot;&gt;&lt;a href=&quot;#基本过程&quot; class=&quot;headerlink&quot; title=&quot;基本过程&quot;/&gt;基本过程&lt;/h3&gt;&lt;p&gt;​        主进程fork(同RDB持久化，因为要分析当前内存数据，所以要fork出一个子进程)一个子进程，然后开始分析内存数据，并生成指令写入到AOF文件中，有一点需要注意，因为Redis服务器存在一个输出端缓冲区的东西，所以如果某个key非常的大，为了避免缓冲区溢出，采用多条命令落地，比如a是个队列，有是三个值，可以生成三条push指令就行追加，至于多少条分一个指令，可以看源码的宏AOF_REWRITE_ITEMS_PER_CMD(为64)。&lt;/p&gt;
&lt;p&gt;​        这时候主进程依然可以监听命令，提供服务，那问题来了，如果在执行AOF的rewrite过程有新的数据修改，那岂不最后新的AOF文件和当前内存里的数据就不一致了么？这时候主进程会增加两个事情，本身主进程在收到指令后，除了操作内存数据外，还要将数据写入到AOF缓冲区(依旧向老的AOF文件追加)，如果此时正在进行AOF重写的话，&lt;strong&gt;会新增向AOF重写缓冲区追加写指令和监听AOF重写完成的信号两件事情。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Users/yunson/Documents/文章笔记/技术/img/redis-aof1.svg&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;​        如果AOF重写子进程执行完毕，会发送信号给主进程，主进程收到信号后，会将AOF重写缓冲区内的内容追加到新的AOF文件中，并原子的用新文件替换老的AOF文件，然后继续接受指令工作。这样就保证了AOF文件内容和在完成AOF文件重写那一刻的内存数据一致。&lt;/p&gt;
&lt;h3 id=&quot;问题&quot;&gt;&lt;a href=&quot;#问题&quot; class=&quot;headerlink&quot; title=&quot;问题&quot;/&gt;问题&lt;/h3&gt;&lt;p&gt;由于需要fork子进程，一样会像RDB持久化一样阻塞主进程，另外由于在执行完AOF重写后，主进程需要将重写期间的写指令，也就是AOF重写缓冲区的内容追加到新的AOF文件中，这就又阻塞住了主进程，AOF重写缓冲区内的内容越大，追加的时间就越长，阻塞的时间也就越长，对于高并发写入场景，你可能会看服务器的内存暴涨，这有些不友好。&lt;/p&gt;
&lt;h2 id=&quot;延伸&quot;&gt;&lt;a href=&quot;#延伸&quot; class=&quot;headerlink&quot; title=&quot;延伸&quot;/&gt;延伸&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;AOF持久化数据安全性&lt;/p&gt;
&lt;p&gt;这种方式持久化，数据的安全性取决于appendfsync的配置，其最高安全性能保证只丢一个事件周期的数据，但是效率最低，折中的办法是接受一秒内的数据丢失，采用everysec配置。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;AOF持久化比RDB持久化好么&lt;/p&gt;
&lt;p&gt;不一定，从上边的描述中我们看到，如果你的服务是高并发写服务，而且数据量大，那AOF持久化，也不太友好，原因就是这个AOF重写缓冲区，因为这里存的那些重写后输入的写指令，如果重写的时间越长，重写缓冲区内的数据就越大，导致内存持续增加。&lt;/p&gt;
&lt;p&gt;但如果你的服务是，写入比较少，但是数据量还是不小，那这个AOF持久化模式看起来要比RDB持久化好些，因为它能保证你的数据更安全，一旦异常，丢失的内容少的多。&lt;/p&gt;
&lt;p&gt;还有一点，AOF文件的重新载入速度要比RDB文件慢，AOF文件载入时相当于一条条的执行命令，而RDB文件就是二进制文件，载入相当快速。&lt;/p&gt;
&lt;p&gt;当你了解了RDB和AOF持久化的基本原理后，还是要结合实际使用情况使用。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;其他建议&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;还是要优化Redis的使用方式，不要使用超长的key和超长的value&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;能用数字代表的尽量用数字代表，比如1-1000的数字&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;尽量将Redis设计成你的缓存服务器，而不是存储，数据没有可以从mysql等数据库恢复&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;尽量给每个key都有过期时间，不要长期保存基本没有访问的数据，这个过期时间也要注意打散，不要让大量的key在同一时间过期。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;

      
    &lt;/div&gt;

    
      


    

    
    
    

    
      &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>df632c5b452a2016273565cc0d1a1f93</guid>
<title>Flink CDC + Hudi + Hive + Presto 构建实时数据湖最佳实践</title>
<link>https://toutiao.io/k/rkrzizq</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;p class=&quot;original_area_primary&quot;&gt;
                                                                                                &lt;/p&gt;

                    
                                            &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.55546875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFrkrQTeDPBLWGbcxfFELLvia02NjhJE6OKwyDnAQ9a8fnHRWavuvWrCia36GPJ10LllnicEIf5ccTuKA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h2&gt;1. 测试过程环境版本说明&lt;br/&gt;&lt;/h2&gt;&lt;p&gt;Flink1.13.1&lt;/p&gt;&lt;p&gt;Scala2.11&lt;/p&gt;&lt;p&gt;CDH6.2.0&lt;/p&gt;&lt;p&gt;Hadoop3.0.0&lt;/p&gt;&lt;p&gt;Hive2.1.1&lt;/p&gt;&lt;p&gt;Hudi0.10(master)&lt;/p&gt;&lt;p&gt;PrestoDB0.256&lt;/p&gt;&lt;p&gt;Mysql5.7&lt;/p&gt;&lt;h2&gt;2. 集群服务器基础环境&lt;/h2&gt;&lt;h3&gt;2.1 Maven和JDK环境版本&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.22748267898383373&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauU12IGuoiawlibOzMJQnIb53ciaSFutZNd4a4llEBbbfbvibiasDfwEfnj0w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;2.2 Hadoop 集群环境版本&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.13856812933025403&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauGIaFF1WSbabGoL6XlTnWhAE82icqkBKKLbu0JKhZXFm91HdeX5tfHvg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;2.3 HADOOP环境变量配置&lt;br/&gt;&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;shell&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;export&lt;/span&gt;&lt;span&gt; HADOOP_HOME=&lt;/span&gt;&lt;span&gt;/opt/&lt;/span&gt;&lt;span&gt;cloudera/parcels/CDH/lib/hadoop&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;export&lt;/span&gt;&lt;span&gt; HADOOP_CALSSPATH=&lt;/span&gt;&lt;span&gt;`$HADOOP_HOME/bin/hadoop classpath`&lt;/span&gt;&lt;span&gt;  &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h2&gt;3. Hudi编译环境配置&lt;/h2&gt;&lt;h3&gt;3.1 Maven Home settings.xml配置修改&lt;/h3&gt;&lt;p&gt;说明：指定aliyun maven地址(支持CDH cloudera依赖) mirror库&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.2586605080831409&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaureNdBzicbErelOAURndia7h2dicbYLmoyQQia08CgFzsDuyt3rnTcFUiauA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;xml&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;mirrors&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;mirror&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&amp;lt;id&amp;gt;&lt;/span&gt;&lt;span&gt;alimaven&lt;/span&gt;&lt;span&gt;&amp;lt;/id&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&amp;lt;mirrorOf&amp;gt;&lt;/span&gt;&lt;span&gt;central,!cloudera&lt;/span&gt;&lt;span&gt;&amp;lt;/mirrorOf&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&amp;lt;name&amp;gt;&lt;/span&gt;&lt;span&gt;aliyun maven&lt;/span&gt;&lt;span&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&amp;lt;url&amp;gt;&lt;/span&gt;&lt;span&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/span&gt;&lt;span&gt;&amp;lt;/url&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;/mirror&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;/mirrors&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;3.2 下载Hudi源码包&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;shell&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;git clone https:&lt;/span&gt;&lt;span&gt;//github.com/apache/hudi.git&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.18244803695150116&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauSSdF8ZwTpPqp9FibY4bnhAFticmRUFLU4DpWic5utSoElJfhLibzJRKqxA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h4&gt;Hudi社区建议版本适配&lt;br/&gt;&lt;/h4&gt;&lt;p&gt;hudi0.9 适配 flink1.12.2&lt;/p&gt;&lt;p&gt;hudi0.10(master) 适配 flink1.13.X ( 说明master分支上版本还未release)&lt;/p&gt;&lt;h3&gt;3.3 Hudi 客户端命令行&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.648960739030023&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauG6IEjOudeXiavQSsyuiamJKtomjbqSflJPSibzyBicWmM0El15aUmu2KKA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;3.4 修改Hudi集成flink和Hive编译依赖版本配置&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;hudi-master/packaging/hudi-flink-bundle&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.17321016166281755&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauSeEiapKQOCsnnkmvwECmYtuom0H4Y0ib1GFJKVy3dRc5lguV4BrSSt3g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;pom.xml文件 ( 笔者环境CDH6.2.0 hive2.1.1)&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.8267898383371824&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiau2ibrDMRhdYh68D3HOrBlehchGtpNAk7nGwpulqHWS6u1EvE16ymBRIQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;xml&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;profile&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&amp;lt;id&amp;gt;&lt;/span&gt;&lt;span&gt;flink-bundle-shade-hive2&lt;/span&gt;&lt;span&gt;&amp;lt;/id&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;properties&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&amp;lt;hive.version&amp;gt;&lt;/span&gt;&lt;span&gt;2.1.1-cdh6.2.0&lt;/span&gt;&lt;span&gt;&amp;lt;/hive.version&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&amp;lt;flink.bundle.hive.scope&amp;gt;&lt;/span&gt;&lt;span&gt;compile&lt;/span&gt;&lt;span&gt;&amp;lt;/flink.bundle.hive.scope&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;/properties&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code/&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;&lt;span&gt;${hive.groupid}&lt;/span&gt;&lt;span&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;&lt;span&gt;hive-service-rpc&lt;/span&gt;&lt;span&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&amp;lt;version&amp;gt;&lt;/span&gt;&lt;span&gt;${hive.version}&lt;/span&gt;&lt;span&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;&lt;span&gt;${flink.bundle.hive.scope}&lt;/span&gt;&lt;span&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;/profile&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;3.5 编译Hudi 指定Hadoop和Hive版本信息&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;shell&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;mvn clean install -&lt;/span&gt;&lt;span&gt;DskipTests&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;Drat&lt;/span&gt;&lt;span&gt;.skip=&lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;Dscala&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;2.11&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;Dhadoop&lt;/span&gt;&lt;span&gt;.version=&lt;/span&gt;&lt;span&gt;3.0&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;Pflink&lt;/span&gt;&lt;span&gt;-bundle-shade-hive2&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;（可加 –e –X 参数查看编译ERROR异常和DEBUG信息）&lt;/p&gt;&lt;p&gt;说明：默认scala2.11、默认不包含hive依赖&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6928406466512702&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaunBCa5B3x5hq1ZxGdfibL27aVUMqhWPibzWV1yHJzRFqFsoCFeNbDJ4uQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;首次编译耗时较长 笔者首次编译大概花费 50min+(也和服务器网络有关)&lt;/p&gt;&lt;p&gt;后续编译会快一些 大约15min左右&lt;/p&gt;&lt;h3&gt;3.6 Hudi编译异常&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.766743648960739&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauj7NicSXGqKvkfA4ZkIsnibZFRBE2xlFyJCh3Mmnic2HpyiauiaxhwtKVicrg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.2471131639722864&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaunOpttW7kzswShM0huyqb92ANV7Yt8GcKMKezAKmJheAPFjrLX800KQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;修改Hudi master pom.xml 增加 CDH repository地址&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.28752886836027713&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauAreItpCTCK5LrYYazlIBTXpAWamcgVUjnxTjMhALPAPKZzxG2Hicohg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;3.7 Hudi重新编译&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.7736720554272517&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauYr6pYD4GSJGf2KJQOLiblKGhuhZS9S33zZA2oxhahjCAC8JH5Y4Vibpw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;3.8 Hudi编译结果说明&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;hudi-master/packaging/hudi-flink-bundle/target&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.17551963048498845&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiau3zjpLJJgYPfVKcGrBSk363y5oJWnTFDWq2MslhBlibAwzLprz6PESvg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;hudi-flink-bundle_2.11-0.10.0-SNAPSHOT.jar&lt;/p&gt;&lt;p&gt;说明：hudi-flink-bundle jar 是 flink 用来写入和读取数据&lt;/p&gt;&lt;p&gt;hudi-master/packaging/hudi-hadoop-mr-bundle/target&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.12933025404157045&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiau3O3QcicFKWibicaYvicHYo9y9AF9P2v6jXwQiawfGzZ9bMficu8KJ0T3xavA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;hudi-hadoop-mr-bundle-0.10.0-SNAPSHOT.jar&lt;/p&gt;&lt;p&gt;说明：hudi-mr-bundle jar 是 hive 需要用来读hudi数据&lt;/p&gt;&lt;h2&gt;4. Flink环境配置&lt;/h2&gt;&lt;p&gt;版本说明：Flink 1.13.1 scala2.11版本&lt;/p&gt;&lt;h3&gt;4.1 FLINK_HOME 下 sql-client-defaults.yaml 配置&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.2806004618937644&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauL3EoLkoxZlgrVhSL4HScPRprJVr07OezibnD9tZM9t93aSib8cZNIuMw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;4.2 flink-conf.yaml配置修改&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.24942263279445728&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauC0rqN9DONDny2cesYJdT5KQ1hGQobibZbuQK4ozcUm5tI323kH19gfg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.24018475750577367&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauqzLg7OOlfzic9DuAazEtHAvrVX41HRFyLmSOqzodLe0LRuH2lfQRZNg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;properties&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;# state.backend: filesystem&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;state.backend: rocksdb&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;# 开启增量checkpoint&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;state.backend.incremental: &lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;# state.checkpoints.dir: hdfs://namenode-host:port/flink-checkpoints&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;state.checkpoints.dir: hdfs:&lt;/span&gt;&lt;span&gt;//nameservice/flink/flink-checkpoints&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;classloader.check-leaked-classloader: &lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;classloader.resolve-order: parent-first&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;4.3 FLINK_HOME lib下添加依赖&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.2066974595842956&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaukc3FJO7Bl7L4dH7kdl45FF0nEaXxN6iajxt3u5LFsuttVZRI152xndg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;shell&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;flink-sql-connector-mysql-cdc-&lt;/span&gt;&lt;span&gt;1.4&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;0.jar&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;flink-sql-connector-oracle-cdc-&lt;/span&gt;&lt;span&gt;2.1&lt;/span&gt;&lt;span&gt;-SNAPSHOT.jar.BAK – oracle cdc 依赖 &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;flink-format-changelog-json-&lt;/span&gt;&lt;span&gt;1.4&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;0.jar&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;flink-sql-connector-kafka_2.&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;1.13&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;1.jar&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;--- &lt;/span&gt;&lt;span&gt;Hadoop&lt;/span&gt;&lt;span&gt; home lib下copy过来&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;hadoop-mapreduce-client-common-&lt;/span&gt;&lt;span&gt;3.0&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;-cdh6.&lt;/span&gt;&lt;span&gt;2.0&lt;/span&gt;&lt;span&gt;.jar&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;hadoop-mapreduce-client-core-&lt;/span&gt;&lt;span&gt;3.0&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;-cdh6.&lt;/span&gt;&lt;span&gt;2.0&lt;/span&gt;&lt;span&gt;.jar&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;hadoop-mapreduce-client-jobclient-&lt;/span&gt;&lt;span&gt;3.0&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;-cdh6.&lt;/span&gt;&lt;span&gt;2.0&lt;/span&gt;&lt;span&gt;.jar&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;--- hudi编译jar copy过来&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;hudi-flink-bundle_2.&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;0.10&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;-SNAPSHOT.jar&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;说明：目前oracle cdc jar和mysql cdc jar一起在lib下发现有冲突异常&lt;/p&gt;&lt;h2&gt;5 启动flink yarn session服务&lt;/h2&gt;&lt;h3&gt;5.1 FLINK_HOME shell 命令&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;shell&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;$FLINK_HOME/bin/yarn-session.sh -s &lt;/span&gt;&lt;span&gt;2&lt;/span&gt;&lt;span&gt;-jm &lt;/span&gt;&lt;span&gt;2048&lt;/span&gt;&lt;span&gt;-tm &lt;/span&gt;&lt;span&gt;2048&lt;/span&gt;&lt;span&gt;-nm ys-hudi01 -d&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.5427251732101617&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauP0XqNoBhAVk3Z9L2GQibxYDAndbmkeH95SObD6onccC6Q3sRIFwgvRA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;5.2 Yarn Web UI&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.08083140877598152&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaufUw3T71PTZvPdMAfKZ9D4q1PqMxd66jujgVTEneGXNBWUG7ZPInN4Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;5.3 Flinksql Client 启动命令&lt;br/&gt;&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;shell&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;$FLINK_HOME/bin/sql-client.sh embedded -j ./lib/hudi-flink-bundle_2.&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;0.10&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;-SNAPSHOT.jar shell&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;说明：-j指定hudi-flink 依赖jar&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6293302540415704&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiau7ZvlYpM0AYiakbHCVib2LScXWAgJZd4noqh5sPxsnF5ib0ngR1iana5juQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;Show table /show catalogs&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.3464203233256351&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauBCvbbibDtibsXB2ekqfTKaYljicIYzWr3MMFn7eldRgdmjxnQUXpkiawicQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h2&gt;6. MySQL binlog 开启配置&lt;br/&gt;&lt;/h2&gt;&lt;h3&gt;6.1 创建binlog日志存储路径&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;shell&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;mkdir logs&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;6.2 修改目录属主和group&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;shell&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;chown -R mysql:mysql /mysqldata/logs&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;6.3 修改mysql配置信息&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;shell&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;vim /etc/&lt;/span&gt;&lt;span&gt;my&lt;/span&gt;&lt;span&gt;.cnf&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code/&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;server-id=&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;log-bin= &lt;/span&gt;&lt;span&gt;/mysqldata/&lt;/span&gt;&lt;span&gt;logs/mysql-bin&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;binlog_format=row&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;expire_logs_days=&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;binlog_row_image=full&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;6.4 修改完，重启mysql server&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;shell&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;service mysqld restart&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;6.5 客户端查看binlog日志情况&lt;/h3&gt;&lt;p&gt;show master logs;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.44028776978417267&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiau5O64KL3B1peSictqVDJKtDA8BHoA8fJC2ab891WGiavzQJ68icoycZ84g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;695&quot;/&gt;&lt;/p&gt;&lt;p&gt;Mysql 版本：5.7.30&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.38190184049079756&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiausWFMjw5c3wYx3CQg4pabPMyBGVt81w8VmOjYoP30QIyQ1NsxdiciadrQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;652&quot;/&gt;&lt;/p&gt;&lt;h3&gt;5.6 创建mysql sources 表 DDL&lt;br/&gt;&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;create table users_cdc(&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;   id bigint auto_increment primary key,&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;   name varchar(&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;&lt;span&gt;) &lt;/span&gt;&lt;span&gt;null&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;   birthday timestamp &lt;/span&gt;&lt;span&gt;default&lt;/span&gt;&lt;span&gt; CURRENT_TIMESTAMP &lt;/span&gt;&lt;span&gt;notnull&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;   ts timestamp &lt;/span&gt;&lt;span&gt;default&lt;/span&gt;&lt;span&gt; CURRENT_TIMESTAMP &lt;/span&gt;&lt;span&gt;notnull&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.5034387895460798&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaudiajSm3SYGDqibP0XmGHKHuwg4Kyw3DibJjU2QUV9sMxjicFSlOUqb2oYQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;727&quot;/&gt;&lt;/p&gt;&lt;h2&gt;7. FlinkCDC sink Hudi测试代码过程&lt;br/&gt;&lt;/h2&gt;&lt;h4&gt;7.1 Flink sql cdc DDL 语句：（具体参数说明可参考flink官网）&lt;/h4&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;CREATE TABLE mysql_users (&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    id BIGINT PRIMARY KEY NOT ENFORCED ,&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    name STRING,&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;    birthday TIMESTAMP(&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;&lt;span&gt;),&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;    ts TIMESTAMP(&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;) WITH (&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&#x27;connector&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;mysql-cdc&#x27;&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&#x27;hostname&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;127.0.0.1&#x27;&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&#x27;port&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;3306&#x27;&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&#x27;username&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;&#x27;&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&#x27;password&#x27;&lt;/span&gt;&lt;span&gt;=’’,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&#x27;server-time-zone&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;Asia/Shanghai&#x27;&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&#x27;debezium.snapshot.mode&#x27;&lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt;&#x27;initial&#x27;&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&#x27;database-name&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;luo&#x27;&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&#x27;table-name&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;users_cdc&#x27;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.7933025404157044&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauy0omby1LiccCn3oCoTvd3UAZdQh187H2CedIp9KevHkBg6we7LhtQDw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.2 查询mysql cdc 表&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;Flink SQL&amp;gt; select * from mysql_users;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.09815242494226328&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaujWtE6wWetORuAyP41GyRibpHqxYaicuYjvU1f9urGfiaGEuwibbLlmH1Ww/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;由于目前MySQL users_cdc表是空，所以flinksql 查询没有数据 只有表结构；&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.1674364896073903&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauPmRC9eNM93n9Axat8WYuibICiaMchdZnn92r6SKNgFHOGOlHDfJib1FVQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;Flink web UI：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.23094688221709006&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauGLJSLBYcZlmq2ibBe38agMl9zsd5VQxnibS2ia2xGD5UlJcC1QSmXozrA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.40877598152424943&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauW3hffNPP4GzSPzViaYqjsqQq326WsQLae9IwRoyTQ2jiaucnw7g42GQw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.3 创建一个临时视图，增加分区列 方便后续同步hive分区表&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;Flink SQL&amp;gt; create view mycdc_v AS SELECT *, DATE_FORMAT(birthday, &#x27;yyyyMMdd&#x27;) as &lt;code&gt;partition&lt;/code&gt; FROM mysql_users;&lt;/p&gt;&lt;p&gt;说明：partition 关键字需要 `` 引起来&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.23325635103926096&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauokxN7BJfbOyE5Qziagyc1ibfGbrOzfbriaRRavkoqIR4HCVfMTdEkzjXg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;查询视图数据也是空结构，但增加了分区字段：&lt;/p&gt;&lt;p&gt;Flink SQL&amp;gt; select * from mycdc_v;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.10508083140877598&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauJLtSpOXYSXaNI6W6OSEH0PdSVHXebSkI1De1bSib9ic3CF4sCoWs265Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.151270207852194&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaukR2qGjSmickFsRuojtPcqgu2T90xQ9ic9JuwlYCbEHicaNEjqeD3GgeyQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;Flink web UI：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.4064665127020785&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiau0mkFZcbwmec8dicjLUmEmJa1JVqf3SdYibyibd4GgeHQDbZTtzxFCiciayQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.4 设置checkpoint间隔时间，存储路径已在flink-conf配置设置全局路径&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;建议:测试环境 可设置秒级别（不能太小），生产环境可设置分钟级别。&lt;/p&gt;&lt;p&gt;Flink SQL&amp;gt; set execution.checkpointing.interval=30sec;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.15741935483870967&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauqBvjNSzeW9CyoEYKiaW8IBsrUXERb0gDvyq3pvUNiaVbKNBw2xa7oZMQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;775&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.5 Flinksql 创建 cdc sink hudi文件，并自动同步hive分区表DDL 语句&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;CREATE TABLE mysqlcdc_sync_hive01(&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;id bigint ,&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;name &lt;/span&gt;&lt;span&gt;string&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;birthday TIMESTAMP(&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;&lt;span&gt;),&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;ts TIMESTAMP(&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;&lt;span&gt;),&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;`partition`&lt;/span&gt;&lt;span&gt; VARCHAR(&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;&lt;span&gt;),&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;primary key(id) &lt;/span&gt;&lt;span&gt;not&lt;/span&gt;&lt;span&gt; enforced --必须指定uuid 主键&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;PARTITIONED BY (&lt;/span&gt;&lt;span&gt;`partition`&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;with&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&#x27;connector&#x27;&lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt;&#x27;hudi&#x27;&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;&#x27;path&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;hdfs://nameservice /luo/hudi/mysqlcdc_sync_hive01&#x27;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;hoodie.datasource.write.recordkey.field&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;id&#x27;&lt;/span&gt;&lt;span&gt;-- 主键&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;write.precombine.field&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;ts&#x27;&lt;/span&gt;&lt;span&gt;-- 自动precombine的字段&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;write.tasks&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;1&#x27;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;compaction.tasks&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;1&#x27;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;write.rate.limit&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;2000&#x27;&lt;/span&gt;&lt;span&gt;-- 限速&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;table.type&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;MERGE_ON_READ&#x27;&lt;/span&gt;&lt;span&gt;-- 默认COPY_ON_WRITE,可选MERGE_ON_READ &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;compaction.async.enabled&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;true&#x27;&lt;/span&gt;&lt;span&gt;-- 是否开启异步压缩&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;compaction.trigger.strategy&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;num_commits&#x27;&lt;/span&gt;&lt;span&gt;-- 按次数压缩&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;compaction.delta_commits&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;1&#x27;&lt;/span&gt;&lt;span&gt;-- 默认为&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;changelog.enabled&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;true&#x27;&lt;/span&gt;&lt;span&gt;-- 开启changelog变更&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;read.streaming.enabled&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;true&#x27;&lt;/span&gt;&lt;span&gt;-- 开启流读&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;read.streaming.check-interval&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;3&#x27;&lt;/span&gt;&lt;span&gt;-- 检查间隔，默认&lt;/span&gt;&lt;span&gt;60s&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;hive_sync.enable&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;true&#x27;&lt;/span&gt;&lt;span&gt;-- 开启自动同步hive&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;hive_sync.mode&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;hms&#x27;&lt;/span&gt;&lt;span&gt;-- 自动同步hive模式，默认jdbc模式&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;hive_sync.metastore.uris&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;thrift://hadoop:9083&#x27;&lt;/span&gt;&lt;span&gt;-- hive metastore地址&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;-- , &lt;/span&gt;&lt;span&gt;&#x27;hive_sync.jdbc_url&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;jdbc:hive2://hadoop:10000&#x27;&lt;/span&gt;&lt;span&gt;-- hiveServer地址&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;hive_sync.table&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;mysqlcdc_sync_hive01&#x27;&lt;/span&gt;&lt;span&gt;-- hive 新建表名&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;hive_sync.db&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;luo&#x27;&lt;/span&gt;&lt;span&gt;-- hive 新建数据库名&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;hive_sync.username&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;&#x27;&lt;/span&gt;&lt;span&gt;-- HMS 用户名&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;hive_sync.password&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;&#x27;&lt;/span&gt;&lt;span&gt;-- HMS 密码&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;&#x27;hive_sync.support_timestamp&#x27;&lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;&#x27;true&#x27;&lt;/span&gt;&lt;span&gt;-- 兼容hive timestamp类型&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h4&gt;说明：Hudi目前支持MOR和COW两种模式&lt;/h4&gt;&lt;p&gt;（1） Copy on Write:使用列式存储来存储数据（例如：parquet）,通过在写入期间执行同步合并来简单地更新和重现文件&lt;/p&gt;&lt;p&gt;（2） Merge on Read:使用列式存储（parquet）+行式文件（arvo）组合存储数据。更新记录到增量文件中，然后进行同步或异步压缩来生成新版本的列式文件。&lt;/p&gt;&lt;p&gt;COW：Copy on Write （写时复制）,快照查询+增量查询&lt;/p&gt;&lt;p&gt;MOR：Merge on Read （读时合并），快照查询+增量查询+读取优化查询（近实时）&lt;/p&gt;&lt;p&gt;使用场景上：&lt;/p&gt;&lt;p&gt;（1）COW适用写少读多的场景 ，MOR 适用写多读少的场景；&lt;/p&gt;&lt;p&gt;（2）MOR适合CDC场景，更新延迟要求较低，COW目前不支持 changelog mode 不适合处理cdc场景；&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.7217090069284064&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauOfN92AdobE0mS4Iyt1bob6zwjg9NjhzModiaOTlF5Iq1X1zleYrSgSQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6893764434180139&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauFuwMaR102uedNdqekLokO9Q4uEcJ5Zsq5c15bSSvRAbopyAtaANtMg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;Flink web UI&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.44226327944572746&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauaP3CA9E0v1OibhLibicq4fLJ9iaubycfXv2oicrkpghY1CIic17sQiaP14SNg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.6 Flink sql mysql cdc数据写入hudi文件数据&lt;/h3&gt;&lt;p&gt;Flink SQL&amp;gt; insert into mysqlcdc_sync_hive01 select id,name,birthday,ts,&lt;code&gt;partition&lt;/code&gt; from mycdc_v;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.13163972286374134&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauJVibC2T6qBl4VbYicrlkwbZxHWjAO52OsBmDDK5Fcwpr46xhgEhlHsAw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;Flink web UI DAG图：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.46882217090069284&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauIHmiaQic05OYyXj80Q7eSxTFbCrhaE0q4shoW0IdicicC1LR8tnu6DcpcA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.7 HDFS上Hudi文件目录情况&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.40415704387990764&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauEWzVcOOjyFicXpuzATdUzJRVn43zMLAlhgTUWpdVlBboQOLOJ3du5ow/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.535796766743649&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauXsh3osKvu5dlnzia5HibuYod3WmrUr3efLSCiakdf6iaicMJbf9T4TvNnkw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;说明：目前还没写入测试数据，hudi目录只生成一些状态标记文件，还未生成分区目录以及.log 和.parquet数据文件，具体含义可见hudi官方文档。&lt;/p&gt;&lt;h3&gt;7.8 Mysql数据源写入测试数据&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;insert &lt;/span&gt;&lt;span&gt;into&lt;/span&gt;&lt;span&gt; users_cdc (name) values (&lt;/span&gt;&lt;span&gt;&#x27;cdc01&#x27;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.5715935334872979&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauQxRdv1kWeM6k8aoHfY6ONiaqNjUKGW9tC4CKMcyCiaxUG4Vibreo2D6TQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.9 Flinksql 查询mysql cdc insert数据：&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;Flink SQL&amp;gt; set execution.result-mode=tableau;&lt;/p&gt;&lt;p&gt;[WARNING] The specified key &#x27;execution.result-mode&#x27; is deprecated. Please use &#x27;sql-client.execution.result-mode&#x27; instead.&lt;/p&gt;&lt;p&gt;[INFO] Session property has been set.&lt;/p&gt;&lt;p&gt;Flink SQL&amp;gt; select * from mysql_users; -- 查询到一条insert数据&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.2540415704387991&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauycKRdVjco3CEUCsBFh1YfvostaO3TWjLBhzTgicjj5fCCwrkbveEBTw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.10 Flink web UI页面可以看到DAG 各个环节产生一条测试数据&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.4491916859122402&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiau6icbUGRJHw6Q9fXM2a8bDr0pUGC5qCXMfUOcccYZljjFsvISiciacVicqQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.11 Flinksql 查询 sink的hudi表数据&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;Flink SQL&amp;gt; select * from mysqlcdc_sync_hive01; --已查询到一条insert数据&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.12471131639722864&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauE8CrZ7c25O0SX1M5PV9qN3iaV8ZQl7x3qNlxjryRMhjFgqFajtRj0Ug/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.12 Hdfs上Hudi文件目录变化情况&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6951501154734411&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauWARPcMicLxKmHnCZeebADEEF8CVVaKCMxzicYwxNUnVibmXjK5cFReMVg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.13 Hive分区表和数据自动同步情况&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6004618937644342&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauPlsmZ8Ecicn9btJGyYw5yAbK605ZOnnt0QBI5esdPDNowWpma9s3mVg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.14 查看自动创建hive表结构&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;&lt;span&gt;hive&amp;gt; show create table mysqlcdc_sync_hive01_ro;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6085450346420324&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaug4Z1RTlniciauTlaf2BbVSdKTGl8RiaE9CuictPRBXP3LJDdYPnggP3jQQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;hive&amp;gt; show create table mysqlcdc_sync_hive01_rt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6270207852193995&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauyoyWoNF9ZBLxeqRnib1bMKPCJUwr6GP4k3yJicfCTOwPc1aicRuoPCBpA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.15 查看自动生成的表分区信息&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;hive&amp;gt; show partitions mysqlcdc_sync_hive01_ro;&lt;/p&gt;&lt;p&gt;hive&amp;gt; show partitions mysqlcdc_sync_hive01_rt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.4468822170900693&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauJHFhYFVdNrCEGUeLzZ7FokfuG1r5Vt1ch83EpUM46pwibwwgiasCzolA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;说明：已自动生产hudi MOR模式的&lt;/p&gt;&lt;p&gt;mysqlcdc_sync_hive01_ro&lt;/p&gt;&lt;p&gt;mysqlcdc_sync_hive01_rt&lt;/p&gt;&lt;h4&gt;ro表和rt表区别：&lt;/h4&gt;&lt;p&gt;ro 表全称 read oprimized table，对于 MOR 表同步的 xxx_ro 表，只暴露压缩后的 parquet。其查询方式和COW表类似。设置完 hiveInputFormat 之后 和普通的 Hive 表一样查询即可；&lt;/p&gt;&lt;p&gt;rt表示增量视图，主要针对增量查询的rt表；&lt;/p&gt;&lt;p&gt;ro表只能查parquet文件数据， rt表 parquet文件数据和log文件数据都可查；&lt;/p&gt;&lt;h3&gt;7.16 Hive访问Hudi数据&lt;/h3&gt;&lt;p&gt;说明：需要引入hudi-hadoop-mr-bundle-0.10.0-SNAPSHOT.jar&lt;/p&gt;&lt;h4&gt;引入Hudi依赖jar方式:&lt;/h4&gt;&lt;p&gt;(1) 引入到 $HIVE_HOME/lib下；&lt;/p&gt;&lt;p&gt;(2) 引入到$HIVE_HOME/auxlib 自定义第三方依赖 修改 hive-site.xml配置文件；&lt;/p&gt;&lt;p&gt;(3) Hive shell命令行引入 Session级别有效；&lt;/p&gt;&lt;p&gt;其中（1）和（3）配置完后需要重启 hive-server服务;&lt;/p&gt;&lt;h4&gt;查询Hive 分区表数据：&lt;/h4&gt;&lt;p&gt;hive&amp;gt; select * from mysqlcdc_sync_hive01_ro; --已查询到mysq insert的一条数据&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6374133949191686&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauCvo8HVw37VZUBNnYfSkIvvkEcLaU3rQzOPiaZqG2ZseMVXSibPprT7dA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;hive&amp;gt; select * from mysqlcdc_sync_hive01_rt; --已查询到mysq insert的一条数据&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6397228637413395&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauHgtYkWmG1AMvDAwB3efz1r8Dfic7dqPicSBTa7xHqLFWeVicyfWNicjDQg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h4&gt;Hive 条件查询：&lt;br/&gt;&lt;/h4&gt;&lt;p&gt;hive&amp;gt; select name,ts from mysqlcdc_sync_hive01_ro where &lt;code&gt;partition&lt;/code&gt;=&#x27;20211109&#x27;;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6397228637413395&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauXBbqiaXVZuw08ibK1ZQzzsIS1GgTjCnMzxeylyRwUEU37GL0NlYKhCng/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h4&gt;Hive ro表 count查询&lt;/h4&gt;&lt;p&gt;hive&amp;gt; select count(1) from mysqlcdc_sync_hive01_ro;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6824480369515011&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaufB40icHzB0qJW001z3pRbqUEUODGADQHZw3V2QJoqIxgbElTUCwFC1Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;Hive Count异常解决：&lt;/h4&gt;&lt;p&gt;引入hudi-hadoop-mr-bundle-0.10.0-SNAPSHOT.jar依赖&lt;/p&gt;&lt;p&gt;hive&amp;gt; add jar hdfs://nameservice /luo/hudi-hadoop-mr-bundle-0.10.0-SNAPSHOT.jar;&lt;/p&gt;&lt;p&gt;hive&amp;gt; set hive.input.format = org.apache.hudi.hadoop.hive.HoodieCombineHiveInputFormat;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.20438799076212472&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaukVpIib7RbMJicBKt5Fg0SomQuCmwZAeN1ibklgiczNLUyc36HrNlKvb6HA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;hive&amp;gt; select count(1) from mysqlcdc_sync_hive01_ro; --可正常count&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6004618937644342&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiau4Rh2LR2208uUgPgtYJRXXGN7RJ7ylsUCEfkBskdsFcjicoTic81qA4gw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;Hive rt表 count查询&lt;/h4&gt;&lt;p&gt;hive&amp;gt; select count(1) from mysqlcdc_sync_hive01_rt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6732101616628176&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiautMtoIqwM63mh4Fwibzqx7telIryqRWoZrqU7nicbCXhelJhYwluiauC4Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;p&gt;说明：rt 表count 还是异常，和Hudi社区人员沟通hudi master目前还没release这块存在bug正在修复中&lt;/p&gt;&lt;p&gt;具体见：https://issues.apache.org/jira/browse/HUDI-2649&lt;/p&gt;&lt;h3&gt;7.17 Mysql 数据源写入多条测试数据&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;insert &lt;/span&gt;&lt;span&gt;into&lt;/span&gt;&lt;span&gt; users_cdc (name) values (&lt;/span&gt;&lt;span&gt;&#x27;cdc02&#x27;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;insert &lt;/span&gt;&lt;span&gt;into&lt;/span&gt;&lt;span&gt; users_cdc (name) values (&lt;/span&gt;&lt;span&gt;&#x27;cdc03&#x27;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;insert &lt;/span&gt;&lt;span&gt;into&lt;/span&gt;&lt;span&gt; users_cdc (name) values (&lt;/span&gt;&lt;span&gt;&#x27;cdc04&#x27;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;insert &lt;/span&gt;&lt;span&gt;into&lt;/span&gt;&lt;span&gt; users_cdc (name) values (&lt;/span&gt;&lt;span&gt;&#x27;cdc05&#x27;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;insert &lt;/span&gt;&lt;span&gt;into&lt;/span&gt;&lt;span&gt; users_cdc (name) values (&lt;/span&gt;&lt;span&gt;&#x27;cdc06&#x27;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.819672131147541&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauRRzRmUnrqXJJDlQBdOF3ddvORmeicyykLjAWGYAiaxGr5iamPGX9YGSIw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;793&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;Flink web UI DAG中数据链路情况：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.45381062355658197&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauicSgEcZGFxXAicgfbicce2ia9nTbvh9LN1BiaR7trGxs9ekvibvBySOeNZ6Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.18 Flinksql中新写入数据查询情况&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.1651270207852194&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaublb636wnOXibMdMW5BgiatkJ419KrxwkevtUuMOicFbrI5MXGpK8ltQDw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h4&gt;Yarn web UI &lt;span&gt;application_1626256835287_40351&lt;sup&gt;[1]&lt;/sup&gt;&lt;/span&gt;资源使用情况&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.08314087759815242&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauYVyt1DZOicnPic7K6uYYEmmrGZSNWQCBdcoPb6kkm0mg4vGkmtUPckUg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;Hdfs上Hudi文件目录变化情况&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.7505773672055427&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauHYnQ9HyuV01WncZvEiawcotXg6ugQwCcGbic4BQwq1oHicZiaH4JmNZgfA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;Hudi状态文件说明：&lt;/h4&gt;&lt;p&gt;（1）requested:表示一个动作已被安排，但尚未启动&lt;/p&gt;&lt;p&gt;（2）inflight:表示当前正在执行操作&lt;/p&gt;&lt;p&gt;（3）completed:表示在时间线上完成了操作&lt;/p&gt;&lt;h4&gt;Flink jobmanager log sync hive过程详细日志&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.4618937644341801&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauO7icJbg5D5wLicHxHSoJ4ZibCJFv3pO1Qiaiba5Pc2SVCw0nBk7FyfZ4SFA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.46420323325635104&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauxqwHDePN6aevTPD25lrcOxcXtYRKe2XHg02PeBZPT1XdiatfbKRGucg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.46420323325635104&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauiaXhX5HKicjG5ZDnic3SIKmfMq2iaDqUuSnPVDtmvQ5QfQ6P08jSJOcV1A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3&gt;7.19 Mysql 数据源更新数据&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;update users_cdc &lt;/span&gt;&lt;span&gt;set&lt;/span&gt;&lt;span&gt; name = &lt;/span&gt;&lt;span&gt;&#x27;cdc05-bj&#x27;&lt;/span&gt;&lt;span&gt;where&lt;/span&gt;&lt;span&gt; id = &lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;1.0216606498194947&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauDH28VCNq4arXHgQIftqkQYSkQiaHlOsFX1Nu0O5Iz9HWa2Vxjj9rBFg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;831&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3&gt;7.20 Flinksql 查询cdc update数据 产生两条binlog数据&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.32217090069284066&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauPHicAtwLfBE76X21Lj1TB57mgy5SFbPiaXIya7OnD40Micjc7CZtPtziaA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;说明：flinksql 查询最终只有一条+I有效数据，且数据已更新&lt;/p&gt;&lt;p&gt;Flink web UI DAG接受到两条binlog数据，但最终compact和sink只有一条有效数据&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.4515011547344111&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaut5z99w1EMdYUZkru5Kqliaj51LNuadUib9pDdgb2aKLOaVsniaOIDicM2A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3&gt;7.21 MySQL 数据源 delete 一条数据：&lt;/h3&gt;&lt;section class=&quot;code-snippet__github&quot;&gt;&lt;pre data-lang=&quot;sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span&gt;deletefrom&lt;/span&gt;&lt;span&gt; users_cdc &lt;/span&gt;&lt;span&gt;where&lt;/span&gt;&lt;span&gt; id = &lt;/span&gt;&lt;span&gt;3&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.894919168591224&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauRRzU9yFuGrrxbPsnuL1RAyIckKQ9Uo0jRKpgMstSoozH4mGANaVd5g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;Flink Web UI job DAG中捕获一条新数据：&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.45381062355658197&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauwjWAPbHgsoBkbDtXYzQNENRYV74JZcpu7FW8kLKAUDVIbL1KtiazXbg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;Flinksql changlog delete数据变化查询&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.1489607390300231&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauBvkRgwHicYEPQY5XGmjJF4AoBJYVQRmarj9cJrxFa8flVBBvYa7mDjg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h4&gt;HDFS上Hudi数据文件生成情况&lt;br/&gt;&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.4330254041570439&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauHFHe0qARcHfriaP9Ing141tasPp9ibonGNRIxwrIXD5loTbygqJLPDeQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.9595842956120092&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaufP1HBUN13ia957mYhyQr3roJibL6xQmtX2AzgFjeLJBkzeDkB5icbCCNQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;Hudi文件类型说明：&lt;/h4&gt;&lt;p&gt;（1）commits: 表示将一批数据原子性写入表中&lt;/p&gt;&lt;p&gt;（2）cleans: 清除表中不在需要的旧版本文件的后台活动&lt;/p&gt;&lt;p&gt;（3）delta_commit:增量提交是指将一批数据原子性写入MergeOnRead类型的表中，其中部分或者所有数据可以写入增量日志中&lt;/p&gt;&lt;p&gt;（4）compaction: 协调hudi中差异数据结构的后台活动，例如：将更新从基于行的日志文件变成列格式。在内部，压缩的表现为时间轴上的特殊提交&lt;/p&gt;&lt;p&gt;（5）rollback:表示提交操作不成功且已经回滚，会删除在写入过程中产生的数据&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.7240184757505773&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauictVUUiaAJwRgWZBIj1LmMSjlhQX4A6EHTxXibZL30iazKLAqCP0B9N1uA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;strong&gt;说明：hudi分区文件以及.log和.parquet文件都已生成&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;两种文件区别：Hudi会在DFS分布式文件系统上的basepath基本路径下组织成目录结构。每张对应的表都会成多个分区，这些分区是包含该分区的数据文件的文件夹，与hive的目录结构非常相似。在每个分区内，文件被组织成文件组，文件id为唯一标识。每个文件组包含多个切片，其中每个切片包含在某个提交/压缩即时时间生成的基本列文件（parquet文件），以及自生成基本文件以来对基本文件的插入/更新的一组日志文件（*.log）。Hudi采用MVCC设计,其中压缩操作会将日志和基本文件合并成新的文件片，清理操作会将未使用/较旧的文件片删除来回收DFS上的空间。&lt;/strong&gt;&lt;/p&gt;&lt;h4&gt;Flink 任务checkpoint 情况：&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;设置30s 一次&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.34295612009237875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiausZRwuAYOvW2KdLian86sD1s7bEibdH3YqUL727vibAYDTPPOXvgL0LZXQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.4226327944572748&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiau4AN5sSWLZ5UQTG9XUHKzQicPaBtNrvyTDz1QicaUj2flpRrue7PwUsNg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3&gt;7.22 Hive shell查询数据update和delete变化情况：&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;hive&amp;gt; select * from mysqlcdc_sync_hive01_ro;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6108545034642032&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauNibBHNslKIzia9ePgm5ia4ZSwJJ2qbnugRsBbGPntWmZGkWxJC8ayw2UA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;strong&gt;hive&amp;gt; select * from mysqlcdc_sync_hive01_rt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6085450346420324&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaus47rZxxlO4f5f9tZ5JJrNJBZMuUSlSxNtSzIYaVnROnoGibGIf507og/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3&gt;7.23 Hudi Client端操作Hudi表&lt;/h3&gt;&lt;h4&gt;进入Hudi客户端命令行：&lt;/h4&gt;&lt;p&gt;hudi-master/hudi-cli/hudi-cli.sh&lt;/p&gt;&lt;h4&gt;连接Hudi表，查看表信息&lt;/h4&gt;&lt;p&gt;hudi-&amp;gt;connect --path hdfs://nameservice1/tmp/luo/hudi/mysqlcdc_sync_hive01&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.5912240184757506&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaueickayAm9qqCJHqUSs4sh7riancYIZIfYJvRH4DJ5cGehd8PWrcoGIiaA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;查看Hudi commit信息&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;hudi:mysqlcdc_sync_hive01-&amp;gt;commits show --sortBy &quot;CommitTime&quot;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.5092378752886836&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiaucDyjFH7EXCbrH1sXfPgNcrk2IRJicj9Qgic2q741lgWhIbKnCSTXk3pQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;span&gt;查看Hudi compactions 计划&lt;/span&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;strong&gt;hudi:mysqlcdc_sync_hive01-&amp;gt;compactions show all&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.36027713625866054&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauxbUlEw9KyBRjUEHyt23guAy3Vrx9Jvbmj0Vvv1qxEwJmPGYGVYiaMjw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;h3&gt;7.24 PrestoDB 查询Hive表Hudi数据&lt;/h3&gt;&lt;h4&gt;版本说明：PrestoDB 0.256 DBeaver7.0.4&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;PrestoDB 集群配置和hive集成参考PrestoDB官网&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;presto-server-***/etc/catalog/hive.properties 配置hive catalog&lt;/p&gt;&lt;h4&gt;可通过 presto-cli 连接 hive metastore 开启查询，presto-cli 的设置参考 presto官方配置；&lt;/h4&gt;&lt;h4&gt;DBeaver客户端查询Hive ro表数据：&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.31986143187066973&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauMQVSRE7HAhvewLB6n8tgibR9d1whJQapexEG9xJ7yoSFpfaDO9kOBTw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;Hive ro表count 正常：&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.778698224852071&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauLY08kOa4fvONzhjtgs5nqUsBRf0NuSTMKuKKibOquUA3nSDtT05b1cQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;845&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;查询Hive rt表数据查询异常：&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.3002309468822171&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauWLqsj3cyUFXicaJTJibmPT5BGYtYsUle8YBkYFOKxicLwoxzSyhjkGWTg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;Hive rt表count异常：&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6085450346420324&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiau1JX1m07QjmHcxGlCw6ch6bBXatqDFZJjyibxYvjBpeg5hIrllmeziaUg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;Presto Web ui:&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.302540415704388&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauBcBIBicKiavVgeAf2RibjibacXtq9HRgkwIQBLhaqhc5q4ATWgcrCibozCg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.4445727482678984&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/brR21T72gFric1Shnb8Czddp0yXVveFiauIa4jzBHh94u7sxdWDjMA7ibnNSzZwJIB2mFfDREMAbQajg0sfs193rA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;866&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h4&gt;&lt;em&gt;推荐阅读&lt;/em&gt;&lt;/h4&gt;&lt;p&gt;&lt;em&gt;&lt;br/&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzIyMzQ0NjA0MQ==&amp;amp;mid=2247487340&amp;amp;idx=2&amp;amp;sn=415daa6ea64cc0c6059fa84b90d24488&amp;amp;chksm=e81f5a1adf68d30c4d15a484610a57139973834145bb45e82d7a15433ac836804f6663ea9ef8&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;超详细步骤！整合Apache Hudi + Flink + CDH&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;超详细步骤！整合Apache Hudi + Flink + CDH&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzIyMzQ0NjA0MQ==&amp;amp;mid=2247487284&amp;amp;idx=2&amp;amp;sn=f7619538ef6d9294cf0ba74a3cf62d2b&amp;amp;chksm=e81f5a42df68d354db06c8b24a54155a50d642e2d6a2aaac8e07967c235cbafdf821da1c56bc&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;Apache Kyuubi + Hudi在 T3 出行的深度实践&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;11&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;Apache Kyuubi + Hudi在 T3 出行的深度实践&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzIyMzQ0NjA0MQ==&amp;amp;mid=2247487212&amp;amp;idx=1&amp;amp;sn=b339dd98675dfc06a14f854bb06b5231&amp;amp;chksm=e81f5b9adf68d28c71796dbdda145590ce2c9a65213d58b72c78033bf61700036473b22e6ee2&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;Apache Hudi PMC畅谈Hudi未来演进之路&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;Apache Hudi PMC畅谈Hudi未来演进之路&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzIyMzQ0NjA0MQ==&amp;amp;mid=2247487099&amp;amp;idx=2&amp;amp;sn=e1add68a259eb2968da30d688033add7&amp;amp;chksm=e81f5b0ddf68d21bdf7658bdc7c4966f5454a2251fcade4369eda60458355006df6c840aeea9&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;顺丰科技 Hudi on Flink 实时数仓实践&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;11&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;顺丰科技 Hudi on Flink 实时数仓实践&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzIyMzQ0NjA0MQ==&amp;amp;mid=2247487070&amp;amp;idx=1&amp;amp;sn=c9a1be42e20cbbb510003fce9c8c322e&amp;amp;chksm=e81f5b28df68d23ecb93159c8323abadb6a51c3192f2a8f5224745cd438270dc704d61eb2736&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;一文彻底弄懂Apache Hudi不同表类型&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;一文彻底弄懂Apache Hudi不同表类型&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.52&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/3EcuPIickyyEwbzUrMVnXJaXicEHYVRUz1Xar9X3Tic8ZUNJ3IfuVNP8wUpaKiafwYOY6lfXjlYbcJUJklKI7psbsg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;750&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>1c435b3f452507ccd0fdb6f8bfed0642</guid>
<title>Go 工具开发：基于网站 API 的子域名与 IP 反查工具（一）</title>
<link>https://toutiao.io/k/aw4fa3e</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;http&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;GET&lt;/span&gt; &lt;span class=&quot;code-snippet__string&quot;&gt;/api/query?q=[ip或者域名]&amp;amp;token=[申请的token值]&lt;/span&gt; HTTP/2&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Host&lt;/span&gt;: www.dnsgrep.cn&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Cookie&lt;/span&gt;: UM_distinctid=17c89fa6562f0f-061b1aa8d7f106-6373267-1fa400-17c89fa6563847; CNZZDATA1279463756=1182095902-1634402460-%7C1634822243&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Sec-Ch-Ua&lt;/span&gt;: &quot;Chromium&quot;;v=&quot;91&quot;, &quot; Not;A Brand&quot;;v=&quot;99&quot;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Sec-Ch-Ua-Mobile&lt;/span&gt;: ?0&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Upgrade-Insecure-Requests&lt;/span&gt;: 1&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;User-Agent&lt;/span&gt;: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Accept&lt;/span&gt;: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Sec-Fetch-Site&lt;/span&gt;: none&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Sec-Fetch-Mode&lt;/span&gt;: navigate&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Sec-Fetch-User&lt;/span&gt;: ?1&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Sec-Fetch-Dest&lt;/span&gt;: document&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Accept-Language&lt;/span&gt;: zh-CN,zh;q=0.9&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Accept-Encoding&lt;/span&gt;: gzip, deflate&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;Connection&lt;/span&gt;: close&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;子域名格式：&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;{&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;status&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__number&quot;&gt;200&lt;/span&gt;,&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;data&quot;&lt;/span&gt;:{&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;data&quot;&lt;/span&gt;:[&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;            {&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;domain&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;wolai.com&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;value&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;139.196.188.106&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;A&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;time&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;2021-06-26&quot;&lt;/span&gt;},&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;            {&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;domain&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;wolai.com&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;value&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;5 mxbiz1.qq.com&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;MX&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;time&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;2021-06-28&quot;&lt;/span&gt;},&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;            {&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;domain&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;www.wolai.com&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;value&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;www.wolai.com.w.kunlunca.com&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;CNAME&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;time&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;2021-06-27&quot;&lt;/span&gt;}&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        ],&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;count&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__number&quot;&gt;16&lt;/span&gt;,&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    }&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;ip反查格式：&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;{&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;status&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__number&quot;&gt;200&lt;/span&gt;,&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;data&quot;&lt;/span&gt;:{&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;data&quot;&lt;/span&gt;:[&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;            {&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;domain&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;47.98.84.224&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;value&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;47.98.84.224&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;A&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;time&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;2021-06-25&quot;&lt;/span&gt;},&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;            {&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;domain&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;a.zhongan.com&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;value&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;47.98.84.224&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;A&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;time&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;2021-06-25&quot;&lt;/span&gt;},&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;            {&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;domain&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;zhongan-xflow-nginx.zhongan.com&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;value&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;47.98.84.224&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;A&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;time&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;2021-06-27&quot;&lt;/span&gt;},&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;            {&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;domain&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;zhongan.com&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;value&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;47.98.84.224&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;A&quot;&lt;/span&gt;,&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;time&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;2021-06-27&quot;&lt;/span&gt;}&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        ],&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;count&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__number&quot;&gt;24&lt;/span&gt;,&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-snippet__number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    }&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>